// <!--GAMFC--> version base on commit a96f610ec5bff10cf67b77fa538a4c92cff678f1, time is 2025-10-17 08:10:31 UTC<!--We are all REvil-->
// @ts-ignore

import{connect}from'cloudflare:sockets';const Config={'proxyIPs':[''],'fromEnv'(a){const b=a['PROXYIP']||this['proxyIPs'][Math['floor'](Math['random']()*this['proxyIPs']['length'])];return{'proxyAddress':b};}},CONST={'VLESS_VERSION':new Uint8Array([0x0]),'WS_READY_STATE_OPEN':0x1,'securityHeaders':{'Content-Security-Policy':'default-src\x20\x27self\x27;\x20style-src\x20\x27self\x27\x20\x27unsafe-inline\x27\x20https://fonts.googleapis.com;\x20font-src\x20\x27self\x27\x20https://fonts.gstatic.com;\x20script-src\x20\x27self\x27\x20\x27unsafe-inline\x27\x20https://cdnjs.cloudflare.com\x20https://cdn.jsdelivr.net;\x20img-src\x20\x27self\x27\x20data:\x20https://flagcdn.com;\x20connect-src\x20\x27self\x27\x20https://ip-api.io\x20https://dns.google;\x20object-src\x20\x27none\x27;\x20base-uri\x20\x27self\x27;\x20form-action\x20\x27self\x27;','X-Content-Type-Options':'nosniff','X-Frame-Options':'DENY','Referrer-Policy':'no-referrer','Strict-Transport-Security':'max-age=31536000;\x20includeSubDomains;\x20preload'}},getAdminPanelScript=a=>'\x0a\x20\x20\x20\x20(function()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20document.addEventListener(\x27DOMContentLoaded\x27,\x20()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20API_BASE\x20=\x20\x27/admin/api\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20let\x20allUsers\x20=\x20[];\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20let\x20currentUsers\x20=\x20[];\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20userList\x20=\x20document.getElementById(\x27userList\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20createUserForm\x20=\x20document.getElementById(\x27createUserForm\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20generateUUIDBtn\x20=\x20document.getElementById(\x27generateUUID\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20uuidInput\x20=\x20document.getElementById(\x27uuid\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20toast\x20=\x20document.getElementById(\x27toast\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20editModal\x20=\x20document.getElementById(\x27editModal\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20editUserForm\x20=\x20document.getElementById(\x27editUserForm\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20searchInput\x20=\x20document.getElementById(\x27searchInput\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20dashboardStats\x20=\x20document.getElementById(\x27dashboardStats\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20pagination\x20=\x20document.getElementById(\x27pagination\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20let\x20currentPage\x20=\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20pageSize\x20=\x2010;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20let\x20searchDebounceTimer;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20let\x20chartInstance\x20=\x20null;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20CSRF_TOKEN\x20=\x20\x22'+a+'\x22;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20showToast(message,\x20isError\x20=\x20false)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20toast.textContent\x20=\x20message;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20toast.className\x20=\x20isError\x20?\x20\x27error\x27\x20:\x20\x27success\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20toast.classList.add(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setTimeout(()\x20=>\x20{\x20toast.classList.remove(\x27show\x27);\x20},\x205000);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20api\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20get:\x20(endpoint)\x20=>\x20fetch(`${API_BASE}${endpoint}`,\x20{\x20credentials:\x20\x27include\x27\x20}).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20post:\x20(endpoint,\x20body)\x20=>\x20fetch(`${API_BASE}${endpoint}`,\x20{\x20method:\x20\x27POST\x27,\x20credentials:\x20\x27include\x27,\x20headers:\x20{\x20\x27Content-Type\x27:\x20\x27application/json\x27,\x20\x27X-CSRF-Token\x27:\x20CSRF_TOKEN\x20},\x20body:\x20JSON.stringify(body)\x20}).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20put:\x20(endpoint,\x20body)\x20=>\x20fetch(`${API_BASE}${endpoint}`,\x20{\x20method:\x20\x27PUT\x27,\x20credentials:\x20\x27include\x27,\x20headers:\x20{\x20\x27Content-Type\x27:\x20\x27application/json\x27,\x20\x27X-CSRF-Token\x27:\x20CSRF_TOKEN\x20},\x20body:\x20JSON.stringify(body)\x20}).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20delete:\x20(endpoint)\x20=>\x20fetch(`${API_BASE}${endpoint}`,\x20{\x20method:\x20\x27DELETE\x27,\x20credentials:\x20\x27include\x27,\x20headers:\x20{\x20\x27X-CSRF-Token\x27:\x20CSRF_TOKEN\x20}\x20}).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20handleResponse(response)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!response.ok)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20errorData\x20=\x20await\x20response.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20console.error(\x22API\x20Error\x20Response:\x22,\x20errorData);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20detailedError\x20=\x20errorData.error\x20+\x20(errorData.cause\x20?\x20`\x20(Cause:\x20${errorData.cause})`\x20:\x20\x27\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20throw\x20new\x20Error(detailedError);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(e)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20textResponse\x20=\x20await\x20response.text();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20console.error(\x22Non-JSON\x20API\x20Error\x20Response:\x22,\x20textResponse);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20throw\x20new\x20Error(`Request\x20failed:\x20Status\x20${response.status}.\x20Server\x20returned\x20a\x20non-JSON\x20response.`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20response.status\x20===\x20204\x20?\x20null\x20:\x20response.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20pad\x20=\x20(num)\x20=>\x20num.toString().padStart(2,\x20\x270\x27);\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20localToUTC(dateStr,\x20timeStr)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!dateStr\x20||\x20!timeStr)\x20return\x20{\x20utcDate:\x20\x27\x27,\x20utcTime:\x20\x27\x27\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20localDateTime\x20=\x20new\x20Date(`${dateStr}T${timeStr}`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(isNaN(localDateTime))\x20return\x20{\x20utcDate:\x20\x27\x27,\x20utcTime:\x20\x27\x27\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20utcDate:\x20`${localDateTime.getUTCFullYear()}-${pad(localDateTime.getUTCMonth()\x20+\x201)}-${pad(localDateTime.getUTCDate())}`,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20utcTime:\x20`${pad(localDateTime.getUTCHours())}:${pad(localDateTime.getUTCMinutes())}:${pad(localDateTime.getUTCSeconds())}`\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20utcToLocal(utcDateStr,\x20utcTimeStr)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!utcDateStr\x20||\x20!utcTimeStr)\x20return\x20{\x20localDate:\x20\x27\x27,\x20localTime:\x20\x27\x27\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20utcDateTime\x20=\x20new\x20Date(`${utcDateStr}T${utcTimeStr}Z`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(isNaN(utcDateTime))\x20return\x20{\x20localDate:\x20\x27\x27,\x20localTime:\x20\x27\x27\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20localDate:\x20`${utcDateTime.getFullYear()}-${pad(utcDateTime.getMonth()\x20+\x201)}-${pad(utcDateTime.getDate())}`,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20localTime:\x20`${pad(utcDateTime.getHours())}:${pad(utcDateTime.getMinutes())}:${pad(utcDateTime.getSeconds())}`\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20addExpiryTime(dateInputId,\x20timeInputId,\x20amount,\x20unit)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20dateInput\x20=\x20document.getElementById(dateInputId);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20timeInput\x20=\x20document.getElementById(timeInputId);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20let\x20date\x20=\x20new\x20Date(`${dateInput.value}T${timeInput.value\x20||\x20\x2700:00:00\x27}`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(isNaN(date.getTime()))\x20date\x20=\x20new\x20Date();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(unit\x20===\x20\x27hour\x27)\x20date.setHours(date.getHours()\x20+\x20amount);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20if\x20(unit\x20===\x20\x27day\x27)\x20date.setDate(date.getDate()\x20+\x20amount);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20if\x20(unit\x20===\x20\x27month\x27)\x20date.setMonth(date.getMonth()\x20+\x20amount);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20dateInput.value\x20=\x20`${date.getFullYear()}-${pad(date.getMonth()\x20+\x201)}-${pad(date.getDate())}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20timeInput.value\x20=\x20`${pad(date.getHours())}:${pad(date.getMinutes())}:${pad(date.getSeconds())}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.body.addEventListener(\x27click\x27,\x20(e)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20timeTarget\x20=\x20e.target.closest(\x27.time-quick-set-group\x20button\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(timeTarget)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20group\x20=\x20timeTarget.closest(\x27.time-quick-set-group\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20addExpiryTime(group.dataset.targetDate,\x20group.dataset.targetTime,\x20parseInt(timeTarget.dataset.amount,\x2010),\x20timeTarget.dataset.unit);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20dataTarget\x20=\x20e.target.closest(\x27.data-quick-set-group\x20button\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(dataTarget)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20gb\x20=\x20parseInt(dataTarget.dataset.gb,\x2010);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20form\x20=\x20dataTarget.closest(\x27form\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20valueInput\x20=\x20form.querySelector(\x27input[type=\x22number\x22][id*=\x22DataLimitValue\x22]\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20unitInput\x20=\x20form.querySelector(\x27select[id*=\x22DataLimitUnit\x22]\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(valueInput\x20&&\x20unitInput)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20valueInput.value\x20=\x20gb;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20unitInput.value\x20=\x20\x27GB\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20formatExpiryDateTime(expDateStr,\x20expTimeStr)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20expiryUTC\x20=\x20new\x20Date(`${expDateStr}T${expTimeStr}Z`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(isNaN(expiryUTC))\x20return\x20{\x20local:\x20\x27Invalid\x20Date\x27,\x20tehran:\x20\x27\x27,\x20relative:\x20\x27\x27,\x20isExpired:\x20true\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20now\x20=\x20new\x20Date();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20isExpired\x20=\x20expiryUTC\x20<\x20now;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20rtf\x20=\x20new\x20Intl.RelativeTimeFormat(\x27en\x27,\x20{\x20numeric:\x20\x27auto\x27\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20diffSeconds\x20=\x20(expiryUTC.getTime()\x20-\x20now.getTime())\x20/\x201000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20let\x20relativeTime\x20=\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(Math.abs(diffSeconds)\x20<\x203600)\x20relativeTime\x20=\x20rtf.format(Math.round(diffSeconds\x20/\x2060),\x20\x27minute\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20if\x20(Math.abs(diffSeconds)\x20<\x2086400)\x20relativeTime\x20=\x20rtf.format(Math.round(diffSeconds\x20/\x203600),\x20\x27hour\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20relativeTime\x20=\x20rtf.format(Math.round(diffSeconds\x20/\x2086400),\x20\x27day\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20local:\x20expiryUTC.toLocaleString(undefined,\x20{\x20year:\x20\x27numeric\x27,\x20month:\x20\x272-digit\x27,\x20day:\x20\x272-digit\x27,\x20hour:\x20\x272-digit\x27,\x20minute:\x20\x272-digit\x27\x20}),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20tehran:\x20expiryUTC.toLocaleString(\x27en-US\x27,\x20{\x20timeZone:\x20\x27Asia/Tehran\x27,\x20year:\x20\x27numeric\x27,\x20month:\x20\x272-digit\x27,\x20day:\x20\x272-digit\x27,\x20hour:\x20\x272-digit\x27,\x20minute:\x20\x272-digit\x27\x20}),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20relative:\x20relativeTime,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20isExpired:\x20isExpired\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20formatBytes(bytes,\x20decimals\x20=\x202)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(bytes\x20===\x20null\x20||\x20typeof\x20bytes\x20===\x20\x27undefined\x27\x20||\x20bytes\x20===\x200)\x20return\x20\x270\x20Bytes\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20k\x20=\x201024;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20dm\x20=\x20decimals\x20<\x200\x20?\x200\x20:\x20decimals;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20sizes\x20=\x20[\x27Bytes\x27,\x20\x27KB\x27,\x20\x27MB\x27,\x20\x27GB\x27,\x20\x27TB\x27];\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20i\x20=\x20Math.floor(Math.log(bytes)\x20/\x20Math.log(k));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20`${parseFloat((bytes\x20/\x20Math.pow(k,\x20i)).toFixed(dm))}\x20${sizes[i]}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20getDataLimitInBytes(value,\x20unit)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20numValue\x20=\x20parseFloat(value)\x20||\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(numValue\x20===\x200)\x20return\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20units\x20=\x20{\x20\x27KB\x27:\x201024,\x20\x27MB\x27:\x201024\x20**\x202,\x20\x27GB\x27:\x201024\x20**\x203,\x20\x27TB\x27:\x201024\x20**\x204\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20Math.round(numValue\x20*\x20(units[unit]\x20||\x200));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20setUnlimited(isEdit\x20=\x20false)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20prefix\x20=\x20isEdit\x20?\x20\x27edit\x27\x20:\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(`${prefix}DataLimitValue`).value\x20=\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(`${prefix}DataLimitUnit`).value\x20=\x20\x27GB\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20getDataLimitFromInputs(isEdit\x20=\x20false)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20prefix\x20=\x20isEdit\x20?\x20\x27edit\x27\x20:\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20getDataLimitInBytes(document.getElementById(`${prefix}DataLimitValue`).value,\x20document.getElementById(`${prefix}DataLimitUnit`).value);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20setDataLimitInputs(dataLimit,\x20isEdit\x20=\x20false)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20prefix\x20=\x20isEdit\x20?\x20\x27edit\x27\x20:\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20valueEl\x20=\x20document.getElementById(`${prefix}DataLimitValue`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20unitEl\x20=\x20document.getElementById(`${prefix}DataLimitUnit`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!dataLimit\x20||\x20dataLimit\x20===\x200)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20valueEl.value\x20=\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20unitEl.value\x20=\x20\x27GB\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20let\x20unit\x20=\x20\x27GB\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20let\x20value\x20=\x20dataLimit;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(value\x20>=\x201024\x20**\x204)\x20{\x20value\x20/=\x201024\x20**\x204;\x20unit\x20=\x20\x27TB\x27;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20if\x20(value\x20>=\x201024\x20**\x203)\x20{\x20value\x20/=\x201024\x20**\x203;\x20unit\x20=\x20\x27GB\x27;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20if\x20(value\x20>=\x201024\x20**\x202)\x20{\x20value\x20/=\x201024\x20**\x202;\x20unit\x20=\x20\x27MB\x27;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20{\x20value\x20/=\x201024;\x20unit\x20=\x20\x27KB\x27;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20valueEl.value\x20=\x20Number.isInteger(value)\x20?\x20value\x20:\x20value.toFixed(2);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20unitEl.value\x20=\x20unit;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20renderDashboardStats(stats)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20dashboardStats.innerHTML\x20=\x20`<div\x20class=\x22dashboard-stat\x22><h3>${stats.totalUsers}</h3><p>Total\x20Users</p></div><div\x20class=\x22dashboard-stat\x22><h3>${stats.activeUsers}</h3><p>Active\x20Users</p></div><div\x20class=\x22dashboard-stat\x22><h3>${stats.expiredUsers}</h3><p>Expired\x20Users</p></div><div\x20class=\x22dashboard-stat\x22><h3>${formatBytes(stats.totalTraffic)}</h3><p>Total\x20Traffic</p></div>`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20ctx\x20=\x20document.getElementById(\x27statsChart\x27).getContext(\x272d\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20style\x20=\x20getComputedStyle(document.documentElement);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(chartInstance)\x20chartInstance.destroy();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20chartInstance\x20=\x20new\x20Chart(ctx,\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20type:\x20\x27bar\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data:\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20labels:\x20[\x27Users\x27,\x20\x27Traffic\x27],\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20datasets:\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20{\x20label:\x20\x27Active\x27,\x20data:\x20[stats.activeUsers,\x200],\x20backgroundColor:\x20style.getPropertyValue(\x27--success\x27).trim(),\x20stack:\x20\x27stack0\x27\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20{\x20label:\x20\x27Expired\x27,\x20data:\x20[stats.expiredUsers,\x200],\x20backgroundColor:\x20style.getPropertyValue(\x27--expired\x27).trim(),\x20stack:\x20\x27stack0\x27\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20{\x20label:\x20\x27Total\x20Traffic\x20(GB)\x27,\x20data:\x20[0,\x20(stats.totalTraffic\x20/\x20(1024\x20**\x203)).toFixed(2)],\x20backgroundColor:\x20style.getPropertyValue(\x27--accent\x27).trim(),\x20yAxisID:\x20\x27yTraffic\x27,\x20stack:\x20\x27stack1\x27\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20]\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20options:\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20responsive:\x20true,\x20maintainAspectRatio:\x20false,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20plugins:\x20{\x20legend:\x20{\x20display:\x20true,\x20labels:\x20{\x20color:\x20\x27white\x27\x20}\x20},\x20title:\x20{\x20display:\x20true,\x20text:\x20\x27User\x20and\x20Traffic\x20Overview\x27,\x20color:\x20\x27white\x27\x20}\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20scales:\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20x:\x20{\x20stacked:\x20true,\x20ticks:\x20{\x20color:\x20\x27white\x27\x20}\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20y:\x20{\x20type:\x20\x27linear\x27,\x20display:\x20true,\x20position:\x20\x27left\x27,\x20stacked:\x20true,\x20title:\x20{\x20display:\x20true,\x20text:\x20\x27User\x20Count\x27,\x20color:\x20\x27white\x27\x20},\x20beginAtZero:\x20true,\x20ticks:\x20{\x20color:\x20\x27white\x27\x20}\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20yTraffic:\x20{\x20type:\x20\x27linear\x27,\x20display:\x20true,\x20position:\x20\x27right\x27,\x20title:\x20{\x20display:\x20true,\x20text:\x20\x27Traffic\x20(GB)\x27,\x20color:\x20\x27white\x27\x20},\x20grid:\x20{\x20drawOnChartArea:\x20false\x20},\x20beginAtZero:\x20true,\x20ticks:\x20{\x20color:\x20\x27white\x27\x20}\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20renderUsers()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20start\x20=\x20(currentPage\x20-\x201)\x20*\x20pageSize;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20end\x20=\x20start\x20+\x20pageSize;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20paginatedUsers\x20=\x20currentUsers.slice(start,\x20end);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20userList.innerHTML\x20=\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(paginatedUsers.length\x20===\x200)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20userList.innerHTML\x20=\x20\x27<tr><td\x20colspan=\x229\x22\x20style=\x22text-align:center;\x22>No\x20users\x20found.</td></tr>\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20renderPagination();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20paginatedUsers.forEach(user\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20expiry\x20=\x20formatExpiryDateTime(user.expiration_date,\x20user.expiration_time);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20dataLimit\x20=\x20user.data_limit\x20??\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20usedTraffic\x20=\x20user.used_traffic\x20??\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20isExpiredByTime\x20=\x20expiry.isExpired;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20isExpiredByTraffic\x20=\x20dataLimit\x20>\x200\x20&&\x20usedTraffic\x20>=\x20dataLimit;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20isExpired\x20=\x20isExpiredByTime\x20||\x20isExpiredByTraffic;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20trafficText\x20=\x20dataLimit\x20===\x200\x20?\x20`${formatBytes(usedTraffic)}\x20/\x20∞`\x20:\x20`${formatBytes(usedTraffic)}\x20/\x20${formatBytes(dataLimit)}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20progressPercent\x20=\x20dataLimit\x20===\x200\x20?\x200\x20:\x20Math.min((usedTraffic\x20/\x20dataLimit)\x20*\x20100,\x20100);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20let\x20progressClass\x20=\x20progressPercent\x20>\x2090\x20?\x20\x27danger\x27\x20:\x20progressPercent\x20>\x2070\x20?\x20\x27warning\x27\x20:\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20row\x20=\x20document.createElement(\x27tr\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20row.dataset.uuid\x20=\x20user.uuid;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20row.innerHTML\x20=\x20`<td><input\x20type=\x22checkbox\x22\x20class=\x22userSelect\x22\x20data-uuid=\x22${user.uuid}\x22></td><td\x20title=\x22${user.uuid}\x22>${user.uuid.substring(0,\x208)}...</td><td>${new\x20Date(user.created_at).toLocaleString()}</td><td\x20title=\x22${expiry.local}\x22>${expiry.relative}</td><td\x20title=\x22Local\x20Time:\x20${expiry.local}\x22>${expiry.tehran}</td><td><span\x20class=\x22status-badge\x20${isExpired\x20?\x20\x27status-expired\x27\x20:\x20\x27status-active\x27}\x22>${isExpired\x20?\x20\x27Expired\x27\x20:\x20\x27Active\x27}</span></td><td><div\x20class=\x22progress-bar-container\x22><div\x20class=\x22progress-bar\x20${progressClass}\x22\x20style=\x22width:\x20${progressPercent}%\x22></div></div><div\x20class=\x22traffic-text\x22>${trafficText}</div></td><td\x20title=\x22${user.notes\x20||\x20\x27\x27}\x22>${(user.notes\x20||\x20\x27-\x27).substring(0,\x2020)}</td><td><div\x20class=\x22actions-cell\x22><button\x20class=\x22btn\x20btn-secondary\x20btn-edit\x22\x20data-uuid=\x22${user.uuid}\x22>Edit</button><button\x20class=\x22btn\x20btn-danger\x20btn-delete\x22\x20data-uuid=\x22${user.uuid}\x22>Delete</button></div></td>`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20userList.appendChild(row);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20renderPagination();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20fetchAndRenderAll()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20[users,\x20stats]\x20=\x20await\x20Promise.all([api.get(\x27/users\x27),\x20api.get(\x27/stats\x27)]);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20allUsers\x20=\x20users.sort((a,\x20b)\x20=>\x20new\x20Date(b.created_at)\x20-\x20new\x20Date(a.created_at));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20handleSearch(true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20renderDashboardStats(stats);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(error.message,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20handleCreateUser(e)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20{\x20utcDate,\x20utcTime\x20}\x20=\x20localToUTC(document.getElementById(\x27expiryDate\x27).value,\x20document.getElementById(\x27expiryTime\x27).value);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!utcDate\x20||\x20!utcTime)\x20return\x20showToast(\x27Invalid\x20date\x20or\x20time.\x27,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20userData\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid:\x20uuidInput.value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20expiration_date:\x20utcDate,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20expiration_time:\x20utcTime,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data_limit:\x20getDataLimitFromInputs(),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20notes:\x20document.getElementById(\x27notes\x27).value\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20api.post(\x27/users\x27,\x20userData);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20created\x20successfully!\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createUserForm.reset();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuidInput.value\x20=\x20crypto.randomUUID();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setDefaultExpiry();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20fetchAndRenderAll();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20console.error(\x22Create\x20User\x20Failed:\x22,\x20error);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(error.message,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20handleDeleteUser(uuid)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(confirm(`Delete\x20user\x20${uuid}?`))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20api.delete(`/users/${uuid}`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20deleted.\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20fetchAndRenderAll();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x20showToast(error.message,\x20true);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20handleBulkDelete()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20selectedUuids\x20=\x20Array.from(document.querySelectorAll(\x27.userSelect:checked\x27)).map(cb\x20=>\x20cb.dataset.uuid);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(selectedUuids.length\x20===\x200)\x20return\x20showToast(\x27No\x20users\x20selected.\x27,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(confirm(`Delete\x20${selectedUuids.length}\x20selected\x20users?`))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20api.post(\x27/users/bulk-delete\x27,\x20{\x20uuids:\x20selectedUuids\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(`${selectedUuids.length}\x20users\x20deleted.`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20fetchAndRenderAll();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x20showToast(error.message,\x20true);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20openEditModal(uuid)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20user\x20=\x20allUsers.find(u\x20=>\x20u.uuid\x20===\x20uuid);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!user)\x20return\x20showToast(\x27User\x20not\x20found.\x27,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20{\x20localDate,\x20localTime\x20}\x20=\x20utcToLocal(user.expiration_date,\x20user.expiration_time);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editUuid\x27).value\x20=\x20user.uuid;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editExpiryDate\x27).value\x20=\x20localDate;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editExpiryTime\x27).value\x20=\x20localTime;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setDataLimitInputs(user.data_limit,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editNotes\x27).value\x20=\x20user.notes\x20||\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27resetTraffic\x27).checked\x20=\x20false;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20editModal.classList.add(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20closeEditModal()\x20{\x20editModal.classList.remove(\x27show\x27);\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20handleEditUser(e)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20{\x20utcDate,\x20utcTime\x20}\x20=\x20localToUTC(document.getElementById(\x27editExpiryDate\x27).value,\x20document.getElementById(\x27editExpiryTime\x27).value);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!utcDate\x20||\x20!utcTime)\x20return\x20showToast(\x27Invalid\x20date\x20or\x20time.\x27,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20updatedData\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20expiration_date:\x20utcDate,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20expiration_time:\x20utcTime,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data_limit:\x20getDataLimitFromInputs(true),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20notes:\x20document.getElementById(\x27editNotes\x27).value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20reset_traffic:\x20document.getElementById(\x27resetTraffic\x27).checked\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20api.put(`/users/${document.getElementById(\x27editUuid\x27).value}`,\x20updatedData);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20updated.\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20closeEditModal();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20fetchAndRenderAll();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x20showToast(error.message,\x20true);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20setDefaultExpiry()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20now\x20=\x20new\x20Date();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20now.setMonth(now.getMonth()\x20+\x201);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27expiryDate\x27).value\x20=\x20`${now.getFullYear()}-${pad(now.getMonth()\x20+\x201)}-${pad(now.getDate())}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27expiryTime\x27).value\x20=\x20`${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20handleSearch(immediate\x20=\x20false)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20applyFilter\x20=\x20()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20searchTerm\x20=\x20searchInput.value.toLowerCase();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20currentUsers\x20=\x20searchTerm\x20?\x20allUsers.filter(user\x20=>\x20user.uuid.toLowerCase().includes(searchTerm)\x20||\x20(user.notes\x20||\x20\x27\x27).toLowerCase().includes(searchTerm))\x20:\x20[...allUsers];\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20currentPage\x20=\x201;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20renderUsers();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20clearTimeout(searchDebounceTimer);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(immediate)\x20applyFilter();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20searchDebounceTimer\x20=\x20setTimeout(applyFilter,\x20300);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20exportToCSV()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(allUsers.length\x20===\x200)\x20return\x20showToast(\x22No\x20users\x20to\x20export.\x22,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20csv\x20=\x20[\x27UUID,CreatedAt,ExpirationDate,ExpirationTime,DataLimit_Bytes,UsedTraffic_Bytes,Notes\x27,\x20...allUsers.map(u\x20=>\x20[u.uuid,\x20u.created_at,\x20u.expiration_date,\x20u.expiration_time,\x20u.data_limit,\x20u.used_traffic,\x20`\x22${(u.notes\x20||\x20\x27\x27).replace(/\x22/g,\x20\x27\x22\x22\x27)}\x22`].join(\x27,\x27))].join(\x27\x5cn\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20blob\x20=\x20new\x20Blob([csv],\x20{\x20type:\x20\x27text/csv;charset=utf-8;\x27\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20link\x20=\x20document.createElement(\x27a\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20link.href\x20=\x20URL.createObjectURL(blob);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20link.download\x20=\x20`users_export_${new\x20Date().toISOString()}.csv`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20link.click();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20URL.revokeObjectURL(link.href);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20renderPagination()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pagination.innerHTML\x20=\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20totalPages\x20=\x20Math.ceil(currentUsers.length\x20/\x20pageSize);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(totalPages\x20<=\x201)\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20createBtn\x20=\x20(text,\x20onClick,\x20disabled)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20btn\x20=\x20document.createElement(\x27button\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20btn.classList.add(\x27btn\x27,\x20\x27btn-secondary\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20btn.innerHTML\x20=\x20text;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20btn.disabled\x20=\x20disabled;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20btn.onclick\x20=\x20onClick;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20btn;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pagination.appendChild(createBtn(\x27&laquo;\x20Prev\x27,\x20()\x20=>\x20{\x20if(currentPage\x20>\x201)\x20{\x20currentPage--;\x20renderUsers();\x20}\x20},\x20currentPage\x20===\x201));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pagination.appendChild(document.createElement(\x27span\x27)).textContent\x20=\x20`Page\x20${currentPage}\x20of\x20${totalPages}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20pagination.appendChild(createBtn(\x27Next\x20&raquo;\x27,\x20()\x20=>\x20{\x20if(currentPage\x20<\x20totalPages)\x20{\x20currentPage++;\x20renderUsers();\x20}\x20},\x20currentPage\x20===\x20totalPages));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20Event\x20Listeners\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20generateUUIDBtn.addEventListener(\x27click\x27,\x20()\x20=>\x20uuidInput.value\x20=\x20crypto.randomUUID());\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27setUnlimitedCreate\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20setUnlimited(false));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27setUnlimitedEdit\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20setUnlimited(true));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27deleteSelected\x27).addEventListener(\x27click\x27,\x20handleBulkDelete);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27exportUsers\x27).addEventListener(\x27click\x27,\x20exportToCSV);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27selectAll\x27).addEventListener(\x27change\x27,\x20(e)\x20=>\x20document.querySelectorAll(\x27.userSelect\x27).forEach(cb\x20=>\x20cb.checked\x20=\x20e.target.checked));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27modalCloseBtn\x27).addEventListener(\x27click\x27,\x20closeEditModal);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27modalCancelBtn\x27).addEventListener(\x27click\x27,\x20closeEditModal);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20createUserForm.addEventListener(\x27submit\x27,\x20handleCreateUser);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20editUserForm.addEventListener(\x27submit\x27,\x20handleEditUser);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20editModal.addEventListener(\x27click\x27,\x20(e)\x20=>\x20{\x20if\x20(e.target\x20===\x20editModal)\x20closeEditModal();\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20searchInput.addEventListener(\x27input\x27,\x20()\x20=>\x20handleSearch(false));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20userList.addEventListener(\x27click\x27,\x20(e)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20target\x20=\x20e.target.closest(\x27button\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!target)\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20uuid\x20=\x20target.dataset.uuid;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(target.classList.contains(\x27btn-edit\x27))\x20openEditModal(uuid);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20else\x20if\x20(target.classList.contains(\x27btn-delete\x27))\x20handleDeleteUser(uuid);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20Initial\x20Load\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setDefaultExpiry();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuidInput.value\x20=\x20crypto.randomUUID();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20fetchAndRenderAll();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setInterval(fetchAndRenderAll,\x2060000);\x0a\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20})();\x0a',adminLoginHTML='<!DOCTYPE\x20html><html\x20lang=\x22en\x22><head><meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22><title>Admin\x20Login</title><style>body{display:flex;justify-content:center;align-items:center;height:100vh;margin:0;background-color:#121212;font-family:-apple-system,BlinkMacSystemFont,\x22Segoe\x20UI\x22,Roboto,Helvetica,Arial,sans-serif}.login-container{background-color:#1e1e1e;padding:40px;border-radius:12px;box-shadow:0\x204px\x2020px\x20rgba(0,0,0,.5);text-align:center;width:320px;border:1px\x20solid\x20#333}h1{color:#fff;margin-bottom:24px;font-weight:500}form{display:flex;flex-direction:column}input[type=password]{background-color:#2c2c2c;border:1px\x20solid\x20#444;color:#fff;padding:12px;border-radius:8px;margin-bottom:20px;font-size:16px}input[type=password]:focus{outline:0;border-color:#007aff;box-shadow:0\x200\x200\x202px\x20rgba(0,122,255,.3)}button{background-color:#007aff;color:#fff;border:0;padding:12px;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:background-color\x20.2s}button:hover{background-color:#005ecb}.error{color:#ff3b30;margin-top:15px;font-size:14px}</style></head><body><div\x20class=\x22login-container\x22><h1>Admin\x20Login</h1><form\x20method=\x22POST\x22\x20action=\x22/admin\x22><input\x20type=\x22password\x22\x20name=\x22password\x22\x20placeholder=\x22••••••••••••••\x22\x20required><button\x20type=\x22submit\x22>Login</button></form></div></body></html>',adminPanelHTML='<!DOCTYPE\x20html><html\x20lang=\x22en\x22><head><meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22><title>Admin\x20Dashboard</title><script\x20src=\x22https://cdn.jsdelivr.net/npm/chart.js\x22></script><style>:root{--bg-main:#111827;--bg-card:#1F2937;--border:#374151;--text-primary:#F9FAFB;--text-secondary:#9CA3AF;--accent:#3B82F6;--accent-hover:#2563EB;--danger:#EF4444;--danger-hover:#DC2626;--success:#22C55E;--expired:#F59E0B;--btn-secondary-bg:#4B5563}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,\x22Segoe\x20UI\x22,Roboto,sans-serif;background-color:var(--bg-main);color:var(--text-primary);font-size:14px}.container{max-width:1200px;margin:40px\x20auto;padding:0\x2020px}h1,h2{font-weight:600}h1{font-size:24px;margin-bottom:20px}h2{font-size:18px;border-bottom:1px\x20solid\x20var(--border);padding-bottom:10px;margin-bottom:20px}.card{background-color:var(--bg-card);border-radius:8px;padding:24px;border:1px\x20solid\x20var(--border);box-shadow:0\x204px\x206px\x20rgba(0,0,0,.1)}.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;align-items:flex-end}.form-group{display:flex;flex-direction:column}.form-group\x20label{margin-bottom:8px;font-weight:500;color:var(--text-secondary)}.form-group\x20.input-group{display:flex}input[type=text],input[type=date],input[type=time],input[type=number],select{width:100%;box-sizing:border-box;background-color:#374151;border:1px\x20solid\x20#4B5563;color:var(--text-primary);padding:10px;border-radius:6px;font-size:14px;transition:border-color\x20.2s}input:focus{outline:0;border-color:var(--accent)}.label-note{font-size:11px;color:var(--text-secondary);margin-top:4px}.btn{padding:10px\x2016px;border:0;border-radius:6px;font-weight:600;cursor:pointer;transition:background-color\x20.2s,transform\x20.1s;display:inline-flex;align-items:center;justify-content:center;gap:8px}.btn:active{transform:scale(.98)}.btn-primary{background-color:var(--accent);color:#fff}.btn-primary:hover{background-color:var(--accent-hover)}.btn-secondary{background-color:var(--btn-secondary-bg);color:#fff}.btn-secondary:hover{background-color:#6B7280}.btn-danger{background-color:var(--danger);color:#fff}.btn-danger:hover{background-color:var(--danger-hover)}.input-group\x20.btn-secondary{border-top-left-radius:0;border-bottom-left-radius:0}.input-group\x20input,\x20.input-group\x20select{border-radius:\x200;\x20border-right:\x200}.input-group\x20input:first-child,\x20.input-group\x20select:first-child{border-top-left-radius:\x206px;\x20border-bottom-left-radius:\x206px}table{width:100%;border-collapse:collapse;margin-top:20px}th,td{padding:12px\x2016px;text-align:left;border-bottom:1px\x20solid\x20var(--border);overflow:hidden;text-overflow:ellipsis}th{color:var(--text-secondary);font-weight:600;font-size:12px;text-transform:uppercase;white-space:nowrap}td{color:var(--text-primary);font-family:\x22SF\x20Mono\x22,\x22Fira\x20Code\x22,monospace;vertical-align:middle}.status-badge{padding:4px\x208px;border-radius:12px;font-size:12px;font-weight:600;display:inline-block}.status-active{background-color:var(--success);color:#064E3B}.status-expired{background-color:var(--expired);color:#78350F}.actions-cell\x20.btn{padding:6px\x2010px;font-size:12px}#toast{position:fixed;top:20px;right:20px;background-color:var(--bg-card);color:#fff;padding:15px\x2020px;border-radius:8px;z-index:1001;display:none;border:1px\x20solid\x20var(--border);box-shadow:0\x204px\x2012px\x20rgba(0,0,0,.3);opacity:0;transition:opacity\x20.3s,transform\x20.3s;transform:translateY(-20px)}#toast.show{display:block;opacity:1;transform:translateY(0)}#toast.error{border-left:5px\x20solid\x20var(--danger)}#toast.success{border-left:5px\x20solid\x20var(--success)}.actions-cell{display:flex;gap:8px;justify-content:flex-start}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.7);z-index:1000;display:flex;justify-content:center;align-items:center;opacity:0;visibility:hidden;transition:opacity\x20.3s,visibility\x20.3s}.modal-overlay.show{opacity:1;visibility:visible}.modal-content{background-color:var(--bg-card);padding:30px;border-radius:12px;box-shadow:0\x205px\x2025px\x20rgba(0,0,0,.4);width:90%;max-width:500px;transform:scale(.9);transition:transform\x20.3s;border:1px\x20solid\x20var(--border)}.modal-overlay.show\x20.modal-content{transform:scale(1)}.modal-header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px\x20solid\x20var(--border);padding-bottom:15px;margin-bottom:20px}.modal-header\x20h2{margin:0;border:0;font-size:20px}.modal-close-btn{background:0\x200;border:0;color:var(--text-secondary);font-size:24px;cursor:pointer;line-height:1}.modal-footer{display:flex;justify-content:flex-end;gap:12px;margin-top:25px}.time-quick-set-group,.data-quick-set-group{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}.btn-outline-secondary{background-color:transparent;border:1px\x20solid\x20var(--btn-secondary-bg);color:var(--text-secondary);padding:6px\x2010px;font-size:12px;font-weight:500}.btn-outline-secondary:hover{background-color:var(--btn-secondary-bg);color:#fff;border-color:var(--btn-secondary-bg)}.progress-bar-container{width:100%;background-color:#374151;border-radius:4px;height:8px;overflow:hidden;margin-top:4px}.progress-bar{height:100%;background-color:var(--success);transition:width\x20.3s\x20ease}.progress-bar.warning{background-color:var(--expired)}.progress-bar.danger{background-color:var(--danger)}.traffic-text{font-size:12px;color:var(--text-secondary);margin-top:4px;text-align:right}.dashboard-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:30px}.dashboard-stat{background-color:var(--bg-card);padding:16px;border-radius:8px;border:1px\x20solid\x20var(--border);text-align:center}.dashboard-stat\x20h3{font-size:28px;color:var(--accent);margin:0}.dashboard-stat\x20p{color:var(--text-secondary);margin:0;font-size:14px}.search-container{margin-bottom:16px}.search-input{width:100%;padding:10px;border-radius:6px;background-color:#374151;border:1px\x20solid\x20#4B5563;color:var(--text-primary)}.table-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.pagination{display:flex;justify-content:center;align-items:center;gap:8px;margin-top:24px}.pagination\x20.btn{padding:6px\x2012px}.pagination\x20span{color:var(--text-secondary);font-size:14px}.export-btn{background-color:#10B981;color:#fff}#statsChartContainer{margin-top:20px;position:relative;height:300px}</style></head><body><div\x20class=\x22container\x22><h1>Admin\x20Dashboard</h1><div\x20class=\x22dashboard-grid\x22\x20id=\x22dashboardStats\x22></div><div\x20id=\x22statsChartContainer\x22><canvas\x20id=\x22statsChart\x22></canvas></div><div\x20class=\x22card\x22><h2>Create\x20User</h2><form\x20id=\x22createUserForm\x22\x20class=\x22form-grid\x22><div\x20class=\x22form-group\x22\x20style=\x22grid-column:1/-1\x22><label\x20for=\x22uuid\x22>UUID</label><div\x20class=\x22input-group\x22><input\x20type=\x22text\x22\x20id=\x22uuid\x22\x20required><button\x20type=\x22button\x22\x20id=\x22generateUUID\x22\x20class=\x22btn\x20btn-secondary\x22>Generate</button></div></div><div\x20class=\x22form-group\x22><label\x20for=\x22expiryDate\x22>Expiry\x20Date</label><input\x20type=\x22date\x22\x20id=\x22expiryDate\x22\x20required></div><div\x20class=\x22form-group\x22><label\x20for=\x22expiryTime\x22>Expiry\x20Time\x20(Your\x20Local\x20Time)</label><input\x20type=\x22time\x22\x20id=\x22expiryTime\x22\x20step=\x221\x22\x20required><div\x20class=\x22label-note\x22>Auto-converted\x20to\x20UTC.</div><div\x20class=\x22time-quick-set-group\x22\x20data-target-date=\x22expiryDate\x22\x20data-target-time=\x22expiryTime\x22><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-amount=\x221\x22\x20data-unit=\x22hour\x22>+1\x20Hour</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-amount=\x221\x22\x20data-unit=\x22day\x22>+1\x20Day</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-amount=\x221\x22\x20data-unit=\x22month\x22>+1\x20Month</button></div></div><div\x20class=\x22form-group\x22><label\x20for=\x22dataLimit\x22>Data\x20Limit</label><div\x20class=\x22input-group\x22><input\x20type=\x22number\x22\x20id=\x22dataLimitValue\x22\x20min=\x220\x22\x20value=\x220\x22\x20required><select\x20id=\x22dataLimitUnit\x22><option\x20value=\x22GB\x22\x20selected>GB</option><option\x20value=\x22MB\x22>MB</option><option\x20value=\x22TB\x22>TB</option><option\x20value=\x22KB\x22>KB</option></select><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-secondary\x22\x20id=\x22setUnlimitedCreate\x22>Unlimited</button></div><div\x20class=\x22data-quick-set-group\x22><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-gb=\x2210\x22>10GB</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-gb=\x2250\x22>50GB</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-gb=\x22100\x22>100GB</button></div></div><div\x20class=\x22form-group\x22><label\x20for=\x22notes\x22>Notes</label><input\x20type=\x22text\x22\x20id=\x22notes\x22\x20placeholder=\x22(Optional)\x22></div><div\x20class=\x22form-group\x22><label>&nbsp;</label><button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-primary\x22>Create\x20User</button></div></form></div><div\x20class=\x22card\x22\x20style=\x22margin-top:30px\x22><h2>User\x20List</h2><div\x20class=\x22search-container\x22><input\x20type=\x22text\x22\x20id=\x22searchInput\x22\x20class=\x22search-input\x22\x20placeholder=\x22Search\x20by\x20UUID\x20or\x20Notes...\x22></div><div\x20class=\x22table-header\x22><button\x20id=\x22deleteSelected\x22\x20class=\x22btn\x20btn-danger\x22>Delete\x20Selected</button><button\x20id=\x22exportUsers\x22\x20class=\x22btn\x20export-btn\x22>Export\x20to\x20CSV</button></div><div\x20style=\x22overflow-x:auto\x22><table><thead><tr><th><input\x20type=\x22checkbox\x22\x20id=\x22selectAll\x22></th><th>UUID</th><th>Created</th><th>Expiry</th><th>Tehran\x20Time</th><th>Status</th><th>Traffic</th><th>Notes</th><th>Actions</th></tr></thead><tbody\x20id=\x22userList\x22></tbody></table></div><div\x20class=\x22pagination\x22\x20id=\x22pagination\x22></div></div></div><div\x20id=\x22toast\x22></div><div\x20id=\x22editModal\x22\x20class=\x22modal-overlay\x22><div\x20class=\x22modal-content\x22><div\x20class=\x22modal-header\x22><h2>Edit\x20User</h2><button\x20id=\x22modalCloseBtn\x22\x20class=\x22modal-close-btn\x22>&times;</button></div><form\x20id=\x22editUserForm\x22><input\x20type=\x22hidden\x22\x20id=\x22editUuid\x22\x20name=\x22uuid\x22><div\x20class=\x22form-group\x22><label\x20for=\x22editExpiryDate\x22>Expiry\x20Date</label><input\x20type=\x22date\x22\x20id=\x22editExpiryDate\x22\x20name=\x22expiration_date\x22\x20required></div><div\x20class=\x22form-group\x22\x20style=\x22margin-top:16px\x22><label\x20for=\x22editExpiryTime\x22>Expiry\x20Time\x20(Local)</label><input\x20type=\x22time\x22\x20id=\x22editExpiryTime\x22\x20name=\x22expiration_time\x22\x20step=\x221\x22\x20required><div\x20class=\x22time-quick-set-group\x22\x20data-target-date=\x22editExpiryDate\x22\x20data-target-time=\x22editExpiryTime\x22><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-amount=\x221\x22\x20data-unit=\x22hour\x22>+1\x20Hour</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-amount=\x221\x22\x20data-unit=\x22day\x22>+1\x20Day</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-amount=\x221\x22\x20data-unit=\x22month\x22>+1\x20Month</button></div></div><div\x20class=\x22form-group\x22\x20style=\x22margin-top:16px\x22><label\x20for=\x22editDataLimit\x22>Data\x20Limit</label><div\x20class=\x22input-group\x22><input\x20type=\x22number\x22\x20id=\x22editDataLimitValue\x22\x20min=\x220\x22\x20required><select\x20id=\x22editDataLimitUnit\x22><option\x20value=\x22GB\x22\x20selected>GB</option><option\x20value=\x22MB\x22>MB</option><option\x20value=\x22TB\x22>TB</option><option\x20value=\x22KB\x22>KB</option></select><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-secondary\x22\x20id=\x22setUnlimitedEdit\x22>Unlimited</button></div><div\x20class=\x22data-quick-set-group\x22><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-gb=\x2210\x22>10GB</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-gb=\x2250\x22>50GB</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-gb=\x22100\x22>100GB</button></div></div><div\x20class=\x22form-group\x22\x20style=\x22margin-top:16px\x22><label\x20for=\x22editNotes\x22>Notes</label><input\x20type=\x22text\x22\x20id=\x22editNotes\x22\x20name=\x22notes\x22\x20placeholder=\x22(Optional)\x22></div><div\x20class=\x22form-group\x22\x20style=\x22margin-top:16px\x22><label><input\x20type=\x22checkbox\x22\x20id=\x22resetTraffic\x22\x20name=\x22resetTraffic\x22>\x20Reset\x20Traffic\x20Usage</label></div><div\x20class=\x22modal-footer\x22><button\x20type=\x22button\x22\x20id=\x22modalCancelBtn\x22\x20class=\x22btn\x20btn-secondary\x22>Cancel</button><button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-primary\x22>Save\x20Changes</button></div></form></div></div><script>/*\x20SCRIPT_PLACEHOLDER\x20*/</script></body></html>';async function handleAdminRequest(a,b){const c=new URL(a['url']),{pathname:d}=c,e={'Content-Type':'application/json'},f={'Content-Type':'text/html;charset=utf-8',...CONST['securityHeaders']};if(!b['ADMIN_KEY'])return log('Admin\x20panel\x20is\x20not\x20configured.\x20ADMIN_KEY\x20secret\x20is\x20missing.','error'),new Response('Admin\x20panel\x20is\x20not\x20configured.',{'status':0x1f7});if(d['startsWith']('/admin/api/')){if(!await isAdmin(a,b))return new Response(JSON['stringify']({'error':'Forbidden'}),{'status':0x193,'headers':e});if(a['method']!=='GET'){const g=a['headers']['get']('X-CSRF-Token'),h=await b['USER_KV']['get']('csrf_token');if(!h||g!==h)return new Response(JSON['stringify']({'error':'Invalid\x20CSRF\x20token'}),{'status':0x193,'headers':e});}try{if(d==='/admin/api/stats'&&a['method']==='GET')return new Response(JSON['stringify'](await fetchDashboardStats(b)),{'status':0xc8,'headers':e});if(d==='/admin/api/users'){if(a['method']==='GET'){const {results:j}=await b['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20ORDER\x20BY\x20created_at\x20DESC')['all']();return new Response(JSON['stringify'](j??[]),{'status':0xc8,'headers':e});}if(a['method']==='POST'){const {uuid:k,expiration_date:l,expiration_time:m,data_limit:n,notes:o}=await a['json']();if(!isValidUUID(k)||!l||!m||n===undefined)throw new Error('Server\x20validation\x20failed:\x20Invalid\x20or\x20missing\x20fields.');return await b['DB']['prepare']('INSERT\x20INTO\x20users\x20(uuid,\x20expiration_date,\x20expiration_time,\x20data_limit,\x20notes)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)')['bind'](String(k),String(l),String(m),Number(n??0x0),o?String(o):null)['run'](),new Response(JSON['stringify']({'success':!![],'uuid':k}),{'status':0xc9,'headers':e});}}if(d==='/admin/api/users/bulk-delete'&&a['method']==='POST'){const {uuids:p}=await a['json']();if(!Array['isArray'](p)||p['length']===0x0)throw new Error('UUIDs\x20array\x20is\x20required.');const q=p['filter'](isValidUUID);return q['length']>0x0&&(await b['DB']['batch'](q['map'](r=>b['DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](r))),await Promise['all'](q['map'](r=>b['USER_KV']['delete']('user:'+r)))),new Response(JSON['stringify']({'success':!![],'count':q['length']}),{'status':0xc8,'headers':e});}const i=d['match'](/^\/admin\/api\/users\/([a-f0-9-]+)$/);if(i){const r=i[0x1];if(!isValidUUID(r))return new Response(JSON['stringify']({'error':'Invalid\x20UUID\x20format'}),{'status':0x190,'headers':e});if(a['method']==='PUT'){const {expiration_date:s,expiration_time:t,data_limit:u,notes:v,reset_traffic:w}=await a['json']();if(!s||!t||u===undefined)throw new Error('Invalid\x20or\x20missing\x20fields.');let x='UPDATE\x20users\x20SET\x20expiration_date\x20=\x20?,\x20expiration_time\x20=\x20?,\x20data_limit\x20=\x20?,\x20notes\x20=\x20?'+(w?',\x20used_traffic\x20=\x200':'')+'\x20WHERE\x20uuid\x20=\x20?';return await b['DB']['prepare'](x)['bind'](String(s),String(t),Number(u??0x0),v?String(v):null,r)['run'](),await b['USER_KV']['delete']('user:'+r),new Response(JSON['stringify']({'success':!![],'uuid':r}),{'status':0xc8,'headers':e});}if(a['method']==='DELETE')return await b['DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](r)['run'](),await b['USER_KV']['delete']('user:'+r),new Response(null,{'status':0xcc});}return new Response(JSON['stringify']({'error':'API\x20route\x20not\x20found'}),{'status':0x194,'headers':e});}catch(y){console['error']('Admin\x20API\x20Error\x20Stack:\x20'+y['stack']);const z=y['message']['includes']('UNIQUE')?'A\x20user\x20with\x20this\x20UUID\x20already\x20exists.':'Server\x20Error:\x20'+y['message'],A=y['cause']?String(y['cause']):'No\x20additional\x20cause\x20information.';return console['error']('Error\x20Cause:\x20'+A),new Response(JSON['stringify']({'error':z,'cause':A}),{'status':0x190,'headers':e});}}if(d==='/admin'){if(a['method']==='POST'){const B=await a['formData']();if(B['get']('password')===b['ADMIN_KEY']){const C=crypto['randomUUID'](),D=crypto['randomUUID']();return await Promise['all']([b['USER_KV']['put']('admin_session_token',C,{'expirationTtl':0x15180}),b['USER_KV']['put']('csrf_token',D,{'expirationTtl':0x15180})]),new Response(null,{'status':0x12e,'headers':{'Location':'/admin','Set-Cookie':'auth_token='+C+';\x20HttpOnly;\x20Secure;\x20Path=/admin;\x20Max-Age=86400;\x20SameSite=Strict'}});}return new Response(adminLoginHTML['replace']('</form>','</form><p\x20class=\x22error\x22>Invalid\x20password.</p>'),{'status':0x191,'headers':f});}if(a['method']==='GET'){if(await isAdmin(a,b)){const E=await b['USER_KV']['get']('csrf_token')||crypto['randomUUID'](),F=adminPanelHTML['replace']('/*\x20SCRIPT_PLACEHOLDER\x20*/',getAdminPanelScript(E));return new Response(F,{'headers':f});}return new Response(adminLoginHTML,{'headers':f});}return new Response('Method\x20Not\x20Allowed',{'status':0x195});}return new Response('Admin\x20route\x20not\x20found.',{'status':0x194});}async function isAdmin(a,b){try{const c=a['headers']['get']('Cookie');if(!c)return![];const d=c['match'](/auth_token=([^;]+)/)?.[0x1];if(!d)return![];const f=await b['USER_KV']['get']('admin_session_token');return f&&f===d;}catch(g){return log('Error\x20in\x20isAdmin\x20check:\x20'+g['message'],'error'),![];}}function getPageCSS(){return'*{margin:0;padding:0;box-sizing:border-box}body{font-family:-apple-system,BlinkMacSystemFont,\x22Segoe\x20UI\x22,Roboto,sans-serif;background-color:#2a2421;color:#e5dfd6;padding:1rem;line-height:1.5}.container{max-width:800px;margin:20px\x20auto}.header{text-align:center;margin-bottom:2rem}h1{font-family:serif;font-weight:400;font-size:1.8rem}p{color:#b3a89d;font-size:.9rem}.config-card{background:#35302c;border-radius:12px;padding:20px;margin-bottom:1.5rem;border:1px\x20solid\x20#5a4f45}.config-title{font-family:serif;font-size:1.6rem;color:#d4b595;margin-bottom:1rem;padding-bottom:.8rem;border-bottom:1px\x20solid\x20#5a4f45}.button{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:.6rem\x201rem;border-radius:12px;font-size:1rem;font-weight:500;cursor:pointer;border:1px\x20solid\x20#5a4f45;background-color:#413b35;color:#e5dfd6;text-decoration:none}.button:hover{background-color:#4d453e}.client-buttons{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:1rem}.button.copied{background-color:#70b570!important;color:#2a2421!important}.footer{text-align:center;margin-top:2rem;color:#b3a89d;font-size:.8rem}.ip-info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(230px,1fr));gap:1.5rem}.ip-info-section{background-color:#413b35;border-radius:12px;padding:1rem;border:1px\x20solid\x20#5a4f45}.ip-info-header\x20h3{font-family:serif;font-size:1.2rem;color:#d4b595;margin-bottom:.5rem}.ip-info-item{margin-top:.5rem}.label{font-size:.8rem;color:#b3a89d}.value{font-size:.9rem}.skeleton{display:inline-block;background:linear-gradient(90deg,\x20#413b35\x2025%,\x20#35302c\x2050%,\x20#413b35\x2075%);background-size:200%\x20100%;animation:loading\x201.5s\x20infinite;border-radius:4px;height:1em;width:70%}.country-flag{width:1.2em;vertical-align:middle;margin-right:.5em}@keyframes\x20loading{0%{background-position:200%\x200}100%{background-position:-200%\x200}}.status-card{text-align:center}.status-title{font-family:serif;font-size:1.6rem;color:#d4b595;margin-bottom:.8rem}.relative-time{font-size:1.1rem;font-weight:500;margin-bottom:.8rem}.relative-time.active{color:#70b570}.relative-time.expired{color:#e05d44}.time-details{font-size:.9rem;color:#b3a89d}.time-details\x20span{display:block;margin-top:.5rem}.traffic-text{font-family:monospace;font-size:1rem;margin-top:1rem}.progress-container{width:100%;max-width:400px;margin:\x20.8rem\x20auto;background-color:#413b35;border-radius:6px;height:12px;overflow:hidden;border:1px\x20solid\x20#5a4f45}.progress-bar{height:100%;background-color:#70b570;transition:width\x20.5s\x20ease}.progress-bar.warning{background-color:#e0bc44}.progress-bar.danger{background-color:#e05d44}';}function getPageHTML(a,b,c){return'<div\x20class=\x22container\x22><div\x20class=\x22header\x22><h1>VLESS\x20Configuration</h1><p>Your\x20secure\x20connection\x20is\x20ready.</p></div><div\x20id=\x22dynamic-content\x22></div><div\x20class=\x22config-card\x22><h2\x20class=\x22config-title\x22>Network\x20Information</h2><div\x20class=\x22ip-info-grid\x22><div\x20class=\x22ip-info-section\x22><div\x20class=\x22ip-info-header\x22><h3>Proxy\x20Server</h3></div><div\x20class=\x22ip-info-item\x22><span\x20class=\x22label\x22>Host:\x20</span><span\x20class=\x22value\x22\x20id=\x22proxy-host\x22><span\x20class=\x22skeleton\x22></span></span></div><div\x20class=\x22ip-info-item\x22><span\x20class=\x22label\x22>Location:\x20</span><span\x20class=\x22value\x22\x20id=\x22proxy-location\x22><span\x20class=\x22skeleton\x22></span></span></div></div><div\x20class=\x22ip-info-section\x22><div\x20class=\x22ip-info-header\x22><h3>Your\x20Connection</h3></div><div\x20class=\x22ip-info-item\x22><span\x20class=\x22label\x22>IP:\x20</span><span\x20class=\x22value\x22\x20id=\x22client-ip\x22><span\x20class=\x22skeleton\x22></span></span></div><div\x20class=\x22ip-info-item\x22><span\x20class=\x22label\x22>Location:\x20</span><span\x20class=\x22value\x22\x20id=\x22client-location\x22><span\x20class=\x22skeleton\x22></span></span></div></div></div></div><div\x20class=\x22config-card\x22><h2\x20class=\x22config-title\x22>Subscription\x20Links</h2><div\x20class=\x22client-buttons\x22><a\x20href=\x22'+a['universalAndroid']+'\x22\x20class=\x22button\x22>Android\x20(v2rayNG)</a><a\x20href=\x22'+a['shadowrocket']+'\x22\x20class=\x22button\x22>iOS\x20(Shadowrocket)</a><a\x20href=\x22'+a['clashMeta']+'\x22\x20class=\x22button\x22>Clash\x20Meta\x20/\x20Stash</a><button\x20class=\x22button\x22\x20onclick=\x22copyToClipboard(this,\x20\x27'+b+'\x27)\x22>Copy\x20Xray/v2fly\x20Link</button><button\x20class=\x22button\x22\x20onclick=\x22copyToClipboard(this,\x20\x27'+c+'\x27)\x22>Copy\x20Sing-Box\x20Link</button></div></div><div\x20class=\x22footer\x22><p>©\x20'+new Date()['getFullYear']()+'\x20-\x20Secure.\x20Private.\x20Fast.</p></div></div>';}function getPageScript(){return'function\x20copyToClipboard(button,text){navigator.clipboard.writeText(text).then(()=>{const\x20t=button.innerHTML;button.innerHTML=\x22Copied!\x22,button.classList.add(\x22copied\x22),setTimeout(()=>{button.innerHTML=t,button.classList.remove(\x22copied\x22)},1500)}).catch(t=>console.error(\x22Failed\x20to\x20copy:\x20\x22,t))}async\x20function\x20fetchIpInfo(t){try{const\x20o=await\x20fetch(\x22https://ip-api.io/json/\x22+(t||\x22\x22));return\x20o.ok?await\x20o.json():null}catch(t){return\x20null}}function\x20updateIpDisplay(t,o,n=null){n&&(document.getElementById(o+\x22-host\x22).textContent=n);if(!t){document.getElementById(o+\x22-ip\x22).textContent=\x22N/A\x22;document.getElementById(o+\x22-location\x22).textContent=\x22N/A\x22;return}document.getElementById(o+\x22-ip\x22).textContent=t.ip||\x22N/A\x22;const\x20e=document.getElementById(o+\x22-location\x22);let\x20l=[t.city,t.country_name].filter(Boolean).join(\x22,\x20\x22);t.country_code&&(l=`<img\x20src=\x22https://flagcdn.com/w20/${t.country_code.toLowerCase()}.png\x22\x20class=\x22country-flag\x22>\x20${l}`),e.innerHTML=l||\x22N/A\x22}function\x20displayExpiration(){const\x20t=document.getElementById(\x22expiration-display\x22),o=document.getElementById(\x22expiration-relative\x22);if(t&&t.dataset.utcTime){const\x20n=new\x20Date(t.dataset.utcTime);if(!isNaN(n.getTime())){const\x20e=(n.getTime()-(new\x20Date).getTime())/1e3,i=e<0;let\x20a=\x22\x22;a=new\x20Intl.RelativeTimeFormat(\x22en\x22,{numeric:\x22auto\x22}),a=Math.abs(e)<3600?a.format(Math.round(e/60),\x22minute\x22):Math.abs(e)<86400?a.format(Math.round(e/3600),\x22hour\x22):a.format(Math.round(e/86400),\x22day\x22),o&&(o.textContent=i?`Expired\x20${a}`:`Expires\x20${a}`,o.classList.add(i?\x22expired\x22:\x22active\x22)),t.innerHTML=`<span><strong>Local:</strong>\x20${n.toLocaleString(undefined,{dateStyle:\x22medium\x22,timeStyle:\x22short\x22})}</span><span><strong>Tehran:</strong>\x20${n.toLocaleString(\x22en-US\x22,{timeZone:\x22Asia/Tehran\x22,dateStyle:\x22medium\x22,timeStyle:\x22short\x22})}</span>`}}}document.addEventListener(\x22DOMContentLoaded\x22,async()=>{const\x20t=document.body.getAttribute(\x22data-proxy-ip\x22),[o]=t.split(\x22:\x22);updateIpDisplay(await\x20fetchIpInfo(o),\x22proxy\x22,t),updateIpDisplay(await\x20fetchIpInfo(),\x22client\x22),displayExpiration()});';}function generateBeautifulConfigPage(a,b,c,d,e,f,g){const h='https://'+b+'/xray/'+a,i='https://'+b+'/sb/'+a,j={'universalAndroid':'v2rayng://install-config?url='+encodeURIComponent(h),'shadowrocket':'shadowrocket://add/sub?url='+encodeURIComponent(h)+'&name='+encodeURIComponent(b),'clashMeta':'clash://install-config?url='+encodeURIComponent('https://sub.bonds.dev/sub/clash?url='+encodeURIComponent(i))},k=d&&e?d+'T'+e['split']('.')[0x0]+'Z':'',l=s=>{if(s===null||typeof s==='undefined'||s===0x0)return'0\x20B';const t=Math['floor'](Math['log'](s)/Math['log'](0x400));return parseFloat((s/Math['pow'](0x400,t))['toFixed'](0x2))+'\x20'+['B','KB','MB','GB','TB'][t];},m=f>0x0?Math['min'](g/f*0x64,0x64):0x0,n=f===0x0?l(g)+'\x20/\x20∞':l(g)+'\x20/\x20'+l(f);let o=m>0x5a?'danger':m>0x46?'warning':'';const p='<div\x20class=\x22config-card\x20status-card\x22><h2\x20class=\x22status-title\x22>Subscription\x20Status</h2><div\x20id=\x22expiration-relative\x22\x20class=\x22relative-time\x22></div><div\x20id=\x22expiration-display\x22\x20class=\x22time-details\x22\x20data-utc-time=\x22'+k+'\x22></div><div\x20class=\x22traffic-text\x22>'+n+'</div><div\x20class=\x22progress-container\x22><div\x20class=\x22progress-bar\x20'+o+'\x22\x20style=\x22width:\x20'+m['toFixed'](0x2)+'%\x22></div></div></div>',q=getPageHTML(j,h,i),r=q['replace']('<div\x20id=\x22dynamic-content\x22></div>',p);return'<!doctype\x20html><html\x20lang=\x22en\x22><head><meta\x20charset=\x22UTF-8\x22\x20/><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22\x20/><title>VLESS\x20Proxy\x20Configuration</title><link\x20rel=\x22icon\x22\x20href=\x22https://raw.githubusercontent.com/NiREvil/zizifn/refs/heads/Legacy/assets/favicon.png\x22\x20type=\x22image/png\x22><style>'+getPageCSS()+'</style></head><body\x20data-proxy-ip=\x22'+c+'\x22>'+r+'<script>'+getPageScript()+'</script></body></html>';}function generateRandomPath(a=0xc,b=''){const c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let d='';for(let e=0x0;e<a;e++)d+=c['charAt'](Math['floor'](Math['random']()*c['length']));return'/'+d+(b?'?'+b:'');}const CORE_PRESETS={'xray':{'tls':{'path':()=>generateRandomPath(0xc,'ed=2048'),'security':'tls','fp':'chrome','alpn':'http/1.1'}},'sb':{'tls':{'path':()=>generateRandomPath(0x12),'security':'tls','fp':'firefox','alpn':'h3','extra':{'ed':0xa00}}}};function createVlessLink({userID:a,address:b,port:c,host:d,path:e,security:f,sni:g,fp:h,alpn:i,extra:extra={},name:j}){const l=new URLSearchParams({'type':'ws','host':d,'path':e,'security':f,'sni':g,'fp':h,'alpn':i});for(const [m,n]of Object['entries'](extra))l['set'](m,n);return'vless://'+a+'@'+b+':'+c+'?'+l['toString']()+'#'+encodeURIComponent(j);}function buildLink({core:a,userID:b,hostName:c,address:d,port:e,tag:f}){const g=CORE_PRESETS[a]['tls'];return createVlessLink({'userID':b,'address':d,'port':e,'host':c,'path':g['path'](),'security':g['security'],'sni':c,'fp':g['fp'],'alpn':g['alpn'],'extra':g['extra'],'name':f+'-TLS'});}const pick=a=>a[Math['floor'](Math['random']()*a['length'])];async function handleIpSubscription(a,b,c){const d=[c,'creativecommons.org','www.speedtest.net'],f=[0x1bb,0x20fb,0x805,0x823,0x827,0x830];let g=d['map']((h,j)=>buildLink({'core':a,'userID':b,'hostName':c,'address':h,'port':pick(f),'tag':'D'+(j+0x1)}));try{const h=await fetch('https://raw.githubusercontent.com/NiREvil/vless/main/Cloudflare-IPs.json');if(h['ok']){const {ipv4:ipv4=[]}=await h['json']();g['push'](...ipv4['slice'](0x0,0xa)['map']((j,k)=>buildLink({'core':a,'userID':b,'hostName':c,'address':j['ip'],'port':pick(f),'tag':'IP'+(k+0x1)})));}}catch(i){console['error']('Fetch\x20IP\x20list\x20failed',i);}return new Response(btoa(g['join']('\x0a')),{'headers':{'Content-Type':'text/plain;charset=utf-8'}});}async function vlessOverWSHandler(a,b,c){const d=new WebSocketPair(),[e,f]=Object['values'](d);f['accept']();let g={'uuid':'','remoteSocket':null,'incoming':0x0,'outgoing':0x0,'closed':![]};function h(){if(g['closed'])return;g['closed']=!![];g['uuid']&&(g['incoming']>0x0||g['outgoing']>0x0)&&c['waitUntil'](updateUsedTraffic(b,g['uuid'],g['incoming']+g['outgoing']));if(g['remoteSocket'])try{g['remoteSocket']['close']();}catch(k){}safeCloseWebSocket(f);}const i=base64ToArrayBuffer(a['headers']['get']('Sec-WebSocket-Protocol')||''),j=new ReadableStream({'start'(k){f['addEventListener']('message',l=>{const m=l['data'];g['outgoing']+=m['byteLength'],k['enqueue'](m);}),f['addEventListener']('close',()=>{h();try{k['close']();}catch(l){}}),f['addEventListener']('error',l=>{log('WebSocket\x20error:\x20'+l['message'],'error'),k['error'](l);}),i&&(g['outgoing']+=i['byteLength'],k['enqueue'](i));}});return j['pipeTo'](new WritableStream({async 'write'(k,l){if(g['remoteSocket'])try{const m=g['remoteSocket']['writable']['getWriter']();await m['write'](k),m['releaseLock']();return;}catch(n){log('Error\x20writing\x20to\x20remote\x20socket:\x20'+n['message'],'error'),l['error'](n),h();}try{const {uuid:o,address:p,port:q,rawDataIndex:r}=await processVlessHeader(k,b);g['uuid']=o;const s=await connect({'hostname':p,'port':q});g['remoteSocket']=s;const t=s['writable']['getWriter']();await t['write'](k['slice'](r)),t['releaseLock']();let u=![];s['readable']['pipeTo'](new WritableStream({'write':v=>{if(f['readyState']!==CONST['WS_READY_STATE_OPEN'])return;if(!u){const w=new Uint8Array([0x0,0x0]),x=new Uint8Array(w['length']+v['length']);x['set'](w),x['set'](v,w['length']),g['incoming']+=x['byteLength'],f['send'](x),u=!![];}else g['incoming']+=v['byteLength'],f['send'](v);},'close':()=>log('Remote\x20socket\x20readable\x20closed\x20for\x20'+o),'abort':v=>log('Remote\x20socket\x20readable\x20aborted\x20for\x20'+o+':\x20'+v['message'],'error')}))['catch'](v=>{log('Remote\x20socket\x20pipe\x20failed\x20for\x20'+o+':\x20'+v['message'],'error'),h();});}catch(v){log('VLESS\x20processing\x20error:\x20'+v['message'],'error'),l['error'](v),h();}},'abort':k=>{log('Main\x20pipeline\x20aborted:\x20'+k['message'],'error'),h();},'close':()=>{log('Main\x20pipeline\x20closed.'),h();}}))['catch'](k=>{log('Unhandled\x20pipeline\x20failure:\x20'+k['message'],'error'),h();}),new Response(null,{'status':0x65,'webSocket':e});}async function processVlessHeader(a,b){if(a['byteLength']<0x18)throw new Error('Invalid\x20VLESS\x20header:\x20too\x20short');const c=new DataView(a);if(c['getUint8'](0x0)!==0x0)throw new Error('Invalid\x20VLESS\x20version:\x20'+c['getUint8'](0x0));const d=unsafeStringify(new Uint8Array(a['slice'](0x1,0x11))),e=await getUserData(b,d);if(!isUserValid(e))throw new Error('User\x20validation\x20failed\x20for\x20'+d+'.\x20User\x20might\x20be\x20expired\x20or\x20over\x20traffic\x20limit.');const f=c['getUint8'](0x11),g=c['getUint8'](0x12+f);if(g===0x2)throw new Error('UDP\x20is\x20not\x20supported.');if(g!==0x1)throw new Error('Unsupported\x20command:\x20'+g);const h=c['getUint16'](0x13+f);let i=0x15+f;const j=c['getUint8'](i++);let k='';if(j===0x1)k=new Uint8Array(a['slice'](i,i+0x4))['join']('.'),i+=0x4;else{if(j===0x2){const l=c['getUint8'](i++);k=new TextDecoder()['decode'](a['slice'](i,i+l)),i+=l;}else{if(j===0x3){const m=new DataView(a['buffer'],a['byteOffset']+i,0x10);k=Array['from']({'length':0x8},(n,o)=>m['getUint16'](o*0x2)['toString'](0x10))['join'](':'),i+=0x10;}else throw new Error('Unsupported\x20address\x20type:\x20'+j);}}return{'uuid':d,'address':k,'port':h,'rawDataIndex':i};}function base64ToArrayBuffer(a){if(!a)return null;try{const b=atob(a['replace'](/-/g,'+')['replace'](/_/g,'/')),c=new ArrayBuffer(b['length']),d=new Uint8Array(c);for(let e=0x0;e<b['length'];e++)d[e]=b['charCodeAt'](e);return c;}catch{return null;}}function safeCloseWebSocket(a){try{if(a['readyState']===CONST['WS_READY_STATE_OPEN'])a['close'](0x3e8,'Closing');}catch(b){log('Error\x20closing\x20WebSocket:\x20'+b,'warn');}}const byteToHex=Array['from']({'length':0x100},(a,b)=>(b+0x100)['toString'](0x10)['slice'](0x1));function unsafeStringify(a){return(byteToHex[a[0x0]]+byteToHex[a[0x1]]+byteToHex[a[0x2]]+byteToHex[a[0x3]]+'-'+byteToHex[a[0x4]]+byteToHex[a[0x5]]+'-'+byteToHex[a[0x6]]+byteToHex[a[0x7]]+'-'+byteToHex[a[0x8]]+byteToHex[a[0x9]]+'-'+byteToHex[a[0xa]]+byteToHex[a[0xb]]+byteToHex[a[0xc]]+byteToHex[a[0xd]]+byteToHex[a[0xe]]+byteToHex[a[0xf]])['toLowerCase']();}export default{async 'fetch'(a,b,c){try{const d=new URL(a['url']);if(d['pathname']['startsWith']('/admin'))return handleAdminRequest(a,b);if(a['headers']['get']('Upgrade')?.['toLowerCase']()==='websocket')return await vlessOverWSHandler(a,b,c);const f=async h=>{const i=d['pathname']['slice'](('/'+h+'/')['length']);if(!isValidUUID(i))return new Response('Invalid\x20UUID',{'status':0x190});const j=await getUserData(b,i);if(!isUserValid(j))return new Response('Invalid\x20or\x20expired\x20user',{'status':0x193});return handleIpSubscription(h,i,d['hostname']);};if(d['pathname']['startsWith']('/xray/'))return f('xray');if(d['pathname']['startsWith']('/sb/'))return f('sb');const g=d['pathname']['slice'](0x1);if(isValidUUID(g)){const h=await getUserData(b,g);if(!isUserValid(h))return new Response('Invalid\x20or\x20expired\x20user',{'status':0x193});const i=generateBeautifulConfigPage(g,d['hostname'],Config['fromEnv'](b)['proxyAddress'],h['expiration_date'],h['expiration_time'],h['data_limit'],h['used_traffic']);return new Response(i,{'headers':{'Content-Type':'text/html;\x20charset=utf-8',...CONST['securityHeaders']}});}if(b['ROOT_PROXY_URL']&&d['pathname']==='/')try{const j=new URL(b['ROOT_PROXY_URL']);j['pathname']=d['pathname'];let k=new Request(j,a);return k['headers']['set']('Host',j['hostname']),fetch(k);}catch(l){return new Response('ROOT_PROXY_URL\x20is\x20not\x20a\x20valid\x20URL:\x20'+l['message'],{'status':0x1f4});}return new Response('Not\x20Found',{'status':0x194});}catch(m){return log('Global\x20fetch\x20error:\x20'+m['stack'],'error'),new Response('Internal\x20Server\x20Error',{'status':0x1f4});}},async 'scheduled'(a,b,c){c['waitUntil'](cleanupExpiredUsers(b));}};