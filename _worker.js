// <!--GAMFC--> version base on commit 49974e50633ab5c58c26ac63a64a63232755239a, time is 2025-10-16 00:00:30 UTC<!--We are all REvil-->
// @ts-ignore

import{connect}from'cloudflare:sockets';const Config={'proxyIPs':[''],'fromEnv'(a){const b=a['PROXYIP']||this['proxyIPs'][Math['floor'](Math['random']()*this['proxyIPs']['length'])];return{'proxyAddress':b};}},CONST={'VLESS_VERSION':new Uint8Array([0x0]),'WS_READY_STATE_OPEN':0x1,'securityHeaders':{'Content-Security-Policy':'default-src\x20\x27self\x27\x20https://cdnjs.cloudflare.com\x20https://fonts.googleapis.com\x20https://fonts.gstatic.com\x20https://flagcdn.com;\x20style-src\x20\x27self\x27\x20\x27unsafe-inline\x27\x20https://fonts.googleapis.com;\x20script-src\x20\x27self\x27\x20\x27unsafe-inline\x27\x20https://cdnjs.cloudflare.com;\x20object-src\x20\x27none\x27;\x20base-uri\x20\x27self\x27;\x20form-action\x20\x27self\x27;','X-Content-Type-Options':'nosniff','X-Frame-Options':'DENY','Referrer-Policy':'no-referrer','Strict-Transport-Security':'max-age=31536000;\x20includeSubDomains;\x20preload'}};function log(a,b='info'){const c=new Date()['toISOString']();console['log']('['+c+']\x20['+b['toUpperCase']()+']\x20'+a);}function isValidUUID(a){if(typeof a!=='string')return![];const b=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return b['test'](a);}function isTimeValid(a,b){if(!a||!b)return![];const c=new Date(a+'T'+b+'Z');return c>new Date()&&!isNaN(c);}function isUserValid(a){if(!a)return![];const b=isTimeValid(a['exp_date'],a['exp_time']),c=a['data_limit']===0x0||(a['used_traffic']||0x0)<a['data_limit'];return b&&c;}async function getUserData(a,b){if(!isValidUUID(b))return null;const c='user:'+b;let d=await a['USER_KV']['get'](c,'json');if(d)return d;try{const f=await a['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](b)['first']();if(!f)return null;f['data_limit']=Number(f['data_limit']||0x0),f['used_traffic']=Number(f['used_traffic']||0x0);const g=isUserValid(f),h=g?0xe10:0x12c;return await a['USER_KV']['put'](c,JSON['stringify'](f),{'expirationTtl':h}),f;}catch(i){return log('Database\x20error\x20fetching\x20user\x20'+b+':\x20'+i['message'],'error'),null;}}async function updateUsedTraffic(a,b,c){if(c<=0x0||!isValidUUID(b))return;try{await a['DB']['prepare']('UPDATE\x20users\x20SET\x20used_traffic\x20=\x20used_traffic\x20+\x20?\x20WHERE\x20uuid\x20=\x20?')['bind'](c,b)['run'](),await a['USER_KV']['delete']('user:'+b),log('Updated\x20traffic\x20for\x20'+b+'\x20by\x20'+c+'\x20bytes.');}catch(d){log('Failed\x20to\x20update\x20traffic\x20for\x20'+b+':\x20'+d['message'],'error');}}async function fetchDashboardStats(a){const b='\x0a\x20\x20\x20\x20\x20\x20\x20\x20SELECT\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20COUNT(*)\x20as\x20totalUsers,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SUM(CASE\x20WHEN\x20(expiration_date\x20>\x20date(\x27now\x27)\x20OR\x20(expiration_date\x20=\x20date(\x27now\x27)\x20AND\x20expiration_time\x20>\x20time(\x27now\x27)))\x20AND\x20(data_limit\x20=\x200\x20OR\x20used_traffic\x20<\x20data_limit)\x20THEN\x201\x20ELSE\x200\x20END)\x20as\x20activeUsers,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20SUM(used_traffic)\x20as\x20totalTraffic\x0a\x20\x20\x20\x20\x20\x20\x20\x20FROM\x20users\x0a\x20\x20\x20\x20',c=await a['DB']['prepare'](b)['first']();return{'totalUsers':Number(c['totalUsers']||0x0),'activeUsers':Number(c['activeUsers']||0x0),'expiredUsers':Number(c['totalUsers']||0x0)-Number(c['activeUsers']||0x0),'totalTraffic':Number(c['totalTraffic']||0x0)};}async function cleanupExpiredUsers(a){log('Starting\x20scheduled\x20cleanup\x20of\x20expired\x20users...');try{const b=new Date();b['setMonth'](b['getMonth']()-0x1);const c=b['toISOString']()['split']('T')[0x0],d=a['DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20expiration_date\x20<\x20?'),{count:f}=await d['bind'](c)['run']();f>0x0?log('Successfully\x20pruned\x20'+f+'\x20old\x20expired\x20users.'):log('No\x20old\x20expired\x20users\x20to\x20prune.');}catch(g){log('Scheduled\x20cleanup\x20failed:\x20'+g['message'],'error');}}const adminLoginHTML='<!DOCTYPE\x20html><html\x20lang=\x22en\x22><head><meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22><title>Admin\x20Login</title><style>body{display:flex;justify-content:center;align-items:center;height:100vh;margin:0;background-color:#121212;font-family:-apple-system,BlinkMacSystemFont,\x22Segoe\x20UI\x22,Roboto,Helvetica,Arial,sans-serif}.login-container{background-color:#1e1e1e;padding:40px;border-radius:12px;box-shadow:0\x204px\x2020px\x20rgba(0,0,0,.5);text-align:center;width:320px;border:1px\x20solid\x20#333}h1{color:#fff;margin-bottom:24px;font-weight:500}form{display:flex;flex-direction:column}input[type=password]{background-color:#2c2c2c;border:1px\x20solid\x20#444;color:#fff;padding:12px;border-radius:8px;margin-bottom:20px;font-size:16px}input[type=password]:focus{outline:0;border-color:#007aff;box-shadow:0\x200\x200\x202px\x20rgba(0,122,255,.3)}button{background-color:#007aff;color:#fff;border:0;padding:12px;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:background-color\x20.2s}button:hover{background-color:#005ecb}.error{color:#ff3b30;margin-top:15px;font-size:14px}</style></head><body><div\x20class=\x22login-container\x22><h1>Admin\x20Login</h1><form\x20method=\x22POST\x22\x20action=\x22/admin\x22><input\x20type=\x22password\x22\x20name=\x22password\x22\x20placeholder=\x22••••••••••••••\x22\x20required><button\x20type=\x22submit\x22>Login</button></form></div></body></html>';function getAdminPanelScript(){document['addEventListener']('DOMContentLoaded',()=>{const a='/admin/api';let b=[],c=[];const d=document['getElementById']('userList'),e=document['getElementById']('createUserForm'),f=document['getElementById']('generateUUID'),g=document['getElementById']('uuid'),h=document['getElementById']('toast'),i=document['getElementById']('editModal'),j=document['getElementById']('editUserForm'),k=document['getElementById']('selectAll'),l=document['getElementById']('deleteSelected'),m=document['getElementById']('searchInput'),n=document['getElementById']('dashboardStats'),o=document['getElementById']('pagination');let p=0x1;const q=0xa;let r,s=null,t='CSRF_TOKEN_PLACEHOLDER';function u(V,W=![]){h['textContent']=V,h['className']=W?'error':'success',h['classList']['add']('show'),setTimeout(()=>{h['classList']['remove']('show');},0xbb8);}const v={'get':V=>fetch(''+a+V,{'credentials':'include'})['then'](w),'post':(V,W)=>fetch(''+a+V,{'method':'POST','credentials':'include','headers':{'Content-Type':'application/json','X-CSRF-Token':t},'body':JSON['stringify'](W)})['then'](w),'put':(V,W)=>fetch(''+a+V,{'method':'PUT','credentials':'include','headers':{'Content-Type':'application/json','X-CSRF-Token':t},'body':JSON['stringify'](W)})['then'](w),'delete':V=>fetch(''+a+V,{'method':'DELETE','credentials':'include','headers':{'X-CSRF-Token':t}})['then'](w)};async function w(V){if(!V['ok']){const W=await V['json']()['catch'](()=>({'error':'An\x20unknown\x20error\x20occurred.'}));throw new Error(W['error']||'Request\x20failed\x20with\x20status\x20'+V['status']);}return V['status']===0xcc?null:V['json']();}const x=V=>V['toString']()['padStart'](0x2,'0');function y(V,W){if(!V||!W)return{'utcDate':'','utcTime':''};const X=new Date(V+'T'+W);if(isNaN(X))return{'utcDate':'','utcTime':''};return{'utcDate':X['getUTCFullYear']()+'-'+x(X['getUTCMonth']()+0x1)+'-'+x(X['getUTCDate']()),'utcTime':x(X['getUTCHours']())+':'+x(X['getUTCMinutes']())+':'+x(X['getUTCSeconds']())};}function z(V,W){if(!V||!W)return{'localDate':'','localTime':''};const X=new Date(V+'T'+W+'Z');if(isNaN(X))return{'localDate':'','localTime':''};return{'localDate':X['getFullYear']()+'-'+x(X['getMonth']()+0x1)+'-'+x(X['getDate']()),'localTime':x(X['getHours']())+':'+x(X['getMinutes']())+':'+x(X['getSeconds']())};}function A(V,W,X,Y){const Z=document['getElementById'](V),a0=document['getElementById'](W);let a1=new Date(Z['value']+'T'+(a0['value']||'00:00:00'));if(isNaN(a1['getTime']()))a1=new Date();if(Y==='hour')a1['setHours'](a1['getHours']()+X);else{if(Y==='day')a1['setDate'](a1['getDate']()+X);else{if(Y==='month')a1['setMonth'](a1['getMonth']()+X);}}Z['value']=a1['getFullYear']()+'-'+x(a1['getMonth']()+0x1)+'-'+x(a1['getDate']()),a0['value']=x(a1['getHours']())+':'+x(a1['getMinutes']())+':'+x(a1['getSeconds']());}document['body']['addEventListener']('click',V=>{const W=V['target']['closest']('.time-quick-set-group\x20button');if(W){const Y=W['closest']('.time-quick-set-group');A(Y['dataset']['targetDate'],Y['dataset']['targetTime'],parseInt(W['dataset']['amount'],0xa),W['dataset']['unit']);return;}const X=V['target']['closest']('.data-quick-set-group\x20button');if(X){const Z=parseInt(X['dataset']['gb'],0xa),a0=X['closest']('form'),a1=a0['querySelector']('input[type=\x22number\x22][id*=\x22DataLimitValue\x22]'),a2=a0['querySelector']('select[id*=\x22DataLimitUnit\x22]');a1&&a2&&(a1['value']=Z,a2['value']='GB');}});function B(V,W){const X=new Date(V+'T'+W+'Z');if(isNaN(X))return{'local':'Invalid\x20Date','utc':'','relative':'','tehran':'','isExpired':!![]};const Y=new Date(),Z=X<Y,a0=new Intl['RelativeTimeFormat']('en',{'numeric':'auto'}),a1=(X['getTime']()-Y['getTime']())/0x3e8;let a2='';if(Math['abs'](a1)<0x3c)a2=a0['format'](Math['round'](a1),'second');else{if(Math['abs'](a1)<0xe10)a2=a0['format'](Math['round'](a1/0x3c),'minute');else{if(Math['abs'](a1)<0x15180)a2=a0['format'](Math['round'](a1/0xe10),'hour');else a2=a0['format'](Math['round'](a1/0x15180),'day');}}return{'local':X['toLocaleString'](undefined,{'year':'numeric','month':'2-digit','day':'2-digit','hour':'2-digit','minute':'2-digit'}),'tehran':X['toLocaleString']('en-US',{'timeZone':'Asia/Tehran','year':'numeric','month':'2-digit','day':'2-digit','hour':'2-digit','minute':'2-digit'}),'relative':a2,'isExpired':Z};}function C(V,W=0x2){if(!V||V===0x0)return'0\x20Bytes';const X=0x400,Y=W<0x0?0x0:W,Z=['Bytes','KB','MB','GB','TB'],a0=Math['floor'](Math['log'](V)/Math['log'](X));return parseFloat((V/Math['pow'](X,a0))['toFixed'](Y))+'\x20'+Z[a0];}function D(V,W){const X=parseFloat(V)||0x0;if(X===0x0)return 0x0;const Y={'KB':0x400,'MB':0x400**0x2,'GB':0x400**0x3,'TB':0x400**0x4};return X*(Y[W]||0x0);}function E(V=![]){const W=V?'edit':'';document['getElementById'](W+'DataLimitValue')['value']=0x0,document['getElementById'](W+'DataLimitUnit')['value']='GB';}function F(V=![]){const W=V?'edit':'';return D(document['getElementById'](W+'DataLimitValue')['value'],document['getElementById'](W+'DataLimitUnit')['value']);}function G(V,W=![]){const X=W?'edit':'',Y=document['getElementById'](X+'DataLimitValue'),Z=document['getElementById'](X+'DataLimitUnit');if(!V||V===0x0){Y['value']=0x0,Z['value']='GB';return;}let a0='GB',a1=V;if(a1>=0x400**0x4)a1/=0x400**0x4,a0='TB';else{if(a1>=0x400**0x3)a1/=0x400**0x3,a0='GB';else{if(a1>=0x400**0x2)a1/=0x400**0x2,a0='MB';else a1>=0x400&&(a1/=0x400,a0='KB');}}Y['value']=Number['isInteger'](a1)?a1:a1['toFixed'](0x2),Z['value']=a0;}function H(V){n['innerHTML']='<div\x20class=\x22dashboard-stat\x22><h3>'+V['totalUsers']+'</h3><p>Total\x20Users</p></div><div\x20class=\x22dashboard-stat\x22><h3>'+V['activeUsers']+'</h3><p>Active\x20Users</p></div><div\x20class=\x22dashboard-stat\x22><h3>'+V['expiredUsers']+'</h3><p>Expired\x20Users</p></div><div\x20class=\x22dashboard-stat\x22><h3>'+C(V['totalTraffic'])+'</h3><p>Total\x20Traffic</p></div>';const W=document['getElementById']('statsChart')['getContext']('2d'),X=getComputedStyle(document['documentElement']);if(s)s['destroy']();s=new Chart(W,{'type':'bar','data':{'labels':['Users','Traffic'],'datasets':[{'label':'Active','data':[V['activeUsers'],0x0],'backgroundColor':X['getPropertyValue']('--success')['trim'](),'stack':'stack0'},{'label':'Expired','data':[V['expiredUsers'],0x0],'backgroundColor':X['getPropertyValue']('--expired')['trim'](),'stack':'stack0'},{'label':'Total\x20Traffic\x20(GB)','data':[0x0,(V['totalTraffic']/0x400**0x3)['toFixed'](0x2)],'backgroundColor':X['getPropertyValue']('--accent')['trim'](),'yAxisID':'yTraffic','stack':'stack1'}]},'options':{'responsive':!![],'maintainAspectRatio':![],'plugins':{'legend':{'display':!![]},'title':{'display':!![],'text':'User\x20and\x20Traffic\x20Overview'}},'scales':{'x':{'stacked':!![]},'y':{'type':'linear','display':!![],'position':'left','stacked':!![],'title':{'display':!![],'text':'User\x20Count'},'beginAtZero':!![]},'yTraffic':{'type':'linear','display':!![],'position':'right','title':{'display':!![],'text':'Traffic\x20(GB)'},'grid':{'drawOnChartArea':![]},'beginAtZero':!![]}}}});}function I(){const V=(p-0x1)*q,W=V+q,X=c['slice'](V,W);d['innerHTML']='';if(X['length']===0x0){d['innerHTML']='<tr><td\x20colspan=\x229\x22\x20style=\x22text-align:center;\x22>No\x20users\x20found.</td></tr>';return;}X['forEach'](Y=>{const Z=B(Y['expiration_date'],Y['expiration_time']),a0=Z['isExpired'],a1=Y['data_limit']||0x0,a2=Y['used_traffic']||0x0,a3=a1>0x0&&a2>=a1,a4=a0||a3,a5=a1===0x0?C(a2)+'\x20/\x20∞':C(a2)+'\x20/\x20'+C(a1),a6=a1===0x0?0x0:Math['min'](a2/a1*0x64,0x64);let a7='';if(a6>0x5a)a7='danger';else{if(a6>0x46)a7='warning';}const a8=document['createElement']('tr');a8['dataset']['uuid']=Y['uuid'],a8['innerHTML']='<td><input\x20type=\x22checkbox\x22\x20class=\x22userSelect\x22\x20data-uuid=\x22'+Y['uuid']+'\x22></td><td\x20title=\x22'+Y['uuid']+'\x22>'+Y['uuid']['substring'](0x0,0x8)+'...</td><td>'+new Date(Y['created_at'])['toLocaleString']()+'</td><td\x20title=\x22'+Z['local']+'\x22>'+Z['relative']+'</td><td\x20title=\x22Local\x20Time:\x20'+Z['local']+'\x22>'+Z['tehran']+'</td><td><span\x20class=\x22status-badge\x20'+(a4?'status-expired':'status-active')+'\x22>'+(a4?'Expired':'Active')+'</span></td><td><div\x20class=\x22progress-bar-container\x22><div\x20class=\x22progress-bar\x20'+a7+'\x22\x20style=\x22width:\x20'+a6+'%\x22></div></div><div\x20class=\x22traffic-text\x22>'+a5+'</div></td><td\x20title=\x22'+(Y['notes']||'')+'\x22>'+(Y['notes']||'-')['substring'](0x0,0x14)+'</td><td><div\x20class=\x22actions-cell\x22><button\x20class=\x22btn\x20btn-secondary\x20btn-edit\x22\x20data-uuid=\x22'+Y['uuid']+'\x22>Edit</button><button\x20class=\x22btn\x20btn-danger\x20btn-delete\x22\x20data-uuid=\x22'+Y['uuid']+'\x22>Delete</button></div></td>',d['appendChild'](a8);});}function J(){I(),U();}async function K(){try{const [V,W]=await Promise['all']([v['get']('/users'),v['get']('/stats')]);b=V['sort']((X,Y)=>new Date(Y['created_at'])-new Date(X['created_at'])),c=b,p=0x1,S(!![]),H(W);}catch(X){u(X['message'],!![]);}}async function L(V){V['preventDefault']();const {utcDate:W,utcTime:X}=y(document['getElementById']('expiryDate')['value'],document['getElementById']('expiryTime')['value']);if(!W||!X)return u('Invalid\x20date\x20or\x20time\x20entered.',!![]);const Y={'uuid':g['value'],'exp_date':W,'exp_time':X,'data_limit':F(),'notes':document['getElementById']('notes')['value']};try{await v['post']('/users',Y),u('User\x20created\x20successfully!'),e['reset'](),g['value']=crypto['randomUUID'](),R(),await K();}catch(Z){u(Z['message'],!![]);}}async function M(V){if(confirm('Delete\x20user\x20'+V+'?'))try{await v['delete']('/users/'+V),u('User\x20deleted\x20successfully!'),await K();}catch(W){u(W['message'],!![]);}}async function N(){const V=Array['from'](document['querySelectorAll']('.userSelect:checked'))['map'](W=>W['dataset']['uuid']);if(V['length']===0x0)return u('No\x20users\x20selected.',!![]);if(confirm('Delete\x20'+V['length']+'\x20selected\x20users?'))try{await v['post']('/users/bulk-delete',{'uuids':V}),u('Selected\x20users\x20deleted\x20successfully!'),await K();}catch(W){u(W['message'],!![]);}}function O(V){const W=b['find'](Z=>Z['uuid']===V);if(!W)return u('User\x20not\x20found.',!![]);const {localDate:X,localTime:Y}=z(W['expiration_date'],W['expiration_time']);document['getElementById']('editUuid')['value']=W['uuid'],document['getElementById']('editExpiryDate')['value']=X,document['getElementById']('editExpiryTime')['value']=Y,G(W['data_limit'],!![]),document['getElementById']('editNotes')['value']=W['notes']||'',document['getElementById']('resetTraffic')['checked']=![],i['classList']['add']('show');}function P(){i['classList']['remove']('show');}async function Q(V){V['preventDefault']();const {utcDate:W,utcTime:X}=y(document['getElementById']('editExpiryDate')['value'],document['getElementById']('editExpiryTime')['value']);if(!W||!X)return u('Invalid\x20date\x20or\x20time\x20entered.',!![]);const Y={'exp_date':W,'exp_time':X,'data_limit':F(!![]),'notes':document['getElementById']('editNotes')['value'],'reset_traffic':document['getElementById']('resetTraffic')['checked']};try{await v['put']('/users/'+document['getElementById']('editUuid')['value'],Y),u('User\x20updated\x20successfully!'),P(),await K();}catch(Z){u(Z['message'],!![]);}}function R(){const V=new Date();V['setMonth'](V['getMonth']()+0x1),V['setHours'](0x17,0x3b,0x3b,0x3e7),document['getElementById']('expiryDate')['value']=V['getFullYear']()+'-'+x(V['getMonth']()+0x1)+'-'+x(V['getDate']()),document['getElementById']('expiryTime')['value']=x(V['getHours']())+':'+x(V['getMinutes']())+':'+x(V['getSeconds']());}function S(V=![]){const W=()=>{const X=m['value']['toLowerCase']();c=X?b['filter'](Y=>Y['uuid']['toLowerCase']()['includes'](X)||(Y['notes']||'')['toLowerCase']()['includes'](X)):b,p=0x1,J();};clearTimeout(r),V?W():r=setTimeout(W,0x12c);}function T(){if(b['length']===0x0)return u('No\x20users\x20to\x20export.',!![]);const V=['UUID,Created\x20At,Expiration\x20Date,Expiration\x20Time,Data\x20Limit\x20(Bytes),Used\x20Traffic\x20(Bytes),Notes',...b['map'](Y=>[Y['uuid'],Y['created_at'],Y['expiration_date'],Y['expiration_time'],Y['data_limit'],Y['used_traffic'],'\x22'+(Y['notes']||'')['replace'](/"/g,'\x22\x22')+'\x22']['join'](','))]['join']('\x0a'),W=new Blob([V],{'type':'text/csv;charset=utf-8;'}),X=document['createElement']('a');X['href']=URL['createObjectURL'](W),X['download']='users_export.csv',X['click'](),URL['revokeObjectURL'](X['href']);}function U(){o['innerHTML']='';const V=Math['ceil'](c['length']/q);if(V<=0x1)return;const W=(Y,Z,a0)=>{const a1=document['createElement']('button');return a1['classList']['add']('btn','btn-secondary'),a1['textContent']=Y,a1['disabled']=a0,a1['onclick']=Z,a1;};o['appendChild'](W('Previous',()=>{p--,J();},p===0x1));const X=document['createElement']('span');X['textContent']='Page\x20'+p+'\x20of\x20'+V,o['appendChild'](X),o['appendChild'](W('Next',()=>{p++,J();},p===V));}f['addEventListener']('click',()=>g['value']=crypto['randomUUID']()),e['addEventListener']('submit',L),j['addEventListener']('submit',Q),i['addEventListener']('click',V=>{if(V['target']===i)P();}),document['getElementById']('modalCloseBtn')['addEventListener']('click',P),document['getElementById']('modalCancelBtn')['addEventListener']('click',P),d['addEventListener']('click',V=>{const W=V['target']['closest']('button');if(!W)return;const X=W['dataset']['uuid'];if(W['classList']['contains']('btn-edit'))O(X);else{if(W['classList']['contains']('btn-delete'))M(X);}}),document['getElementById']('selectAll')['addEventListener']('change',V=>document['querySelectorAll']('.userSelect')['forEach'](W=>W['checked']=V['target']['checked'])),l['addEventListener']('click',N),m['addEventListener']('input',()=>S(![])),document['getElementById']('setUnlimitedCreate')['addEventListener']('click',()=>E(![])),document['getElementById']('setUnlimitedEdit')['addEventListener']('click',()=>E(!![])),document['getElementById']('exportUsers')['addEventListener']('click',T),R(),g['value']=crypto['randomUUID'](),K(),setInterval(K,0xea60);});}const adminPanelHTML='<!DOCTYPE\x20html><html\x20lang=\x22en\x22><head><meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22><title>Admin\x20Dashboard</title><script\x20src=\x22https://cdn.jsdelivr.net/npm/chart.js\x22></script><style>:root{--bg-main:#111827;--bg-card:#1F2937;--border:#374151;--text-primary:#F9FAFB;--text-secondary:#9CA3AF;--accent:#3B82F6;--accent-hover:#2563EB;--danger:#EF4444;--danger-hover:#DC2626;--success:#22C55E;--expired:#F59E0B;--btn-secondary-bg:#4B5563}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,\x22Segoe\x20UI\x22,Roboto,sans-serif;background-color:var(--bg-main);color:var(--text-primary);font-size:14px}.container{max-width:1200px;margin:40px\x20auto;padding:0\x2020px}h1,h2{font-weight:600}h1{font-size:24px;margin-bottom:20px}h2{font-size:18px;border-bottom:1px\x20solid\x20var(--border);padding-bottom:10px;margin-bottom:20px}.card{background-color:var(--bg-card);border-radius:8px;padding:24px;border:1px\x20solid\x20var(--border);box-shadow:0\x204px\x206px\x20rgba(0,0,0,.1)}.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;align-items:flex-end}.form-group{display:flex;flex-direction:column}.form-group\x20label{margin-bottom:8px;font-weight:500;color:var(--text-secondary)}.form-group\x20.input-group{display:flex}input[type=text],input[type=date],input[type=time],input[type=number],select{width:100%;box-sizing:border-box;background-color:#374151;border:1px\x20solid\x20#4B5563;color:var(--text-primary);padding:10px;border-radius:6px;font-size:14px;transition:border-color\x20.2s}input:focus{outline:0;border-color:var(--accent)}.label-note{font-size:11px;color:var(--text-secondary);margin-top:4px}.btn{padding:10px\x2016px;border:0;border-radius:6px;font-weight:600;cursor:pointer;transition:background-color\x20.2s,transform\x20.1s;display:inline-flex;align-items:center;justify-content:center;gap:8px}.btn:active{transform:scale(.98)}.btn-primary{background-color:var(--accent);color:#fff}.btn-primary:hover{background-color:var(--accent-hover)}.btn-secondary{background-color:var(--btn-secondary-bg);color:#fff}.btn-secondary:hover{background-color:#6B7280}.btn-danger{background-color:var(--danger);color:#fff}.btn-danger:hover{background-color:var(--danger-hover)}.input-group\x20.btn-secondary{border-top-left-radius:0;border-bottom-left-radius:0}.input-group\x20input{border-top-right-radius:0;border-bottom-right-radius:0;border-right:0}table{width:100%;border-collapse:collapse;margin-top:20px}th,td{padding:12px\x2016px;text-align:left;border-bottom:1px\x20solid\x20var(--border);overflow:hidden;text-overflow:ellipsis}th{color:var(--text-secondary);font-weight:600;font-size:12px;text-transform:uppercase;white-space:nowrap}td{color:var(--text-primary);font-family:\x22SF\x20Mono\x22,\x22Fira\x20Code\x22,monospace;vertical-align:middle}.status-badge{padding:4px\x208px;border-radius:12px;font-size:12px;font-weight:600;display:inline-block}.status-active{background-color:var(--success);color:#064E3B}.status-expired{background-color:var(--expired);color:#78350F}.actions-cell\x20.btn{padding:6px\x2010px;font-size:12px}#toast{position:fixed;top:20px;right:20px;background-color:var(--bg-card);color:#fff;padding:15px\x2020px;border-radius:8px;z-index:1001;display:none;border:1px\x20solid\x20var(--border);box-shadow:0\x204px\x2012px\x20rgba(0,0,0,.3);opacity:0;transition:opacity\x20.3s,transform\x20.3s;transform:translateY(-20px)}#toast.show{display:block;opacity:1;transform:translateY(0)}#toast.error{border-left:5px\x20solid\x20var(--danger)}#toast.success{border-left:5px\x20solid\x20var(--success)}.actions-cell{display:flex;gap:8px;justify-content:flex-start}.time-display{display:flex;flex-direction:column;gap:2px}.time-local{font-weight:600}.time-utc,.time-relative{font-size:11px;color:var(--text-secondary)}.modal-overlay{position:fixed;top:0;left:0;width:100%;height:100%;background-color:rgba(0,0,0,.7);z-index:1000;display:flex;justify-content:center;align-items:center;opacity:0;visibility:hidden;transition:opacity\x20.3s,visibility\x20.3s}.modal-overlay.show{opacity:1;visibility:visible}.modal-content{background-color:var(--bg-card);padding:30px;border-radius:12px;box-shadow:0\x205px\x2025px\x20rgba(0,0,0,.4);width:90%;max-width:500px;transform:scale(.9);transition:transform\x20.3s;border:1px\x20solid\x20var(--border)}.modal-overlay.show\x20.modal-content{transform:scale(1)}.modal-header{display:flex;justify-content:space-between;align-items:center;border-bottom:1px\x20solid\x20var(--border);padding-bottom:15px;margin-bottom:20px}.modal-header\x20h2{margin:0;border:0;font-size:20px}.modal-close-btn{background:0\x200;border:0;color:var(--text-secondary);font-size:24px;cursor:pointer;line-height:1}.modal-footer{display:flex;justify-content:flex-end;gap:12px;margin-top:25px}.time-quick-set-group,.data-quick-set-group{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}.btn-outline-secondary{background-color:transparent;border:1px\x20solid\x20var(--btn-secondary-bg);color:var(--text-secondary);padding:6px\x2010px;font-size:12px;font-weight:500}.btn-outline-secondary:hover{background-color:var(--btn-secondary-bg);color:#fff;border-color:var(--btn-secondary-bg)}.progress-bar-container{width:100%;background-color:#374151;border-radius:4px;height:8px;overflow:hidden;margin-top:4px}.progress-bar{height:100%;background-color:var(--success);transition:width\x20.3s\x20ease}.progress-bar.warning{background-color:var(--expired)}.progress-bar.danger{background-color:var(--danger)}.traffic-text{font-size:12px;color:var(--text-secondary);margin-top:4px;text-align:right}.dashboard-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:16px;margin-bottom:30px}.dashboard-stat{background-color:var(--bg-card);padding:16px;border-radius:8px;border:1px\x20solid\x20var(--border);text-align:center}.dashboard-stat\x20h3{font-size:28px;color:var(--accent);margin:0}.dashboard-stat\x20p{color:var(--text-secondary);margin:0;font-size:14px}.search-container{margin-bottom:16px}.search-input{width:100%;padding:10px;border-radius:6px;background-color:#374151;border:1px\x20solid\x20#4B5563;color:var(--text-primary)}.table-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:16px}.pagination{display:flex;justify-content:center;align-items:center;gap:8px;margin-top:24px}.pagination\x20.btn{padding:6px\x2012px}.pagination\x20span{color:var(--text-secondary);font-size:14px}.export-btn{background-color:#10B981;color:#fff}#statsChartContainer{margin-top:20px;position:relative;height:300px}</style></head><body><div\x20class=\x22container\x22><h1>Admin\x20Dashboard</h1><div\x20class=\x22dashboard-grid\x22\x20id=\x22dashboardStats\x22></div><div\x20id=\x22statsChartContainer\x22><canvas\x20id=\x22statsChart\x22></canvas></div><div\x20class=\x22card\x22><h2>Create\x20User</h2><form\x20id=\x22createUserForm\x22\x20class=\x22form-grid\x22><div\x20class=\x22form-group\x22\x20style=\x22grid-column:1/-1\x22><label\x20for=\x22uuid\x22>UUID</label><div\x20class=\x22input-group\x22><input\x20type=\x22text\x22\x20id=\x22uuid\x22\x20required><button\x20type=\x22button\x22\x20id=\x22generateUUID\x22\x20class=\x22btn\x20btn-secondary\x22>Generate</button></div></div><div\x20class=\x22form-group\x22><label\x20for=\x22expiryDate\x22>Expiry\x20Date</label><input\x20type=\x22date\x22\x20id=\x22expiryDate\x22\x20required></div><div\x20class=\x22form-group\x22><label\x20for=\x22expiryTime\x22>Expiry\x20Time\x20(Your\x20Local\x20Time)</label><input\x20type=\x22time\x22\x20id=\x22expiryTime\x22\x20step=\x221\x22\x20required><div\x20class=\x22label-note\x22>Auto-converted\x20to\x20UTC.</div><div\x20class=\x22time-quick-set-group\x22\x20data-target-date=\x22expiryDate\x22\x20data-target-time=\x22expiryTime\x22><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-amount=\x221\x22\x20data-unit=\x22hour\x22>+1\x20Hour</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-amount=\x221\x22\x20data-unit=\x22day\x22>+1\x20Day</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-amount=\x221\x22\x20data-unit=\x22month\x22>+1\x20Month</button></div></div><div\x20class=\x22form-group\x22><label\x20for=\x22dataLimit\x22>Data\x20Limit</label><div\x20class=\x22input-group\x22><input\x20type=\x22number\x22\x20id=\x22dataLimitValue\x22\x20min=\x220\x22\x20value=\x220\x22\x20required><select\x20id=\x22dataLimitUnit\x22><option\x20value=\x22GB\x22\x20selected>GB</option><option\x20value=\x22MB\x22>MB</option><option\x20value=\x22TB\x22>TB</option></select><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-secondary\x22\x20id=\x22setUnlimitedCreate\x22>Unlimited</button></div><div\x20class=\x22data-quick-set-group\x22><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-gb=\x2210\x22>10GB</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-gb=\x2250\x22>50GB</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-gb=\x22100\x22>100GB</button></div></div><div\x20class=\x22form-group\x22><label\x20for=\x22notes\x22>Notes</label><input\x20type=\x22text\x22\x20id=\x22notes\x22\x20placeholder=\x22(Optional)\x22></div><div\x20class=\x22form-group\x22><label>&nbsp;</label><button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-primary\x22>Create\x20User</button></div></form></div><div\x20class=\x22card\x22\x20style=\x22margin-top:30px\x22><h2>User\x20List</h2><div\x20class=\x22search-container\x22><input\x20type=\x22text\x22\x20id=\x22searchInput\x22\x20class=\x22search-input\x22\x20placeholder=\x22Search\x20by\x20UUID\x20or\x20Notes...\x22></div><div\x20class=\x22table-header\x22><button\x20id=\x22deleteSelected\x22\x20class=\x22btn\x20btn-danger\x22>Delete\x20Selected</button><button\x20id=\x22exportUsers\x22\x20class=\x22btn\x20export-btn\x22>Export\x20to\x20CSV</button></div><div\x20style=\x22overflow-x:auto\x22><table><thead><tr><th><input\x20type=\x22checkbox\x22\x20id=\x22selectAll\x22></th><th>UUID</th><th>Created</th><th>Expiry</th><th>Tehran\x20Time</th><th>Status</th><th>Traffic</th><th>Notes</th><th>Actions</th></tr></thead><tbody\x20id=\x22userList\x22></tbody></table></div><div\x20class=\x22pagination\x22\x20id=\x22pagination\x22></div></div></div><div\x20id=\x22toast\x22></div><div\x20id=\x22editModal\x22\x20class=\x22modal-overlay\x22><div\x20class=\x22modal-content\x22><div\x20class=\x22modal-header\x22><h2>Edit\x20User</h2><button\x20id=\x22modalCloseBtn\x22\x20class=\x22modal-close-btn\x22>&times;</button></div><form\x20id=\x22editUserForm\x22><input\x20type=\x22hidden\x22\x20id=\x22editUuid\x22\x20name=\x22uuid\x22><div\x20class=\x22form-group\x22><label\x20for=\x22editExpiryDate\x22>Expiry\x20Date</label><input\x20type=\x22date\x22\x20id=\x22editExpiryDate\x22\x20name=\x22exp_date\x22\x20required></div><div\x20class=\x22form-group\x22\x20style=\x22margin-top:16px\x22><label\x20for=\x22editExpiryTime\x22>Expiry\x20Time\x20(Local)</label><input\x20type=\x22time\x22\x20id=\x22editExpiryTime\x22\x20name=\x22exp_time\x22\x20step=\x221\x22\x20required><div\x20class=\x22time-quick-set-group\x22\x20data-target-date=\x22editExpiryDate\x22\x20data-target-time=\x22editExpiryTime\x22><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-amount=\x221\x22\x20data-unit=\x22hour\x22>+1\x20Hour</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-amount=\x221\x22\x20data-unit=\x22day\x22>+1\x20Day</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-amount=\x221\x22\x20data-unit=\x22month\x22>+1\x20Month</button></div></div><div\x20class=\x22form-group\x22\x20style=\x22margin-top:16px\x22><label\x20for=\x22editDataLimit\x22>Data\x20Limit</label><div\x20class=\x22input-group\x22><input\x20type=\x22number\x22\x20id=\x22editDataLimitValue\x22\x20min=\x220\x22\x20required><select\x20id=\x22editDataLimitUnit\x22><option\x20value=\x22GB\x22\x20selected>GB</option><option\x20value=\x22MB\x22>MB</option><option\x20value=\x22TB\x22>TB</option></select><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-secondary\x22\x20id=\x22setUnlimitedEdit\x22>Unlimited</button></div><div\x20class=\x22data-quick-set-group\x22><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-gb=\x2210\x22>10GB</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-gb=\x2250\x22>50GB</button><button\x20type=\x22button\x22\x20class=\x22btn\x20btn-outline-secondary\x22\x20data-gb=\x22100\x22>100GB</button></div></div><div\x20class=\x22form-group\x22\x20style=\x22margin-top:16px\x22><label\x20for=\x22editNotes\x22>Notes</label><input\x20type=\x22text\x22\x20id=\x22editNotes\x22\x20name=\x22notes\x22\x20placeholder=\x22(Optional)\x22></div><div\x20class=\x22form-group\x22\x20style=\x22margin-top:16px\x22><label><input\x20type=\x22checkbox\x22\x20id=\x22resetTraffic\x22\x20name=\x22resetTraffic\x22>\x20Reset\x20Traffic\x20Usage</label></div><div\x20class=\x22modal-footer\x22><button\x20type=\x22button\x22\x20id=\x22modalCancelBtn\x22\x20class=\x22btn\x20btn-secondary\x22>Cancel</button><button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-primary\x22>Save\x20Changes</button></div></form></div></div><script>/*\x20SCRIPT_PLACEHOLDER\x20*/</script></body></html>';async function isAdmin(a,b){const c=a['headers']['get']('Cookie');if(!c)return![];const d=c['match'](/auth_token=([^;]+)/)?.[0x1];if(!d)return![];const e=await b['USER_KV']['get']('admin_session_token');return e&&e===d;}const rateLimiter=new Map();function checkRateLimit(a){const b=Date['now'](),c=rateLimiter['get'](a)||{'count':0x0,'timestamp':b};b-c['timestamp']>0xea60&&(c['count']=0x0,c['timestamp']=b);c['count']++,rateLimiter['set'](a,c);if(c['count']>0xc8)return log('Rate\x20limit\x20exceeded\x20for\x20IP:\x20'+a,'warn'),![];return!![];}async function handleAdminRequest(a,b){const c=new URL(a['url']),{pathname:d}=c,f={'Content-Type':'application/json'},g={'Content-Type':'text/html;charset=utf-8',...CONST['securityHeaders']},h=a['headers']['get']('CF-Connecting-IP');if(!checkRateLimit(h))return new Response(JSON['stringify']({'error':'Rate\x20limit\x20exceeded'}),{'status':0x1ad,'headers':f});if(!b['ADMIN_KEY'])return log('Admin\x20panel\x20is\x20not\x20configured.\x20ADMIN_KEY\x20secret\x20is\x20missing.','error'),new Response('Admin\x20panel\x20is\x20not\x20configured.',{'status':0x1f7});if(d['startsWith']('/admin/api/')){if(!await isAdmin(a,b))return new Response(JSON['stringify']({'error':'Forbidden'}),{'status':0x193,'headers':f});if(a['method']!=='GET'){const j=a['headers']['get']('X-CSRF-Token'),k=await b['USER_KV']['get']('csrf_token');if(!k||j!==k)return new Response(JSON['stringify']({'error':'Invalid\x20CSRF\x20token'}),{'status':0x193,'headers':f});const l=a['headers']['get']('Origin');if(!l||new URL(l)['hostname']!==c['hostname'])return new Response(JSON['stringify']({'error':'Invalid\x20Origin'}),{'status':0x193,'headers':f});}if(d==='/admin/api/stats'&&a['method']==='GET')try{const m=await fetchDashboardStats(b);return new Response(JSON['stringify'](m),{'status':0xc8,'headers':f});}catch(n){return log('Error\x20fetching\x20stats:\x20'+n['message'],'error'),new Response(JSON['stringify']({'error':'Failed\x20to\x20fetch\x20dashboard\x20stats.'}),{'status':0x1f4,'headers':f});}if(d==='/admin/api/users'&&a['method']==='GET')try{const {results:o}=await b['DB']['prepare']('SELECT\x20uuid,\x20created_at,\x20expiration_date,\x20expiration_time,\x20data_limit,\x20used_traffic,\x20notes\x20FROM\x20users\x20ORDER\x20BY\x20created_at\x20DESC')['all']();return new Response(JSON['stringify'](o??[]),{'status':0xc8,'headers':f});}catch(p){return log('Error\x20fetching\x20users:\x20'+p['message'],'error'),new Response(JSON['stringify']({'error':'Failed\x20to\x20fetch\x20users.'}),{'status':0x1f4,'headers':f});}if(d==='/admin/api/users'&&a['method']==='POST')try{const {uuid:q,exp_date:r,exp_time:s,data_limit:t,notes:u}=await a['json']();if(!isValidUUID(q)||!r||!s||!/^\d{4}-\d{2}-\d{2}$/['test'](r)||!/^\d{2}:\d{2}:\d{2}$/['test'](s))throw new Error('Invalid\x20or\x20missing\x20fields.\x20Use\x20a\x20valid\x20UUID,\x20YYYY-MM-DD,\x20and\x20HH:MM:SS.');return await b['DB']['prepare']('INSERT\x20INTO\x20users\x20(uuid,\x20expiration_date,\x20expiration_time,\x20data_limit,\x20used_traffic,\x20notes)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x200,\x20?)')['bind'](q,r,s,t||0x0,u||null)['run'](),await b['USER_KV']['delete']('user:'+q),new Response(JSON['stringify']({'success':!![],'uuid':q}),{'status':0xc9,'headers':f});}catch(v){log('Error\x20creating\x20user:\x20'+v['message'],'error');const w=v['message']['includes']('UNIQUE')?'A\x20user\x20with\x20this\x20UUID\x20already\x20exists.':v['message'];return new Response(JSON['stringify']({'error':w}),{'status':0x190,'headers':f});}if(d==='/admin/api/users/bulk-delete'&&a['method']==='POST')try{const {uuids:x}=await a['json']();if(!Array['isArray'](x)||x['length']===0x0)throw new Error('UUIDs\x20array\x20is\x20required.');const y=x['filter'](isValidUUID);return await b['DB']['batch'](y['map'](z=>b['DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](z))),await Promise['all'](y['map'](z=>b['USER_KV']['delete']('user:'+z))),new Response(JSON['stringify']({'success':!![],'count':y['length']}),{'status':0xc8,'headers':f});}catch(z){return log('Error\x20bulk\x20deleting\x20users:\x20'+z['message'],'error'),new Response(JSON['stringify']({'error':z['message']}),{'status':0x190,'headers':f});}const i=d['match'](/^\/admin\/api\/users\/([a-f0-9-]+)$/);if(i&&a['method']==='PUT'){const A=i[0x1];if(!isValidUUID(A))return new Response(JSON['stringify']({'error':'Invalid\x20UUID\x20format'}),{'status':0x190,'headers':f});try{const {exp_date:B,exp_time:C,data_limit:D,notes:E,reset_traffic:F}=await a['json']();if(!B||!C||!/^\d{4}-\d{2}-\d{2}$/['test'](B)||!/^\d{2}:\d{2}:\d{2}$/['test'](C))throw new Error('Invalid\x20date/time\x20fields.');let G='UPDATE\x20users\x20SET\x20expiration_date\x20=\x20?,\x20expiration_time\x20=\x20?,\x20data_limit\x20=\x20?,\x20notes\x20=\x20?';const H=[B,C,D??0x0,E||null];return F&&(G+=',\x20used_traffic\x20=\x200'),G+='\x20WHERE\x20uuid\x20=\x20?',H['push'](A),await b['DB']['prepare'](G)['bind'](...H)['run'](),await b['USER_KV']['delete']('user:'+A),new Response(JSON['stringify']({'success':!![],'uuid':A}),{'status':0xc8,'headers':f});}catch(I){return log('Error\x20updating\x20user\x20'+A+':\x20'+I['message'],'error'),new Response(JSON['stringify']({'error':I['message']}),{'status':0x190,'headers':f});}}if(i&&a['method']==='DELETE'){const J=i[0x1];if(!isValidUUID(J))return new Response(JSON['stringify']({'error':'Invalid\x20UUID\x20format'}),{'status':0x190,'headers':f});try{return await b['DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](J)['run'](),await b['USER_KV']['delete']('user:'+J),new Response(null,{'status':0xcc});}catch(K){return log('Error\x20deleting\x20user\x20'+J+':\x20'+K['message'],'error'),new Response(JSON['stringify']({'error':'Failed\x20to\x20delete\x20user.'}),{'status':0x1f4,'headers':f});}}return new Response(JSON['stringify']({'error':'API\x20route\x20not\x20found'}),{'status':0x194,'headers':f});}if(d==='/admin'){if(a['method']==='POST'){const L=await a['formData']();if(L['get']('password')===b['ADMIN_KEY']){const M=crypto['randomUUID'](),N=crypto['randomUUID']();return await Promise['all']([b['USER_KV']['put']('admin_session_token',M,{'expirationTtl':0x15180}),b['USER_KV']['put']('csrf_token',N,{'expirationTtl':0x15180})]),new Response(null,{'status':0x12e,'headers':{'Location':'/admin','Set-Cookie':'auth_token='+M+';\x20HttpOnly;\x20Secure;\x20Path=/;\x20Max-Age=86400;\x20SameSite=Strict'}});}else return new Response(adminLoginHTML['replace']('</form>','</form><p\x20class=\x22error\x22>Invalid\x20password.</p>'),{'status':0x191,'headers':g});}if(a['method']==='GET'){if(await isAdmin(a,b)){const O=await b['USER_KV']['get']('csrf_token')||crypto['randomUUID'](),P=getAdminPanelScript['toString']()['replace']('\x22CSRF_TOKEN_PLACEHOLDER\x22','\x22'+O+'\x22'),Q=adminPanelHTML['replace']('/*\x20SCRIPT_PLACEHOLDER\x20*/','('+P+')()');return new Response(Q,{'headers':g});}else return new Response(adminLoginHTML,{'headers':g});}return new Response('Method\x20Not\x20Allowed',{'status':0x195});}return new Response('Admin\x20route\x20not\x20found.',{'status':0x194});}function getPageCSS(){return'\x0a\x20\x20\x20\x20\x20\x20*\x20{\x20margin:\x200;\x20padding:\x200;\x20box-sizing:\x20border-box;\x20}\x0a\x20\x20\x20\x20\x20\x20@font-face\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x22Aldine\x20401\x20BT\x20Web\x22;\x0a\x20\x20\x20\x20\x20\x20\x20\x20src:\x20url(\x22https://pub-7a3b428c76aa411181a0f4dd7fa9064b.r2.dev/Aldine401_Mersedeh.woff2\x22)\x20format(\x22woff2\x22);\x0a\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20400;\x20font-style:\x20normal;\x20font-display:\x20swap;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20@font-face\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x22Styrene\x20B\x20LC\x22;\x0a\x20\x20\x20\x20\x20\x20\x20\x20src:\x20url(\x22https://pub-7a3b428c76aa411181a0f4dd7fa9064b.r2.dev/StyreneBLC-Regular.woff2\x22)\x20format(\x22woff2\x22);\x0a\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20400;\x20font-style:\x20normal;\x20font-display:\x20swap;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20@font-face\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20\x22Styrene\x20B\x20LC\x22;\x0a\x20\x20\x20\x20\x20\x20\x20\x20src:\x20url(\x22https://pub-7a3b428c76aa411181a0f4dd7fa9064b.r2.dev/StyreneBLC-Medium.woff2\x22)\x20format(\x22woff2\x22);\x0a\x20\x20\x20\x20\x20\x20\x20\x20font-weight:\x20500;\x20font-style:\x20normal;\x20font-display:\x20swap;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20:root\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20--background-primary:\x20#2a2421;\x20--background-secondary:\x20#35302c;\x20--background-tertiary:\x20#413b35;\x0a\x20\x20\x20\x20\x20\x20\x20\x20--border-color:\x20#5a4f45;\x20--border-color-hover:\x20#766a5f;\x20--text-primary:\x20#e5dfd6;\x20--text-secondary:\x20#b3a89d;\x0a\x20\x20\x20\x20\x20\x20\x20\x20--text-accent:\x20#ffffff;\x20--accent-primary:\x20#be9b7b;\x20--accent-secondary:\x20#d4b595;\x20--accent-tertiary:\x20#8d6e5c;\x0a\x20\x20\x20\x20\x20\x20\x20\x20--accent-primary-darker:\x20#8a6f56;\x20--button-text-primary:\x20#2a2421;\x20--button-text-secondary:\x20var(--text-primary);\x0a\x20\x20\x20\x20\x20\x20\x20\x20--shadow-color:\x20rgba(0,\x200,\x200,\x200.35);\x20--shadow-color-accent:\x20rgba(190,\x20155,\x20123,\x200.4);\x0a\x20\x20\x20\x20\x20\x20\x20\x20--border-radius:\x2012px;\x20--transition-speed-medium:\x200.3s;\x0a\x20\x20\x20\x20\x20\x20\x20\x20--status-success:\x20#70b570;\x20--status-error:\x20#e05d44;\x20--status-warning:\x20#e0bc44;\x20--status-info:\x20#4f90c4;\x0a\x20\x20\x20\x20\x20\x20\x20\x20--serif:\x20\x22Aldine\x20401\x20BT\x20Web\x22,\x20\x22Times\x20New\x20Roman\x22,\x20Times,\x20Georgia,\x20ui-serif,\x20serif;\x0a\x20\x20\x20\x20\x20\x20\x20\x20--sans-serif:\x20\x22Styrene\x20B\x20LC\x22,\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Helvetica,\x20Arial,\x20\x22Noto\x20Color\x20Emoji\x22,\x20sans-serif;\x0a\x20\x20\x20\x20\x20\x20\x20\x20--mono-serif:\x20\x22Fira\x20Code\x22,\x20Cantarell,\x20\x22Courier\x20Prime\x22,\x20monospace;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20body\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20font-family:\x20var(--sans-serif);\x20font-size:\x2016px;\x20background-color:\x20var(--background-primary);\x0a\x20\x20\x20\x20\x20\x20\x20\x20color:\x20var(--text-primary);\x20padding:\x203rem;\x20line-height:\x201.5;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x20800px;\x20margin:\x2020px\x20auto;\x20}\x0a\x20\x20\x20\x20\x20\x20.header\x20{\x20text-align:\x20center;\x20margin-bottom:\x2030px;\x20}\x0a\x20\x20\x20\x20\x20\x20.header\x20h1\x20{\x20font-family:\x20var(--serif);\x20font-weight:\x20400;\x20font-size:\x201.8rem;\x20margin-bottom:\x202px;\x20}\x0a\x20\x20\x20\x20\x20\x20.header\x20p\x20{\x20color:\x20var(--text-secondary);\x20font-size:\x200.8rem;\x20}\x0a\x20\x20\x20\x20\x20\x20.config-card\x20{\x20background:\x20var(--background-secondary);\x20border-radius:\x20var(--border-radius);\x20padding:\x2020px;\x20margin-bottom:\x2024px;\x20border:\x201px\x20solid\x20var(--border-color);\x20}\x0a\x20\x20\x20\x20\x20\x20.config-title\x20{\x20font-family:\x20var(--serif);\x20font-size:\x201.6rem;\x20color:\x20var(--accent-secondary);\x20margin-bottom:\x2016px;\x20padding-bottom:\x2013px;\x20border-bottom:\x201px\x20solid\x20var(--border-color);\x20}\x0a\x20\x20\x20\x20\x20\x20.button\x20{\x20display:\x20inline-flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20gap:\x208px;\x20padding:\x208px\x2016px;\x20border-radius:\x20var(--border-radius);\x20font-size:\x2015px;\x20font-weight:\x20500;\x20cursor:\x20pointer;\x20border:\x201px\x20solid\x20var(--border-color);\x20background-color:\x20var(--background-tertiary);\x20color:\x20var(--button-text-secondary);\x20text-decoration:\x20none;\x20}\x0a\x20\x20\x20\x20\x20\x20.button:hover\x20{\x20background-color:\x20#4d453e;\x20}\x0a\x20\x20\x20\x20\x20\x20.copy-buttons\x20{\x20gap:\x204px;\x20font-size:\x2013px;\x20}\x0a\x20\x20\x20\x20\x20\x20.client-buttons-container\x20{\x20display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x2016px;\x20margin-top:\x2016px;\x20}\x0a\x20\x20\x20\x20\x20\x20.client-buttons\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fill,\x20minmax(220px,\x201fr));\x20gap:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20.client-btn\x20{\x20width:\x20100%;\x20background-color:\x20var(--accent-primary);\x20color:\x20var(--background-tertiary);\x20border-color:\x20var(--accent-primary-darker);\x20}\x0a\x20\x20\x20\x20\x20\x20.client-btn:hover\x20{\x20background-color:\x20var(--accent-secondary);\x20color:\x20var(--button-text-primary);\x20}\x0a\x20\x20\x20\x20\x20\x20.button.copied\x20{\x20background-color:\x20var(--status-success)\x20!important;\x20color:\x20var(--background-tertiary)\x20!important;\x20}\x0a\x20\x20\x20\x20\x20\x20.footer\x20{\x20text-align:\x20center;\x20margin-top:\x2040px;\x20color:\x20var(--text-secondary);\x20font-size:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20.ip-info-grid\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(230px,\x201fr));\x20gap:\x2024px;\x20}\x0a\x20\x20\x20\x20\x20\x20.ip-info-section\x20{\x20background-color:\x20var(--background-tertiary);\x20border-radius:\x20var(--border-radius);\x20padding:\x2016px;\x20border:\x201px\x20solid\x20var(--border-color);\x20}\x0a\x20\x20\x20\x20\x20\x20.ip-info-header\x20{\x20display:\x20flex;\x20align-items:\x20center;\x20gap:\x2010px;\x20border-bottom:\x201px\x20solid\x20var(--border-color);\x20padding-bottom:\x2010px;\x20margin-bottom:\x2010px;}\x0a\x20\x20\x20\x20\x20\x20.ip-info-header\x20h3\x20{\x20font-family:\x20var(--serif);\x20font-size:\x2018px;\x20color:\x20var(--accent-secondary);\x20margin:\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20.ip-info-item\x20{\x20display:\x20flex;\x20flex-direction:\x20column;\x20gap:\x202px;\x20}\x0a\x20\x20\x20\x20\x20\x20.ip-info-item\x20.label\x20{\x20font-size:\x2011px;\x20color:\x20var(--text-secondary);\x20}\x0a\x20\x20\x20\x20\x20\x20.ip-info-item\x20.value\x20{\x20font-size:\x2014px;\x20}\x0a\x20\x20\x20\x20\x20\x20.skeleton\x20{\x20display:\x20block;\x20background:\x20linear-gradient(90deg,\x20var(--background-tertiary)\x2025%,\x20var(--background-secondary)\x2050%,\x20var(--background-tertiary)\x2075%);\x20background-size:\x20200%\x20100%;\x20animation:\x20loading\x201.5s\x20infinite;\x20border-radius:\x204px;\x20height:\x2016px;\x20}\x0a\x20\x20\x20\x20\x20\x20@keyframes\x20loading\x20{\x200%\x20{\x20background-position:\x20200%\x200;\x20}\x20100%\x20{\x20background-position:\x20-200%\x200;\x20}\x20}\x0a\x20\x20\x20\x20\x20\x20.country-flag\x20{\x20display:\x20inline-block;\x20width:\x2018px;\x20vertical-align:\x20middle;\x20margin-right:\x206px;\x20}\x0a\x20\x20\x20\x20\x20\x20.expiration-card,\x20.traffic-card\x20{\x20padding:\x2020px;\x20text-align:\x20center;\x20}\x0a\x20\x20\x20\x20\x20\x20.expiration-title,\x20.traffic-title\x20{\x20font-family:\x20var(--serif);\x20font-size:\x201.6rem;\x20color:\x20var(--accent-secondary);\x20margin-bottom:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20.expiration-relative-time\x20{\x20font-size:\x201.1rem;\x20font-weight:\x20500;\x20margin-bottom:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20.expiration-relative-time.active\x20{\x20color:\x20var(--status-success);\x20}\x0a\x20\x20\x20\x20\x20\x20.expiration-relative-time.expired\x20{\x20color:\x20var(--status-error);\x20}\x0a\x20\x20\x20\x20\x20\x20#expiration-display\x20{\x20font-size:\x200.9em;\x20color:\x20var(--text-secondary);\x20}\x0a\x20\x20\x20\x20\x20\x20#expiration-display\x20span\x20{\x20display:\x20block;\x20margin-top:\x208px;\x20}\x0a\x20\x20\x20\x20\x20\x20.traffic-text\x20{\x20font-family:\x20var(--mono-serif);\x20font-size:\x201rem;\x20color:\x20var(--text-primary);\x20margin-bottom:\x2012px;\x20}\x0a\x20\x20\x20\x20\x20\x20.progress-container\x20{\x20width:\x20100%;\x20max-width:\x20400px;\x20margin:\x200\x20auto;\x20background-color:\x20var(--background-tertiary);\x20border-radius:\x206px;\x20height:\x2012px;\x20overflow:\x20hidden;\x20border:\x201px\x20solid\x20var(--border-color);\x20}\x0a\x20\x20\x20\x20\x20\x20.progress-bar\x20{\x20height:\x20100%;\x20background-color:\x20var(--status-success);\x20transition:\x20width\x200.5s\x20ease;\x20}\x0a\x20\x20\x20\x20\x20\x20.progress-bar.warning\x20{\x20background-color:\x20var(--status-warning);\x20}\x0a\x20\x20\x20\x20\x20\x20.progress-bar.danger\x20{\x20background-color:\x20var(--status-error);\x20}\x0a\x20\x20\x20\x20\x20\x20@media\x20(max-width:\x20768px)\x20{\x20body\x20{\x20padding:\x2020px;\x20}\x20}\x0a\x20\x20';}function getPageHTML(a,b,c){return'\x0a\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<h1>VLESS\x20Proxy\x20Configuration</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<p>Copy\x20the\x20configuration\x20or\x20import\x20directly\x20into\x20your\x20client</p>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<div\x20id=\x22dynamic-content\x22></div>\x0a\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-title\x22>Network\x20Information</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-header\x22><h3>Proxy\x20Server</h3></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-item\x22><span\x20class=\x22label\x22>Host</span><span\x20class=\x22value\x22\x20id=\x22proxy-host\x22><span\x20class=\x22skeleton\x22\x20style=\x22width:\x20150px\x22></span></span></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-item\x22><span\x20class=\x22label\x22>Location</span><span\x20class=\x22value\x22\x20id=\x22proxy-location\x22><span\x20class=\x22skeleton\x22\x20style=\x22width:\x20100px\x22></span></span></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-section\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-header\x22><h3>Your\x20Connection</h3></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-item\x22><span\x20class=\x22label\x22>IP</span><span\x20class=\x22value\x22\x20id=\x22client-ip\x22><span\x20class=\x22skeleton\x22\x20style=\x22width:\x20110px\x22></span></span></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-item\x22><span\x20class=\x22label\x22>Location</span><span\x20class=\x22value\x22\x20id=\x22client-location\x22><span\x20class=\x22skeleton\x22\x20style=\x22width:\x2090px\x22></span></span></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-title\x22>Xray\x20Subscription</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22client-buttons-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22client-buttons\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22'+a['universalAndroid']+'\x22\x20class=\x22button\x20client-btn\x22>Universal\x20Import\x20(Android)</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22'+a['shadowrocket']+'\x22\x20class=\x22button\x20client-btn\x22>Import\x20to\x20Shadowrocket\x20(iOS)</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22'+a['stash']+'\x22\x20class=\x22button\x20client-btn\x22>Import\x20to\x20Stash\x20(iOS)</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22button\x20copy-buttons\x22\x20data-clipboard-text=\x22'+b+'\x22>Copy\x20Link</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-title\x22>Sing-Box\x20/\x20Clash\x20Subscription</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22client-buttons-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22client-buttons\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<a\x20href=\x22'+a['clashMeta']+'\x22\x20class=\x22button\x20client-btn\x22>Import\x20to\x20Clash\x20Meta\x20/\x20Stash</a>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22button\x20copy-buttons\x22\x20data-clipboard-text=\x22'+c+'\x22>Copy\x20Link</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22footer\x22><p>©\x20'+new Date()['getFullYear']()+'\x20-\x20Secure.\x20Private.\x20Fast.</p></div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20';}function getPageScript(){return'\x0a\x20\x20\x20\x20\x20\x20function\x20copyToClipboard(button,\x20text)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20navigator.clipboard.writeText(text).then(()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20originalHTML\x20=\x20button.innerHTML;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20button.innerHTML\x20=\x20\x27Copied!\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20button.classList.add(\x22copied\x22);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setTimeout(()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20button.innerHTML\x20=\x20originalHTML;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20button.classList.remove(\x22copied\x22);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20},\x201500);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}).catch(err\x20=>\x20console.error(\x22Failed\x20to\x20copy:\x20\x22,\x20err));\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20async\x20function\x20fetchIpApiIoInfo(ip)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20response\x20=\x20await\x20fetch(\x27https://ip-api.io/json/\x27\x20+\x20ip);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!response.ok)\x20return\x20null;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20await\x20response.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x20return\x20null;\x20}\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20function\x20updateIpDisplay(data,\x20prefix,\x20host\x20=\x20null)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(host)\x20document.getElementById(prefix\x20+\x20\x27-host\x27).textContent\x20=\x20host;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!data)\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20locationEl\x20=\x20document.getElementById(prefix\x20+\x20\x27-location\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20ipEl\x20=\x20document.getElementById(prefix\x20+\x20\x27-ip\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(ipEl)\x20ipEl.textContent\x20=\x20data.ip\x20||\x20\x22N/A\x22;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20let\x20locationString\x20=\x20[data.city,\x20data.country_name].filter(Boolean).join(\x27,\x20\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(data.country_code)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20locationString\x20=\x20`<img\x20src=\x22https://flagcdn.com/w20/${data.country_code.toLowerCase()}.png\x22\x20class=\x22country-flag\x22>\x20${locationString}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20locationEl.innerHTML\x20=\x20locationString\x20||\x20\x22N/A\x22;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20async\x20function\x20loadNetworkInfo()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20proxyHost\x20=\x20document.body.getAttribute(\x27data-proxy-ip\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20[proxyDomain,\x20]\x20=\x20proxyHost.split(\x27:\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20Fetch\x20proxy\x20info\x20(no\x20IP\x20resolution,\x20rely\x20on\x20geo\x20from\x20domain)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20proxyGeo\x20=\x20await\x20fetchIpApiIoInfo(proxyDomain);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20updateIpDisplay(proxyGeo,\x20\x27proxy\x27,\x20proxyHost);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20Fetch\x20client\x20info\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20clientGeo\x20=\x20await\x20fetchIpApiIoInfo(\x27\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20updateIpDisplay(clientGeo,\x20\x27client\x27);\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20function\x20displayExpirationTimes()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20expElement\x20=\x20document.getElementById(\x27expiration-display\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20relativeElement\x20=\x20document.getElementById(\x27expiration-relative\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!expElement\x20||\x20!expElement.dataset.utcTime)\x20return;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20utcDate\x20=\x20new\x20Date(expElement.dataset.utcTime);\x0a\x20\x20\x20\x20\x20\x20\x20\x20if\x20(isNaN(utcDate.getTime()))\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20now\x20=\x20new\x20Date();\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20diffSeconds\x20=\x20(utcDate.getTime()\x20-\x20now.getTime())\x20/\x201000;\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20isExpired\x20=\x20diffSeconds\x20<\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20rtf\x20=\x20new\x20Intl.RelativeTimeFormat(\x27en\x27,\x20{\x20numeric:\x20\x27auto\x27\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20let\x20relativeTimeStr\x20=\x20\x27\x27;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20if\x20(Math.abs(diffSeconds)\x20<\x203600)\x20relativeTimeStr\x20=\x20rtf.format(Math.round(diffSeconds\x20/\x2060),\x20\x27minute\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20else\x20if\x20(Math.abs(diffSeconds)\x20<\x2086400)\x20relativeTimeStr\x20=\x20rtf.format(Math.round(diffSeconds\x20/\x203600),\x20\x27hour\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20else\x20relativeTimeStr\x20=\x20rtf.format(Math.round(diffSeconds\x20/\x2086400),\x20\x27day\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20if\x20(relativeElement)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20relativeElement.textContent\x20=\x20isExpired\x20?\x20`Expired\x20${relativeTimeStr}`\x20:\x20`Expires\x20${relativeTimeStr}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20relativeElement.classList.add(isExpired\x20?\x20\x27expired\x27\x20:\x20\x27active\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20expElement.innerHTML\x20=\x20`\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span><strong>Your\x20Local:</strong>\x20${utcDate.toLocaleString(undefined,\x20{dateStyle:\x20\x27medium\x27,\x20timeStyle:\x20\x27short\x27})}</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span><strong>Tehran:</strong>\x20${utcDate.toLocaleString(\x27en-US\x27,\x20{\x20timeZone:\x20\x27Asia/Tehran\x27,\x20dateStyle:\x20\x27medium\x27,\x20timeStyle:\x20\x27short\x27\x20})}</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20`;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20document.addEventListener(\x27DOMContentLoaded\x27,\x20()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20loadNetworkInfo();\x0a\x20\x20\x20\x20\x20\x20\x20\x20displayExpirationTimes();\x0a\x20\x20\x20\x20\x20\x20\x20\x20document.querySelectorAll(\x27.copy-buttons\x27).forEach(button\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20button.addEventListener(\x27click\x27,\x20function(e)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20copyToClipboard(this,\x20this.getAttribute(\x27data-clipboard-text\x27));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20});\x0a\x20\x20';}function generateBeautifulConfigPage(a,b,c,d,e,f,g){const h='https://'+b+'/xray/'+a,i='https://'+b+'/sb/'+a,j={'universalAndroid':'v2rayng://install-config?url='+encodeURIComponent(h),'shadowrocket':'shadowrocket://add/sub?url='+encodeURIComponent(h)+'&name='+encodeURIComponent(b),'stash':'stash://install-config?url='+encodeURIComponent(h),'streisand':'streisand://import/'+btoa(h),'clashMeta':'clash://install-config?url='+encodeURIComponent('https://sub.bonds.dev/sub/clash?url='+i)},k=d&&e?d+'T'+e['split']('.')[0x0]+'Z':'',l=s=>{if(!s||s===0x0)return'0\x20B';const t=Math['floor'](Math['log'](s)/Math['log'](0x400));return parseFloat((s/Math['pow'](0x400,t))['toFixed'](0x2))+'\x20'+['B','KB','MB','GB','TB'][t];},m=f>0x0?Math['min'](g/f*0x64,0x64):0x0,n=f===0x0?l(g)+'\x20/\x20∞':l(g)+'\x20/\x20'+l(f);let o='progress-bar';if(m>0x5a)o+='\x20danger';else{if(m>0x46)o+='\x20warning';}const p='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22expiration-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22expiration-title\x22>Subscription\x20Status</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22expiration-relative\x22\x20class=\x22expiration-relative-time\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22expiration-display\x22\x20data-utc-time=\x22'+k+'\x22>Loading...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22traffic-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2\x20class=\x22traffic-title\x22>Data\x20Usage</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22traffic-text\x22>'+n+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22progress-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22'+o+'\x22\x20style=\x22width:\x20'+m['toFixed'](0x2)+'%\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20',q=getPageHTML(j,h,i),r=q['replace']('<div\x20id=\x22dynamic-content\x22></div>',p);return'<!doctype\x20html>\x0a\x20\x20\x20\x20<html\x20lang=\x22en\x22>\x0a\x20\x20\x20\x20<head>\x0a\x20\x20\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22\x20/>\x0a\x20\x20\x20\x20\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22\x20/>\x0a\x20\x20\x20\x20\x20\x20<title>VLESS\x20Proxy\x20Configuration</title>\x0a\x20\x20\x20\x20\x20\x20<link\x20rel=\x22icon\x22\x20href=\x22https://raw.githubusercontent.com/NiREvil/zizifn/refs/heads/Legacy/assets/favicon.png\x22\x20type=\x22image/png\x22>\x0a\x20\x20\x20\x20\x20\x20<style>'+getPageCSS()+'</style>\x20\x0a\x20\x20\x20\x20</head>\x0a\x20\x20\x20\x20<body\x20data-proxy-ip=\x22'+c+'\x22>\x0a\x20\x20\x20\x20\x20\x20'+r+'\x0a\x20\x20\x20\x20\x20\x20<script>'+getPageScript()+'</script>\x0a\x20\x20\x20\x20</body>\x0a\x20\x20\x20\x20</html>';}function generateRandomPath(a=0xc,b=''){const c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let d='';for(let e=0x0;e<a;e++)d+=c['charAt'](Math['floor'](Math['random']()*c['length']));return'/'+d+(b?'?'+b:'');}const CORE_PRESETS={'xray':{'tls':{'path':()=>generateRandomPath(0xc,'ed=2048'),'security':'tls','fp':'chrome','alpn':'http/1.1','extra':{}},'tcp':{'path':()=>generateRandomPath(0xc,'ed=2048'),'security':'none','fp':'chrome','extra':{}}},'sb':{'tls':{'path':()=>generateRandomPath(0x12),'security':'tls','fp':'firefox','alpn':'h3','extra':{'ed':0xa00}},'tcp':{'path':()=>generateRandomPath(0x12),'security':'none','fp':'firefox','extra':{'ed':0xa00}}}};function createVlessLink({userID:a,address:b,port:c,host:d,path:e,security:f,sni:g,fp:h,alpn:i,extra:extra={},name:j}){const l=new URLSearchParams({'type':'ws','host':d,'path':e});if(f)l['set']('security',f);if(g)l['set']('sni',g);if(h)l['set']('fp',h);if(i)l['set']('alpn',i);for(const [m,n]of Object['entries'](extra))l['set'](m,n);return'vless://'+a+'@'+b+':'+c+'?'+l['toString']()+'#'+encodeURIComponent(j);}function buildLink({core:a,proto:b,userID:c,hostName:d,address:e,port:f,tag:g}){const h=CORE_PRESETS[a][b];return createVlessLink({'userID':c,'address':e,'port':f,'host':d,'path':h['path'](),'security':h['security'],'sni':h['security']==='tls'?d:undefined,'fp':h['fp'],'alpn':h['alpn'],'extra':h['extra'],'name':g+'-'+b['toUpperCase']()});}const pick=a=>a[Math['floor'](Math['random']()*a['length'])];async function handleIpSubscription(a,b,c){const d=[c,'creativecommons.org','www.speedtest.net','sky.rethinkdns.com','cfip.1323123.xyz','go.inmobi.com','zula.ir'],f=[0x1bb,0x20fb,0x805,0x823,0x827,0x830];let g=[];d['forEach']((h,j)=>{g['push'](buildLink({'core':a,'proto':'tls','userID':b,'hostName':c,'address':h,'port':pick(f),'tag':'D'+(j+0x1)}));});try{const h=await fetch('https://raw.githubusercontent.com/NiREvil/vless/main/Cloudflare-IPs.json',{'headers':{'User-Agent':'Cloudflare-Worker'}});if(h['ok']){const i=await h['json'](),j=[...i['ipv4']??[],...i['ipv6']??[]]['slice'](0x0,0x14)['map'](k=>k['ip']);j['forEach']((k,l)=>{const m=k['includes'](':')?'['+k+']':k;g['push'](buildLink({'core':a,'proto':'tls','userID':b,'hostName':c,'address':m,'port':pick(f),'tag':'IP'+(l+0x1)}));});}}catch(k){console['error']('Fetch\x20IP\x20list\x20failed',k);}return new Response(btoa(g['join']('\x0a')),{'headers':{'Content-Type':'text/plain;charset=utf-8'}});}async function vlessOverWSHandler(a,b,c){const d=new WebSocketPair(),[e,f]=Object['values'](d);f['accept']();const g={'uuid':'','remoteSocket':null,'incoming':0x0,'outgoing':0x0};let h=a['headers']['get']('Sec-WebSocket-Protocol')||'';const i=new ReadableStream({'start'(j){f['addEventListener']('message',k=>{const l=k['data'];g['outgoing']+=l['byteLength'],j['enqueue'](l);}),f['addEventListener']('close',()=>j['close']()),f['addEventListener']('error',k=>j['error'](k));if(h){const k=base64ToArrayBuffer(h);k&&(g['outgoing']+=k['byteLength'],j['enqueue'](k));}}});return i['pipeTo'](new WritableStream({async 'write'(j,k){if(g['remoteSocket']){const l=g['remoteSocket']['writable']['getWriter']();await l['write'](j),l['releaseLock']();return;}try{const {uuid:m,address:n,port:o,rawDataIndex:p,isUDP:q}=await processVlessHeader(j,b);g['uuid']=m;if(q){k['error']('UDP\x20proxying\x20is\x20not\x20supported\x20in\x20this\x20version.');return;}const r=await connect({'hostname':n,'port':o});g['remoteSocket']=r;const s=r['writable']['getWriter']();await s['write'](j['slice'](p)),s['releaseLock']();let t=![];r['readable']['pipeTo'](new WritableStream({'write':u=>{if(!t){const v=new Uint8Array([CONST['VLESS_VERSION'][0x0],0x0]),w=new Uint8Array(v['length']+u['length']);w['set'](v),w['set'](u,v['length']),g['incoming']+=w['byteLength'],f['send'](w),t=!![];}else g['incoming']+=u['byteLength'],f['send'](u);},'close':()=>log('Remote\x20socket\x20readable\x20stream\x20closed\x20for\x20'+m+'.'),'abort':u=>log('Remote\x20socket\x20readable\x20stream\x20aborted\x20for\x20'+m+':\x20'+u,'error')}))['catch'](u=>log('Remote\x20socket\x20pipe\x20failed:\x20'+u,'error'));}catch(u){log('VLESS\x20processing\x20error:\x20'+u['message'],'error'),k['error'](u['message']);}}}))['catch'](j=>{log('Main\x20pipeline\x20failed:\x20'+j['message'],'error'),safeCloseWebSocket(f);})['finally'](()=>{if(g['uuid']){const j=g['incoming']+g['outgoing'];if(j>0x0)c['waitUntil'](updateUsedTraffic(b,g['uuid'],j));}g['remoteSocket']&&g['remoteSocket']['close'](),log('Connection\x20closed.\x20UUID:\x20'+(g['uuid']||'N/A')+'.\x20In:\x20'+g['incoming']+',\x20Out:\x20'+g['outgoing']);}),new Response(null,{'status':0x65,'webSocket':e});}async function processVlessHeader(a,b){if(a['byteLength']<0x18)throw new Error('Invalid\x20VLESS\x20header:\x20too\x20short');const c=new DataView(a);if(c['getUint8'](0x0)!==0x0)throw new Error('Invalid\x20VLESS\x20version:\x20'+c['getUint8'](0x0));const d=unsafeStringify(new Uint8Array(a['slice'](0x1,0x11))),e=await getUserData(b,d);if(!isUserValid(e))throw new Error('User\x20is\x20invalid,\x20expired,\x20or\x20has\x20reached\x20their\x20data\x20limit');const f=c['getUint8'](0x11),g=c['getUint8'](0x12+f),h=c['getUint16'](0x13+f);let i=0x15+f;const j=c['getUint8'](i++);let k='';switch(j){case 0x1:k=new Uint8Array(a['slice'](i,i+0x4))['join']('.'),i+=0x4;break;case 0x2:const l=c['getUint8'](i++);k=new TextDecoder()['decode'](a['slice'](i,i+l)),i+=l;break;case 0x3:const m=a['slice'](i,i+0x10);k=Array['from']({'length':0x8},(n,o)=>new DataView(m)['getUint16'](o*0x2)['toString'](0x10))['join'](':'),i+=0x10;break;default:throw new Error('Unsupported\x20address\x20type:\x20'+j);}return{'uuid':d,'address':k,'port':h,'rawDataIndex':i,'isUDP':g===0x2};}function base64ToArrayBuffer(a){try{const b=atob(a['replace'](/-/g,'+')['replace'](/_/g,'/')),c=new ArrayBuffer(b['length']),d=new Uint8Array(c);for(let e=0x0;e<b['length'];e++)d[e]=b['charCodeAt'](e);return c;}catch{return null;}}function safeCloseWebSocket(a){try{if(a['readyState']===CONST['WS_READY_STATE_OPEN'])a['close'](0x3e8,'Closing\x20connection');}catch(b){log('Error\x20closing\x20WebSocket:\x20'+b,'error');}}const byteToHex=Array['from']({'length':0x100},(a,b)=>(b+0x100)['toString'](0x10)['slice'](0x1));function unsafeStringify(a,b=0x0){return(byteToHex[a[b++]]+byteToHex[a[b++]]+byteToHex[a[b++]]+byteToHex[a[b++]]+'-'+byteToHex[a[b++]]+byteToHex[a[b++]]+'-'+byteToHex[a[b++]]+byteToHex[a[b++]]+'-'+byteToHex[a[b++]]+byteToHex[a[b++]]+'-'+byteToHex[a[b++]]+byteToHex[a[b++]]+byteToHex[a[b++]]+byteToHex[a[b++]]+byteToHex[a[b++]]+byteToHex[a[b++]])['toLowerCase']();}export default{async 'fetch'(a,b,c){try{const d=new URL(a['url']);if(d['pathname']['startsWith']('/admin'))return handleAdminRequest(a,b);if(a['headers']['get']('Upgrade')?.['toLowerCase']()==='websocket')return await vlessOverWSHandler(a,b,c);const f=async h=>{const i=d['pathname']['slice'](('/'+h+'/')['length']),j=await getUserData(b,i);if(!isUserValid(j))return new Response('Invalid\x20or\x20expired\x20user,\x20or\x20traffic\x20limit\x20reached',{'status':0x193});return handleIpSubscription(h,i,d['hostname']);};if(d['pathname']['startsWith']('/xray/'))return f('xray');if(d['pathname']['startsWith']('/sb/'))return f('sb');const g=d['pathname']['slice'](0x1);if(isValidUUID(g)){const h=await getUserData(b,g);if(!isUserValid(h))return new Response('Invalid\x20or\x20expired\x20user,\x20or\x20traffic\x20limit\x20reached',{'status':0x193});const i=Config['fromEnv'](b),j=generateBeautifulConfigPage(g,d['hostname'],i['proxyAddress'],h['exp_date'],h['exp_time'],h['data_limit'],h['used_traffic']);return new Response(j,{'headers':{'Content-Type':'text/html;\x20charset=utf-8',...CONST['securityHeaders']}});}if(b['ROOT_PROXY_URL'])try{const k=new URL(b['ROOT_PROXY_URL']),l=new URL(a['url']);l['hostname']=k['hostname'],l['protocol']=k['protocol'],l['port']=k['port'];const m=new Request(l,a);return m['headers']['set']('Host',k['hostname']),m['headers']['set']('X-Forwarded-For',a['headers']['get']('CF-Connecting-IP')),m['headers']['set']('X-Forwarded-Proto','https'),fetch(m);}catch(n){return log('Reverse\x20Proxy\x20Error:\x20'+n['message'],'error'),new Response('Proxy\x20configuration\x20error:\x20'+n['message'],{'status':0x1f6});}return new Response('Not\x20Found',{'status':0x194});}catch(o){return log('Global\x20fetch\x20error:\x20'+o['stack'],'error'),new Response('Internal\x20Server\x20Error',{'status':0x1f4});}},async 'scheduled'(a,b,c){c['waitUntil'](cleanupExpiredUsers(b));}};