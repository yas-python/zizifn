// <!--GAMFC--> version base on commit 0d40b1fdc052176cdd9e13fc0b55d2cd9f384d0f, time is 2025-10-25 22:21:21 UTC<!--We are all REvil-->
// @ts-ignore

import{connect}from'cloudflare:sockets';const Config={'userID':'d342d11e-d424-4583-b36e-524ab1f0afa4','proxyIPs':['www.speedtest.net:443','creativecommons.org:443','www.visa.com:443','cdn.jsdelivr.net:443','sky.rethinkdns.com:443','cdnjs.cloudflare.com:443'],'scamalytics':{'username':'revilseptember','apiKey':'b2fc368184deb3d8ac914bd776b8215fe899dd8fef69fbaba77511acfbdeca0d','baseUrl':'https://api12.scamalytics.com/v3/'},'socks5':{'enabled':![],'relayMode':![],'address':''},'healthCheck':{'enabled':!![],'interval':0x493e0,'failureThreshold':0x3,'successThreshold':0x2},'connection':{'timeout':0x7530,'keepAlive':!![],'keepAliveInterval':0xafc8,'maxRetries':0x3,'retryDelay':0x3e8,'backoffMultiplier':0x2},'optimization':{'compression':![],'bufferSize':0x10000,'chunkSize':0x8000},'fromEnv'(a){const b=a['PROXYIP']||this['proxyIPs'][Math['floor'](Math['random']()*this['proxyIPs']['length'])],[c,d='443']=b['split'](':');return{'userID':a['UUID']||this['userID'],'proxyIP':c,'proxyPort':parseInt(d,0xa),'proxyAddress':b,'allProxyIPs':this['proxyIPs'],'scamalytics':{'username':a['SCAMALYTICS_USERNAME']||this['scamalytics']['username'],'apiKey':a['SCAMALYTICS_API_KEY']||this['scamalytics']['apiKey'],'baseUrl':a['SCAMALYTICS_BASEURL']||this['scamalytics']['baseUrl']},'socks5':{'enabled':!!a['SOCKS5'],'relayMode':a['SOCKS5_RELAY']==='true','address':a['SOCKS5']||''},'healthCheck':this['healthCheck'],'connection':this['connection'],'optimization':this['optimization'],'rootProxyUrl':a['ROOT_PROXY_URL']||null};}},WS={'READY_STATE_OPEN':0x1,'READY_STATE_CLOSING':0x2,'READY_STATE_CLOSED':0x3};class HealthMonitor{constructor(a){this['config']=a,this['endpoints']=new Map();}['recordSuccess'](a){if(!this['config']['enabled'])return;const b=this['endpoints']['get'](a)||{'failures':0x0,'successes':0x0,'lastCheck':Date['now'](),'healthy':!![]};b['successes']++,b['failures']=Math['max'](0x0,b['failures']-0x1),b['lastCheck']=Date['now'](),b['successes']>=this['config']['successThreshold']&&(b['healthy']=!![]),this['endpoints']['set'](a,b);}['recordFailure'](a){if(!this['config']['enabled'])return;const b=this['endpoints']['get'](a)||{'failures':0x0,'successes':0x0,'lastCheck':Date['now'](),'healthy':!![]};b['failures']++,b['successes']=0x0,b['lastCheck']=Date['now'](),b['failures']>=this['config']['failureThreshold']&&(b['healthy']=![],console['warn']('Endpoint\x20'+a+'\x20marked\x20as\x20unhealthy')),this['endpoints']['set'](a,b);}['isHealthy'](a){if(!this['config']['enabled'])return!![];const b=this['endpoints']['get'](a);return!b||b['healthy'];}['getStats'](){const a={};return this['endpoints']['forEach']((b,c)=>{a[c]={'healthy':b['healthy'],'failures':b['failures'],'successes':b['successes'],'lastCheck':new Date(b['lastCheck'])['toISOString']()};}),a;}}let globalHealthMonitor=null;function getHealthMonitor(a){return!globalHealthMonitor&&(globalHealthMonitor=new HealthMonitor(a['healthCheck'])),globalHealthMonitor;}function generateUUID(){return crypto['randomUUID']();}function isValidUUID(a){if(typeof a!=='string')return![];const b=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return b['test'](a);}function isExpired(a,b){if(!a||!b)return!![];try{const c=b['includes'](':')&&b['split'](':')['length']===0x2?b+':00':b,d=c['split']('.')[0x0],e=new Date(a+'T'+d+'Z');return e<=new Date()||isNaN(e['getTime']());}catch{return!![];}}function formatBytes(a){if(!a||a===0x0)return'0\x20Bytes';const b=0x400,c=['Bytes','KB','MB','GB','TB'],d=Math['floor'](Math['log'](a)/Math['log'](b));return parseFloat((a/Math['pow'](b,d))['toFixed'](0x2))+'\x20'+c[d];}async function getUserData(a,b,c){if(!isValidUUID(b))return null;if(!a['DB']||!a['USER_KV'])return console['error']('Database\x20or\x20KV\x20bindings\x20missing'),null;const d='user:'+b;try{const f=await a['USER_KV']['get'](d,'json');if(f&&f['uuid'])return f;}catch(g){console['error']('Cache\x20read\x20failed\x20for\x20'+b+':',g);}try{const h=await a['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?\x20AND\x20is_active\x20=\x201')['bind'](b)['first']();if(!h)return null;const i=a['USER_KV']['put'](d,JSON['stringify'](h),{'expirationTtl':0x708});return c?c['waitUntil'](i):await i,h;}catch(j){return console['error']('Database\x20read\x20failed\x20for\x20'+b+':',j),null;}}async function updateUsage(a,b,c,d){if(c<=0x0||!b)return;try{const e=Math['round'](c),f=a['DB']['prepare']('UPDATE\x20users\x20SET\x20traffic_used\x20=\x20traffic_used\x20+\x20?,\x20last_connection\x20=\x20CURRENT_TIMESTAMP,\x20connection_count\x20=\x20connection_count\x20+\x201\x20WHERE\x20uuid\x20=\x20?')['bind'](e,b)['run'](),g=a['USER_KV']['delete']('user:'+b);d?d['waitUntil'](Promise['all']([f,g])):await Promise['all']([f,g]);}catch(h){console['error']('Usage\x20update\x20failed\x20for\x20'+b+':',h);}}const byteToHex=Array['from']({'length':0x100},(a,b)=>(b+0x100)['toString'](0x10)['slice'](0x1));function unsafeStringify(a,b=0x0){return(byteToHex[a[b]]+byteToHex[a[b+0x1]]+byteToHex[a[b+0x2]]+byteToHex[a[b+0x3]]+'-'+byteToHex[a[b+0x4]]+byteToHex[a[b+0x5]]+'-'+byteToHex[a[b+0x6]]+byteToHex[a[b+0x7]]+'-'+byteToHex[a[b+0x8]]+byteToHex[a[b+0x9]]+'-'+byteToHex[a[b+0xa]]+byteToHex[a[b+0xb]]+byteToHex[a[b+0xc]]+byteToHex[a[b+0xd]]+byteToHex[a[b+0xe]]+byteToHex[a[b+0xf]])['toLowerCase']();}function stringify(a,b=0x0){const c=unsafeStringify(a,b);if(!isValidUUID(c))throw new TypeError('Invalid\x20UUID');return c;}function generateRandomPath(a=0xc,b=''){const c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let d='';for(let e=0x0;e<a;e++){d+=c['charAt'](Math['floor'](Math['random']()*c['length']));}return'/'+d+(b?'?'+b:'');}const CORE_PRESETS={'xray':{'tls':{'path':()=>generateRandomPath(0xc,'ed=2048'),'security':'tls','fp':'chrome','alpn':'http/1.1'},'tcp':{'path':()=>generateRandomPath(0xc,'ed=2048'),'security':'none','fp':'chrome'}},'sb':{'tls':{'path':()=>generateRandomPath(0x12),'security':'tls','fp':'firefox','alpn':'h3'},'tcp':{'path':()=>generateRandomPath(0x12),'security':'none','fp':'firefox'}}};function createVlessLink({userID:a,address:b,port:c,host:d,path:e,security:f,sni:g,fp:h,alpn:i,name:j}){const k=new URLSearchParams({'type':'ws','host':d,'path':e,'encryption':'none'});if(f)k['set']('security',f);if(g)k['set']('sni',g);if(h)k['set']('fp',h);if(i)k['set']('alpn',i);return'vless://'+a+'@'+b+':'+c+'?'+k['toString']()+'#'+encodeURIComponent(j);}function buildLink({core:a,proto:b,userID:c,hostName:d,address:e,port:f,tag:g}){const h=CORE_PRESETS[a][b];return createVlessLink({'userID':c,'address':e,'port':f,'host':d,'path':h['path'](),'security':h['security'],'sni':h['security']==='tls'?d:undefined,'fp':h['fp'],'alpn':h['alpn'],'name':g+'-'+b['toUpperCase']()});}async function handleSubscription(a,b,c){const d=b['uuid'],f=[c,'www.speedtest.net','creativecommons.org','www.visa.com','cdn.jsdelivr.net','cdnjs.cloudflare.com','sky.rethinkdns.com'],g=[0x1bb,0x20fb,0x805,0x823,0x827,0x830],h=[0x50,0x1f90,0x22b0,0x804,0x822,0x826,0x82f],i=[],j=c['endsWith']('.pages.dev');f['forEach']((n,o)=>{const p=g[o%g['length']];i['push'](buildLink({'core':a,'proto':'tls','userID':d,'hostName':c,'address':n,'port':p,'tag':'D'+(o+0x1)}));if(!j){const q=h[o%h['length']];i['push'](buildLink({'core':a,'proto':'tcp','userID':d,'hostName':c,'address':n,'port':q,'tag':'D'+(o+0x1)}));}});try{const n=await fetch('https://raw.githubusercontent.com/NiREvil/vless/refs/heads/main/Cloudflare-IPs.json',{'cf':{'cacheTtl':0xe10}});if(n['ok']){const o=await n['json'](),p=[...o['ipv4']||[],...o['ipv6']||[]]['slice'](0x0,0xf);p['forEach']((q,r)=>{const s=q['ip']||q,t=s['includes'](':')?'['+s+']':s,u=g[r%g['length']];i['push'](buildLink({'core':a,'proto':'tls','userID':d,'hostName':c,'address':t,'port':u,'tag':'IP'+(r+0x1)}));if(!j){const v=h[r%h['length']];i['push'](buildLink({'core':a,'proto':'tcp','userID':d,'hostName':c,'address':t,'port':v,'tag':'IP'+(r+0x1)}));}});}}catch(q){console['error']('Failed\x20to\x20fetch\x20Cloudflare\x20IPs:',q);}const k=new Date(b['expiration_date']+'T'+b['expiration_time']+'Z'),l=isNaN(k['getTime']())?0x0:Math['floor'](k['getTime']()/0x3e8),m='upload=0;\x20download='+(b['traffic_used']||0x0)+';\x20total='+(b['traffic_limit']||0x0)+';\x20expire='+l;return new Response(btoa(i['join']('\x0a')),{'headers':{'Content-Type':'text/plain;charset=utf-8','Cache-Control':'public,\x20max-age=3600','Profile-Update-Interval':'24','Subscription-Userinfo':m}});}const ADMIN_LOGIN_HTML='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,initial-scale=1\x22>\x0a\x20\x20<title>Admin\x20Login\x20-\x20VLESS\x20Proxy</title>\x0a\x20\x20<style>\x0a\x20\x20\x20\x20*{margin:0;padding:0;box-sizing:border-box}\x0a\x20\x20\x20\x20body{font-family:-apple-system,BlinkMacSystemFont,\x22Segoe\x20UI\x22,Roboto,sans-serif;display:flex;justify-content:center;align-items:center;min-height:100vh;background:linear-gradient(135deg,#1e3c72\x200%,#2a5298\x20100%);padding:20px}\x0a\x20\x20\x20\x20.login-box{background:#fff;padding:40px;border-radius:12px;box-shadow:0\x2010px\x2040px\x20rgba(0,0,0,0.2);width:100%;max-width:400px}\x0a\x20\x20\x20\x20h1{color:#1e3c72;margin-bottom:10px;font-size:28px;font-weight:700}\x0a\x20\x20\x20\x20.subtitle{color:#666;margin-bottom:30px;font-size:14px}\x0a\x20\x20\x20\x20input[type=\x22password\x22]{width:100%;padding:12px\x2015px;border:2px\x20solid\x20#e0e0e0;border-radius:8px;font-size:16px;transition:border-color\x200.3s;margin-bottom:20px}\x0a\x20\x20\x20\x20input[type=\x22password\x22]:focus{outline:none;border-color:#2a5298}\x0a\x20\x20\x20\x20button{width:100%;padding:12px;background:linear-gradient(135deg,#2a5298,#1e3c72);color:#fff;border:none;border-radius:8px;font-size:16px;font-weight:600;cursor:pointer;transition:transform\x200.2s}\x0a\x20\x20\x20\x20button:hover{transform:translateY(-2px)}\x0a\x20\x20\x20\x20.error{color:#e74c3c;margin-top:15px;font-size:14px;text-align:center}\x0a\x20\x20\x20\x20.icon{text-align:center;margin-bottom:20px;font-size:48px}\x0a\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20<div\x20class=\x22login-box\x22>\x0a\x20\x20\x20\x20<div\x20class=\x22icon\x22>🔐</div>\x0a\x20\x20\x20\x20<h1>Admin\x20Panel</h1>\x0a\x20\x20\x20\x20<p\x20class=\x22subtitle\x22>Enter\x20your\x20admin\x20password\x20to\x20continue</p>\x0a\x20\x20\x20\x20<form\x20method=\x22POST\x22\x20action=\x22/admin\x22>\x0a\x20\x20\x20\x20\x20\x20<input\x20type=\x22password\x22\x20name=\x22password\x22\x20placeholder=\x22Admin\x20Password\x22\x20required\x20autofocus>\x0a\x20\x20\x20\x20\x20\x20<button\x20type=\x22submit\x22>Login</button>\x0a\x20\x20\x20\x20</form>\x0a\x20\x20</div>\x0a</body>\x0a</html>',ADMIN_PANEL_HTML='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,initial-scale=1\x22>\x0a\x20\x20<title>Admin\x20Panel\x20-\x20VLESS\x20Proxy\x20Manager</title>\x0a\x20\x20<style>\x0a\x20\x20\x20\x20*{margin:0;padding:0;box-sizing:border-box}\x0a\x20\x20\x20\x20body{font-family:-apple-system,BlinkMacSystemFont,\x22Segoe\x20UI\x22,Roboto,sans-serif;background:#f5f7fa;color:#2c3e50}\x0a\x20\x20\x20\x20.header{background:linear-gradient(135deg,#2a5298,#1e3c72);color:#fff;padding:20px;box-shadow:0\x202px\x2010px\x20rgba(0,0,0,0.1)}\x0a\x20\x20\x20\x20.header\x20h1{font-size:24px;font-weight:700;margin-bottom:5px}\x0a\x20\x20\x20\x20.header\x20p{opacity:0.9;font-size:14px}\x0a\x20\x20\x20\x20.container{max-width:1400px;margin:0\x20auto;padding:20px}\x0a\x20\x20\x20\x20.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:20px;margin-bottom:30px}\x0a\x20\x20\x20\x20.stat-card{background:#fff;padding:20px;border-radius:12px;box-shadow:0\x202px\x208px\x20rgba(0,0,0,0.08);text-align:center;transition:transform\x200.2s}\x0a\x20\x20\x20\x20.stat-card:hover{transform:translateY(-5px)}\x0a\x20\x20\x20\x20.stat-value{font-size:32px;font-weight:700;margin-bottom:5px}\x0a\x20\x20\x20\x20.stat-label{color:#7f8c8d;font-size:14px;text-transform:uppercase;letter-spacing:0.5px}\x0a\x20\x20\x20\x20.card{background:#fff;border-radius:12px;padding:25px;box-shadow:0\x202px\x208px\x20rgba(0,0,0,0.08);margin-bottom:25px}\x0a\x20\x20\x20\x20.card\x20h2{font-size:20px;margin-bottom:20px;color:#2c3e50;display:flex;align-items:center;justify-content:space-between}\x0a\x20\x20\x20\x20.btn{padding:10px\x2020px;border:none;border-radius:8px;cursor:pointer;font-size:14px;font-weight:600;transition:all\x200.2s;display:inline-flex;align-items:center;gap:8px}\x0a\x20\x20\x20\x20.btn-primary{background:linear-gradient(135deg,#3498db,#2980b9);color:#fff}\x0a\x20\x20\x20\x20.btn-primary:hover{transform:translateY(-2px);box-shadow:0\x204px\x2012px\x20rgba(52,152,219,0.4)}\x0a\x20\x20\x20\x20.btn-success{background:linear-gradient(135deg,#27ae60,#229954);color:#fff}\x0a\x20\x20\x20\x20.btn-danger{background:linear-gradient(135deg,#e74c3c,#c0392b);color:#fff}\x0a\x20\x20\x20\x20.btn-sm{padding:6px\x2012px;font-size:12px}\x0a\x20\x20\x20\x20.form-group{margin-bottom:20px}\x0a\x20\x20\x20\x20.form-group\x20label{display:block;margin-bottom:8px;font-weight:600;color:#34495e;font-size:14px}\x0a\x20\x20\x20\x20.form-group\x20input,.form-group\x20textarea{width:100%;padding:10px\x2012px;border:2px\x20solid\x20#e0e0e0;border-radius:8px;font-size:14px;transition:border-color\x200.3s}\x0a\x20\x20\x20\x20.form-group\x20input:focus,.form-group\x20textarea:focus{outline:none;border-color:#3498db}\x0a\x20\x20\x20\x20.table-container{overflow-x:auto;margin-top:20px}\x0a\x20\x20\x20\x20table{width:100%;border-collapse:collapse;min-width:800px}\x0a\x20\x20\x20\x20th,td{padding:12px;text-align:left;border-bottom:1px\x20solid\x20#ecf0f1}\x0a\x20\x20\x20\x20th{background:#f8f9fa;color:#2c3e50;font-weight:600;font-size:13px;text-transform:uppercase}\x0a\x20\x20\x20\x20tr:hover{background:#f8f9fa}\x0a\x20\x20\x20\x20.badge{display:inline-block;padding:4px\x2010px;border-radius:12px;font-size:11px;font-weight:600;text-transform:uppercase}\x0a\x20\x20\x20\x20.badge-success{background:#d5f4e6;color:#27ae60}\x0a\x20\x20\x20\x20.badge-danger{background:#fadbd8;color:#e74c3c}\x0a\x20\x20\x20\x20.badge-warning{background:#fcf3cf;color:#f39c12}\x0a\x20\x20\x20\x20.modal{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background:rgba(0,0,0,0.5);animation:fadeIn\x200.3s}\x0a\x20\x20\x20\x20.modal-content{background:#fff;margin:50px\x20auto;padding:30px;border-radius:12px;width:90%;max-width:600px;max-height:90vh;overflow-y:auto;animation:slideIn\x200.3s}\x0a\x20\x20\x20\x20.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}\x0a\x20\x20\x20\x20.modal-header\x20h3{font-size:20px;color:#2c3e50}\x0a\x20\x20\x20\x20.close{font-size:28px;cursor:pointer;color:#7f8c8d;line-height:1}\x0a\x20\x20\x20\x20.close:hover{color:#e74c3c}\x0a\x20\x20\x20\x20.copy-btn{cursor:pointer;color:#3498db;padding:4px\x208px;border-radius:4px;transition:all\x200.2s}\x0a\x20\x20\x20\x20.copy-btn:hover{background:#e3f2fd;color:#2980b9}\x0a\x20\x20\x20\x20.actions{display:flex;gap:8px;flex-wrap:wrap}\x0a\x20\x20\x20\x20.search-box{margin-bottom:20px}\x0a\x20\x20\x20\x20.search-box\x20input{width:100%;max-width:400px;padding:10px\x2015px;border:2px\x20solid\x20#e0e0e0;border-radius:8px;font-size:14px}\x0a\x20\x20\x20\x20.bulk-actions{display:flex;gap:10px;margin-bottom:20px;flex-wrap:wrap}\x0a\x20\x20\x20\x20.checkbox{width:18px;height:18px;cursor:pointer}\x0a\x20\x20\x20\x20.loading{text-align:center;padding:40px;color:#7f8c8d}\x0a\x20\x20\x20\x20.empty-state{text-align:center;padding:60px\x2020px;color:#7f8c8d}\x0a\x20\x20\x20\x20.empty-state-icon{font-size:64px;margin-bottom:20px;opacity:0.5}\x0a\x20\x20\x20\x20.toast{position:fixed;bottom:20px;right:20px;background:#2c3e50;color:#fff;padding:15px\x2020px;border-radius:8px;box-shadow:0\x204px\x2012px\x20rgba(0,0,0,0.3);z-index:2000;animation:slideInRight\x200.3s}\x0a\x20\x20\x20\x20@keyframes\x20fadeIn{from{opacity:0}to{opacity:1}}\x0a\x20\x20\x20\x20@keyframes\x20slideIn{from{transform:translateY(-50px);opacity:0}to{transform:translateY(0);opacity:1}}\x0a\x20\x20\x20\x20@keyframes\x20slideInRight{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}\x0a\x20\x20\x20\x20@media(max-width:768px){\x0a\x20\x20\x20\x20\x20\x20.stats-grid{grid-template-columns:1fr}\x0a\x20\x20\x20\x20\x20\x20.actions{flex-direction:column}\x0a\x20\x20\x20\x20\x20\x20.btn{width:100%}\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20table{font-size:13px}\x0a\x20\x20\x20\x20\x20\x20.modal-content{margin:20px;padding:20px}\x0a\x20\x20\x20\x20}\x0a\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20<h1>🚀\x20VLESS\x20Proxy\x20Admin\x20Panel</h1>\x0a\x20\x20\x20\x20\x20\x20<p>Comprehensive\x20user\x20management\x20and\x20monitoring\x20system</p>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20</div>\x0a\x0a\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20<div\x20class=\x22stats-grid\x22>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-value\x22\x20id=\x22totalUsers\x22>-</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-label\x22>Total\x20Users</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-value\x22\x20id=\x22activeUsers\x22>-</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-label\x22>Active\x20Users</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-value\x22\x20id=\x22expiredUsers\x22>-</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-label\x22>Expired\x20Users</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-value\x22\x20id=\x22totalTraffic\x22>-</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-label\x22>Total\x20Traffic</div>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20<h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span>👥\x20User\x20Management</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-success\x22\x20onclick=\x22openCreateModal()\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20➕\x20Create\x20New\x20User\x0a\x20\x20\x20\x20\x20\x20\x20\x20</button>\x0a\x20\x20\x20\x20\x20\x20</h2>\x0a\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22search-box\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22searchInput\x22\x20placeholder=\x22🔍\x20Search\x20by\x20UUID\x20or\x20notes...\x22\x20onkeyup=\x22filterUsers()\x22>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22bulk-actions\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-sm\x20btn-primary\x22\x20onclick=\x22selectAll()\x22>Select\x20All</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-sm\x20btn-primary\x22\x20onclick=\x22deselectAll()\x22>Deselect\x20All</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-sm\x20btn-danger\x22\x20onclick=\x22bulkDelete()\x22>🗑️\x20Delete\x20Selected</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-sm\x20btn-success\x22\x20onclick=\x22exportUsers()\x22>📥\x20Export\x20Users</button>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22table-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22loadingUsers\x22\x20class=\x22loading\x22>Loading\x20users...</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22emptyState\x22\x20class=\x22empty-state\x22\x20style=\x22display:none\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22empty-state-icon\x22>📭</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h3>No\x20Users\x20Found</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<p>Create\x20your\x20first\x20user\x20to\x20get\x20started</p>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<table\x20id=\x22usersTable\x22\x20style=\x22display:none\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th><input\x20type=\x22checkbox\x22\x20class=\x22checkbox\x22\x20id=\x22selectAllCheckbox\x22\x20onchange=\x22toggleSelectAll()\x22></th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>UUID</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Status</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Created</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Expires</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Traffic\x20Used</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Traffic\x20Limit</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Connections</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Notes</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<th>Actions</th>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody\x20id=\x22usersTableBody\x22></tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</table>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20</div>\x0a\x0a\x20\x20<div\x20id=\x22createModal\x22\x20class=\x22modal\x22>\x0a\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<h3>➕\x20Create\x20New\x20User</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22close\x22\x20onclick=\x22closeCreateModal()\x22>&times;</span>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<form\x20id=\x22createUserForm\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>UUID</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:flex;gap:10px\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22createUUID\x22\x20required\x20style=\x22flex:1\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20class=\x22btn\x20btn-primary\x22\x20onclick=\x22generateNewUUID()\x22>🎲\x20Generate</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Expiration\x20Date</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22date\x22\x20id=\x22createExpDate\x22\x20required>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Expiration\x20Time\x20(UTC)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22time\x22\x20id=\x22createExpTime\x22\x20value=\x2223:59:59\x22\x20step=\x221\x22\x20required>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Traffic\x20Limit\x20(bytes,\x200\x20=\x20unlimited)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20id=\x22createTrafficLimit\x22\x20value=\x220\x22\x20min=\x220\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<small\x20style=\x22color:#7f8c8d;margin-top:5px;display:block\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Examples:\x201073741824\x20(1GB),\x2010737418240\x20(10GB),\x20107374182400\x20(100GB)\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</small>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Notes\x20(optional)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22createNotes\x22\x20rows=\x223\x22\x20placeholder=\x22Add\x20notes\x20about\x20this\x20user...\x22></textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-success\x22\x20style=\x22width:100%\x22>Create\x20User</button>\x0a\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20</div>\x0a\x0a\x20\x20<div\x20id=\x22editModal\x22\x20class=\x22modal\x22>\x0a\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<h3>✏️\x20Edit\x20User</h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22close\x22\x20onclick=\x22closeEditModal()\x22>&times;</span>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<form\x20id=\x22editUserForm\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22hidden\x22\x20id=\x22editUUID\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>UUID\x20(read-only)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22text\x22\x20id=\x22editUUIDDisplay\x22\x20readonly\x20style=\x22background:#f5f5f5\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Expiration\x20Date</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22date\x22\x20id=\x22editExpDate\x22\x20required>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Expiration\x20Time\x20(UTC)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22time\x22\x20id=\x22editExpTime\x22\x20step=\x221\x22\x20required>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Traffic\x20Limit\x20(bytes,\x200\x20=\x20unlimited)</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22number\x22\x20id=\x22editTrafficLimit\x22\x20min=\x220\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>Notes</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<textarea\x20id=\x22editNotes\x22\x20rows=\x223\x22></textarea>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22checkbox\x22\x20id=\x22resetTraffic\x22\x20class=\x22checkbox\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20Reset\x20traffic\x20usage\x20to\x20zero\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</label>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-success\x22\x20style=\x22width:100%\x22>Save\x20Changes</button>\x0a\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20</div>\x0a\x0a\x20\x20<script>\x0a\x20\x20\x20\x20let\x20allUsers\x20=\x20[];\x0a\x20\x20\x20\x20let\x20selectedUsers\x20=\x20new\x20Set();\x0a\x0a\x20\x20\x20\x20//\x20Load\x20statistics\x20and\x20users\x20on\x20page\x20load\x0a\x20\x20\x20\x20document.addEventListener(\x27DOMContentLoaded\x27,\x20()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20loadStats();\x0a\x20\x20\x20\x20\x20\x20loadUsers();\x0a\x20\x20\x20\x20\x20\x20setInterval(loadStats,\x2030000);\x20//\x20Refresh\x20stats\x20every\x2030\x20seconds\x0a\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20//\x20Load\x20statistics\x20from\x20API\x0a\x20\x20\x20\x20async\x20function\x20loadStats()\x20{\x0a\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20response\x20=\x20await\x20fetch(\x27/admin/api/stats\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20data\x20=\x20await\x20response.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27totalUsers\x27).textContent\x20=\x20data.total_users\x20||\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27activeUsers\x27).textContent\x20=\x20data.active_users\x20||\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27expiredUsers\x27).textContent\x20=\x20data.expired_users\x20||\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27totalTraffic\x27).textContent\x20=\x20formatBytes(data.total_traffic\x20||\x200);\x0a\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20console.error(\x27Failed\x20to\x20load\x20statistics:\x27,\x20error);\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27Failed\x20to\x20load\x20statistics\x27,\x20\x27error\x27);\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Load\x20all\x20users\x20from\x20API\x0a\x20\x20\x20\x20async\x20function\x20loadUsers()\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20loadingEl\x20=\x20document.getElementById(\x27loadingUsers\x27);\x0a\x20\x20\x20\x20\x20\x20const\x20tableEl\x20=\x20document.getElementById(\x27usersTable\x27);\x0a\x20\x20\x20\x20\x20\x20const\x20emptyEl\x20=\x20document.getElementById(\x27emptyState\x27);\x0a\x0a\x20\x20\x20\x20\x20\x20loadingEl.style.display\x20=\x20\x27block\x27;\x0a\x20\x20\x20\x20\x20\x20tableEl.style.display\x20=\x20\x27none\x27;\x0a\x20\x20\x20\x20\x20\x20emptyEl.style.display\x20=\x20\x27none\x27;\x0a\x0a\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20response\x20=\x20await\x20fetch(\x27/admin/api/users\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!response.ok)\x20throw\x20new\x20Error(\x27Failed\x20to\x20fetch\x20users\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20allUsers\x20=\x20await\x20response.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20loadingEl.style.display\x20=\x20\x27none\x27;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20if\x20(allUsers.length\x20===\x200)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20emptyEl.style.display\x20=\x20\x27block\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20tableEl.style.display\x20=\x20\x27table\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20renderUsers(allUsers);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20console.error(\x27Failed\x20to\x20load\x20users:\x27,\x20error);\x0a\x20\x20\x20\x20\x20\x20\x20\x20loadingEl.innerHTML\x20=\x20\x27<p\x20style=\x22color:#e74c3c\x22>Failed\x20to\x20load\x20users.\x20Please\x20refresh\x20the\x20page.</p>\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27Failed\x20to\x20load\x20users\x27,\x20\x27error\x27);\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Render\x20users\x20in\x20table\x0a\x20\x20\x20\x20function\x20renderUsers(users)\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20tbody\x20=\x20document.getElementById(\x27usersTableBody\x27);\x0a\x20\x20\x20\x20\x20\x20tbody.innerHTML\x20=\x20\x27\x27;\x0a\x0a\x20\x20\x20\x20\x20\x20users.forEach(user\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20isExpired\x20=\x20checkIfExpired(user.expiration_date,\x20user.expiration_time);\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20trafficPercentage\x20=\x20user.traffic_limit\x20>\x200\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20?\x20((user.traffic_used\x20/\x20user.traffic_limit)\x20*\x20100).toFixed(1)\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20tr\x20=\x20document.createElement(\x27tr\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20tr.innerHTML\x20=\x20\x27<td><input\x20type=\x22checkbox\x22\x20class=\x22checkbox\x20user-checkbox\x22\x20value=\x22\x27\x20+\x20user.uuid\x20+\x20\x27\x22\x20onchange=\x22toggleUserSelection(\x27\x27\x20+\x20user.uuid\x20+\x20\x27\x27)\x22></td>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<td>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<div\x20style=\x22display:flex;align-items:center;gap:8px\x22>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<code\x20style=\x22font-size:11px\x22>\x27\x20+\x20user.uuid.substring(0,\x2013)\x20+\x20\x27...</code>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<span\x20class=\x22copy-btn\x22\x20onclick=\x22copyToClipboard(\x27\x27\x20+\x20user.uuid\x20+\x20\x27\x27)\x22\x20title=\x22Copy\x20UUID\x22>📋</span>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27</div>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27</td>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<td><span\x20class=\x22badge\x20\x27\x20+\x20(isExpired\x20?\x20\x27badge-danger\x27\x20:\x20\x27badge-success\x27)\x20+\x20\x27\x22>\x27\x20+\x20(isExpired\x20?\x20\x27Expired\x27\x20:\x20\x27Active\x27)\x20+\x20\x27</span></td>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<td>\x27\x20+\x20formatDate(user.created_at)\x20+\x20\x27</td>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<td>\x27\x20+\x20user.expiration_date\x20+\x20\x27\x20\x27\x20+\x20user.expiration_time\x20+\x20\x27</td>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<td>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20formatBytes(user.traffic_used\x20||\x200)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20(user.traffic_limit\x20>\x200\x20?\x20\x27<br><small\x20style=\x22color:#7f8c8d\x22>(\x27\x20+\x20trafficPercentage\x20+\x20\x27%)</small>\x27\x20:\x20\x27\x27)\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27</td>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<td>\x27\x20+\x20(user.traffic_limit\x20>\x200\x20?\x20formatBytes(user.traffic_limit)\x20:\x20\x27<span\x20style=\x22color:#27ae60\x22>Unlimited</span>\x27)\x20+\x20\x27</td>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<td>\x27\x20+\x20(user.connection_count\x20||\x200)\x20+\x20\x27</td>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<td><small>\x27\x20+\x20(user.notes\x20||\x20\x27-\x27)\x20+\x20\x27</small></td>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<td>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<div\x20class=\x22actions\x22>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<button\x20class=\x22btn\x20btn-sm\x20btn-primary\x22\x20onclick=\x22openEditModal(\x27\x27\x20+\x20user.uuid\x20+\x20\x27\x27)\x22>✏️</button>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<button\x20class=\x22btn\x20btn-sm\x20btn-primary\x22\x20onclick=\x22viewUserPanel(\x27\x27\x20+\x20user.uuid\x20+\x20\x27\x27)\x22>👁️</button>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27<button\x20class=\x22btn\x20btn-sm\x20btn-danger\x22\x20onclick=\x22deleteUser(\x27\x27\x20+\x20user.uuid\x20+\x20\x27\x27)\x22>🗑️</button>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27</div>\x27\x20+\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27</td>\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20tbody.appendChild(tr);\x0a\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Filter\x20users\x20based\x20on\x20search\x20input\x0a\x20\x20\x20\x20function\x20filterUsers()\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20searchTerm\x20=\x20document.getElementById(\x27searchInput\x27).value.toLowerCase();\x0a\x20\x20\x20\x20\x20\x20const\x20filteredUsers\x20=\x20allUsers.filter(user\x20=>\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20user.uuid.toLowerCase().includes(searchTerm)\x20||\x0a\x20\x20\x20\x20\x20\x20\x20\x20(user.notes\x20&&\x20user.notes.toLowerCase().includes(searchTerm))\x0a\x20\x20\x20\x20\x20\x20);\x0a\x20\x20\x20\x20\x20\x20renderUsers(filteredUsers);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Check\x20if\x20user\x20is\x20expired\x0a\x20\x20\x20\x20function\x20checkIfExpired(expDate,\x20expTime)\x20{\x0a\x20\x20\x20\x20\x20\x20if\x20(!expDate\x20||\x20!expTime)\x20return\x20true;\x0a\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20expDateTime\x20=\x20new\x20Date(expDate\x20+\x20\x27T\x27\x20+\x20expTime\x20+\x20\x27Z\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20return\x20expDateTime\x20<=\x20new\x20Date();\x0a\x20\x20\x20\x20\x20\x20}\x20catch\x20(e)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20return\x20true;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Format\x20bytes\x20to\x20human\x20readable\x0a\x20\x20\x20\x20function\x20formatBytes(bytes)\x20{\x0a\x20\x20\x20\x20\x20\x20if\x20(!bytes\x20||\x20bytes\x20===\x200)\x20return\x20\x270\x20B\x27;\x0a\x20\x20\x20\x20\x20\x20const\x20k\x20=\x201024;\x0a\x20\x20\x20\x20\x20\x20const\x20sizes\x20=\x20[\x27B\x27,\x20\x27KB\x27,\x20\x27MB\x27,\x20\x27GB\x27,\x20\x27TB\x27];\x0a\x20\x20\x20\x20\x20\x20const\x20i\x20=\x20Math.floor(Math.log(bytes)\x20/\x20Math.log(k));\x0a\x20\x20\x20\x20\x20\x20return\x20parseFloat((bytes\x20/\x20Math.pow(k,\x20i)).toFixed(2))\x20+\x20\x27\x20\x27\x20+\x20sizes[i];\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Format\x20date\x0a\x20\x20\x20\x20function\x20formatDate(dateString)\x20{\x0a\x20\x20\x20\x20\x20\x20return\x20new\x20Date(dateString).toLocaleDateString(\x27en-US\x27,\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20year:\x20\x27numeric\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20month:\x20\x27short\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20day:\x20\x27numeric\x27\x0a\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Copy\x20to\x20clipboard\x20with\x20visual\x20feedback\x0a\x20\x20\x20\x20async\x20function\x20copyToClipboard(text)\x20{\x0a\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20await\x20navigator.clipboard.writeText(text);\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27UUID\x20copied\x20to\x20clipboard!\x27,\x20\x27success\x27);\x0a\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27Failed\x20to\x20copy\x20UUID\x27,\x20\x27error\x27);\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Show\x20toast\x20notification\x0a\x20\x20\x20\x20function\x20showToast(message,\x20type\x20=\x20\x27info\x27)\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20toast\x20=\x20document.createElement(\x27div\x27);\x0a\x20\x20\x20\x20\x20\x20toast.className\x20=\x20\x27toast\x27;\x0a\x20\x20\x20\x20\x20\x20toast.textContent\x20=\x20message;\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20if\x20(type\x20===\x20\x27success\x27)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20toast.style.background\x20=\x20\x27#27ae60\x27;\x0a\x20\x20\x20\x20\x20\x20}\x20else\x20if\x20(type\x20===\x20\x27error\x27)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20toast.style.background\x20=\x20\x27#e74c3c\x27;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20document.body.appendChild(toast);\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20setTimeout(()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20toast.style.animation\x20=\x20\x27slideInRight\x200.3s\x20reverse\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20setTimeout(()\x20=>\x20toast.remove(),\x20300);\x0a\x20\x20\x20\x20\x20\x20},\x203000);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Modal\x20management\x0a\x20\x20\x20\x20function\x20openCreateModal()\x20{\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27createModal\x27).style.display\x20=\x20\x27block\x27;\x0a\x20\x20\x20\x20\x20\x20generateNewUUID();\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27createExpDate\x27).value\x20=\x20new\x20Date(Date.now()\x20+\x2030*24*60*60*1000).toISOString().split(\x27T\x27)[0];\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20closeCreateModal()\x20{\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27createModal\x27).style.display\x20=\x20\x27none\x27;\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27createUserForm\x27).reset();\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20generateNewUUID()\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20uuid\x20=\x20crypto.randomUUID();\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27createUUID\x27).value\x20=\x20uuid;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Create\x20user\x20form\x20submission\x0a\x20\x20\x20\x20document.getElementById(\x27createUserForm\x27).addEventListener(\x27submit\x27,\x20async\x20(e)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20const\x20userData\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20uuid:\x20document.getElementById(\x27createUUID\x27).value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20exp_date:\x20document.getElementById(\x27createExpDate\x27).value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20exp_time:\x20document.getElementById(\x27createExpTime\x27).value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20traffic_limit:\x20parseInt(document.getElementById(\x27createTrafficLimit\x27).value),\x0a\x20\x20\x20\x20\x20\x20\x20\x20notes:\x20document.getElementById(\x27createNotes\x27).value\x0a\x20\x20\x20\x20\x20\x20};\x0a\x0a\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20response\x20=\x20await\x20fetch(\x27/admin/api/users\x27,\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20method:\x20\x27POST\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20headers:\x20{\x20\x27Content-Type\x27:\x20\x27application/json\x27\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body:\x20JSON.stringify(userData)\x0a\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!response.ok)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20error\x20=\x20await\x20response.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20throw\x20new\x20Error(error.error\x20||\x20\x27Failed\x20to\x20create\x20user\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20created\x20successfully!\x27,\x20\x27success\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20closeCreateModal();\x0a\x20\x20\x20\x20\x20\x20\x20\x20loadUsers();\x0a\x20\x20\x20\x20\x20\x20\x20\x20loadStats();\x0a\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(error.message,\x20\x27error\x27);\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20//\x20Open\x20edit\x20modal\x0a\x20\x20\x20\x20function\x20openEditModal(uuid)\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20user\x20=\x20allUsers.find(u\x20=>\x20u.uuid\x20===\x20uuid);\x0a\x20\x20\x20\x20\x20\x20if\x20(!user)\x20return;\x0a\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27editUUID\x27).value\x20=\x20user.uuid;\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27editUUIDDisplay\x27).value\x20=\x20user.uuid;\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27editExpDate\x27).value\x20=\x20user.expiration_date;\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27editExpTime\x27).value\x20=\x20user.expiration_time;\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27editTrafficLimit\x27).value\x20=\x20user.traffic_limit\x20||\x200;\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27editNotes\x27).value\x20=\x20user.notes\x20||\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27resetTraffic\x27).checked\x20=\x20false;\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27editModal\x27).style.display\x20=\x20\x27block\x27;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20closeEditModal()\x20{\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27editModal\x27).style.display\x20=\x20\x27none\x27;\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27editUserForm\x27).reset();\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Edit\x20user\x20form\x20submission\x0a\x20\x20\x20\x20document.getElementById(\x27editUserForm\x27).addEventListener(\x27submit\x27,\x20async\x20(e)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20const\x20uuid\x20=\x20document.getElementById(\x27editUUID\x27).value;\x0a\x20\x20\x20\x20\x20\x20const\x20userData\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20exp_date:\x20document.getElementById(\x27editExpDate\x27).value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20exp_time:\x20document.getElementById(\x27editExpTime\x27).value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20traffic_limit:\x20parseInt(document.getElementById(\x27editTrafficLimit\x27).value),\x0a\x20\x20\x20\x20\x20\x20\x20\x20notes:\x20document.getElementById(\x27editNotes\x27).value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20reset_traffic:\x20document.getElementById(\x27resetTraffic\x27).checked\x0a\x20\x20\x20\x20\x20\x20};\x0a\x0a\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20response\x20=\x20await\x20fetch(\x27/admin/api/users/\x27\x20+\x20uuid,\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20method:\x20\x27PUT\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20headers:\x20{\x20\x27Content-Type\x27:\x20\x27application/json\x27\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body:\x20JSON.stringify(userData)\x0a\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!response.ok)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20error\x20=\x20await\x20response.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20throw\x20new\x20Error(error.error\x20||\x20\x27Failed\x20to\x20update\x20user\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20updated\x20successfully!\x27,\x20\x27success\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20closeEditModal();\x0a\x20\x20\x20\x20\x20\x20\x20\x20loadUsers();\x0a\x20\x20\x20\x20\x20\x20\x20\x20loadStats();\x0a\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(error.message,\x20\x27error\x27);\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20//\x20Delete\x20single\x20user\x0a\x20\x20\x20\x20async\x20function\x20deleteUser(uuid)\x20{\x0a\x20\x20\x20\x20\x20\x20if\x20(!confirm(\x27Are\x20you\x20sure\x20you\x20want\x20to\x20delete\x20this\x20user?\x20This\x20action\x20cannot\x20be\x20undone.\x27))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20response\x20=\x20await\x20fetch(\x27/admin/api/users/\x27\x20+\x20uuid,\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20method:\x20\x27DELETE\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!response.ok)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20throw\x20new\x20Error(\x27Failed\x20to\x20delete\x20user\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20deleted\x20successfully\x27,\x20\x27success\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20loadUsers();\x0a\x20\x20\x20\x20\x20\x20\x20\x20loadStats();\x0a\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(error.message,\x20\x27error\x27);\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20View\x20user\x20panel\x0a\x20\x20\x20\x20function\x20viewUserPanel(uuid)\x20{\x0a\x20\x20\x20\x20\x20\x20window.open(\x27/\x27\x20+\x20uuid,\x20\x27_blank\x27);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Selection\x20management\x0a\x20\x20\x20\x20function\x20toggleUserSelection(uuid)\x20{\x0a\x20\x20\x20\x20\x20\x20if\x20(selectedUsers.has(uuid))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20selectedUsers.delete(uuid);\x0a\x20\x20\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20selectedUsers.add(uuid);\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20updateSelectAllCheckbox();\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20selectAll()\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20checkboxes\x20=\x20document.querySelectorAll(\x27.user-checkbox\x27);\x0a\x20\x20\x20\x20\x20\x20checkboxes.forEach(cb\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20cb.checked\x20=\x20true;\x0a\x20\x20\x20\x20\x20\x20\x20\x20selectedUsers.add(cb.value);\x0a\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20updateSelectAllCheckbox();\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20deselectAll()\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20checkboxes\x20=\x20document.querySelectorAll(\x27.user-checkbox\x27);\x0a\x20\x20\x20\x20\x20\x20checkboxes.forEach(cb\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20cb.checked\x20=\x20false;\x0a\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20selectedUsers.clear();\x0a\x20\x20\x20\x20\x20\x20updateSelectAllCheckbox();\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20toggleSelectAll()\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20selectAllCheckbox\x20=\x20document.getElementById(\x27selectAllCheckbox\x27);\x0a\x20\x20\x20\x20\x20\x20if\x20(selectAllCheckbox.checked)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20selectAll();\x0a\x20\x20\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20deselectAll();\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20function\x20updateSelectAllCheckbox()\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20selectAllCheckbox\x20=\x20document.getElementById(\x27selectAllCheckbox\x27);\x0a\x20\x20\x20\x20\x20\x20const\x20checkboxes\x20=\x20document.querySelectorAll(\x27.user-checkbox\x27);\x0a\x20\x20\x20\x20\x20\x20selectAllCheckbox.checked\x20=\x20checkboxes.length\x20>\x200\x20&&\x20selectedUsers.size\x20===\x20checkboxes.length;\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Bulk\x20delete\x0a\x20\x20\x20\x20async\x20function\x20bulkDelete()\x20{\x0a\x20\x20\x20\x20\x20\x20if\x20(selectedUsers.size\x20===\x200)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27No\x20users\x20selected\x27,\x20\x27error\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20if\x20(!confirm(\x27Are\x20you\x20sure\x20you\x20want\x20to\x20delete\x20\x27\x20+\x20selectedUsers.size\x20+\x20\x27\x20user(s)?\x20This\x20action\x20cannot\x20be\x20undone.\x27))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20response\x20=\x20await\x20fetch(\x27/admin/api/users/bulk-delete\x27,\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20method:\x20\x27POST\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20headers:\x20{\x20\x27Content-Type\x27:\x20\x27application/json\x27\x20},\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20body:\x20JSON.stringify({\x20uuids:\x20Array.from(selectedUsers)\x20})\x0a\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!response.ok)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20throw\x20new\x20Error(\x27Failed\x20to\x20delete\x20users\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27Successfully\x20deleted\x20\x27\x20+\x20selectedUsers.size\x20+\x20\x27\x20user(s)\x27,\x20\x27success\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20selectedUsers.clear();\x0a\x20\x20\x20\x20\x20\x20\x20\x20loadUsers();\x0a\x20\x20\x20\x20\x20\x20\x20\x20loadStats();\x0a\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(error.message,\x20\x27error\x27);\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Export\x20users\x20to\x20CSV\x0a\x20\x20\x20\x20function\x20exportUsers()\x20{\x0a\x20\x20\x20\x20\x20\x20if\x20(allUsers.length\x20===\x200)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27No\x20users\x20to\x20export\x27,\x20\x27error\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20const\x20headers\x20=\x20[\x27UUID\x27,\x20\x27Created\x20At\x27,\x20\x27Expiration\x20Date\x27,\x20\x27Expiration\x20Time\x27,\x20\x27Traffic\x20Used\x27,\x20\x27Traffic\x20Limit\x27,\x20\x27Connection\x20Count\x27,\x20\x27Notes\x27];\x0a\x20\x20\x20\x20\x20\x20const\x20csvContent\x20=\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20headers.join(\x27,\x27),\x0a\x20\x20\x20\x20\x20\x20\x20\x20...allUsers.map(user\x20=>\x20[\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user.uuid,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user.created_at,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user.expiration_date,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user.expiration_time,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user.traffic_used\x20||\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user.traffic_limit\x20||\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20user.connection_count\x20||\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x27\x22\x27\x20+\x20(user.notes\x20||\x20\x27\x27).replace(/\x22/g,\x20\x27\x22\x22\x27)\x20+\x20\x27\x22\x27\x0a\x20\x20\x20\x20\x20\x20\x20\x20].join(\x27,\x27))\x0a\x20\x20\x20\x20\x20\x20].join(\x27\x5cn\x27);\x0a\x0a\x20\x20\x20\x20\x20\x20const\x20blob\x20=\x20new\x20Blob([csvContent],\x20{\x20type:\x20\x27text/csv;charset=utf-8;\x27\x20});\x0a\x20\x20\x20\x20\x20\x20const\x20link\x20=\x20document.createElement(\x27a\x27);\x0a\x20\x20\x20\x20\x20\x20link.href\x20=\x20URL.createObjectURL(blob);\x0a\x20\x20\x20\x20\x20\x20link.download\x20=\x20\x27vless-users-\x27\x20+\x20new\x20Date().toISOString().split(\x27T\x27)[0]\x20+\x20\x27.csv\x27;\x0a\x20\x20\x20\x20\x20\x20link.click();\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20showToast(\x27Users\x20exported\x20successfully\x27,\x20\x27success\x27);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20Close\x20modals\x20when\x20clicking\x20outside\x0a\x20\x20\x20\x20window.onclick\x20=\x20function(event)\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20createModal\x20=\x20document.getElementById(\x27createModal\x27);\x0a\x20\x20\x20\x20\x20\x20const\x20editModal\x20=\x20document.getElementById(\x27editModal\x27);\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20if\x20(event.target\x20===\x20createModal)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20closeCreateModal();\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20if\x20(event.target\x20===\x20editModal)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20closeEditModal();\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x20\x20</script>\x0a</body>\x0a</html>';async function isAdmin(a,b){const c=a['headers']['get']('Cookie');if(!c)return![];const d=c['match'](/auth_token=([^;]+)/)?.[0x1];if(!d)return![];try{const e=await b['USER_KV']['get']('admin_session_token');return e&&e===d;}catch{return![];}}async function handleAdminRequest(a,b,c){const d=new URL(a['url']),{pathname:f}=d,g={'Content-Type':'application/json','Access-Control-Allow-Origin':d['origin']};if(!b['ADMIN_KEY'])return new Response('Admin\x20panel\x20not\x20configured',{'status':0x1f7});if(f['startsWith']('/admin/api/')){if(!await isAdmin(a,b))return new Response(JSON['stringify']({'error':'Unauthorized'}),{'status':0x193,'headers':g});if(a['method']!=='GET'){const i=a['headers']['get']('Origin');if(!i||new URL(i)['hostname']!==d['hostname'])return new Response(JSON['stringify']({'error':'Invalid\x20origin'}),{'status':0x193,'headers':g});}if(f==='/admin/api/stats'&&a['method']==='GET')try{const j=await b['DB']['prepare']('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20users')['first']('count')||0x0,k=await b['DB']['prepare']('SELECT\x20COUNT(*)\x20as\x20count\x20FROM\x20users\x20WHERE\x20datetime(expiration_date\x20||\x20\x27T\x27\x20||\x20expiration_time\x20||\x20\x27Z\x27)\x20<\x20datetime(\x27now\x27)')['first'](),l=k?.['count']||0x0,m=j-l,n=await b['DB']['prepare']('SELECT\x20SUM(traffic_used)\x20as\x20sum\x20FROM\x20users')['first'](),o=n?.['sum']||0x0,p=getHealthMonitor(Config),q=p['getStats']();return new Response(JSON['stringify']({'total_users':j,'active_users':m,'expired_users':l,'total_traffic':o,'health_stats':q}),{'status':0xc8,'headers':g});}catch(r){return console['error']('Stats\x20error:',r),new Response(JSON['stringify']({'error':r['message']}),{'status':0x1f4,'headers':g});}if(f==='/admin/api/users'&&a['method']==='GET')try{const {results:s}=await b['DB']['prepare']('SELECT\x20uuid,\x20created_at,\x20expiration_date,\x20expiration_time,\x20notes,\x20traffic_limit,\x20traffic_used,\x20last_connection,\x20connection_count\x20FROM\x20users\x20ORDER\x20BY\x20created_at\x20DESC')['all']();return new Response(JSON['stringify'](s||[]),{'status':0xc8,'headers':g});}catch(t){return console['error']('List\x20users\x20error:',t),new Response(JSON['stringify']({'error':t['message']}),{'status':0x1f4,'headers':g});}if(f==='/admin/api/users'&&a['method']==='POST')try{const {uuid:u,exp_date:v,exp_time:w,notes:x,traffic_limit:y}=await a['json']();if(!u||!v||!w)throw new Error('Missing\x20required\x20fields:\x20uuid,\x20exp_date,\x20exp_time');if(!isValidUUID(u))throw new Error('Invalid\x20UUID\x20format');if(!/^\d{4}-\d{2}-\d{2}$/['test'](v))throw new Error('Invalid\x20date\x20format.\x20Use\x20YYYY-MM-DD');if(!/^\d{2}:\d{2}:\d{2}$/['test'](w))throw new Error('Invalid\x20time\x20format.\x20Use\x20HH:MM:SS');return await b['DB']['prepare']('INSERT\x20INTO\x20users\x20(uuid,\x20expiration_date,\x20expiration_time,\x20notes,\x20traffic_limit,\x20traffic_used)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x200)')['bind'](u,v,w,x||null,y||0x0)['run'](),c['waitUntil'](b['USER_KV']['put']('user:'+u,JSON['stringify']({'uuid':u,'expiration_date':v,'expiration_time':w,'notes':x||null,'traffic_limit':y||0x0,'traffic_used':0x0,'is_active':0x1}),{'expirationTtl':0x708})),new Response(JSON['stringify']({'success':!![],'uuid':u}),{'status':0xc9,'headers':g});}catch(z){console['error']('Create\x20user\x20error:',z);if(z['message']?.['includes']('UNIQUE\x20constraint\x20failed'))return new Response(JSON['stringify']({'error':'User\x20with\x20this\x20UUID\x20already\x20exists'}),{'status':0x199,'headers':g});return new Response(JSON['stringify']({'error':z['message']}),{'status':0x190,'headers':g});}if(f==='/admin/api/users/bulk-delete'&&a['method']==='POST')try{const {uuids:A}=await a['json']();if(!Array['isArray'](A)||A['length']===0x0)throw new Error('Invalid\x20request:\x20expected\x20array\x20of\x20UUIDs');const B=b['DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?'),C=A['map'](D=>B['bind'](D));return await b['DB']['batch'](C),c['waitUntil'](Promise['all'](A['map'](D=>b['USER_KV']['delete']('user:'+D)))),new Response(JSON['stringify']({'success':!![],'count':A['length']}),{'status':0xc8,'headers':g});}catch(D){return console['error']('Bulk\x20delete\x20error:',D),new Response(JSON['stringify']({'error':D['message']}),{'status':0x190,'headers':g});}const h=f['match'](/^\/admin\/api\/users\/([a-f0-9-]+)$/);if(h&&a['method']==='PUT'){const E=h[0x1];try{const {exp_date:F,exp_time:G,notes:H,traffic_limit:I,reset_traffic:J}=await a['json']();if(!F||!G)throw new Error('Missing\x20required\x20fields:\x20exp_date,\x20exp_time');if(!/^\d{4}-\d{2}-\d{2}$/['test'](F)||!/^\d{2}:\d{2}:\d{2}$/['test'](G))throw new Error('Invalid\x20date/time\x20format');let K='UPDATE\x20users\x20SET\x20expiration_date\x20=\x20?,\x20expiration_time\x20=\x20?,\x20notes\x20=\x20?,\x20traffic_limit\x20=\x20?',L=[F,G,H||null,I||0x0];return J&&(K+=',\x20traffic_used\x20=\x200'),K+='\x20WHERE\x20uuid\x20=\x20?',L['push'](E),await b['DB']['prepare'](K)['bind'](...L)['run'](),c['waitUntil'](b['USER_KV']['delete']('user:'+E)),new Response(JSON['stringify']({'success':!![],'uuid':E}),{'status':0xc8,'headers':g});}catch(M){return console['error']('Update\x20user\x20error:',M),new Response(JSON['stringify']({'error':M['message']}),{'status':0x190,'headers':g});}}if(h&&a['method']==='DELETE'){const N=h[0x1];try{return await b['DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](N)['run'](),c['waitUntil'](b['USER_KV']['delete']('user:'+N)),new Response(JSON['stringify']({'success':!![],'uuid':N}),{'status':0xc8,'headers':g});}catch(O){return console['error']('Delete\x20user\x20error:',O),new Response(JSON['stringify']({'error':O['message']}),{'status':0x1f4,'headers':g});}}return new Response(JSON['stringify']({'error':'API\x20route\x20not\x20found'}),{'status':0x194,'headers':g});}if(f==='/admin'){if(a['method']==='POST'){const P=await a['formData'](),Q=P['get']('password');if(Q===b['ADMIN_KEY']){const R=crypto['randomUUID']();return c['waitUntil'](b['USER_KV']['put']('admin_session_token',R,{'expirationTtl':0x15180})),new Response(null,{'status':0x12e,'headers':{'Location':'/admin','Set-Cookie':'auth_token='+R+';\x20HttpOnly;\x20Secure;\x20Path=/admin;\x20Max-Age=86400;\x20SameSite=Strict'}});}else return new Response(ADMIN_LOGIN_HTML['replace']('</form>','</form><p\x20class=\x22error\x22>❌\x20Invalid\x20password.\x20Please\x20try\x20again.</p>'),{'status':0x191,'headers':{'Content-Type':'text/html;charset=utf-8'}});}if(a['method']==='GET'){if(await isAdmin(a,b))return new Response(ADMIN_PANEL_HTML,{'headers':{'Content-Type':'text/html;charset=utf-8'}});return new Response(ADMIN_LOGIN_HTML,{'headers':{'Content-Type':'text/html;charset=utf-8'}});}return new Response('Method\x20not\x20allowed',{'status':0x195});}return new Response('Not\x20found',{'status':0x194});}function generateUserPanel(a,b,c){const d='https://'+b+'/xray/'+a,e='https://'+b+'/sb/'+a,f=isExpired(c['expiration_date'],c['expiration_time']);let g=0x0;c['traffic_limit']&&c['traffic_limit']>0x0&&(g=Math['min']((c['traffic_used']||0x0)/c['traffic_limit']*0x64,0x64)['toFixed'](0x2));const h=new Date(c['expiration_date']+'T'+c['expiration_time']+'Z'),i=Math['max'](0x0,Math['ceil']((h-new Date())/(0x3e8*0x3c*0x3c*0x18))),j=l=>{if(!l||l===0x0)return'0\x20Bytes';const m=0x400,n=['Bytes','KB','MB','GB','TB'],o=Math['floor'](Math['log'](l)/Math['log'](m));return parseFloat((l/Math['pow'](m,o))['toFixed'](0x2))+'\x20'+n[o];};return'<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,initial-scale=1\x22>\x0a\x20\x20<title>VLESS\x20Configuration\x20Panel</title>\x0a\x20\x20<script\x20src=\x22https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js\x22></script>\x0a\x20\x20<style>\x0a\x20\x20\x20\x20*{margin:0;padding:0;box-sizing:border-box}\x0a\x20\x20\x20\x20body{font-family:-apple-system,BlinkMacSystemFont,\x22Segoe\x20UI\x22,Roboto,sans-serif;background:linear-gradient(135deg,#667eea\x200%,#764ba2\x20100%);min-height:100vh;padding:20px;color:#2c3e50}\x0a\x20\x20\x20\x20.container{max-width:900px;margin:0\x20auto}\x0a\x20\x20\x20\x20.header{text-align:center;color:#fff;margin-bottom:30px}\x0a\x20\x20\x20\x20.header\x20h1{font-size:32px;margin-bottom:10px;font-weight:700}\x0a\x20\x20\x20\x20.header\x20p{opacity:0.9;font-size:16px}\x0a\x20\x20\x20\x20.card{background:#fff;border-radius:16px;padding:25px;box-shadow:0\x2010px\x2040px\x20rgba(0,0,0,0.15);margin-bottom:20px}\x0a\x20\x20\x20\x20.stats-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:15px;margin-bottom:25px}\x0a\x20\x20\x20\x20.stat{background:linear-gradient(135deg,#f5f7fa,#c3cfe2);padding:20px;border-radius:12px;text-align:center}\x0a\x20\x20\x20\x20.stat-value{font-size:24px;font-weight:700;margin-bottom:5px}\x0a\x20\x20\x20\x20.stat-label{font-size:12px;color:#7f8c8d;text-transform:uppercase;letter-spacing:0.5px}\x0a\x20\x20\x20\x20.status-active{color:#27ae60}\x0a\x20\x20\x20\x20.status-expired{color:#e74c3c}\x0a\x20\x20\x20\x20.status-warning{color:#f39c12}\x0a\x20\x20\x20\x20.progress-bar{background:#ecf0f1;height:8px;border-radius:4px;overflow:hidden;margin:10px\x200}\x0a\x20\x20\x20\x20.progress-fill{background:linear-gradient(90deg,#3498db,#2ecc71);height:100%;transition:width\x200.3s}\x0a\x20\x20\x20\x20.btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:12px\x2020px;border-radius:10px;border:none;cursor:pointer;font-weight:600;font-size:14px;text-decoration:none;transition:all\x200.2s;margin:5px}\x0a\x20\x20\x20\x20.btn-primary{background:linear-gradient(135deg,#3498db,#2980b9);color:#fff}\x0a\x20\x20\x20\x20.btn-primary:hover{transform:translateY(-2px);box-shadow:0\x205px\x2015px\x20rgba(52,152,219,0.4)}\x0a\x20\x20\x20\x20.btn-success{background:linear-gradient(135deg,#27ae60,#229954);color:#fff}\x0a\x20\x20\x20\x20.btn-success:hover{transform:translateY(-2px);box-shadow:0\x205px\x2015px\x20rgba(39,174,96,0.4)}\x0a\x20\x20\x20\x20.config-box{background:#2c3e50;color:#ecf0f1;padding:15px;border-radius:10px;font-family:\x27Courier\x20New\x27,monospace;font-size:13px;margin:15px\x200;word-break:break-all;position:relative}\x0a\x20\x20\x20\x20.copy-btn{position:absolute;top:10px;right:10px;background:rgba(255,255,255,0.2);border:none;color:#fff;padding:6px\x2012px;border-radius:6px;cursor:pointer;font-size:12px;transition:background\x200.2s}\x0a\x20\x20\x20\x20.copy-btn:hover{background:rgba(255,255,255,0.3)}\x0a\x20\x20\x20\x20#qr-container{text-align:center;padding:30px;background:#f8f9fa;border-radius:12px;margin-top:20px;display:none}\x0a\x20\x20\x20\x20#qr-code{display:inline-block;padding:15px;background:#fff;border-radius:10px;box-shadow:0\x205px\x2020px\x20rgba(0,0,0,0.1)}\x0a\x20\x20\x20\x20.section-title{font-size:20px;font-weight:700;margin:25px\x200\x2015px;color:#2c3e50;display:flex;align-items:center;gap:10px}\x0a\x20\x20\x20\x20.info-row{display:flex;justify-content:space-between;padding:12px\x200;border-bottom:1px\x20solid\x20#ecf0f1}\x0a\x20\x20\x20\x20.info-row:last-child{border-bottom:none}\x0a\x20\x20\x20\x20.info-label{font-weight:600;color:#7f8c8d}\x0a\x20\x20\x20\x20.info-value{color:#2c3e50}\x0a\x20\x20\x20\x20.alert{padding:15px;border-radius:10px;margin-bottom:20px}\x0a\x20\x20\x20\x20.alert-warning{background:#fcf3cf;border-left:4px\x20solid\x20#f39c12;color:#856404}\x0a\x20\x20\x20\x20.alert-danger{background:#fadbd8;border-left:4px\x20solid\x20#e74c3c;color:#721c24}\x0a\x20\x20\x20\x20.alert-success{background:#d5f4e6;border-left:4px\x20solid\x20#27ae60;color:#155724}\x0a\x20\x20\x20\x20.toast{position:fixed;bottom:20px;right:20px;background:#2c3e50;color:#fff;padding:15px\x2020px;border-radius:10px;box-shadow:0\x205px\x2020px\x20rgba(0,0,0,0.3);z-index:1000;animation:slideIn\x200.3s;display:none}\x0a\x20\x20\x20\x20@keyframes\x20slideIn{from{transform:translateX(100%);opacity:0}to{transform:translateX(0);opacity:1}}\x0a\x20\x20\x20\x20@media(max-width:768px){\x0a\x20\x20\x20\x20\x20\x20.header\x20h1{font-size:24px}\x0a\x20\x20\x20\x20\x20\x20.stats-grid{grid-template-columns:1fr\x201fr}\x0a\x20\x20\x20\x20\x20\x20.btn{width:100%;margin:5px\x200}\x0a\x20\x20\x20\x20}\x0a\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20<div\x20class=\x22header\x22>\x0a\x20\x20\x20\x20\x20\x20<h1>🚀\x20VLESS\x20Configuration\x20Panel</h1>\x0a\x20\x20\x20\x20\x20\x20<p>Your\x20personal\x20VPN\x20configuration\x20dashboard</p>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20'+(f?'\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22alert\x20alert-danger\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<strong>⚠️\x20Account\x20Expired</strong><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20Your\x20account\x20has\x20expired.\x20Please\x20contact\x20the\x20administrator\x20to\x20renew\x20your\x20subscription.\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20':i<=0x7?'\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22alert\x20alert-warning\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<strong>⏰\x20Expiring\x20Soon</strong><br>\x0a\x20\x20\x20\x20\x20\x20\x20\x20Your\x20account\x20will\x20expire\x20in\x20'+i+'\x20day'+(i!==0x1?'s':'')+'.\x20Consider\x20renewing\x20your\x20subscription.\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20':'')+'\x0a\x0a\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22stats-grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-value\x20'+(f?'status-expired':i<=0x7?'status-warning':'status-active')+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(f?'❌\x20Expired':'✅\x20Active')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-label\x22>Account\x20Status</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-value\x22>'+j(c['traffic_used']||0x0)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-label\x22>Data\x20Used</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-value\x22>'+(c['traffic_limit']?j(c['traffic_limit']):'∞')+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-label\x22>Data\x20Limit</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-value\x22>'+(c['connection_count']||0x0)+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-label\x22>Connections</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+(!f?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-value\x22>'+i+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-label\x22>Days\x20Left</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20':'')+'\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20\x20\x20'+(c['traffic_limit']>0x0?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:flex;justify-content:space-between;margin-bottom:5px;font-size:13px\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>Traffic\x20Usage</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span>'+g+'%</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22progress-bar\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22progress-fill\x22\x20style=\x22width:'+g+'%;background:'+(g>0x5a?'#e74c3c':g>0x46?'#f39c12':'linear-gradient(90deg,#3498db,#2ecc71)')+'\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20':'')+'\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20<h2\x20class=\x22section-title\x22>📱\x20Subscription\x20Links</h2>\x0a\x20\x20\x20\x20\x20\x20<p\x20style=\x22color:#7f8c8d;margin-bottom:20px\x22>Copy\x20these\x20URLs\x20to\x20your\x20VPN\x20client\x20application</p>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin-top:20px;font-size:16px;color:#2c3e50\x22>Xray\x20/\x20V2Ray\x20/\x20V2RayNG</h3>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-box\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22copy-btn\x22\x20onclick=\x22copyText(\x27'+d+'\x27)\x22>📋\x20Copy</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+d+'\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:flex;gap:10px;flex-wrap:wrap\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-primary\x22\x20onclick=\x22copyText(\x27'+d+'\x27)\x22>📋\x20Copy\x20Link</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-success\x22\x20onclick=\x22showQR(\x27'+d+'\x27,\x20\x27Xray\x20Subscription\x27)\x22>📱\x20Show\x20QR\x20Code</button>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<h3\x20style=\x22margin-top:30px;font-size:16px;color:#2c3e50\x22>Sing-Box\x20/\x20Clash\x20Meta</h3>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-box\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22copy-btn\x22\x20onclick=\x22copyText(\x27'+e+'\x27)\x22>📋\x20Copy</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+e+'\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20style=\x22display:flex;gap:10px;flex-wrap:wrap\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-primary\x22\x20onclick=\x22copyText(\x27'+e+'\x27)\x22>📋\x20Copy\x20Link</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-success\x22\x20onclick=\x22showQR(\x27'+e+'\x27,\x20\x27Sing-Box\x20Subscription\x27)\x22>📱\x20Show\x20QR\x20Code</button>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20<div\x20id=\x22qr-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<h3\x20id=\x22qr-title\x22\x20style=\x22margin-bottom:15px;color:#2c3e50\x22></h3>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22qr-code\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-primary\x22\x20onclick=\x22hideQR()\x22\x20style=\x22margin-top:15px\x22>Close</button>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20<h2\x20class=\x22section-title\x22>ℹ️\x20Account\x20Information</h2>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22info-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22info-label\x22>UUID</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22info-value\x22\x20style=\x22font-family:monospace;font-size:12px\x22>'+a+'</span>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22info-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22info-label\x22>Created</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22info-value\x22>'+new Date(c['created_at'])['toLocaleDateString']()+'</span>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22info-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22info-label\x22>Expires</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22info-value\x22>'+h['toLocaleString']()+'</span>\x0a\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20'+(c['notes']?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22info-label\x22>Notes</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22info-value\x22>'+c['notes']+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20':'')+'\x0a\x20\x20\x20\x20\x20\x20'+(c['last_connection']?'\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22info-row\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22info-label\x22>Last\x20Connection</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<span\x20class=\x22info-value\x22>'+new Date(c['last_connection'])['toLocaleString']()+'</span>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20':'')+'\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20<h2\x20class=\x22section-title\x22>📖\x20Quick\x20Setup\x20Guide</h2>\x0a\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin-bottom:15px;color:#555\x22>Follow\x20these\x20steps\x20to\x20connect\x20to\x20your\x20VPN:</p>\x0a\x20\x20\x20\x20\x20\x20<ol\x20style=\x22padding-left:20px;line-height:1.8;color:#555\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<li>Download\x20a\x20compatible\x20VPN\x20client\x20(V2RayNG\x20for\x20Android,\x20V2Box\x20for\x20iOS,\x20V2RayN\x20for\x20Windows)</li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<li>Open\x20the\x20application\x20and\x20find\x20the\x20subscription\x20or\x20import\x20option</li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<li>Copy\x20your\x20subscription\x20link\x20from\x20above\x20or\x20scan\x20the\x20QR\x20code</li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<li>Add\x20the\x20subscription\x20to\x20your\x20client</li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<li>Update\x20the\x20subscription\x20and\x20select\x20a\x20server</li>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<li>Connect\x20and\x20enjoy\x20secure\x20internet\x20access!</li>\x0a\x20\x20\x20\x20\x20\x20</ol>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20</div>\x0a\x0a\x20\x20<div\x20id=\x22toast\x22\x20class=\x22toast\x22></div>\x0a\x0a\x20\x20<script>\x0a\x20\x20\x20\x20function\x20copyText(text)\x20{\x0a\x20\x20\x20\x20\x20\x20navigator.clipboard.writeText(text).then(()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27✅\x20Copied\x20to\x20clipboard!\x27);\x0a\x20\x20\x20\x20\x20\x20}).catch(()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27❌\x20Failed\x20to\x20copy\x27);\x0a\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20function\x20showQR(text,\x20title)\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20container\x20=\x20document.getElementById(\x27qr-container\x27);\x0a\x20\x20\x20\x20\x20\x20const\x20qrBox\x20=\x20document.getElementById(\x27qr-code\x27);\x0a\x20\x20\x20\x20\x20\x20const\x20qrTitle\x20=\x20document.getElementById(\x27qr-title\x27);\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20qrBox.innerHTML\x20=\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20qrTitle.textContent\x20=\x20title;\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20if\x20(typeof\x20QRCode\x20!==\x20\x27undefined\x27)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20new\x20QRCode(qrBox,\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text:\x20text,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20256,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x20256,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20colorDark:\x20\x27#000000\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20colorLight:\x20\x27#ffffff\x27,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20correctLevel:\x20QRCode.CorrectLevel.H\x0a\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20container.style.display\x20=\x20\x27block\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20container.scrollIntoView({\x20behavior:\x20\x27smooth\x27,\x20block:\x20\x27center\x27\x20});\x0a\x20\x20\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27❌\x20QR\x20code\x20library\x20not\x20loaded\x27);\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20function\x20hideQR()\x20{\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27qr-container\x27).style.display\x20=\x20\x27none\x27;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20function\x20showToast(message)\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20toast\x20=\x20document.getElementById(\x27toast\x27);\x0a\x20\x20\x20\x20\x20\x20toast.textContent\x20=\x20message;\x0a\x20\x20\x20\x20\x20\x20toast.style.display\x20=\x20\x27block\x27;\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20setTimeout(()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20toast.style.display\x20=\x20\x27none\x27;\x0a\x20\x20\x20\x20\x20\x20},\x203000);\x0a\x20\x20\x20\x20}\x0a\x20\x20</script>\x0a</body>\x0a</html>';}async function handleVLESSProtocol(a,b,c,d){const e=new WebSocketPair(),[f,g]=Object['values'](e);g['accept']();let h='',i='',j=0x0,k='',l=null,m={'value':null};const n=(u,v)=>{console['log']('['+h+':'+i+']\x20'+u,v||'');},o=getHealthMonitor(b),p=()=>{if(j>0x0&&k){const u=j,v=k;j=0x0,d['waitUntil'](updateUsage(c,v,u,d)['catch'](w=>console['error']('Usage\x20update\x20failed\x20for\x20'+v+':',w)));}},q=setInterval(p,0x2710),r=()=>{clearInterval(q),p();if(m['value'])try{m['value']['close']();}catch(u){}};g['addEventListener']('close',r,{'once':!![]}),g['addEventListener']('error',r,{'once':!![]});const s=a['headers']['get']('Sec-WebSocket-Protocol')||'',t=makeReadableWebSocketStream(g,s,n);return t['pipeTo'](new WritableStream({async 'write'(u,v){j+=u['byteLength'];if(l)return l['write'](u);if(m['value']){const E=m['value']['writable']['getWriter']();await E['write'](u),E['releaseLock']();return;}const {user:w,hasError:x,message:y,addressType:z,portRemote:portRemote=0x1bb,addressRemote:addressRemote='',rawDataIndex:A,vlessVersion:vlessVersion=new Uint8Array([0x0,0x0]),isUDP:B}=await processVLESSHeader(u,c,d);if(x)throw new Error(y);if(!w)throw new Error('User\x20not\x20found');k=w['uuid'];if(isExpired(w['expiration_date'],w['expiration_time']))throw new Error('Account\x20expired');if(w['traffic_limit']&&w['traffic_limit']>0x0){const F=(w['traffic_used']||0x0)+j;if(F>=w['traffic_limit'])throw new Error('Traffic\x20limit\x20exceeded');}h=addressRemote,i=portRemote+'--'+Math['random']()+'\x20'+(B?'udp':'tcp');const C=new Uint8Array([vlessVersion[0x0],0x0]),D=u['slice'](A);if(B){if(portRemote===0x35){const G=await handleDNS(g,C,n,H=>{j+=H;});l=G['write'],await l(D);}else throw new Error('UDP\x20proxy\x20only\x20available\x20for\x20DNS\x20(port\x2053)');return;}handleTCPConnection(m,z,addressRemote,portRemote,D,g,C,n,b,o,H=>{j+=H;});},'close'(){n('WebSocket\x20stream\x20closed'),r();},'abort'(u){n('WebSocket\x20stream\x20aborted',u),r();}}))['catch'](u=>{console['error']('WebSocket\x20pipeline\x20error:',u['message']),safeCloseWebSocket(g),r();}),new Response(null,{'status':0x65,'webSocket':f});}async function processVLESSHeader(a,b,c){if(a['byteLength']<0x18)return{'hasError':!![],'message':'Invalid\x20data\x20length'};const d=new Uint8Array(a['slice'](0x0,0x1)),f=new Uint8Array(a['slice'](0x1,0x11));let g;try{g=stringify(f);}catch(u){return{'hasError':!![],'message':'Invalid\x20UUID\x20format'};}const h=await getUserData(b,g,c);if(!h)return{'hasError':!![],'message':'User\x20not\x20found'};const j=new Uint8Array(a['slice'](0x11,0x12))[0x0],k=new Uint8Array(a['slice'](0x12+j,0x12+j+0x1))[0x0];if(k!==0x1&&k!==0x2)return{'hasError':!![],'message':'Unsupported\x20command:\x20'+k};const l=0x12+j+0x1,m=a['slice'](l,l+0x2),n=new DataView(m)['getUint16'](0x0);let o=l+0x2;const p=new Uint8Array(a['slice'](o,o+0x1)),q=p[0x0];let r=0x0,s=o+0x1,t='';switch(q){case 0x1:r=0x4,t=new Uint8Array(a['slice'](s,s+r))['join']('.');break;case 0x2:r=new Uint8Array(a['slice'](s,s+0x1))[0x0],s+=0x1,t=new TextDecoder()['decode'](a['slice'](s,s+r));break;case 0x3:r=0x10;const v=new DataView(a['slice'](s,s+r)),w=[];for(let x=0x0;x<0x8;x++){w['push'](v['getUint16'](x*0x2)['toString'](0x10));}t='['+w['join'](':')+']';break;default:return{'hasError':!![],'message':'Invalid\x20address\x20type:\x20'+q};}q===0x3&&(t=t['substring'](0x1,t['length']-0x1));if(!t)return{'hasError':!![],'message':'Address\x20value\x20is\x20empty'};return{'user':h,'hasError':![],'addressRemote':t,'addressType':q,'portRemote':n,'rawDataIndex':s+r,'vlessVersion':d,'isUDP':k===0x2};}async function handleTCPConnection(a,b,c,d,e,f,g,h,i,j,k){async function l(n=![]){try{let o;const p=c+':'+d;if(n&&i['socks5']['enabled']){h('Connecting\x20via\x20SOCKS5\x20to\x20'+p);const r=parseSocks5Address(i['socks5']['address']);o=await socks5Connect(b,c,d,h,r);}else h('Direct\x20connection\x20to\x20'+p),o=connect({'hostname':c,'port':d});a['value']=o,j['recordSuccess'](p);const q=o['writable']['getWriter']();return await q['write'](e),q['releaseLock'](),o;}catch(s){j['recordFailure'](c+':'+d);throw s;}}async function m(){let n=0x0;while(n<i['connection']['maxRetries']){try{n++;const o=i['connection']['retryDelay']*Math['pow'](i['connection']['backoffMultiplier'],n-0x1);h('Retry\x20attempt\x20'+n+'/'+i['connection']['maxRetries']+'\x20after\x20'+o+'ms'),await new Promise(r=>setTimeout(r,o));const p=i['socks5']['enabled'],q=await l(p);q['closed']['catch'](r=>h('Retry\x20socket\x20closed\x20with\x20error',r))['finally'](()=>safeCloseWebSocket(f)),await pipeSocketToWebSocket(q,f,g,null,h,k);return;}catch(r){h('Retry\x20'+n+'\x20failed:\x20'+r['message']),n>=i['connection']['maxRetries']&&(h('All\x20retries\x20exhausted'),safeCloseWebSocket(f));}}}try{const n=await l(![]);n['closed']['catch'](o=>h('Socket\x20closed\x20with\x20error',o))['finally'](()=>safeCloseWebSocket(f)),await pipeSocketToWebSocket(n,f,g,m,h,k);}catch(o){h('Initial\x20connection\x20failed:\x20'+o['message']),await m();}}function makeReadableWebSocketStream(a,b,c){let d=![];const e=new ReadableStream({'start'(f){a['addEventListener']('message',i=>{if(d)return;const j=i['data'];f['enqueue'](j);}),a['addEventListener']('close',()=>{safeCloseWebSocket(a);if(d)return;f['close']();}),a['addEventListener']('error',i=>{c('WebSocket\x20server\x20error'),f['error'](i);});const {earlyData:g,error:h}=base64ToArrayBuffer(b);if(h)f['error'](h);else g&&f['enqueue'](g);},'pull'(){},'cancel'(f){if(d)return;c('Readable\x20stream\x20cancelled:\x20'+f),d=!![],safeCloseWebSocket(a);}});return e;}async function pipeSocketToWebSocket(a,b,c,d,e,f){let g=![],h=0x0;await a['readable']['pipeTo'](new WritableStream({'start'(){},async 'write'(i,j){h++,g=!![],f&&f(i['byteLength']),b['readyState']!==WS['READY_STATE_OPEN']&&j['error']('WebSocket\x20connection\x20closed'),c?(b['send'](await new Blob([c,i])['arrayBuffer']()),c=null):b['send'](i);},'close'(){e('Remote\x20connection\x20closed\x20cleanly.\x20Received\x20'+h+'\x20chunks.');},'abort'(i){console['error']('Remote\x20connection\x20aborted:',i);}}))['catch'](i=>{console['error']('Error\x20in\x20remote\x20socket\x20to\x20WebSocket\x20pipe:',i['stack']||i),safeCloseWebSocket(b);}),!g&&d&&(e('No\x20incoming\x20data\x20detected,\x20initiating\x20retry\x20mechanism'),d());}function base64ToArrayBuffer(a){if(!a)return{'earlyData':null,'error':null};try{a=a['replace'](/-/g,'+')['replace'](/_/g,'/');const b=atob(a),c=Uint8Array['from'](b,d=>d['charCodeAt'](0x0));return{'earlyData':c['buffer'],'error':null};}catch(d){return{'earlyData':null,'error':d};}}function safeCloseWebSocket(a){try{(a['readyState']===WS['READY_STATE_OPEN']||a['readyState']===WS['READY_STATE_CLOSING'])&&a['close']();}catch(b){console['error']('Error\x20closing\x20WebSocket:',b);}}async function handleDNS(a,b,c,d){const e='https://1.1.1.1/dns-query';let f=![];const g=new TransformStream({'start'(){},'transform'(i,j){for(let k=0x0;k<i['byteLength'];){const l=i['slice'](k,k+0x2),m=new DataView(l)['getUint16'](0x0),n=new Uint8Array(i['slice'](k+0x2,k+0x2+m));k=k+0x2+m,j['enqueue'](n);}},'flush'(){}});g['readable']['pipeTo'](new WritableStream({async 'write'(i){try{const j=await fetch(e,{'method':'POST','headers':{'content-type':'application/dns-message'},'body':i}),k=await j['arrayBuffer'](),l=k['byteLength'],m=new Uint8Array([l>>0x8&0xff,l&0xff]);a['readyState']===WS['READY_STATE_OPEN']&&(c('DNS\x20query\x20successful,\x20response\x20size:\x20'+l+'\x20bytes'),f?a['send'](await new Blob([m,k])['arrayBuffer']()):(a['send'](await new Blob([b,m,k])['arrayBuffer']()),f=!![]),d&&d(l+0x2+(f?0x0:b['byteLength'])));}catch(n){c('DNS\x20query\x20failed:\x20'+n['message']),console['error']('DNS\x20error:',n);}},'close'(){c('DNS\x20stream\x20closed');},'abort'(i){console['error']('DNS\x20stream\x20aborted:',i);}}))['catch'](i=>{console['error']('DNS\x20pipeline\x20error:',i);});const h=g['writable']['getWriter']();return{'write'(i){h['write'](i);}};}async function socks5Connect(a,b,c,d,e){const {username:f,password:g,hostname:h,port:i}=e;d('Initiating\x20SOCKS5\x20connection\x20to\x20'+h+':'+i);const j=connect({'hostname':h,'port':i}),k=new Uint8Array([0x5,0x2,0x0,0x2]),l=j['writable']['getWriter'](),m=j['readable']['getReader']();await l['write'](k);const n=await m['read'](),o=new Uint8Array(n['value']);if(o[0x0]!==0x5)throw new Error('SOCKS5\x20greeting\x20failed:\x20invalid\x20version\x20'+o[0x0]);if(o[0x1]===0xff)throw new Error('SOCKS5\x20authentication\x20method\x20not\x20acceptable');if(o[0x1]===0x2){d('SOCKS5\x20requires\x20authentication');if(!f||!g)throw new Error('SOCKS5\x20authentication\x20required\x20but\x20credentials\x20not\x20provided');const u=new Uint8Array([0x1,f['length'],...new TextEncoder()['encode'](f),g['length'],...new TextEncoder()['encode'](g)]);await l['write'](u);const v=await m['read'](),w=new Uint8Array(v['value']);if(w[0x0]!==0x1||w[0x1]!==0x0)throw new Error('SOCKS5\x20authentication\x20failed');d('SOCKS5\x20authentication\x20successful');}let p;const q=new TextEncoder();switch(a){case 0x1:p=new Uint8Array([0x1,...b['split']('.')['map'](Number)]);break;case 0x2:const x=q['encode'](b);p=new Uint8Array([0x3,x['length'],...x]);break;case 0x3:p=new Uint8Array([0x4,...b['split'](':')['flatMap'](y=>{const z=parseInt(y,0x10)||0x0;return[z>>0x8,z&0xff];})]);break;default:throw new Error('Unsupported\x20address\x20type:\x20'+a);}const r=new Uint8Array([0x5,0x1,0x0,...p,c>>0x8,c&0xff]);await l['write'](r);const s=await m['read'](),t=new Uint8Array(s['value']);if(t[0x1]!==0x0)throw new Error('SOCKS5\x20connection\x20failed\x20with\x20error\x20code:\x20'+t[0x1]);return d('SOCKS5\x20connection\x20established\x20to\x20'+b+':'+c),l['releaseLock'](),m['releaseLock'](),j;}function parseSocks5Address(a){let b,c,d,e;if(a['includes']('@')){const f=a['split']('@'),g=f[0x0],h=f[0x1];g['includes'](':')?[b,c]=g['split'](':'):(b=g,c=''),[d,e]=h['split'](':');}else[d,e]=a['split'](':');if(!d||!e)throw new Error('Invalid\x20SOCKS5\x20address\x20format.\x20Expected\x20format:\x20[username:password@]hostname:port');return{'username':b||'','password':c||'','hostname':d,'port':parseInt(e,0xa)};}async function handleScamalyticsLookup(a,b){const c=new URL(a['url']),d=c['searchParams']['get']('ip');if(!d)return new Response(JSON['stringify']({'error':'IP\x20parameter\x20is\x20required'}),{'status':0x190,'headers':{'Content-Type':'application/json'}});const {username:e,apiKey:f,baseUrl:g}=b['scamalytics'];if(!e||!f)return new Response(JSON['stringify']({'error':'Scamalytics\x20API\x20not\x20configured'}),{'status':0x1f4,'headers':{'Content-Type':'application/json'}});try{const h=g+e+'/?key='+f+'&ip='+d,i=await fetch(h),j=await i['json']();return new Response(JSON['stringify'](j),{'headers':{'Content-Type':'application/json','Access-Control-Allow-Origin':'*'}});}catch(k){return new Response(JSON['stringify']({'error':k['message']}),{'status':0x1f4,'headers':{'Content-Type':'application/json'}});}}export default{async 'fetch'(a,b,c){try{const d=Config['fromEnv'](b);getHealthMonitor(d);const e=new URL(a['url']);if(e['pathname']['startsWith']('/admin'))return handleAdminRequest(a,b,c);const f=a['headers']['get']('Upgrade');if(f?.['toLowerCase']()==='websocket'){if(!b['DB']||!b['USER_KV'])return new Response('Service\x20not\x20configured\x20properly.\x20Missing\x20database\x20or\x20KV\x20bindings.',{'status':0x1f7,'headers':{'Content-Type':'text/plain'}});return await handleVLESSProtocol(a,d,b,c);}if(e['pathname']==='/scamalytics-lookup')return handleScamalyticsLookup(a,d);const g=async i=>{const j=e['pathname']['slice'](('/'+i+'/')['length']);if(!isValidUUID(j))return new Response('Invalid\x20UUID\x20format',{'status':0x190,'headers':{'Content-Type':'text/plain'}});const k=await getUserData(b,j,c);if(!k)return new Response('User\x20not\x20found',{'status':0x194,'headers':{'Content-Type':'text/plain'}});if(isExpired(k['expiration_date'],k['expiration_time']))return new Response('Account\x20has\x20expired',{'status':0x193,'headers':{'Content-Type':'text/plain'}});if(k['traffic_limit']&&k['traffic_limit']>0x0&&(k['traffic_used']||0x0)>=k['traffic_limit'])return new Response('Traffic\x20limit\x20exceeded',{'status':0x193,'headers':{'Content-Type':'text/plain'}});return handleSubscription(i,k,e['hostname']);};if(e['pathname']['startsWith']('/xray/'))return g('xray');if(e['pathname']['startsWith']('/sb/'))return g('sb');const h=e['pathname']['slice'](0x1);if(isValidUUID(h)){const i=await getUserData(b,h,c);if(!i)return new Response('User\x20not\x20found',{'status':0x194,'headers':{'Content-Type':'text/plain'}});return new Response(generateUserPanel(h,e['hostname'],i),{'headers':{'Content-Type':'text/html;charset=utf-8'}});}if(d['rootProxyUrl'])try{const j=new URL(d['rootProxyUrl']),k=new URL(a['url']);k['hostname']=j['hostname'],k['protocol']=j['protocol'],k['port']=j['port'];const l=new Request(k,a);l['headers']['set']('Host',j['hostname']),l['headers']['set']('X-Forwarded-For',a['headers']['get']('CF-Connecting-IP')||''),l['headers']['set']('X-Forwarded-Proto','https');const m=await fetch(l),n=new Headers(m['headers']);return n['delete']('Content-Security-Policy'),n['delete']('Content-Security-Policy-Report-Only'),n['delete']('X-Frame-Options'),new Response(m['body'],{'status':m['status'],'statusText':m['statusText'],'headers':n});}catch(o){return console['error']('Root\x20proxy\x20error:',o),new Response('Proxy\x20configuration\x20error:\x20'+o['message'],{'status':0x1f6,'headers':{'Content-Type':'text/plain'}});}return new Response('<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,initial-scale=1\x22>\x0a\x20\x20<title>VLESS\x20Proxy\x20Service\x20-\x20Professional\x20VPN\x20Solution</title>\x0a\x20\x20<style>\x0a\x20\x20\x20\x20*{margin:0;padding:0;box-sizing:border-box}\x0a\x20\x20\x20\x20body{font-family:-apple-system,BlinkMacSystemFont,\x22Segoe\x20UI\x22,Roboto,sans-serif;background:linear-gradient(135deg,#667eea\x200%,#764ba2\x20100%);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:20px;color:#fff}\x0a\x20\x20\x20\x20.container{max-width:800px;text-align:center}\x0a\x20\x20\x20\x20.icon{font-size:80px;margin-bottom:20px;animation:float\x203s\x20ease-in-out\x20infinite}\x0a\x20\x20\x20\x20h1{font-size:42px;margin-bottom:15px;font-weight:700}\x0a\x20\x20\x20\x20.subtitle{font-size:18px;opacity:0.95;margin-bottom:30px;line-height:1.6}\x0a\x20\x20\x20\x20.status{background:rgba(255,255,255,0.2);backdrop-filter:blur(10px);padding:15px\x2030px;border-radius:30px;display:inline-block;margin:20px\x200;font-weight:600}\x0a\x20\x20\x20\x20.card{background:rgba(255,255,255,0.15);backdrop-filter:blur(10px);border-radius:20px;padding:30px;margin-top:30px;text-align:left}\x0a\x20\x20\x20\x20.card\x20h2{margin-bottom:20px;font-size:22px}\x0a\x20\x20\x20\x20.feature{margin:15px\x200;padding:12px;background:rgba(255,255,0.1);border-radius:10px;font-size:15px}\x0a\x20\x20\x20\x20.link{display:inline-block;margin-top:20px;padding:12px\x2025px;background:rgba(255,255,255,0.3);color:#fff;text-decoration:none;border-radius:10px;font-weight:600;transition:all\x200.3s}\x0a\x20\x20\x20\x20.link:hover{background:rgba(255,255,255,0.4);transform:translateY(-2px)}\x0a\x20\x20\x20\x20.code{background:rgba(0,0,0,0.3);padding:15px;border-radius:10px;font-family:monospace;margin:15px\x200;word-break:break-all}\x0a\x20\x20\x20\x20@keyframes\x20float{0%,100%{transform:translateY(0)}50%{transform:translateY(-20px)}}\x0a\x20\x20\x20\x20@media(max-width:768px){h1{font-size:28px}.subtitle{font-size:16px}}\x0a\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20<div\x20class=\x22icon\x22>🚀</div>\x0a\x20\x20\x20\x20<h1>VLESS\x20Proxy\x20Service</h1>\x0a\x20\x20\x20\x20<p\x20class=\x22subtitle\x22>\x0a\x20\x20\x20\x20\x20\x20Enterprise-grade\x20VPN\x20solution\x20running\x20on\x20Cloudflare\x27s\x20global\x20network\x20with\x20advanced\x20traffic\x20management,\x20\x0a\x20\x20\x20\x20\x20\x20intelligent\x20routing,\x20health\x20monitoring,\x20and\x20comprehensive\x20user\x20administration\x20capabilities.\x0a\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20<div\x20class=\x22status\x22>✅\x20Service\x20Operational\x20-\x20All\x20Systems\x20Running</div>\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20<h2>🎯\x20Access\x20Your\x20Configuration\x20Panel</h2>\x0a\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin-bottom:15px\x22>To\x20view\x20your\x20personal\x20VPN\x20configuration\x20and\x20subscription\x20links,\x20visit:</p>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22code\x22>https://'+e['hostname']+'/YOUR-UUID-HERE</div>\x0a\x20\x20\x20\x20\x20\x20<p\x20style=\x22font-size:14px;opacity:0.9;margin-top:10px\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20Replace\x20\x22YOUR-UUID-HERE\x22\x20with\x20your\x20actual\x20user\x20UUID\x20provided\x20by\x20your\x20administrator.\x0a\x20\x20\x20\x20\x20\x20</p>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20<h2>⚡\x20Premium\x20Features</h2>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>🔒\x20Direct\x20SSL/TLS\x20encrypted\x20connections\x20with\x20certificate\x20pinning</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>🌍\x20Global\x20CDN\x20routing\x20with\x20automatic\x20failover\x20mechanisms</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>📊\x20Real-time\x20traffic\x20monitoring\x20and\x20usage\x20statistics</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>⚖️\x20Intelligent\x20load\x20balancing\x20across\x20multiple\x20endpoints</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>🛡️\x20Advanced\x20health\x20monitoring\x20with\x20automatic\x20recovery</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>📱\x20QR\x20code\x20generation\x20for\x20instant\x20mobile\x20setup</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>🔄\x20Multi-protocol\x20support\x20(Xray,\x20V2Ray,\x20Sing-Box,\x20Clash)</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>💾\x20Traffic\x20limit\x20management\x20with\x20automatic\x20cutoff</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>🔍\x20DNS\x20over\x20HTTPS\x20for\x20enhanced\x20privacy</div>\x0a\x20\x20\x20\x20\x20\x20<div\x20class=\x22feature\x22>🎯\x20SOCKS5\x20proxy\x20support\x20with\x20authentication</div>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20<h2>👨‍💼\x20Administrator\x20Access</h2>\x0a\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin-bottom:15px\x22>Manage\x20users,\x20monitor\x20traffic,\x20and\x20configure\x20system\x20settings:</p>\x0a\x20\x20\x20\x20\x20\x20<a\x20href=\x22/admin\x22\x20class=\x22link\x22>🔐\x20Access\x20Admin\x20Panel</a>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<div\x20class=\x22card\x22\x20style=\x22background:rgba(255,255,255,0.1);font-size:13px;opacity:0.9\x22>\x0a\x20\x20\x20\x20\x20\x20<p><strong>Technical\x20Information:</strong></p>\x0a\x20\x20\x20\x20\x20\x20<p\x20style=\x22margin-top:10px\x22>This\x20service\x20utilizes\x20Cloudflare\x20Workers\x20for\x20edge\x20computing,\x20D1\x20database\x20for\x20user\x20management,\x20\x0a\x20\x20\x20\x20\x20\x20and\x20KV\x20storage\x20for\x20high-performance\x20caching.\x20All\x20connections\x20are\x20encrypted\x20end-to-end\x20with\x20modern\x20TLS\x20standards.</p>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20</div>\x0a</body>\x0a</html>',{'status':0xc8,'headers':{'Content-Type':'text/html;charset=utf-8','Cache-Control':'public,\x20max-age=3600'}});}catch(p){return console['error']('Fatal\x20worker\x20error:',p),new Response('<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,initial-scale=1\x22>\x0a\x20\x20<title>Service\x20Error</title>\x0a\x20\x20<style>\x0a\x20\x20\x20\x20body{display:flex;justify-content:center;align-items:center;min-height:100vh;background:#1a1a2e;color:#fff;font-family:monospace;padding:20px;text-align:center}\x0a\x20\x20\x20\x20.error{background:#e74c3c;padding:40px;border-radius:15px;max-width:700px;box-shadow:0\x2010px\x2040px\x20rgba(0,0,0,0.5)}\x0a\x20\x20\x20\x20h1{margin-bottom:20px;font-size:28px}\x0a\x20\x20\x20\x20pre{background:rgba(0,0,0,0.4);padding:20px;border-radius:10px;text-align:left;overflow:auto;font-size:13px;margin-top:20px;max-height:300px}\x0a\x20\x20\x20\x20.icon{font-size:60px;margin-bottom:20px}\x0a\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20<div\x20class=\x22error\x22>\x0a\x20\x20\x20\x20<div\x20class=\x22icon\x22>⚠️</div>\x0a\x20\x20\x20\x20<h1>Service\x20Error\x20Occurred</h1>\x0a\x20\x20\x20\x20<p>An\x20unexpected\x20error\x20occurred\x20while\x20processing\x20your\x20request.\x20The\x20technical\x20team\x20has\x20been\x20notified.</p>\x0a\x20\x20\x20\x20<pre>'+p['message']+'\x0a\x0a'+(p['stack']||'No\x20stack\x20trace\x20available')+'</pre>\x0a\x20\x20\x20\x20<p\x20style=\x22margin-top:20px;font-size:14px;opacity:0.9\x22>\x0a\x20\x20\x20\x20\x20\x20Please\x20try\x20refreshing\x20the\x20page.\x20If\x20the\x20problem\x20persists,\x20contact\x20your\x20administrator.\x0a\x20\x20\x20\x20</p>\x0a\x20\x20</div>\x0a</body>\x0a</html>',{'status':0x1f4,'headers':{'Content-Type':'text/html;charset=utf-8'}});}}};