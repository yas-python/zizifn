// <!--GAMFC--> version base on commit c5391d04622bc4b087f1bc88fdfda81fcacf0eeb, time is 2025-10-17 23:13:05 UTC<!--We are all REvil-->
// @ts-ignore

import{connect}from'cloudflare:sockets';function isValidUUID(a){if(typeof a!=='string')return![];const b=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return b['test'](a);}function isUserInvalid(a){if(!a)return!![];const b=new Date(a['expiration_date']+'T'+a['expiration_time']+'Z');if(b<=new Date())return!![];if(a['data_limit']>0x0&&a['data_usage']>=a['data_limit'])return!![];return![];}async function getUserData(a,b){if(!isValidUUID(b))return null;const c='user:'+b;try{const f=await a['USER_KV']['get'](c,'json');if(f&&f['uuid'])return f;}catch(g){console['error']('Failed\x20to\x20parse\x20cached\x20user\x20data\x20for\x20'+b,g);}const d=await a['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](b)['first']();if(!d)return null;return await a['USER_KV']['put'](c,JSON['stringify'](d),{'expirationTtl':0xe10}),d;}async function getIPInfo(a){if(!a)return{'ip':'N/A','location':'N/A','isp':'N/A','risk':'N/A'};try{const b=await fetch('https://ipinfo.io/'+a+'/json');if(!b['ok'])throw new Error('ipinfo.io\x20status:\x20'+b['status']);const c=await b['json']();return{'ip':c['ip']||'N/A','location':((c['city']||'')+',\x20'+(c['country']||''))['replace'](/^,|,$/g,'')['trim']()||'N/A','isp':c['org']||'N/A','risk':'Low'};}catch(d){return console['error']('Error\x20fetching\x20IP\x20info\x20for\x20'+a+':',d),{'ip':a,'location':'Error','isp':'Error','risk':'Unknown'};}}async function getProxyIPInfo(a,b){const c='proxy_ip_info';let d=await a['USER_KV']['get'](c,'json');if(d)return d;try{let f=b['split'](':')[0x0];if(!/^\d{1,3}(\.\d{1,3}){3}$/['test'](f)&&!f['includes'](':')){const h=await fetch('https://dns.google/resolve?name='+f+'&type=A'),i=await h['json']();i['Answer']&&i['Answer']['length']>0x0&&(f=i['Answer'][0x0]['data']);}const g=await getIPInfo(f);return g['host']=b,await a['USER_KV']['put'](c,JSON['stringify'](g),{'expirationTtl':0xe10}),g;}catch(j){return console['error']('Failed\x20to\x20determine\x20proxy\x20IP\x20info:',j),{'host':b,'ip':'N/A','location':'N/A','isp':'N/A'};}}const adminLoginHTML=a=>'<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20\x20\x20<title>Admin\x20Login</title>\x0a\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20display:\x20flex;\x20justify-content:\x20center;\x20align-items:\x20center;\x20height:\x20100vh;\x20margin:\x200;\x20background-color:\x20#111827;\x20font-family:\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20Helvetica,\x20Arial,\x20sans-serif;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.login-container\x20{\x20background-color:\x20#1F2937;\x20padding:\x2040px;\x20border-radius:\x2012px;\x20box-shadow:\x200\x204px\x2020px\x20rgba(0,\x200,\x200,\x200.5);\x20text-align:\x20center;\x20width:\x20320px;\x20border:\x201px\x20solid\x20#374151;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20h1\x20{\x20color:\x20#F9FAFB;\x20margin-bottom:\x2024px;\x20font-weight:\x20500;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20form\x20{\x20display:\x20flex;\x20flex-direction:\x20column;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20input[type=\x22password\x22]\x20{\x20background-color:\x20#374151;\x20border:\x201px\x20solid\x20#4B5563;\x20color:\x20#F9FAFB;\x20padding:\x2012px;\x20border-radius:\x208px;\x20margin-bottom:\x2020px;\x20font-size:\x2016px;\x20transition:\x20border-color\x200.2s,\x20box-shadow\x200.2s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20input[type=\x22password\x22]:focus\x20{\x20outline:\x20none;\x20border-color:\x20#3B82F6;\x20box-shadow:\x200\x200\x200\x203px\x20rgba(59,\x20130,\x20246,\x200.3);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20button\x20{\x20background-color:\x20#3B82F6;\x20color:\x20white;\x20border:\x20none;\x20padding:\x2012px;\x20border-radius:\x208px;\x20font-size:\x2016px;\x20font-weight:\x20600;\x20cursor:\x20pointer;\x20transition:\x20background-color\x200.2s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20button:hover\x20{\x20background-color:\x20#2563EB;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.error\x20{\x20color:\x20#EF4444;\x20margin-top:\x2015px;\x20font-size:\x2014px;\x20}\x0a\x20\x20\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20\x20\x20<div\x20class=\x22login-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<h1>Admin\x20Login</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<form\x20method=\x22POST\x22\x20action=\x22/'+a+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22password\x22\x20name=\x22password\x22\x20placeholder=\x22••••••••••••••\x22\x20required>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22submit\x22>Login</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a</body>\x0a</html>',adminPanelHTML=(a,b)=>'<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20\x20\x20<title>Admin\x20Dashboard</title>\x0a\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20:root\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--bg-main:\x20#0c0a09;\x20--bg-card:\x20#1c1917;\x20--bg-input:\x20#292524;\x20--border:\x20#44403c;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--text-primary:\x20#f5f5f4;\x20--text-secondary:\x20#a8a29e;\x20--accent:\x20#fb923c;\x20--accent-hover:\x20#f97316;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--danger:\x20#ef4444;\x20--danger-hover:\x20#dc2626;\x20--success:\x20#4ade80;\x20--expired:\x20#facc15;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--btn-secondary-bg:\x20#57534e;\x20--btn-secondary-hover:\x20#78716c;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20margin:\x200;\x20font-family:\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20sans-serif;\x20background-color:\x20var(--bg-main);\x20color:\x20var(--text-primary);\x20font-size:\x2014px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x201280px;\x20margin:\x2030px\x20auto;\x20padding:\x200\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.card\x20{\x20background-color:\x20var(--bg-card);\x20border-radius:\x2012px;\x20padding:\x2024px;\x20border:\x201px\x20solid\x20var(--border);\x20box-shadow:\x200\x204px\x2012px\x20rgba(0,0,0,0.3);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stats-grid\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(200px,\x201fr));\x20gap:\x2020px;\x20margin-bottom:\x2030px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stat-card\x20{\x20background-color:\x20var(--bg-card);\x20border-radius:\x2012px;\x20padding:\x2020px;\x20border:\x201px\x20solid\x20var(--border);\x20transition:\x20transform\x200.2s,\x20box-shadow\x200.2s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stat-card:hover\x20{\x20transform:\x20translateY(-5px);\x20box-shadow:\x200\x208px\x2016px\x20rgba(0,0,0,0.4);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stat-title\x20{\x20font-size:\x2014px;\x20color:\x20var(--text-secondary);\x20margin:\x200\x200\x2010px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stat-value\x20{\x20font-size:\x2028px;\x20font-weight:\x20600;\x20margin:\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-grid\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(180px,\x201fr));\x20gap:\x2016px;\x20align-items:\x20flex-end;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20{\x20display:\x20flex;\x20flex-direction:\x20column;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20label\x20{\x20margin-bottom:\x208px;\x20font-weight:\x20500;\x20color:\x20var(--text-secondary);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20{\x20display:\x20flex;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20input,\x20select\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x20box-sizing:\x20border-box;\x20background-color:\x20var(--bg-input);\x20border:\x201px\x20solid\x20var(--border);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20var(--text-primary);\x20padding:\x2010px;\x20border-radius:\x206px;\x20font-size:\x2014px;\x20transition:\x20border-color\x200.2s,\x20box-shadow\x200.2s;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20input:focus,\x20select:focus\x20{\x20outline:\x20none;\x20border-color:\x20var(--accent);\x20box-shadow:\x200\x200\x200\x203px\x20rgba(251,\x20146,\x2060,\x200.3);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn\x20{\x20padding:\x2010px\x2016px;\x20border:\x20none;\x20border-radius:\x206px;\x20font-weight:\x20600;\x20cursor:\x20pointer;\x20transition:\x20all\x200.2s;\x20display:\x20inline-flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20gap:\x208px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn:active\x20{\x20transform:\x20scale(0.97);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-primary\x20{\x20background-color:\x20var(--accent);\x20color:\x20var(--bg-main);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-primary:hover\x20{\x20background-color:\x20var(--accent-hover);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-danger\x20{\x20background-color:\x20var(--danger);\x20color:\x20white;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-danger:hover\x20{\x20background-color:\x20var(--danger-hover);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-secondary\x20{\x20background-color:\x20var(--btn-secondary-bg);\x20color:\x20white;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-secondary:hover\x20{\x20background-color:\x20var(--btn-secondary-hover);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20button\x20{\x20border-top-left-radius:\x200;\x20border-bottom-left-radius:\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20input,\x20.input-group\x20select\x20{\x20border-radius:\x200;\x20border-right:\x20none;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20input:first-child\x20{\x20border-top-left-radius:\x206px;\x20border-bottom-left-radius:\x206px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20button:last-child\x20{\x20border-top-right-radius:\x206px;\x20border-bottom-right-radius:\x206px;\x20border-right:\x201px\x20solid\x20var(--border);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20table\x20{\x20width:\x20100%;\x20border-collapse:\x20collapse;\x20margin-top:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20th,\x20td\x20{\x20padding:\x2012px\x2016px;\x20text-align:\x20left;\x20border-bottom:\x201px\x20solid\x20var(--border);\x20white-space:\x20nowrap;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20th\x20{\x20color:\x20var(--text-secondary);\x20font-weight:\x20600;\x20font-size:\x2012px;\x20text-transform:\x20uppercase;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-badge\x20{\x20padding:\x204px\x2010px;\x20border-radius:\x2012px;\x20font-size:\x2012px;\x20font-weight:\x20600;\x20display:\x20inline-block;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-active\x20{\x20background-color:\x20rgba(74,\x20222,\x20128,\x200.2);\x20color:\x20var(--success);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-expired\x20{\x20background-color:\x20rgba(250,\x20204,\x2021,\x200.2);\x20color:\x20var(--expired);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.actions-cell\x20{\x20display:\x20flex;\x20gap:\x208px;\x20justify-content:\x20flex-start;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20#toast\x20{\x20position:\x20fixed;\x20bottom:\x2020px;\x20left:\x2050%;\x20transform:\x20translateX(-50%);\x20background-color:\x20var(--bg-card);\x20color:\x20white;\x20padding:\x2015px\x2025px;\x20border-radius:\x208px;\x20z-index:\x201001;\x20display:\x20none;\x20border:\x201px\x20solid\x20var(--border);\x20box-shadow:\x200\x204px\x2012px\x20rgba(0,0,0,0.3);\x20opacity:\x200;\x20transition:\x20all\x200.3s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20#toast.show\x20{\x20display:\x20block;\x20opacity:\x201;\x20transform:\x20translate(-50%,\x20-10px);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-overlay\x20{\x20position:\x20fixed;\x20top:\x200;\x20left:\x200;\x20width:\x20100%;\x20height:\x20100%;\x20background-color:\x20rgba(0,0,0,0.7);\x20z-index:\x201000;\x20display:\x20flex;\x20justify-content:\x20center;\x20align-items:\x20center;\x20opacity:\x200;\x20visibility:\x20hidden;\x20transition:\x20opacity\x200.3s,\x20visibility\x200.3s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-overlay.show\x20{\x20opacity:\x201;\x20visibility:\x20visible;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-content\x20{\x20background-color:\x20var(--bg-card);\x20padding:\x2030px;\x20border-radius:\x2012px;\x20width:\x2090%;\x20max-width:\x20550px;\x20transform:\x20scale(0.9);\x20transition:\x20transform\x200.3s;\x20border:\x201px\x20solid\x20var(--border);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-overlay.show\x20.modal-content\x20{\x20transform:\x20scale(1);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-header\x20{\x20display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x20padding-bottom:\x2015px;\x20margin-bottom:\x2020px;\x20border-bottom:\x201px\x20solid\x20var(--border);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-header\x20h2\x20{\x20margin:\x200;\x20font-size:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-close-btn\x20{\x20background:\x20none;\x20border:\x20none;\x20color:\x20var(--text-secondary);\x20font-size:\x2024px;\x20cursor:\x20pointer;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-footer\x20{\x20display:\x20flex;\x20justify-content:\x20flex-end;\x20gap:\x2012px;\x20margin-top:\x2025px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.traffic-bar\x20{\x20width:\x20100%;\x20background-color:\x20var(--bg-input);\x20border-radius:\x204px;\x20height:\x206px;\x20overflow:\x20hidden;\x20margin-top:\x204px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.traffic-bar-inner\x20{\x20height:\x20100%;\x20background-color:\x20var(--accent);\x20border-radius:\x204px;\x20transition:\x20width\x200.5s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-check\x20{\x20display:\x20flex;\x20align-items:\x20center;\x20margin-top:\x2010px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-check\x20input\x20{\x20width:\x20auto;\x20margin-right:\x208px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.user-list-wrapper\x20{\x20overflow-x:\x20auto;\x20-webkit-overflow-scrolling:\x20touch;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20@media\x20(max-width:\x20768px)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20padding:\x200\x2010px;\x20margin-top:\x2015px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.stats-grid\x20{\x20grid-template-columns:\x201fr\x201fr;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20table\x20{\x20min-width:\x20800px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22stats\x22\x20class=\x22stats-grid\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2>Create\x20User</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<form\x20id=\x22createUserForm\x22\x20class=\x22form-grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22hidden\x22\x20id=\x22csrf_token\x22\x20name=\x22csrf_token\x22\x20value=\x22'+b+'\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22\x20style=\x22grid-column:\x201\x20/\x20-1;\x22><label\x20for=\x22uuid\x22>UUID</label><div\x20class=\x22input-group\x22><input\x20type=\x22text\x22\x20id=\x22uuid\x22\x20required><button\x20type=\x22button\x22\x20id=\x22generateUUID\x22\x20class=\x22btn\x20btn-secondary\x22>Generate</button></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22expiryDate\x22>Expiry\x20Date</label><input\x20type=\x22date\x22\x20id=\x22expiryDate\x22\x20required></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22expiryTime\x22>Expiry\x20Time\x20(Your\x20Local\x20Time)</label><input\x20type=\x22time\x22\x20id=\x22expiryTime\x22\x20step=\x221\x22\x20required></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22dataLimit\x22>Data\x20Limit</label><div\x20class=\x22input-group\x22><input\x20type=\x22number\x22\x20id=\x22dataLimitValue\x22\x20placeholder=\x22e.g.,\x2010\x22><select\x20id=\x22dataLimitUnit\x22><option\x20value=\x22GB\x22>GB</option><option\x20value=\x22MB\x22>MB</option></select><button\x20type=\x22button\x22\x20id=\x22unlimitedBtn\x22\x20class=\x22btn\x20btn-secondary\x22>Unlimited</button></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22notes\x22>Notes</label><input\x20type=\x22text\x22\x20id=\x22notes\x22\x20placeholder=\x22(Optional)\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22\x20style=\x22grid-column:\x201\x20/\x20-1;\x20align-items:\x20flex-start;\x20margin-top:\x2010px;\x22><button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-primary\x22>Create\x20User</button></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x22\x20style=\x22margin-top:\x2030px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2>User\x20List</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22user-list-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<table>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead><tr><th>UUID</th><th>Created</th><th>Expiry</th><th>Status</th><th>Traffic</th><th>Notes</th><th>Actions</th></tr></thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody\x20id=\x22userList\x22></tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</table>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20id=\x22toast\x22></div>\x0a\x0a\x20\x20\x20\x20<div\x20id=\x22editModal\x22\x20class=\x22modal-overlay\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22><h2>Edit\x20User</h2><button\x20id=\x22modalCloseBtn\x22\x20class=\x22modal-close-btn\x22>&times;</button></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<form\x20id=\x22editUserForm\x22\x20class=\x22form-grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22hidden\x22\x20id=\x22editUuid\x22\x20name=\x22uuid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22editExpiryDate\x22>Expiry\x20Date</label><input\x20type=\x22date\x22\x20id=\x22editExpiryDate\x22\x20name=\x22exp_date\x22\x20required></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22editExpiryTime\x22>Expiry\x20Time\x20(Your\x20Local\x20Time)</label><input\x20type=\x22time\x22\x20id=\x22editExpiryTime\x22\x20name=\x22exp_time\x22\x20step=\x221\x22\x20required></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22editDataLimit\x22>Data\x20Limit</label><div\x20class=\x22input-group\x22><input\x20type=\x22number\x22\x20id=\x22editDataLimitValue\x22\x20placeholder=\x22e.g.,\x2010\x22><select\x20id=\x22editDataLimitUnit\x22><option\x20value=\x22GB\x22>GB</option><option\x20value=\x22MB\x22>MB</option></select><button\x20type=\x22button\x22\x20id=\x22editUnlimitedBtn\x22\x20class=\x22btn\x20btn-secondary\x22>Unlimited</button></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22editNotes\x22>Notes</label><input\x20type=\x22text\x22\x20id=\x22editNotes\x22\x20name=\x22notes\x22\x20placeholder=\x22(Optional)\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x20form-check\x22\x20style=\x22grid-column:\x201\x20/\x20-1;\x22><input\x20type=\x22checkbox\x22\x20id=\x22resetTraffic\x22><label\x20for=\x22resetTraffic\x22>Reset\x20Traffic\x20Usage</label></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22\x20style=\x22grid-column:\x201\x20/\x20-1;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20id=\x22modalCancelBtn\x22\x20class=\x22btn\x20btn-secondary\x22>Cancel</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-primary\x22>Save\x20Changes</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<script>\x0a\x20\x20\x20\x20\x20\x20\x20\x20document.addEventListener(\x27DOMContentLoaded\x27,\x20()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20API_BASE\x20=\x20\x27/'+a+'/api\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20csrfToken\x20=\x20document.getElementById(\x27csrf_token\x27).value;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20apiHeaders\x20=\x20{\x20\x27Content-Type\x27:\x20\x27application/json\x27,\x20\x27X-CSRF-Token\x27:\x20csrfToken\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20api\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20get:\x20(endpoint)\x20=>\x20fetch(`${API_BASE}${endpoint}`).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20post:\x20(endpoint,\x20body)\x20=>\x20fetch(`${API_BASE}${endpoint}`,\x20{\x20method:\x20\x27POST\x27,\x20headers:\x20apiHeaders,\x20body:\x20JSON.stringify(body)\x20}).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20put:\x20(endpoint,\x20body)\x20=>\x20fetch(`${API_BASE}${endpoint}`,\x20{\x20method:\x20\x27PUT\x27,\x20headers:\x20apiHeaders,\x20body:\x20JSON.stringify(body)\x20}).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20delete:\x20(endpoint)\x20=>\x20fetch(`${API_BASE}${endpoint}`,\x20{\x20method:\x20\x27DELETE\x27,\x20headers:\x20apiHeaders\x20}).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20handleResponse(response)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(response.status\x20===\x20403)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27Session\x20expired\x20or\x20invalid.\x20Please\x20refresh\x20the\x20page.\x27,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20throw\x20new\x20Error(\x27Forbidden:\x20Invalid\x20session\x20or\x20CSRF\x20token.\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!response.ok)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20errorData\x20=\x20await\x20response.json().catch(()\x20=>\x20({\x20error:\x20\x27An\x20unknown\x20error\x20occurred.\x27\x20}));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20throw\x20new\x20Error(errorData.error\x20||\x20`Request\x20failed\x20with\x20status\x20${response.status}`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20response.status\x20===\x20204\x20?\x20null\x20:\x20response.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20showToast(message,\x20isError\x20=\x20false)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20toast\x20=\x20document.getElementById(\x27toast\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20toast.textContent\x20=\x20message;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20toast.style.backgroundColor\x20=\x20isError\x20?\x20\x27var(--danger)\x27\x20:\x20\x27var(--success)\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20toast.classList.add(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setTimeout(()\x20=>\x20{\x20toast.classList.remove(\x27show\x27);\x20},\x203000);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20pad\x20=\x20num\x20=>\x20num.toString().padStart(2,\x20\x270\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20localToUTC\x20=\x20(d,\x20t)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!d\x20||\x20!t)\x20return\x20{\x20utcDate:\x20\x27\x27,\x20utcTime:\x20\x27\x27\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20dt\x20=\x20new\x20Date(`${d}T${t}`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20{\x20utcDate:\x20`${dt.getUTCFullYear()}-${pad(dt.getUTCMonth()\x20+\x201)}-${pad(dt.getUTCDate())}`,\x20utcTime:\x20`${pad(dt.getUTCHours())}:${pad(dt.getUTCMinutes())}:${pad(dt.getUTCSeconds())}`\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20utcToLocal\x20=\x20(d,\x20t)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!d\x20||\x20!t)\x20return\x20{\x20localDate:\x20\x27\x27,\x20localTime:\x20\x27\x27\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20dt\x20=\x20new\x20Date(`${d}T${t}Z`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20{\x20localDate:\x20`${dt.getFullYear()}-${pad(dt.getMonth()\x20+\x201)}-${pad(dt.getDate())}`,\x20localTime:\x20`${pad(dt.getHours())}:${pad(dt.getMinutes())}:${pad(dt.getSeconds())}`\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20bytesToReadable(bytes)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(bytes\x20===\x200)\x20return\x20\x270\x20Bytes\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20i\x20=\x20Math.floor(Math.log(bytes)\x20/\x20Math.log(1024));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20`${parseFloat((bytes\x20/\x20Math.pow(1024,\x20i)).toFixed(2))}\x20${[\x27Bytes\x27,\x20\x27KB\x27,\x20\x27MB\x27,\x20\x27GB\x27,\x20\x27TB\x27][i]}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20renderStats(stats)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20statsContainer\x20=\x20document.getElementById(\x27stats\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20statsContainer.innerHTML\x20=\x20`\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><h3\x20class=\x22stat-title\x22>Total\x20Users</h3><p\x20class=\x22stat-value\x22>${stats.totalUsers}</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><h3\x20class=\x22stat-title\x22>Active\x20Users</h3><p\x20class=\x22stat-value\x22>${stats.activeUsers}</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><h3\x20class=\x22stat-title\x22>Expired\x20Users</h3><p\x20class=\x22stat-value\x22>${stats.expiredUsers}</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><h3\x20class=\x22stat-title\x22>Total\x20Traffic\x20Used</h3><p\x20class=\x22stat-value\x22>${bytesToReadable(stats.totalTraffic)}</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20renderUsers(users)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20userList\x20=\x20document.getElementById(\x27userList\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20userList.innerHTML\x20=\x20users.length\x20===\x200\x20?\x20\x27<tr><td\x20colspan=\x227\x22\x20style=\x22text-align:center;\x22>No\x20users\x20found.</td></tr>\x27\x20:\x20users.map(user\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20expiryUTC\x20=\x20new\x20Date(`${user.expiration_date}T${user.expiration_time}Z`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20isExpired\x20=\x20expiryUTC\x20<\x20new\x20Date();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20trafficUsage\x20=\x20user.data_limit\x20>\x200\x20?\x20`${bytesToReadable(user.data_usage)}\x20/\x20${bytesToReadable(user.data_limit)}`\x20:\x20`${bytesToReadable(user.data_usage)}\x20/\x20&infin;`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20trafficPercent\x20=\x20user.data_limit\x20>\x200\x20?\x20Math.min(100,\x20(user.data_usage\x20/\x20user.data_limit\x20*\x20100))\x20:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20`\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20data-uuid=\x22${user.uuid}\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20title=\x22${user.uuid}\x22>${user.uuid.substring(0,\x208)}...</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${new\x20Date(user.created_at).toLocaleString()}</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${expiryUTC.toLocaleString()}</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><span\x20class=\x22status-badge\x20${isExpired\x20?\x20\x27status-expired\x27\x20:\x20\x27status-active\x27}\x22>${isExpired\x20?\x20\x27Expired\x27\x20:\x20\x27Active\x27}</span></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20${trafficUsage}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22traffic-bar\x22><div\x20class=\x22traffic-bar-inner\x22\x20style=\x22width:\x20${trafficPercent}%;\x22></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${user.notes\x20||\x20\x27-\x27}</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22actions-cell\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x20btn-edit\x22>Edit</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-danger\x20btn-delete\x22>Delete</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}).join(\x27\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20refreshData()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20[stats,\x20users]\x20=\x20await\x20Promise.all([api.get(\x27/stats\x27),\x20api.get(\x27/users\x27)]);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20window.allUsers\x20=\x20users;\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20renderStats(stats);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20renderUsers(users);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x20showToast(error.message,\x20true);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20getLimitInBytes\x20=\x20(valueId,\x20unitId)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20value\x20=\x20parseFloat(document.getElementById(valueId).value);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20unit\x20=\x20document.getElementById(unitId).value;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(isNaN(value)\x20||\x20value\x20<=\x200)\x20return\x200;\x20//\x200\x20for\x20unlimited\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20multiplier\x20=\x20unit\x20===\x20\x27GB\x27\x20?\x201024\x20*\x201024\x20*\x201024\x20:\x201024\x20*\x201024;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20Math.round(value\x20*\x20multiplier);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20setLimitFromBytes\x20=\x20(bytes,\x20valueId,\x20unitId)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20valueEl\x20=\x20document.getElementById(valueId);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20unitEl\x20=\x20document.getElementById(unitId);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(bytes\x20<=\x200)\x20{\x20valueEl.value\x20=\x20\x27\x27;\x20unitEl.value\x20=\x20\x27GB\x27;\x20return;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20isGB\x20=\x20bytes\x20>=\x201024\x20*\x201024\x20*\x201024;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20unit\x20=\x20isGB\x20?\x20\x27GB\x27\x20:\x20\x27MB\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20divisor\x20=\x20isGB\x20?\x201024\x20*\x201024\x20*\x201024\x20:\x201024\x20*\x201024;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20valueEl.value\x20=\x20parseFloat((bytes\x20/\x20divisor).toFixed(2));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20unitEl.value\x20=\x20unit;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27createUserForm\x27).addEventListener(\x27submit\x27,\x20async\x20e\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20{\x20utcDate,\x20utcTime\x20}\x20=\x20localToUTC(document.getElementById(\x27expiryDate\x27).value,\x20document.getElementById(\x27expiryTime\x27).value);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20userData\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid:\x20document.getElementById(\x27uuid\x27).value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20exp_date:\x20utcDate,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20exp_time:\x20utcTime,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data_limit:\x20getLimitInBytes(\x27dataLimitValue\x27,\x20\x27dataLimitUnit\x27),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20notes:\x20document.getElementById(\x27notes\x27).value\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20api.post(\x27/users\x27,\x20userData);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20created\x20successfully!\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20e.target.reset();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27uuid\x27).value\x20=\x20crypto.randomUUID();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setDefaultExpiry();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20refreshData();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x20showToast(error.message,\x20true);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20editModal\x20=\x20document.getElementById(\x27editModal\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27userList\x27).addEventListener(\x27click\x27,\x20e\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20button\x20=\x20e.target.closest(\x27button\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!button)\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20uuid\x20=\x20e.target.closest(\x27tr\x27).dataset.uuid;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(button.classList.contains(\x27btn-edit\x27))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20user\x20=\x20window.allUsers.find(u\x20=>\x20u.uuid\x20===\x20uuid);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!user)\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20{\x20localDate,\x20localTime\x20}\x20=\x20utcToLocal(user.expiration_date,\x20user.expiration_time);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editUuid\x27).value\x20=\x20user.uuid;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editExpiryDate\x27).value\x20=\x20localDate;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editExpiryTime\x27).value\x20=\x20localTime;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setLimitFromBytes(user.data_limit,\x20\x27editDataLimitValue\x27,\x20\x27editDataLimitUnit\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editNotes\x27).value\x20=\x20user.notes\x20||\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27resetTraffic\x27).checked\x20=\x20false;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20editModal.classList.add(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20else\x20if\x20(button.classList.contains(\x27btn-delete\x27))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(confirm(`Are\x20you\x20sure\x20you\x20want\x20to\x20delete\x20user\x20${uuid.substring(0,8)}...?`))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20api.delete(`/users/${uuid}`).then(()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20deleted\x20successfully!\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20refreshData();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}).catch(err\x20=>\x20showToast(err.message,\x20true));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editUserForm\x27).addEventListener(\x27submit\x27,\x20async\x20e\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20uuid\x20=\x20document.getElementById(\x27editUuid\x27).value;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20{\x20utcDate,\x20utcTime\x20}\x20=\x20localToUTC(document.getElementById(\x27editExpiryDate\x27).value,\x20document.getElementById(\x27editExpiryTime\x27).value);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20updatedData\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20exp_date:\x20utcDate,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20exp_time:\x20utcTime,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data_limit:\x20getLimitInBytes(\x27editDataLimitValue\x27,\x20\x27editDataLimitUnit\x27),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20notes:\x20document.getElementById(\x27editNotes\x27).value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20reset_traffic:\x20document.getElementById(\x27resetTraffic\x27).checked,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20api.put(`/users/${uuid}`,\x20updatedData);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20updated\x20successfully!\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20editModal.classList.remove(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20refreshData();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x20showToast(error.message,\x20true);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20closeModal\x20=\x20()\x20=>\x20editModal.classList.remove(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27modalCloseBtn\x27).addEventListener(\x27click\x27,\x20closeModal);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27modalCancelBtn\x27).addEventListener(\x27click\x27,\x20closeModal);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20editModal.addEventListener(\x27click\x27,\x20e\x20=>\x20{\x20if\x20(e.target\x20===\x20editModal)\x20closeModal();\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.addEventListener(\x27keydown\x27,\x20e\x20=>\x20{\x20if\x20(e.key\x20===\x20\x22Escape\x22)\x20closeModal();\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27generateUUID\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20document.getElementById(\x27uuid\x27).value\x20=\x20crypto.randomUUID());\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27unlimitedBtn\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20{\x20document.getElementById(\x27dataLimitValue\x27).value\x20=\x20\x27\x27;\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editUnlimitedBtn\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20{\x20document.getElementById(\x27editDataLimitValue\x27).value\x20=\x20\x27\x27;\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20setDefaultExpiry\x20=\x20()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20now\x20=\x20new\x20Date();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20now.setMonth(now.getMonth()\x20+\x201);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27expiryDate\x27).value\x20=\x20`${now.getFullYear()}-${pad(now.getMonth()\x20+\x201)}-${pad(now.getDate())}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27expiryTime\x27).value\x20=\x20`${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27uuid\x27).value\x20=\x20crypto.randomUUID();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setDefaultExpiry();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20refreshData();\x0a\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20</script>\x0a</body>\x0a</html>';async function checkAdminAuth(a,b,c){const d=a['headers']['get']('Cookie'),e=d?.['match'](/auth_token=([^;]+)/)?.[0x1];if(!e)return{'isAdmin':![],'errorResponse':null,'csrfToken':null};const f=await b['USER_KV']['get']('admin_session:'+e,'json');if(!f){const h=new Headers({'Set-Cookie':'auth_token=;\x20Path=/'+c+';\x20Expires=Thu,\x2001\x20Jan\x201970\x2000:00:00\x20GMT'});return{'isAdmin':![],'errorResponse':new Response(JSON['stringify']({'error':'Session\x20expired'}),{'status':0x191,'headers':h}),'csrfToken':null};}const {csrfToken:g}=f;if(['POST','PUT','DELETE']['includes'](a['method'])){const i=a['headers']['get']('X-CSRF-Token');if(!i||i!==g){const j=new Response(JSON['stringify']({'error':'Invalid\x20CSRF\x20token.'}),{'status':0x193,'headers':{'Content-Type':'application/json'}});return{'isAdmin':![],'errorResponse':j,'csrfToken':null};}}return{'isAdmin':!![],'errorResponse':null,'csrfToken':g};}async function handleAdminRequest(a,b,c){const d=new URL(a['url']),{pathname:f}=d,g={'Content-Type':'application/json'};if(!b['ADMIN_KEY'])return new Response('Admin\x20panel\x20is\x20not\x20configured.\x20Please\x20set\x20ADMIN_KEY\x20secret.',{'status':0x1f7});if(f['startsWith']('/'+c+'/api/')){const {isAdmin:h,errorResponse:i}=await checkAdminAuth(a,b,c);if(i)return i;if(!h)return new Response(JSON['stringify']({'error':'Forbidden'}),{'status':0x193,'headers':g});const j=f['substring'](('/'+c+'/api')['length']);if(j==='/stats'&&a['method']==='GET'){const {results:l}=await b['DB']['prepare']('SELECT\x20expiration_date,\x20expiration_time,\x20data_usage\x20FROM\x20users')['all'](),m=new Date(),n=l['reduce']((o,p)=>{o['totalUsers']++;const q=new Date(p['expiration_date']+'T'+p['expiration_time']+'Z')<=m;return q?o['expiredUsers']++:o['activeUsers']++,o['totalTraffic']+=p['data_usage']||0x0,o;},{'totalUsers':0x0,'activeUsers':0x0,'expiredUsers':0x0,'totalTraffic':0x0});return new Response(JSON['stringify'](n),{'status':0xc8,'headers':g});}if(j==='/users'&&a['method']==='GET'){const {results:o}=await b['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20ORDER\x20BY\x20created_at\x20DESC')['all']();return new Response(JSON['stringify'](o??[]),{'status':0xc8,'headers':g});}if(j==='/users'&&a['method']==='POST')try{const {uuid:p,exp_date:q,exp_time:r,notes:s,data_limit:t}=await a['json']();if(!p||!q||!r||!isValidUUID(p))throw new Error('Invalid\x20or\x20missing\x20fields.');return await b['DB']['prepare']('INSERT\x20INTO\x20users\x20(uuid,\x20expiration_date,\x20expiration_time,\x20notes,\x20data_limit)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?)')['bind'](p,q,r,s||null,t>=0x0?t:0x0)['run'](),new Response(JSON['stringify']({'success':!![],'uuid':p}),{'status':0xc9,'headers':g});}catch(u){const v=u['message']['includes']('UNIQUE\x20constraint\x20failed')?'UUID\x20already\x20exists.':u['message'];return new Response(JSON['stringify']({'error':v}),{'status':0x190,'headers':g});}const k=j['match'](/^\/users\/([a-f0-9-]+)$/);if(k){const w=k[0x1];if(a['method']==='PUT')try{const {exp_date:x,exp_time:y,notes:z,data_limit:A,reset_traffic:B}=await a['json']();if(!x||!y)throw new Error('Invalid\x20date/time\x20fields.');const C='UPDATE\x20users\x20SET\x20expiration_date\x20=\x20?,\x20expiration_time\x20=\x20?,\x20notes\x20=\x20?,\x20data_limit\x20=\x20?\x20'+(B?',\x20data_usage\x20=\x200':'')+'\x20WHERE\x20uuid\x20=\x20?';return await b['DB']['prepare'](C)['bind'](x,y,z||null,A>=0x0?A:0x0,w)['run'](),await b['USER_KV']['delete']('user:'+w),new Response(JSON['stringify']({'success':!![],'uuid':w}),{'status':0xc8,'headers':g});}catch(D){return new Response(JSON['stringify']({'error':D['message']}),{'status':0x190,'headers':g});}if(a['method']==='DELETE')return await b['DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](w)['run'](),await b['USER_KV']['delete']('user:'+w),new Response(null,{'status':0xcc});}return new Response(JSON['stringify']({'error':'API\x20route\x20not\x20found'}),{'status':0x194,'headers':g});}if(f==='/'+c){if(a['method']==='POST'){const E=await a['formData']();if(E['get']('password')===b['ADMIN_KEY']){const F=crypto['randomUUID'](),G=crypto['randomUUID']();await b['USER_KV']['put']('admin_session:'+F,JSON['stringify']({'csrfToken':G}),{'expirationTtl':0x15180});const H=new Headers({'Location':'/'+c,'Set-Cookie':'auth_token='+F+';\x20HttpOnly;\x20Secure;\x20Path=/'+c+';\x20Max-Age=86400;\x20SameSite=Strict'});return new Response(null,{'status':0x12e,'headers':H});}else return new Response(adminLoginHTML(c)['replace']('</form>','</form><p\x20class=\x22error\x22>Invalid\x20password.</p>'),{'status':0x191,'headers':{'Content-Type':'text/html;charset=utf-8'}});}if(a['method']==='GET'){const {isAdmin:I,csrfToken:J,errorResponse:K}=await checkAdminAuth(a,b,c);if(K)return K;return I?new Response(adminPanelHTML(c,J),{'headers':{'Content-Type':'text/html;charset=utf-8'}}):new Response(adminLoginHTML(c),{'headers':{'Content-Type':'text/html;charset=utf-8'}});}return new Response('Method\x20Not\x20Allowed',{'status':0x195});}return new Response('Not\x20found',{'status':0x194});}const Config={'userID':'d342d11e-d424-4583-b36e-524ab1f0afa4','proxyIPs':[''],'fromEnv'(a){const b=a['PROXYIP']||this['proxyIPs'][Math['floor'](Math['random']()*this['proxyIPs']['length'])],[c,d='443']=b['split'](':');return{'userID':a['UUID']||this['userID'],'proxyAddress':b};}},CONST={'ED_PARAMS':{'ed':0xa00},'WS_READY_STATE_OPEN':0x1,'WS_READY_STATE_CLOSING':0x2};function generateRandomPath(a=0xc,b=''){const c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let d='';for(let e=0x0;e<a;e++)d+=c['charAt'](Math['floor'](Math['random']()*c['length']));return'/'+d+(b?'?'+b:'');}const CORE_PRESETS={'xray':{'tls':{'path':()=>generateRandomPath(0xc,'ed=2048'),'security':'tls','fp':'chrome','alpn':'http/1.1','extra':{}}},'sb':{'tls':{'path':()=>generateRandomPath(0x12),'security':'tls','fp':'firefox','alpn':'h3','extra':CONST['ED_PARAMS']}}};function createVlessLink({userID:a,address:b,port:c,host:d,path:e,security:f,sni:g,fp:h,alpn:i,extra:extra={},name:j}){const l=new URLSearchParams({'type':'ws','host':d,'path':e});if(f)l['set']('security',f);if(g)l['set']('sni',g);if(h)l['set']('fp',h);if(i)l['set']('alpn',i);for(const [m,n]of Object['entries'](extra))l['set'](m,n);return'vless://'+a+'@'+b+':'+c+'?'+l['toString']()+'#'+encodeURIComponent(j);}function buildLink({core:a,userID:b,hostName:c,address:d,port:e,tag:f}){const g=CORE_PRESETS[a]['tls'];return createVlessLink({'userID':b,'address':d,'port':e,'host':c,'path':g['path'](),'security':g['security'],'sni':c,'fp':g['fp'],'alpn':g['alpn'],'extra':g['extra'],'name':f+'-TLS'});}async function handleIpSubscription(a,b,c){const d=[c,'www.speedtest.net','www.visa.com','cdnjs.com'],f=[0x1bb,0x20fb,0x805,0x823,0x827,0x830],g=i=>i[Math['floor'](Math['random']()*i['length'])];let h=[];d['forEach']((j,k)=>h['push'](buildLink({'core':a,'userID':b,'hostName':c,'address':j,'port':g(f),'tag':'D'+(k+0x1)})));try{const i=await fetch('https://raw.githubusercontent.com/NiREvil/vless/main/Cloudflare-IPs.json');if(i['ok']){const j=await i['json'](),k=[...j['ipv4']||[],...j['ipv6']||[]]['slice'](0x0,0x14)['map'](l=>l['ip']);k['forEach']((l,m)=>{const n=l['includes'](':')?'['+l+']':l;h['push'](buildLink({'core':a,'userID':b,'hostName':c,'address':n,'port':g(f),'tag':'IP'+(m+0x1)}));});}}catch(l){console['error']('Fetch\x20IP\x20list\x20failed',l);}return new Response(btoa(h['join']('\x0a')),{'headers':{'Content-Type':'text/plain;charset=utf-8'}});}export default{async 'fetch'(a,b,c){const d=new URL(a['url']),e=b['ADMIN_PATH']||'admin';if(d['pathname']['startsWith']('/'+e))return handleAdminRequest(a,b,e);if(a['headers']['get']('Upgrade')?.['toLowerCase']()==='websocket')return ProtocolOverWSHandler(a,b,c);const f=async h=>{const i=d['pathname']['slice'](('/'+h+'/')['length']),j=await getUserData(b,i);if(isUserInvalid(j))return new Response('Invalid\x20or\x20expired\x20user',{'status':0x193});return handleIpSubscription(h,i,d['hostname']);};if(d['pathname']['startsWith']('/xray/'))return f('xray');if(d['pathname']['startsWith']('/sb/'))return f('sb');const g=d['pathname']['slice'](0x1);if(isValidUUID(g)){const h=await getUserData(b,g);if(!h)return new Response('User\x20not\x20found',{'status':0x194});const i=Config['fromEnv'](b),j=a['headers']['get']('CF-Connecting-IP'),[k,l]=await Promise['all']([getIPInfo(j),getProxyIPInfo(b,i['proxyAddress'])]);return handleConfigPage(g,d['hostname'],h,k,l);}return new Response('Not\x20found.',{'status':0x194});}};async function ProtocolOverWSHandler(a,b,c){const d=new WebSocketPair(),[e,f]=Object['values'](d);f['accept']();let g='',h='',i=0x0,j='';const k=(s,t)=>console['log']('['+g+':'+h+']\x20'+s,t||''),l=async()=>{if(i>0x0&&j){try{await b['DB']['prepare']('UPDATE\x20users\x20SET\x20data_usage\x20=\x20data_usage\x20+\x20?\x20WHERE\x20uuid\x20=\x20?')['bind'](Math['round'](i),j)['run'](),await b['USER_KV']['delete']('user:'+j),k('Updated\x20usage\x20for\x20'+j+'\x20by\x20'+i+'\x20bytes.');}catch(s){console['error']('Failed\x20to\x20update\x20usage\x20for\x20'+j+':',s);}i=0x0;}},m=()=>new TransformStream({'transform'(s,t){i+=s['byteLength'],t['enqueue'](s);}}),n=m(),o=m(),p=a['headers']['get']('Sec-WebSocket-Protocol')||'',q=MakeReadableWebSocketStream(f,p,k);let r={'value':null};return q['pipeThrough'](n)['pipeTo'](new WritableStream({async 'write'(s,t){if(r['value']){const D=r['value']['writable']['getWriter']();await D['write'](s),D['releaseLock']();return;}const {user:u,hasError:v,message:w,addressRemote:x,portRemote:y,rawDataIndex:z,ProtocolVersion:A}=await ProcessProtocolHeader(s,b);if(v){t['error'](new Error(w));return;}j=u['uuid'];if(isUserInvalid(u)){t['error'](new Error('User\x20is\x20invalid,\x20expired,\x20or\x20has\x20reached\x20data\x20limit.'));return;}g=x,h=y+'--'+Math['random']();const B=new Uint8Array([A[0x0],0x0]),C=s['slice'](z);HandleTCPOutBound(r,x,y,C,f,B,k,o);},'close'(){k('readableWebSocketStream\x20closed'),c['waitUntil'](l());},'abort'(s){k('readableWebSocketStream\x20aborted',s),c['waitUntil'](l());}}))['catch'](s=>{console['error']('WebSocket\x20pipeline\x20failed:',s['stack']||s),safeCloseWebSocket(f),c['waitUntil'](l());}),new Response(null,{'status':0x65,'webSocket':e});}async function ProcessProtocolHeader(a,b){if(a['byteLength']<0x18)return{'hasError':!![],'message':'invalid\x20data'};const c=new DataView(a),d=c['getUint8'](0x0),e=unsafeStringify(new Uint8Array(a['slice'](0x1,0x11))),f=await getUserData(b,e);if(!f)return{'hasError':!![],'message':'invalid\x20user'};const g=c['getUint8'](0x11),h=c['getUint8'](0x12+g);if(h!==0x1)return{'hasError':!![],'message':'command\x20'+h+'\x20is\x20not\x20supported'};const i=0x12+g+0x1,j=c['getUint16'](i),k=c['getUint8'](i+0x2);let l,m,n;switch(k){case 0x1:m=0x4,n=i+0x3,l=new Uint8Array(a['slice'](n,n+m))['join']('.');break;case 0x2:m=c['getUint8'](i+0x3),n=i+0x4,l=new TextDecoder()['decode'](a['slice'](n,n+m));break;case 0x3:m=0x10,n=i+0x3;const o=new Uint16Array(a['slice'](n,n+m)['buffer']);l=Array['from'](o)['map'](p=>p['toString'](0x10)['padStart'](0x4,'0'))['join'](':');break;default:return{'hasError':!![],'message':'invalid\x20addressType:\x20'+k};}return{'user':f,'hasError':![],'addressRemote':l,'portRemote':j,'rawDataIndex':n+m,'ProtocolVersion':new Uint8Array([d])};}async function HandleTCPOutBound(a,b,c,d,e,f,g,h){try{const i=connect({'hostname':b,'port':c});a['value']=i,g('connected\x20to\x20'+b+':'+c);const j=i['writable']['getWriter']();await j['write'](d),j['releaseLock'](),RemoteSocketToWS(i,e,f,g,h);}catch(k){console['error']('Failed\x20to\x20connect\x20to\x20'+b+':'+c+':',k),safeCloseWebSocket(e);}}function MakeReadableWebSocketStream(a,b,c){return new ReadableStream({'start'(d){a['addEventListener']('message',g=>d['enqueue'](g['data'])),a['addEventListener']('close',()=>{safeCloseWebSocket(a),d['close']();}),a['addEventListener']('error',g=>{c('WebSocket\x20error'),d['error'](g);});const {earlyData:e,error:f}=base64ToArrayBuffer(b);if(f)d['error'](f);else{if(e)d['enqueue'](e);}},'cancel'(d){c('ReadableStream\x20canceled:\x20'+d),safeCloseWebSocket(a);}});}async function RemoteSocketToWS(a,b,c,d,e){try{await a['readable']['pipeThrough'](e)['pipeTo'](new WritableStream({async 'write'(f){if(b['readyState']!==CONST['WS_READY_STATE_OPEN'])return;const g=c?await new Blob([c,f])['arrayBuffer']():f;b['send'](g),c=null;},'close'(){d('Remote\x20connection\x20readable\x20closed.');},'abort'(f){console['error']('Remote\x20connection\x20readable\x20aborted:',f);}}));}catch(f){console['error']('RemoteSocketToWS\x20error:',f['stack']||f),safeCloseWebSocket(b);}}function base64ToArrayBuffer(a){if(!a)return{'earlyData':null,'error':null};try{const b=atob(a['replace'](/-/g,'+')['replace'](/_/g,'/')),c=new ArrayBuffer(b['length']),d=new Uint8Array(c);for(let e=0x0;e<b['length'];e++)d[e]=b['charCodeAt'](e);return{'earlyData':c,'error':null};}catch(f){return{'earlyData':null,'error':f};}}function safeCloseWebSocket(a){try{(a['readyState']===CONST['WS_READY_STATE_OPEN']||a['readyState']===CONST['WS_READY_STATE_CLOSING'])&&a['close']();}catch(b){console['error']('safeCloseWebSocket\x20error:',b);}}const byteToHex=Array['from']({'length':0x100},(a,b)=>(b+0x100)['toString'](0x10)['slice'](0x1));function unsafeStringify(a){return(byteToHex[a[0x0]]+byteToHex[a[0x1]]+byteToHex[a[0x2]]+byteToHex[a[0x3]]+'-'+byteToHex[a[0x4]]+byteToHex[a[0x5]]+'-'+byteToHex[a[0x6]]+byteToHex[a[0x7]]+'-'+byteToHex[a[0x8]]+byteToHex[a[0x9]]+'-'+byteToHex[a[0xa]]+byteToHex[a[0xb]]+byteToHex[a[0xc]]+byteToHex[a[0xd]]+byteToHex[a[0xe]]+byteToHex[a[0xf]])['toLowerCase']();}function handleConfigPage(a,b,c,d,e){const f=generateBeautifulConfigPage(a,b,c,d,e);return new Response(f,{'headers':{'Content-Type':'text/html;\x20charset=utf-8'}});}function generateBeautifulConfigPage(a,b,c,d,e){const {expiration_date:f,expiration_time:g,data_usage:h,data_limit:i}=c,j='https://'+b+'/xray/'+a,k='https://'+b+'/sb/'+a,l={'universal':'v2rayng://install-config?url='+encodeURIComponent(j),'shadowrocket':'shadowrocket://add/sub?url='+encodeURIComponent(j)+'&name='+encodeURIComponent(b),'stash':'stash://install-config?url='+encodeURIComponent(j),'clashMeta':'clash://install-config?url='+encodeURIComponent(k)},m=f+'T'+g['split']('.')[0x0]+'Z',n=(r,s,t=![])=>{const u=t?s?.['host']||'N/A':'N/A',v=s?.['ip']||'N/A',w=s?.['location']||'N/A',x=s?.['isp']||'N/A',y=s?.['risk']||'N/A';return'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22network-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-header\x22><h3>'+r+'</h3></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(t?'<div\x20class=\x22ip-info-item\x22><span\x20class=\x22label\x22>Proxy\x20Host</span><span\x20class=\x22value\x22>'+u+'</span></div>':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-item\x22><span\x20class=\x22label\x22>IP\x20Address</span><span\x20class=\x22value\x22>'+v+'</span></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-item\x22><span\x20class=\x22label\x22>Location</span><span\x20class=\x22value\x22>'+w+'</span></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-item\x22><span\x20class=\x22label\x22>ISP\x20Provider</span><span\x20class=\x22value\x22>'+x+'</span></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+(!t?'<div\x20class=\x22ip-info-item\x22><span\x20class=\x22label\x22>Risk\x20Score</span><span\x20class=\x22value\x22>'+y+'</span></div>':'')+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>';},o='\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-title\x22><span>Network\x20Information</span><button\x20class=\x22button\x22\x20onclick=\x22location.reload()\x22>Refresh</button></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22ip-info-grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+n('Proxy\x20Server',e,!![])+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20'+n('Your\x20Connection',d,![])+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>',p='<div\x20class=\x22info-card\x20rainbow-border\x22><div\x20class=\x22info-card-content\x22><h2\x20class=\x22info-title\x22>Expiration\x20Date</h2><div\x20id=\x22expiration-relative\x22\x20class=\x22info-relative-time\x22>--</div><div\x20id=\x22expiration-display\x22\x20data-utc-time=\x22'+m+'\x22\x20class=\x22info-time-grid\x22></div></div></div>',q='<div\x20class=\x22info-card\x22><div\x20class=\x22info-card-content\x22><h2\x20class=\x22info-title\x22>Data\x20Usage</h2><div\x20class=\x22data-usage-text\x22\x20id=\x22data-usage-display\x22\x20data-usage=\x22'+h+'\x22\x20data-limit=\x22'+i+'\x22>...</div><div\x20class=\x22traffic-bar-container\x22><div\x20id=\x22traffic-bar-inner\x22\x20class=\x22traffic-bar\x22></div></div></div></div>';return'<!doctype\x20html>\x0a\x20\x20\x20\x20<html><head><meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22><title>VLESS\x20Configuration</title><script\x20src=\x22https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js\x22></script><style>'+getPageCSS()+'</style></head>\x0a\x20\x20\x20\x20<body><div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22header\x22><h1>VLESS\x20Proxy\x20Configuration</h1><p>Copy\x20the\x20configuration\x20or\x20import\x20directly\x20into\x20your\x20client</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22top-grid\x22>'+p+q+'</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20'+o+'\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-card\x22><div\x20class=\x22config-title\x22><span>Xray\x20Subscription</span><button\x20class=\x22button\x22\x20onclick=\x22copyToClipboard(this,\x20\x27'+j+'\x27)\x22>Copy\x20Link</button></div><div\x20class=\x22client-buttons\x22><a\x20href=\x22'+l['universal']+'\x22\x20class=\x22client-btn\x22>Universal\x20Import\x20(V2rayNG,\x20etc.)</a><a\x20href=\x22'+l['shadowrocket']+'\x22\x20class=\x22client-btn\x22>Import\x20to\x20Shadowrocket</a><a\x20href=\x22'+l['stash']+'\x22\x20class=\x22client-btn\x22>Import\x20to\x20Stash\x20(VLESS)</a><button\x20class=\x22client-btn\x22\x20onclick=\x22toggleQR(\x27xray\x27,\x20\x27'+j+'\x27)\x22>Show\x20QR\x20Code</button></div><div\x20id=\x22qr-xray-container\x22\x20class=\x22qr-container\x22><div\x20id=\x22qr-xray\x22></div></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22config-card\x22><div\x20class=\x22config-title\x22><span>Sing-Box\x20/\x20Clash\x20Subscription</span><button\x20class=\x22button\x22\x20onclick=\x22copyToClipboard(this,\x20\x27'+k+'\x27)\x22>Copy\x20Link</button></div><div\x20class=\x22client-buttons\x22><a\x20href=\x22'+l['clashMeta']+'\x22\x20class=\x22client-btn\x22>Import\x20to\x20Clash\x20Meta\x20/\x20Stash</a><button\x20class=\x22client-btn\x22\x20onclick=\x22toggleQR(\x27singbox\x27,\x20\x27'+k+'\x27)\x22>Show\x20QR\x20Code</button></div><div\x20id=\x22qr-singbox-container\x22\x20class=\x22qr-container\x22><div\x20id=\x22qr-singbox\x22></div></div></div>\x0a\x20\x20\x20\x20</div><script>'+getPageScript()+'</script></body></html>';}function getPageCSS(){return':root{--bg-main:#111827;--bg-card:#1F2937;--bg-inner:#374151;--border:#4B5563;--text-primary:#F9FAFB;--text-secondary:#9CA3AF;--accent:#818CF8;--accent-hover:#6366F1;--status-active:#34D399;--status-expired:#F87171}body{margin:0;font-family:-apple-system,BlinkMacSystemFont,\x22Segoe\x20UI\x22,Roboto,sans-serif;background-color:var(--bg-main);color:var(--text-primary);padding:20px}.container{max-width:800px;margin:auto}.header{text-align:center;margin-bottom:24px}.header\x20h1{font-size:2em;margin-bottom:8px}.header\x20p{color:var(--text-secondary)}.top-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(300px,1fr));gap:20px;margin-bottom:20px}.info-card{background:var(--bg-card);border-radius:12px;position:relative;overflow:hidden;border:1px\x20solid\x20var(--border)}.info-card.rainbow-border::before{content:\x27\x27;position:absolute;top:-50%;left:-50%;width:200%;height:200%;background:conic-gradient(from\x20180deg\x20at\x2050%\x2050%,#F87171,#6366F1,#34D399,#F87171);animation:spin\x204s\x20linear\x20infinite;z-index:1}.info-card-content{background:var(--bg-card);padding:20px;border-radius:10px;position:relative;z-index:2;margin:2px}.info-title{font-size:1.25em;text-align:center;margin:0\x200\x2016px;font-weight:500}.info-relative-time{text-align:center;font-size:1.4em;font-weight:600;margin-bottom:16px}.status-active-text{color:var(--status-active)}.status-expired-text{color:var(--status-expired)}.info-time-grid{display:grid;gap:8px;font-size:.9em;color:var(--text-secondary)}.data-usage-text{font-size:1.4em;font-weight:600;text-align:center;color:var(--text-primary);margin-bottom:16px}.traffic-bar-container{height:8px;background-color:var(--bg-inner);border-radius:4px;overflow:hidden}.traffic-bar{height:100%;background:linear-gradient(90deg,var(--accent)\x200%,var(--status-active)\x20100%);border-radius:4px;transition:width\x20.5s\x20ease-out}.config-card{background:var(--bg-card);border-radius:12px;padding:24px;margin-bottom:24px;border:1px\x20solid\x20var(--border)}.config-title{display:flex;justify-content:space-between;align-items:center;font-size:1.4rem;margin-bottom:20px;padding-bottom:16px;border-bottom:1px\x20solid\x20var(--border)}.button,.client-btn{display:inline-flex;align-items:center;justify-content:center;gap:8px;padding:10px\x2016px;border-radius:8px;font-size:14px;font-weight:500;cursor:pointer;border:1px\x20solid\x20var(--border);background-color:var(--bg-inner);color:var(--text-primary);text-decoration:none;transition:all\x20.2s}.button:hover{background-color:#4B5563}.client-buttons{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:12px}.client-btn{width:100%;box-sizing:border-box;background-color:var(--accent);color:white;border:none}.client-btn:hover{background-color:var(--accent-hover)}.qr-container{display:none;margin-top:20px;background:white;padding:16px;border-radius:8px;max-width:288px;margin-left:auto;margin-right:auto}.ip-info-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(280px,1fr));gap:20px}.ip-info-header{border-bottom:1px\x20solid\x20var(--border);padding-bottom:10px;margin-bottom:12px}.ip-info-header\x20h3{margin:0;font-size:1.1em}.ip-info-item{display:flex;justify-content:space-between;font-size:.9em;padding:4px\x200}.ip-info-item\x20.label{color:var(--text-secondary)}.ip-info-item\x20.value{color:var(--text-primary);font-weight:500;text-align:right}@keyframes\x20spin{100%{transform:rotate(360deg)}}@media\x20(max-width:768px){body{padding:10px}.top-grid{grid-template-columns:1fr}}';}function getPageScript(){return'function\x20copyToClipboard(btn,text){const\x20o=btn.textContent;navigator.clipboard.writeText(text).then(()=>{btn.textContent=\x27Copied!\x27;setTimeout(()=>{btn.textContent=o},1500)})}function\x20toggleQR(id,url){const\x20c=document.getElementById(\x27qr-\x27+id+\x27-container\x27),q=document.getElementById(\x27qr-\x27+id);if(c.style.display===\x27none\x27||c.style.display===\x27\x27){c.style.display=\x27block\x27;if(!q.hasChildNodes()){new\x20QRCode(q,{text:url,width:256,height:256})}}else{c.style.display=\x27none\x27}}function\x20displayExpirationTimes(){const\x20e=document.getElementById(\x27expiration-display\x27),r=document.getElementById(\x27expiration-relative\x27);if(!e?.dataset.utcTime)return;const\x20t=new\x20Date(e.dataset.utcTime);if(isNaN(t.getTime()))return;const\x20n=(t.getTime()-new\x20Date().getTime())/1000,i=n<0;if(i){r.textContent=\x22Subscription\x20Expired\x22;r.className=\x22info-relative-time\x20status-expired-text\x22}else{const\x20o=new\x20Intl.RelativeTimeFormat(\x27en\x27,{numeric:\x27auto\x27});let\x20a;if(Math.abs(n)<3600)a=o.format(Math.round(n/60),\x27minute\x27);else\x20if(Math.abs(n)<86400)a=o.format(Math.round(n/3600),\x27hour\x27);else\x20a=o.format(Math.round(n/86400),\x27day\x27);r.textContent=`Expires\x20${a}`;r.className=\x22info-relative-time\x20status-active-text\x22}e.innerHTML=`<div><strong>Your\x20Local\x20Time:</strong>\x20<span>${t.toLocaleString()}</span></div><div><strong>Tehran\x20Time:</strong>\x20<span>${t.toLocaleString(\x22en-US\x22,{timeZone:\x22Asia/Tehran\x22,hour12:!0,year:\x22numeric\x22,month:\x22short\x22,day:\x22numeric\x22,hour:\x22numeric\x22,minute:\x222-digit\x22})}</span></div><div><strong>Universal\x20Time:</strong>\x20<span>${t.toISOString().substring(0,19).replace(\x22T\x22,\x22\x20\x22)}\x20UTC</span></div>`}function\x20displayDataUsage(){const\x20t=document.getElementById(\x22data-usage-display\x22),e=parseInt(t.dataset.usage,10),a=parseInt(t.dataset.limit,10);const\x20n=t=>{if(t<=0)return\x220\x20Bytes\x22;const\x20e=Math.floor(Math.log(t)/Math.log(1024));return`${parseFloat((t/Math.pow(1024,e)).toFixed(2))}\x20${[\x22Bytes\x22,\x22KB\x22,\x22MB\x22,\x22GB\x22,\x22TB\x22][e]}`};const\x20i=a>0?n(a):\x22&infin;\x22;t.innerHTML=`${n(e)}\x20/\x20${i}`;const\x20d=document.getElementById(\x22traffic-bar-inner\x22);if(d){const\x20s=a>0?Math.min(100,e/a*100):0;d.style.width=`${s}%`}}document.addEventListener(\x27DOMContentLoaded\x27,()=>{displayExpirationTimes();displayDataUsage();setInterval(displayExpirationTimes,6e4)});';}