// <!--GAMFC--> version base on commit 971a66c045a61a4be4223302213528c5ca3e0259, time is 2025-10-24 10:29:05 UTC<!--We are all REvil-->
// @ts-ignore

import{connect}from'cloudflare:sockets';const Config={'userID':'d342d11e-d424-4583-b36e-524ab1f0afa4','proxyIPs':[],'socks5':{'enabled':![],'relayMode':![],'address':''},'fromEnv'(a){let b=a['PROXYIP'];!b&&this['proxyIPs']['length']>0x0&&(b=this['proxyIPs'][Math['floor'](Math['random']()*this['proxyIPs']['length'])]);b=b||'';const [c,d='443']=b['split'](':');return{'userID':a['UUID']||this['userID'],'proxyIP':c,'proxyPort':d,'proxyAddress':b,'adminPath':a['ADMIN_PATH']||'/admin','apiToken':a['API_TOKEN'],'rootProxyUrl':a['ROOT_PROXY_URL'],'scamalytics':{'username':a['SCAMALYTICS_USERNAME'],'apiKey':a['SCAMALYTICS_API_KEY'],'baseUrl':'https://api12.scamalytics.com/v3/'},'socks5':{'enabled':!!a['SOCKS5'],'relayMode':a['SOCKS5_RELAY']==='true'||this['socks5']['relayMode'],'address':a['SOCKS5']||this['socks5']['address']}};}},CONST={'ED_PARAMS':{'ed':0xa00,'eh':'Sec-WebSocket-Protocol'},'VLESS_PROTOCOL':'vless','WS_READY_STATE_OPEN':0x1,'WS_READY_STATE_CLOSING':0x2};function isValidUUID(a){if(typeof a!=='string')return![];const b=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return b['test'](a);}function isExpired(a,b){if(!a||!b)return!![];const c=b['includes'](':')&&b['split'](':')['length']===0x2?b+':00':b,d=c['split']('.')[0x0],e=new Date(a+'T'+d+'Z');return e<=new Date();}function bytesToReadable(a){if(a<=0x0)return'0\x20Bytes';const b=Math['floor'](Math['log'](a)/Math['log'](0x400));return parseFloat((a/Math['pow'](0x400,b))['toFixed'](0x2))+'\x20'+['Bytes','KB','MB','GB','TB'][b];}async function getUserData(a,b,c){if(!isValidUUID(b))return null;if(!a['DB']||!a['USER_KV'])return console['error']('D1\x20or\x20KV\x20bindings\x20are\x20missing.\x20Cannot\x20fetch\x20user\x20data.'),null;const d='user:'+b;try{const f=await a['USER_KV']['get'](d,'json');if(f&&f['uuid'])return f;}catch(g){console['error']('Failed\x20to\x20parse\x20cached\x20user\x20data\x20for\x20'+b,g);}try{const h=await a['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](b)['first']();if(!h)return null;const i=isExpired(h['expiration_date'],h['expiration_time'])?0x15180:0x258;return c?c['waitUntil'](a['USER_KV']['put'](d,JSON['stringify'](h),{'expirationTtl':i})):await a['USER_KV']['put'](d,JSON['stringify'](h),{'expirationTtl':i}),h;}catch(j){return console['error']('D1\x20query\x20failed\x20for\x20user\x20'+b+':',j),null;}}const adminLoginHTML='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20\x20\x20<title>Admin\x20Login</title>\x0a\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20display:\x20flex;\x20justify-content:\x20center;\x20align-items:\x20center;\x20height:\x20100vh;\x20margin:\x200;\x20background-color:\x20#111827;\x20font-family:\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20Helvetica,\x20Arial,\x20sans-serif;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.login-container\x20{\x20background-color:\x20#1F2937;\x20padding:\x2040px;\x20border-radius:\x2012px;\x20box-shadow:\x200\x204px\x2020px\x20rgba(0,\x200,\x200,\x200.5);\x20text-align:\x20center;\x20width:\x20320px;\x20border:\x201px\x20solid\x20#374151;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20h1\x20{\x20color:\x20#F9FAFB;\x20margin-bottom:\x2024px;\x20font-weight:\x20500;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20form\x20{\x20display:\x20flex;\x20flex-direction:\x20column;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20input[type=\x22password\x22]\x20{\x20background-color:\x20#374151;\x20border:\x201px\x20solid\x20#4B5563;\x20color:\x20#F9FAFB;\x20padding:\x2012px;\x20border-radius:\x208px;\x20margin-bottom:\x2020px;\x20font-size:\x2016px;\x20transition:\x20border-color\x200.2s,\x20box-shadow\x200.2s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20input[type=\x22password\x22]:focus\x20{\x20outline:\x20none;\x20border-color:\x20#3B82F6;\x20box-shadow:\x200\x200\x200\x203px\x20rgba(59,\x20130,\x20246,\x200.3);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20button\x20{\x20background-color:\x20#3B82F6;\x20color:\x20white;\x20border:\x20none;\x20padding:\x2012px;\x20border-radius:\x208px;\x20font-size:\x2016px;\x20font-weight:\x20600;\x20cursor:\x20pointer;\x20transition:\x20background-color\x200.2s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20button:hover\x20{\x20background-color:\x20#2563EB;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.error\x20{\x20color:\x20#EF4444;\x20margin-top:\x2015px;\x20font-size:\x2014px;\x20}\x0a\x20\x20\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20\x20\x20<div\x20class=\x22login-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<h1>Admin\x20Login</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<form\x20method=\x22POST\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22password\x22\x20name=\x22password\x22\x20placeholder=\x22â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢\x22\x20required>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22submit\x22>Login</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a</body>\x0a</html>',adminPanelHTML='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20\x20\x20<title>Admin\x20Dashboard</title>\x0a\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20:root\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--bg-main:\x20#0c0a09;\x20--bg-card:\x20#1c1917;\x20--bg-input:\x20#292524;\x20--border:\x20#44403c;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--text-primary:\x20#f5f5f4;\x20--text-secondary:\x20#a8a29e;\x20--accent:\x20#fb923c;\x20--accent-hover:\x20#f97316;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--danger:\x20#ef4444;\x20--danger-hover:\x20#dc2626;\x20--success:\x20#4ade80;\x20--expired:\x20#facc15;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--btn-secondary-bg:\x20#57534e;\x20--btn-secondary-hover:\x20#78716c;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20margin:\x200;\x20font-family:\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20sans-serif;\x20background-color:\x20var(--bg-main);\x20color:\x20var(--text-primary);\x20font-size:\x2014px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x201280px;\x20margin:\x2030px\x20auto;\x20padding:\x200\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.card\x20{\x20background-color:\x20var(--bg-card);\x20border-radius:\x2012px;\x20padding:\x2024px;\x20border:\x201px\x20solid\x20var(--border);\x20box-shadow:\x200\x204px\x2012px\x20rgba(0,0,0,0.3);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stats-grid\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(200px,\x201fr));\x20gap:\x2020px;\x20margin-bottom:\x2030px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stat-card\x20{\x20background-color:\x20var(--bg-card);\x20border-radius:\x2012px;\x20padding:\x2020px;\x20border:\x201px\x20solid\x20var(--border);\x20transition:\x20transform\x200.2s,\x20box-shadow\x200.2s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stat-card:hover\x20{\x20transform:\x20translateY(-5px);\x20box-shadow:\x200\x208px\x2016px\x20rgba(0,0,0,0.4);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stat-title\x20{\x20font-size:\x2014px;\x20color:\x20var(--text-secondary);\x20margin:\x200\x200\x2010px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stat-value\x20{\x20font-size:\x2028px;\x20font-weight:\x20600;\x20margin:\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-grid\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(180px,\x201fr));\x20gap:\x2016px;\x20align-items:\x20flex-end;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20{\x20display:\x20flex;\x20flex-direction:\x20column;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20label\x20{\x20margin-bottom:\x208px;\x20font-weight:\x20500;\x20color:\x20var(--text-secondary);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20{\x20display:\x20flex;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20input,\x20select\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x20box-sizing:\x20border-box;\x20background-color:\x20var(--bg-input);\x20border:\x201px\x20solid\x20var(--border);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20var(--text-primary);\x20padding:\x2010px;\x20border-radius:\x206px;\x20font-size:\x2014px;\x20transition:\x20border-color\x200.2s,\x20box-shadow\x200.2s;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20input:focus,\x20select:focus\x20{\x20outline:\x20none;\x20border-color:\x20var(--accent);\x20box-shadow:\x200\x200\x200\x203px\x20rgba(251,\x20146,\x2060,\x200.3);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn\x20{\x20padding:\x2010px\x2016px;\x20border:\x20none;\x20border-radius:\x206px;\x20font-weight:\x20600;\x20cursor:\x20pointer;\x20transition:\x20all\x200.2s;\x20display:\x20inline-flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20gap:\x208px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn:active\x20{\x20transform:\x20scale(0.97);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-primary\x20{\x20background-color:\x20var(--accent);\x20color:\x20var(--bg-main);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-primary:hover\x20{\x20background-color:\x20var(--accent-hover);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-danger\x20{\x20background-color:\x20var(--danger);\x20color:\x20white;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-danger:hover\x20{\x20background-color:\x20var(--danger-hover);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-secondary\x20{\x20background-color:\x20var(--btn-secondary-bg);\x20color:\x20white;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-secondary:hover\x20{\x20background-color:\x20var(--btn-secondary-hover);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20button\x20{\x20border-top-left-radius:\x200;\x20border-bottom-left-radius:\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20input,\x20.input-group\x20select\x20{\x20border-radius:\x200;\x20border-right:\x20none;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20input:first-child,\x20.input-group\x20select:first-child\x20{\x20border-top-left-radius:\x206px;\x20border-bottom-left-radius:\x206px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20button:last-child,\x20.input-group\x20select:last-child,\x20.input-group\x20input:last-child\x20{\x20border-top-right-radius:\x206px;\x20border-bottom-right-radius:\x206px;\x20border-right:\x201px\x20solid\x20var(--border);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20input:last-child\x20{\x20border-radius:\x206px;\x20border-right:\x201px\x20solid\x20var(--border);\x20}\x20/*\x20Fix\x20for\x20UUID\x20input\x20*/\x0a\x20\x20\x20\x20\x20\x20\x20\x20table\x20{\x20width:\x20100%;\x20border-collapse:\x20collapse;\x20margin-top:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20th,\x20td\x20{\x20padding:\x2012px\x2016px;\x20text-align:\x20left;\x20border-bottom:\x201px\x20solid\x20var(--border);\x20white-space:\x20nowrap;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20th\x20{\x20color:\x20var(--text-secondary);\x20font-weight:\x20600;\x20font-size:\x2012px;\x20text-transform:\x20uppercase;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-badge\x20{\x20padding:\x204px\x2010px;\x20border-radius:\x2012px;\x20font-size:\x2012px;\x20font-weight:\x20600;\x20display:\x20inline-block;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-active\x20{\x20background-color:\x20rgba(74,\x20222,\x20128,\x200.2);\x20color:\x20var(--success);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-expired\x20{\x20background-color:\x20rgba(250,\x20204,\x2021,\x200.2);\x20color:\x20var(--expired);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.actions-cell\x20{\x20display:\x20flex;\x20gap:\x208px;\x20justify-content:\x20flex-start;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20#toast\x20{\x20position:\x20fixed;\x20bottom:\x2020px;\x20left:\x2050%;\x20transform:\x20translateX(-50%);\x20background-color:\x20var(--bg-card);\x20color:\x20white;\x20padding:\x2015px\x2025px;\x20border-radius:\x208px;\x20z-index:\x201001;\x20display:\x20none;\x20border:\x201px\x20solid\x20var(--border);\x20box-shadow:\x200\x204px\x2012px\x20rgba(0,0,0,0.3);\x20opacity:\x200;\x20transition:\x20all\x200.3s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20#toast.show\x20{\x20display:\x20block;\x20opacity:\x201;\x20transform:\x20translate(-50%,\x20-10px);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-overlay\x20{\x20position:\x20fixed;\x20top:\x200;\x20left:\x200;\x20width:\x20100%;\x20height:\x20100%;\x20background-color:\x20rgba(0,0,0,0.7);\x20z-index:\x201000;\x20display:\x20flex;\x20justify-content:\x20center;\x20align-items:\x20center;\x20opacity:\x200;\x20visibility:\x20hidden;\x20transition:\x20opacity\x200.3s,\x20visibility\x200.3s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-overlay.show\x20{\x20opacity:\x201;\x20visibility:\x20visible;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-content\x20{\x20background-color:\x20var(--bg-card);\x20padding:\x2030px;\x20border-radius:\x2012px;\x20width:\x2090%;\x20max-width:\x20550px;\x20transform:\x20scale(0.9);\x20transition:\x20transform\x200.3s;\x20border:\x201px\x20solid\x20var(--border);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-overlay.show\x20.modal-content\x20{\x20transform:\x20scale(1);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-header\x20{\x20display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x20padding-bottom:\x2015px;\x20margin-bottom:\x2020px;\x20border-bottom:\x201px\x20solid\x20var(--border);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-header\x20h2\x20{\x20margin:\x200;\x20font-size:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-close-btn\x20{\x20background:\x20none;\x20border:\x20none;\x20color:\x20var(--text-secondary);\x20font-size:\x2024px;\x20cursor:\x20pointer;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-footer\x20{\x20display:\x20flex;\x20justify-content:\x20flex-end;\x20gap:\x2012px;\x20margin-top:\x2025px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.traffic-bar\x20{\x20width:\x20100%;\x20background-color:\x20var(--bg-input);\x20border-radius:\x204px;\x20height:\x206px;\x20overflow:\x20hidden;\x20margin-top:\x204px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.traffic-bar-inner\x20{\x20height:\x20100%;\x20background-color:\x20var(--accent);\x20border-radius:\x204px;\x20transition:\x20width\x200.5s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-check\x20{\x20display:\x20flex;\x20align-items:\x20center;\x20margin-top:\x2010px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-check\x20input\x20{\x20width:\x20auto;\x20margin-right:\x208px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-copy-uuid\x20{\x20background:\x20none;\x20border:\x20none;\x20color:\x20var(--text-secondary);\x20cursor:\x20pointer;\x20padding:\x204px;\x20margin-left:\x204px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-copy-uuid:hover\x20{\x20color:\x20var(--text-primary);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20@media\x20(max-width:\x20768px)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20padding:\x200\x2010px;\x20margin-top:\x2015px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.stats-grid\x20{\x20grid-template-columns:\x201fr\x201fr;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.user-list-wrapper\x20{\x20overflow-x:\x20auto;\x20-webkit-overflow-scrolling:\x20touch;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20table\x20{\x20min-width:\x20800px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22stats\x22\x20class=\x22stats-grid\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2>Create\x20User</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<form\x20id=\x22createUserForm\x22\x20class=\x22form-grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22hidden\x22\x20id=\x22csrf_token\x22\x20name=\x22csrf_token\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22\x20style=\x22grid-column:\x201\x20/\x20-1;\x22><label\x20for=\x22uuid\x22>UUID</label><div\x20class=\x22input-group\x22><input\x20type=\x22text\x22\x20id=\x22uuid\x22\x20required><button\x20type=\x22button\x22\x20id=\x22generateUUID\x22\x20class=\x22btn\x20btn-secondary\x22>Generate</button></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22expiryDate\x22>Expiry\x20Date</label><input\x20type=\x22date\x22\x20id=\x22expiryDate\x22\x20required></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22expiryTime\x22>Expiry\x20Time\x20(Your\x20Local\x20Time)</label><input\x20type=\x22time\x22\x20id=\x22expiryTime\x22\x20step=\x221\x22\x20required></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22dataLimit\x22>Data\x20Limit</label><div\x20class=\x22input-group\x22><input\x20type=\x22number\x22\x20id=\x22dataLimitValue\x22\x20placeholder=\x22e.g.,\x2010\x22\x20min=\x220\x22><select\x20id=\x22dataLimitUnit\x22><option\x20value=\x22GB\x22>GB</option><option\x20value=\x22MB\x22>MB</option></select><button\x20type=\x22button\x22\x20id=\x22unlimitedBtn\x22\x20class=\x22btn\x20btn-secondary\x22>Unlimited</button></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22notes\x22>Notes</label><input\x20type=\x22text\x22\x20id=\x22notes\x22\x20placeholder=\x22(Optional)\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22\x20style=\x22grid-column:\x201\x20/\x20-1;\x20align-items:\x20flex-start;\x20margin-top:\x2010px;\x22><button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-primary\x22>Create\x20User</button></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x22\x20style=\x22margin-top:\x2030px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2>User\x20List</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22user-list-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<table>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead><tr><th>UUID</th><th>Created</th><th>Expiry</th><th>Status</th><th>Traffic</th><th>Notes</th><th>Actions</th></tr></thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody\x20id=\x22userList\x22></tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</table>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20id=\x22toast\x22></div>\x0a\x0a\x20\x20\x20\x20<div\x20id=\x22editModal\x22\x20class=\x22modal-overlay\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22><h2>Edit\x20User</h2><button\x20id=\x22modalCloseBtn\x22\x20class=\x22modal-close-btn\x22>&times;</button></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<form\x20id=\x22editUserForm\x22\x20class=\x22form-grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22hidden\x22\x20id=\x22editUuid\x22\x20name=\x22uuid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22editExpiryDate\x22>Expiry\x20Date</label><input\x20type=\x22date\x22\x20id=\x22editExpiryDate\x22\x20name=\x22exp_date\x22\x20required></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22editExpiryTime\x22>Expiry\x20Time\x20(Your\x20Local\x20Time)</label><input\x20type=\x22time\x22\x20id=\x22editExpiryTime\x22\x20name=\x22exp_time\x22\x20step=\x221\x22\x20required></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22editDataLimit\x22>Data\x20Limit</label><div\x20class=\x22input-group\x22><input\x20type=\x22number\x22\x20id=\x22editDataLimitValue\x22\x20placeholder=\x22e.g.,\x2010\x22\x20min=\x220\x22><select\x20id=\x22editDataLimitUnit\x22><option\x20value=\x22GB\x22>GB</option><option\x20value=\x22MB\x22>MB</option></select><button\x20type=\x22button\x22\x20id=\x22editUnlimitedBtn\x22\x20class=\x22btn\x20btn-secondary\x22>Unlimited</button></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22editNotes\x22>Notes</label><input\x20type=\x22text\x22\x20id=\x22editNotes\x22\x20name=\x22notes\x22\x20placeholder=\x22(Optional)\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x20form-check\x22\x20style=\x22grid-column:\x201\x20/\x20-1;\x22><input\x20type=\x22checkbox\x22\x20id=\x22resetTraffic\x22><label\x20for=\x22resetTraffic\x22>Reset\x20Traffic\x20Usage</label></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22\x20style=\x22grid-column:\x201\x20/\x20-1;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20id=\x22modalCancelBtn\x22\x20class=\x22btn\x20btn-secondary\x22>Cancel</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-primary\x22>Save\x20Changes</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<script>\x0a\x20\x20\x20\x20\x20\x20\x20\x20document.addEventListener(\x27DOMContentLoaded\x27,\x20()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20API_BASE\x20=\x20window.location.pathname\x20+\x20(window.location.pathname.endsWith(\x27/\x27)\x20?\x20\x27\x27\x20:\x20\x27/\x27)\x20+\x20\x27api\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20csrfTokenEl\x20=\x20document.getElementById(\x27csrf_token\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20csrfToken\x20=\x20csrfTokenEl\x20?\x20csrfTokenEl.value\x20:\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20apiHeaders\x20=\x20{\x20\x27Content-Type\x27:\x20\x27application/json\x27,\x20\x27X-CSRF-Token\x27:\x20csrfToken\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20api\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20get:\x20(endpoint)\x20=>\x20fetch(`${API_BASE}${endpoint}`).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20post:\x20(endpoint,\x20body)\x20=>\x20fetch(`${API_BASE}${endpoint}`,\x20{\x20method:\x20\x27POST\x27,\x20headers:\x20apiHeaders,\x20body:\x20JSON.stringify(body)\x20}).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20put:\x20(endpoint,\x20body)\x20=>\x20fetch(`${API_BASE}${endpoint}`,\x20{\x20method:\x20\x27PUT\x27,\x20headers:\x20apiHeaders,\x20body:\x20JSON.stringify(body)\x20}).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20delete:\x20(endpoint)\x20=>\x20fetch(`${API_BASE}${endpoint}`,\x20{\x20method:\x20\x27DELETE\x27,\x20headers:\x20apiHeaders\x20}).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20handleResponse(response)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(response.status\x20===\x20403)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27Session\x20expired\x20or\x20invalid.\x20Please\x20refresh\x20the\x20page.\x27,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20throw\x20new\x20Error(\x27Forbidden:\x20Invalid\x20session\x20or\x20CSRF\x20token.\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!response.ok)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20errorData\x20=\x20await\x20response.json().catch(()\x20=>\x20({\x20error:\x20\x27An\x20unknown\x20error\x20occurred.\x27\x20}));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20throw\x20new\x20Error(errorData.error\x20||\x20`Request\x20failed\x20with\x20status\x20${response.status}`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20response.status\x20===\x20204\x20?\x20null\x20:\x20response.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20showToast(message,\x20isError\x20=\x20false)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20toast\x20=\x20document.getElementById(\x27toast\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20toast.textContent\x20=\x20message;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20toast.style.backgroundColor\x20=\x20isError\x20?\x20\x27var(--danger)\x27\x20:\x20\x27var(--success)\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20toast.classList.add(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setTimeout(()\x20=>\x20{\x20toast.classList.remove(\x27show\x27);\x20},\x203000);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20pad\x20=\x20num\x20=>\x20num.toString().padStart(2,\x20\x270\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20localToUTC\x20=\x20(d,\x20t)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!d\x20||\x20!t)\x20return\x20{\x20utcDate:\x20\x27\x27,\x20utcTime:\x20\x27\x27\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20dt\x20=\x20new\x20Date(`${d}T${t}`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(isNaN(dt))\x20return\x20{\x20utcDate:\x20\x27\x27,\x20utcTime:\x20\x27\x27\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20{\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20utcDate:\x20`${dt.getUTCFullYear()}-${pad(dt.getUTCMonth()\x20+\x201)}-${pad(dt.getUTCDate())}`,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20utcTime:\x20`${pad(dt.getUTCHours())}:${pad(dt.getUTCMinutes())}:${pad(dt.getUTCSeconds())}`\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20utcToLocal\x20=\x20(d,\x20t)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!d\x20||\x20!t)\x20return\x20{\x20localDate:\x20\x27\x27,\x20localTime:\x20\x27\x27\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20dt\x20=\x20new\x20Date(`${d}T${t}Z`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(isNaN(dt))\x20return\x20{\x20localDate:\x20\x27\x27,\x20localTime:\x20\x27\x27\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20{\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20localDate:\x20`${dt.getFullYear()}-${pad(dt.getMonth()\x20+\x201)}-${pad(dt.getDate())}`,\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20localTime:\x20`${pad(dt.getHours())}:${pad(dt.getMinutes())}:${pad(dt.getSeconds())}`\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20bytesToReadable(bytes)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(bytes\x20<=\x200)\x20return\x20\x270\x20Bytes\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20i\x20=\x20Math.floor(Math.log(bytes)\x20/\x20Math.log(1024));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20`${parseFloat((bytes\x20/\x20Math.pow(1024,\x20i)).toFixed(2))}\x20${[\x27Bytes\x27,\x20\x27KB\x27,\x20\x27MB\x27,\x20\x27GB\x27,\x20\x27TB\x27][i]}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20renderStats(stats)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20statsContainer\x20=\x20document.getElementById(\x27stats\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20statsContainer.innerHTML\x20=\x20`\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><h3\x20class=\x22stat-title\x22>Total\x20Users</h3><p\x20class=\x22stat-value\x22>${stats.totalUsers}</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><h3\x20class=\x22stat-title\x22>Active\x20Users</h3><p\x20class=\x22stat-value\x22>${stats.activeUsers}</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><h3\x20class=\x22stat-title\x22>Expired\x20Users</h3><p\x20class=\x22stat-value\x22>${stats.expiredUsers}</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><h3\x20class=\x22stat-title\x22>Total\x20Traffic\x20Used</h3><p\x20class=\x22stat-value\x22>${bytesToReadable(stats.totalTraffic)}</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20renderUsers(users)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20userList\x20=\x20document.getElementById(\x27userList\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20userList.innerHTML\x20=\x20users.length\x20===\x200\x20?\x20\x27<tr><td\x20colspan=\x227\x22\x20style=\x22text-align:center;\x22>No\x20users\x20found.</td></tr>\x27\x20:\x20users.map(user\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20expiryUTC\x20=\x20new\x20Date(`${user.expiration_date}T${user.expiration_time}Z`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20isExpired\x20=\x20expiryUTC\x20<\x20new\x20Date();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20trafficUsage\x20=\x20user.data_limit\x20>\x200\x20?\x20`${bytesToReadable(user.data_usage)}\x20/\x20${bytesToReadable(user.data_limit)}`\x20:\x20`${bytesToReadable(user.data_usage)}\x20/\x20&infin;`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20trafficPercent\x20=\x20user.data_limit\x20>\x200\x20?\x20Math.min(100,\x20(user.data_usage\x20/\x20user.data_limit\x20*\x20100))\x20:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20`\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20data-uuid=\x22${user.uuid}\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20title=\x22${user.uuid}\x22>${user.uuid.substring(0,\x208)}...<button\x20class=\x22btn-copy-uuid\x22\x20title=\x22Copy\x20UUID\x22>ðŸ“‹</button></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${new\x20Date(user.created_at).toLocaleString()}</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${expiryUTC.toLocaleString()}</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><span\x20class=\x22status-badge\x20${isExpired\x20?\x20\x27status-expired\x27\x20:\x20\x27status-active\x27\x20}\x22>${isExpired\x20?\x20\x27Expired\x27\x20:\x20\x27Active\x27}</span></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20${trafficUsage}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22traffic-bar\x22><div\x20class=\x22traffic-bar-inner\x22\x20style=\x22width:\x20${trafficPercent}%;\x22></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${user.notes\x20||\x20\x27-\x27}</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22actions-cell\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x20btn-edit\x22>Edit</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-danger\x20btn-delete\x22>Delete</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}).join(\x27\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20refreshData()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20[stats,\x20users]\x20=\x20await\x20Promise.all([api.get(\x27/stats\x27),\x20api.get(\x27/users\x27)]);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20window.allUsers\x20=\x20users;\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20renderStats(stats);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20renderUsers(users);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20console.error(\x27Failed\x20to\x20refresh\x20data:\x27,\x20error);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(error.message,\x20true);\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20getLimitInBytes\x20=\x20(valueId,\x20unitId)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20value\x20=\x20parseFloat(document.getElementById(valueId).value);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20unit\x20=\x20document.getElementById(unitId).value;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(isNaN(value)\x20||\x20value\x20<=\x200)\x20return\x200;\x20//\x200\x20for\x20unlimited\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20multiplier\x20=\x20unit\x20===\x20\x27GB\x27\x20?\x201024\x20*\x201024\x20*\x201024\x20:\x201024\x20*\x201024;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20Math.round(value\x20*\x20multiplier);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20setLimitFromBytes\x20=\x20(bytes,\x20valueId,\x20unitId)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20valueEl\x20=\x20document.getElementById(valueId);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20unitEl\x20=\x20document.getElementById(unitId);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(bytes\x20<=\x200)\x20{\x20valueEl.value\x20=\x20\x27\x27;\x20unitEl.value\x20=\x20\x27GB\x27;\x20return;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20isGB\x20=\x20bytes\x20>=\x201024\x20*\x201024\x20*\x201024;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20unit\x20=\x20isGB\x20?\x20\x27GB\x27\x20:\x20\x27MB\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20divisor\x20=\x20isGB\x20?\x201024\x20*\x201024\x20*\x201024\x20:\x201024\x20*\x201024;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20valueEl.value\x20=\x20parseFloat((bytes\x20/\x20divisor).toFixed(2));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20unitEl.value\x20=\x20unit;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27createUserForm\x27).addEventListener(\x27submit\x27,\x20async\x20e\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20expiryDate\x20=\x20document.getElementById(\x27expiryDate\x27).value;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20expiryTime\x20=\x20document.getElementById(\x27expiryTime\x27).value;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20uuid\x20=\x20document.getElementById(\x27uuid\x27).value;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!uuid\x20||\x20!expiryDate\x20||\x20!expiryTime)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27UUID,\x20Expiry\x20Date,\x20and\x20Expiry\x20Time\x20are\x20all\x20required.\x27,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20{\x20utcDate,\x20utcTime\x20}\x20=\x20localToUTC(expiryDate,\x20expiryTime);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!utcDate)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27Invalid\x20local\x20date\x20or\x20time\x20entered.\x27,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20userData\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid:\x20uuid,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20exp_date:\x20utcDate,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20exp_time:\x20utcTime,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data_limit:\x20getLimitInBytes(\x27dataLimitValue\x27,\x20\x27dataLimitUnit\x27),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20notes:\x20document.getElementById(\x27notes\x27).value\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20api.post(\x27/users\x27,\x20userData);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20created\x20successfully!\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20e.target.reset();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27uuid\x27).value\x20=\x20crypto.randomUUID();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setDefaultExpiry();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20refreshData();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(error.message,\x20true);\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20editModal\x20=\x20document.getElementById(\x27editModal\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27userList\x27).addEventListener(\x27click\x27,\x20e\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20button\x20=\x20e.target.closest(\x27button\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!button)\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20row\x20=\x20e.target.closest(\x27tr\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!row)\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20uuid\x20=\x20row.dataset.uuid;\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(button.classList.contains(\x27btn-copy-uuid\x27))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20navigator.clipboard.writeText(uuid);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27UUID\x20copied\x20to\x20clipboard\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20else\x20if\x20(button.classList.contains(\x27btn-edit\x27))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20user\x20=\x20window.allUsers.find(u\x20=>\x20u.uuid\x20===\x20uuid);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!user)\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20{\x20localDate,\x20localTime\x20}\x20=\x20utcToLocal(user.expiration_date,\x20user.expiration_time);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editUuid\x27).value\x20=\x20user.uuid;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editExpiryDate\x27).value\x20=\x20localDate;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editExpiryTime\x27).value\x20=\x20localTime;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setLimitFromBytes(user.data_limit,\x20\x27editDataLimitValue\x27,\x20\x27editDataLimitUnit\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editNotes\x27).value\x20=\x20user.notes\x20||\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27resetTraffic\x27).checked\x20=\x20false;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20editModal.classList.add(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20else\x20if\x20(button.classList.contains(\x27btn-delete\x27))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(confirm(`Are\x20you\x20sure\x20you\x20want\x20to\x20delete\x20user\x20${uuid.substring(0,8)}...?`))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20api.delete(`/users/${uuid}`).then(()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20deleted\x20successfully!\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20refreshData();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}).catch(err\x20=>\x20showToast(err.message,\x20true));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editUserForm\x27).addEventListener(\x27submit\x27,\x20async\x20e\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20uuid\x20=\x20document.getElementById(\x27editUuid\x27).value;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20{\x20utcDate,\x20utcTime\x20}\x20=\x20localToUTC(document.getElementById(\x27editExpiryDate\x27).value,\x20document.getElementById(\x27editExpiryTime\x27).value);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!utcDate)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27Invalid\x20local\x20date\x20or\x20time\x20entered.\x27,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20updatedData\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20exp_date:\x20utcDate,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20exp_time:\x20utcTime,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data_limit:\x20getLimitInBytes(\x27editDataLimitValue\x27,\x20\x27editDataLimitUnit\x27),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20notes:\x20document.getElementById(\x27editNotes\x27).value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20reset_traffic:\x20document.getElementById(\x27resetTraffic\x27).checked,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20api.put(`/users/${uuid}`,\x20updatedData);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20updated\x20successfully!\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20editModal.classList.remove(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20refreshData();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x20showToast(error.message,\x20true);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20closeModal\x20=\x20()\x20=>\x20editModal.classList.remove(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27modalCloseBtn\x27).addEventListener(\x27click\x27,\x20closeModal);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27modalCancelBtn\x27).addEventListener(\x27click\x27,\x20closeModal);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20editModal.addEventListener(\x27click\x27,\x20e\x20=>\x20{\x20if\x20(e.target\x20===\x20editModal)\x20closeModal();\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.addEventListener(\x27keydown\x27,\x20e\x20=>\x20{\x20if\x20(e.key\x20===\x20\x22Escape\x22)\x20closeModal();\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27generateUUID\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20document.getElementById(\x27uuid\x27).value\x20=\x20crypto.randomUUID());\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27unlimitedBtn\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20{\x20document.getElementById(\x27dataLimitValue\x27).value\x20=\x20\x27\x27;\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editUnlimitedBtn\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20{\x20document.getElementById(\x27editDataLimitValue\x27).value\x20=\x20\x27\x27;\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20setDefaultExpiry\x20=\x20()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20now\x20=\x20new\x20Date();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20now.setMonth(now.getMonth()\x20+\x201);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27expiryDate\x27).value\x20=\x20`${now.getFullYear()}-${pad(now.getMonth()\x20+\x201)}-${pad(now.getDate())}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27expiryTime\x27).value\x20=\x20`${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27uuid\x27).value\x20=\x20crypto.randomUUID();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setDefaultExpiry();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20refreshData();\x0a\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20</script>\x0a</body>\x0a</html>';async function checkAdminAuth(a,b,c){const d=a['headers']['get']('Cookie'),e=d?.['match'](/auth_token=([^;]+)/)?.[0x1];if(!e)return{'isAdmin':![],'errorResponse':null,'csrfToken':null};const f=await b['USER_KV']['get']('admin_session:'+e,'json');if(!f){const h=new Headers({'Set-Cookie':'auth_token=;\x20Path='+c['adminPath']+';\x20Expires=Thu,\x2001\x20Jan\x201970\x2000:00:00\x20GMT'});return{'isAdmin':![],'errorResponse':new Response(null,{'status':0x193,'headers':h}),'csrfToken':null};}const {csrfToken:g}=f;if(['POST','PUT','DELETE']['includes'](a['method'])){const i=a['headers']['get']('X-CSRF-Token');if(!i||i!==g){const j=new Response(JSON['stringify']({'error':'Invalid\x20CSRF\x20token\x20or\x20session\x20expired.'}),{'status':0x193,'headers':{'Content-Type':'application/json'}});return{'isAdmin':![],'errorResponse':j,'csrfToken':null};}}return{'isAdmin':!![],'errorResponse':null,'csrfToken':g};}function handleApiError(a,b=''){console['error']('API\x20Error'+(b?'\x20('+b+')':'')+':',JSON['stringify'](a,null,0x2));let c='An\x20unexpected\x20error\x20occurred.\x20Check\x20worker\x20logs\x20for\x20details.';if(a instanceof Error)c=a['message'];else{if(typeof a==='string')c=a;else typeof a==='object'&&a!==null&&a['message']&&(c=String(a['message']),a['cause']?.['message']&&(c+=':\x20'+a['cause']['message']));}if(c['includes']('UNIQUE\x20constraint\x20failed'))c='UUID\x20already\x20exists\x20in\x20the\x20database.';else{if(c['includes']('not\x20iterable'))c='Database\x20binding\x20error:\x20\x22(intermediate\x20value)\x20is\x20not\x20iterable\x22.\x20Please\x20check\x20worker\x20logs.';else c['includes']('attempt\x20to\x20write\x20a\x20readonly\x20database')&&(c='Database\x20is\x20read-only.\x20Check\x20your\x20D1\x20binding\x20permissions.');}return new Response(JSON['stringify']({'error':c}),{'status':0x190,'headers':{'Content-Type':'application/json'}});}async function handleAdminRequest(a,b,c,d){const f=new URL(a['url']),{pathname:g}=f,h={'Content-Type':'application/json'};if(!b['ADMIN_KEY'])return new Response(JSON['stringify']({'error':'Admin\x20panel\x20is\x20not\x20configured.\x20Please\x20set\x20ADMIN_KEY\x20secret.'}),{'status':0x1f7,'headers':h});if(!b['DB']||!b['USER_KV'])return new Response(JSON['stringify']({'error':'Admin\x20panel\x20is\x20not\x20fully\x20configured.\x20Please\x20ensure\x20D1\x20(DB)\x20and\x20KV\x20(USER_KV)\x20bindings\x20are\x20set.'}),{'status':0x1f7,'headers':h});const i=c['adminPath']['endsWith']('/')?c['adminPath']['slice'](0x0,-0x1):c['adminPath'],j=i+'/api';if(g['startsWith'](j)){const {isAdmin:k,errorResponse:l}=await checkAdminAuth(a,b,c);if(l)return l;if(!k)return new Response(JSON['stringify']({'error':'Forbidden'}),{'status':0x193,'headers':h});const m=g['substring'](j['length']);if(m==='/stats'&&a['method']==='GET')try{const o=await b['DB']['prepare']('SELECT\x20COUNT(*)\x20as\x20totalUsers,\x20'+'SUM(CASE\x20WHEN\x20DATETIME(expiration_date\x20||\x20\x27T\x27\x20||\x20expiration_time\x20||\x20\x27Z\x27)\x20>\x20CURRENT_TIMESTAMP\x20THEN\x201\x20ELSE\x200\x20END)\x20as\x20activeUsers,\x20'+'SUM(CASE\x20WHEN\x20DATETIME(expiration_date\x20||\x20\x27T\x27\x20||\x20expiration_time\x20||\x20\x27Z\x27)\x20<=\x20CURRENT_TIMESTAMP\x20THEN\x201\x20ELSE\x200\x20END)\x20as\x20expiredUsers,\x20'+'SUM(data_usage)\x20as\x20totalTraffic\x20'+'FROM\x20users')['first']();return new Response(JSON['stringify']({'totalUsers':o?.['totalUsers']||0x0,'activeUsers':o?.['activeUsers']||0x0,'expiredUsers':o?.['expiredUsers']||0x0,'totalTraffic':o?.['totalTraffic']||0x0}),{'status':0xc8,'headers':h});}catch(p){return handleApiError(p,'GET\x20/stats');}if(m==='/users'&&a['method']==='GET')try{const {results:q}=await b['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20ORDER\x20BY\x20created_at\x20DESC')['all']();return new Response(JSON['stringify'](q??[]),{'status':0xc8,'headers':h});}catch(r){return handleApiError(r,'GET\x20/users');}if(m==='/users'&&a['method']==='POST')try{const s=await a['json'](),{uuid:t,exp_date:u,exp_time:v}=s,w=s['notes']||null,x=typeof s['data_limit']==='number'&&s['data_limit']>=0x0?Math['round'](s['data_limit']):0x0;if(!t||!u||!v||!isValidUUID(t))throw new Error('Invalid\x20or\x20missing\x20fields.\x20(uuid,\x20exp_date,\x20exp_time\x20are\x20required\x20and\x20must\x20be\x20a\x20valid\x20UUID).');return await b['DB']['prepare']('INSERT\x20INTO\x20users\x20(uuid,\x20expiration_date,\x20expiration_time,\x20notes,\x20data_limit,\x20data_usage)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x200)')['bind'](t,u,v,w,x)['run'](),d['waitUntil'](b['USER_KV']['delete']('user:'+t)),new Response(JSON['stringify']({'success':!![],'uuid':t}),{'status':0xc9,'headers':h});}catch(y){return handleApiError(y,'POST\x20/users');}const n=m['match'](/^\/users\/([a-f0-9-]+)$/);if(n){const z=n[0x1];if(a['method']==='PUT')try{const A=await a['json'](),{exp_date:B,exp_time:C}=A,D=A['notes']||null,E=typeof A['data_limit']==='number'&&A['data_limit']>=0x0?Math['round'](A['data_limit']):0x0,F=A['reset_traffic']||![];if(!B||!C)throw new Error('Invalid\x20date/time\x20fields.');const G='UPDATE\x20users\x20SET\x20expiration_date\x20=\x20?,\x20expiration_time\x20=\x20?,\x20notes\x20=\x20?,\x20data_limit\x20=\x20?\x20'+(F?',\x20data_usage\x20=\x200':'')+'\x20WHERE\x20uuid\x20=\x20?',H=await b['DB']['prepare'](G)['bind'](B,C,D,E,z)['run']();if(H['changes']===0x0)return new Response(JSON['stringify']({'error':'User\x20not\x20found'}),{'status':0x194,'headers':h});return d['waitUntil'](b['USER_KV']['delete']('user:'+z)),new Response(JSON['stringify']({'success':!![],'uuid':z}),{'status':0xc8,'headers':h});}catch(I){return handleApiError(I,'PUT\x20/users/'+z);}if(a['method']==='DELETE')try{const J=await b['DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](z)['run']();if(J['changes']===0x0)return new Response(JSON['stringify']({'error':'User\x20not\x20found'}),{'status':0x194,'headers':h});return d['waitUntil'](b['USER_KV']['delete']('user:'+z)),new Response(null,{'status':0xcc});}catch(K){return handleApiError(K,'DELETE\x20/users/'+z);}}return new Response(JSON['stringify']({'error':'API\x20route\x20not\x20found'}),{'status':0x194,'headers':h});}if(g===c['adminPath']){if(a['method']==='POST'){const L=a['headers']['get']('Cookie'),M=L?.['match'](/login_csrf_token=([^;]+)/)?.[0x1],N=await a['formData'](),O=N['get']('csrf_token');if(!M||!O||M!==O){const P=adminLoginHTML['replace']('</form>','</form><p\x20class=\x22error\x22>Invalid\x20session\x20or\x20request.\x20Please\x20try\x20again.</p>'),Q=new Headers({'Content-Type':'text/html;charset=utf-8'});return Q['append']('Set-Cookie','login_csrf_token=;\x20Path='+c['adminPath']+';\x20Expires=Thu,\x2001\x20Jan\x201970\x2000:00:00\x20GMT'),new Response(P,{'status':0x193,'headers':Q});}if(N['get']('password')===b['ADMIN_KEY']){const R=crypto['randomUUID'](),S=crypto['randomUUID']();d['waitUntil'](b['USER_KV']['put']('admin_session:'+R,JSON['stringify']({'csrfToken':S}),{'expirationTtl':0x15180}));const T=new Headers({'Location':c['adminPath'],'Set-Cookie':'auth_token='+R+';\x20HttpOnly;\x20Secure;\x20Path='+c['adminPath']+';\x20Max-Age=86400;\x20SameSite=Strict'});return T['append']('Set-Cookie','login_csrf_token=;\x20Path='+c['adminPath']+';\x20Expires=Thu,\x2001\x20Jan\x201970\x2000:00:00\x20GMT'),new Response(null,{'status':0x12e,'headers':T});}else{const U=new Headers({'Content-Type':'text/html;charset=utf-8'});return U['append']('Set-Cookie','login_csrf_token=;\x20Path='+c['adminPath']+';\x20Expires=Thu,\x2001\x20Jan\x201970\x2000:00:00\x20GMT'),new Response(adminLoginHTML['replace']('</form>','</form><p\x20class=\x22error\x22>Invalid\x20password.</p>'),{'status':0x191,'headers':U});}}if(a['method']==='GET'){const {isAdmin:V,csrfToken:W,errorResponse:X}=await checkAdminAuth(a,b,c);if(X)return X;if(V){const Y=adminPanelHTML['replace']('<input\x20type=\x22hidden\x22\x20id=\x22csrf_token\x22\x20name=\x22csrf_token\x22>','<input\x20type=\x22hidden\x22\x20id=\x22csrf_token\x22\x20name=\x22csrf_token\x22\x20value=\x22'+W+'\x22>');return new Response(Y,{'headers':{'Content-Type':'text/html;charset=utf-8'}});}else{const Z=crypto['randomUUID'](),a0=adminLoginHTML['replace']('</form>','<input\x20type=\x22hidden\x22\x20name=\x22csrf_token\x22\x20value=\x22'+Z+'\x22></form>'),a1=new Headers({'Content-Type':'text/html;charset=utf-8'});return a1['append']('Set-Cookie','login_csrf_token='+Z+';\x20HttpOnly;\x20Secure;\x20Path='+c['adminPath']+';\x20Max-Age=600;\x20SameSite=Strict'),new Response(a0,{'headers':a1});}}return new Response('Method\x20Not\x20Allowed',{'status':0x195});}return new Response('Not\x20found',{'status':0x194});}async function handleManagementAPI(a,b,c,d){const f={'Content-Type':'application/json'};if(!c['apiToken']||a['headers']['get']('Authorization')!=='Bearer\x20'+c['apiToken'])return new Response(JSON['stringify']({'error':'Forbidden:\x20Invalid\x20API\x20Token.'}),{'status':0x193,'headers':f});if(!b['DB']||!b['USER_KV'])return new Response(JSON['stringify']({'error':'Service\x20is\x20partially\x20configured.\x20Missing\x20D1\x20(DB)\x20or\x20KV\x20(USER_KV)\x20bindings.'}),{'status':0x1f7,'headers':f});const g=new URL(a['url']),h=g['pathname']['match'](/^\/api\/v1\/users\/([a-f0-9-]+)$/);if(g['pathname']==='/api/v1/users'&&a['method']==='GET')try{const {results:i}=await b['DB']['prepare']('SELECT\x20*\x20FROM\x20users')['all']();return new Response(JSON['stringify'](i??[]),{'status':0xc8,'headers':f});}catch(j){return handleApiError(j,'GET\x20/api/v1/users');}if(g['pathname']==='/api/v1/users'&&a['method']==='POST')try{const k=await a['json'](),{uuid:l,exp_date:m,exp_time:n}=k;if(!l||!m||!n||!isValidUUID(l))throw new Error('Invalid\x20or\x20missing\x20fields.\x20(uuid,\x20exp_date,\x20exp_time\x20are\x20required\x20and\x20must\x20be\x20a\x20valid\x20UUID).');const o=k['hasOwnProperty']('notes')?k['notes']||null:null;let p=0x0;if(typeof k['data_limit_gb']==='number'&&k['data_limit_gb']>=0x0)p=Math['round'](k['data_limit_gb']*0x400*0x400*0x400);else typeof k['data_limit_mb']==='number'&&k['data_limit_mb']>=0x0&&(p=Math['round'](k['data_limit_mb']*0x400*0x400));await b['DB']['prepare']('INSERT\x20INTO\x20users\x20(uuid,\x20expiration_date,\x20expiration_time,\x20notes,\x20data_limit,\x20data_usage)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x200)')['bind'](l,m,n,o,p)['run'](),d['waitUntil'](b['USER_KV']['delete']('user:'+l));const q=await b['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](l)['first']();return new Response(JSON['stringify'](q),{'status':0xc9,'headers':f});}catch(r){return handleApiError(r,'POST\x20/api/v1/users');}if(h){const s=h[0x1];if(a['method']==='GET')try{const t=await getUserData(b,s,d);if(!t)return new Response(JSON['stringify']({'error':'User\x20not\x20found'}),{'status':0x194,'headers':f});return new Response(JSON['stringify'](t),{'status':0xc8,'headers':f});}catch(u){return handleApiError(u,'GET\x20/api/v1/users/'+s);}if(a['method']==='DELETE')try{const v=await b['DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](s)['run']();if(v['changes']===0x0)return new Response(JSON['stringify']({'error':'User\x20not\x20found'}),{'status':0x194,'headers':f});return d['waitUntil'](b['USER_KV']['delete']('user:'+s)),new Response(null,{'status':0xcc});}catch(w){return handleApiError(w,'DELETE\x20/api/v1/users/'+s);}if(a['method']==='PUT')try{const x=await getUserData(b,s,d);if(!x)return new Response(JSON['stringify']({'error':'User\x20not\x20found'}),{'status':0x194,'headers':f});const y=await a['json'](),z=y['exp_date']||x['expiration_date'],A=y['exp_time']||x['expiration_time'],B=y['hasOwnProperty']('notes')?y['notes']||null:x['notes'];let C=x['data_limit'];if(typeof y['data_limit_gb']==='number'&&y['data_limit_gb']>=0x0)C=Math['round'](y['data_limit_gb']*0x400*0x400*0x400);else typeof y['data_limit_mb']==='number'&&y['data_limit_mb']>=0x0&&(C=Math['round'](y['data_limit_mb']*0x400*0x400));const D='UPDATE\x20users\x20SET\x20expiration_date\x20=\x20?,\x20expiration_time\x20=\x20?,\x20notes\x20=\x20?,\x20data_limit\x20=\x20?\x20'+(y['reset_traffic']?',\x20data_usage\x20=\x200':'')+'\x20WHERE\x20uuid\x20=\x20?',E=await b['DB']['prepare'](D)['bind'](z,A,B,C,s)['run']();if(E['changes']===0x0)return new Response(JSON['stringify']({'error':'User\x20not\x20found'}),{'status':0x194,'headers':f});d['waitUntil'](b['USER_KV']['delete']('user:'+s));const F=await b['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](s)['first']();return new Response(JSON['stringify'](F),{'status':0xc8,'headers':f});}catch(G){return handleApiError(G,'PUT\x20/api/v1/users/'+s);}}return new Response(JSON['stringify']({'error':'API\x20route\x20not\x20found'}),{'status':0x194,'headers':f});}const byteToHex=Array['from']({'length':0x100},(a,b)=>(b+0x100)['toString'](0x10)['slice'](0x1));function unsafeStringify(a,b=0x0){return(byteToHex[a[b]]+byteToHex[a[b+0x1]]+byteToHex[a[b+0x2]]+byteToHex[a[b+0x3]]+'-'+byteToHex[a[b+0x4]]+byteToHex[a[b+0x5]]+'-'+byteToHex[a[b+0x6]]+byteToHex[a[b+0x7]]+'-'+byteToHex[a[b+0x8]]+byteToHex[a[b+0x9]]+'-'+byteToHex[a[b+0xa]]+byteToHex[a[b+0xb]]+byteToHex[a[b+0xc]]+byteToHex[a[b+0xd]]+byteToHex[a[b+0xe]]+byteToHex[a[b+0xf]])['toLowerCase']();}function stringify(a,b=0x0){const c=unsafeStringify(a,b);if(!isValidUUID(c))throw new TypeError('Stringified\x20UUID\x20is\x20invalid');return c;}function generateRandomPath(a=0xc,b=''){const c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let d='';for(let e=0x0;e<a;e++){d+=c['charAt'](Math['floor'](Math['random']()*c['length']));}return'/'+d+(b?'?'+b:'');}const CORE_PRESETS={'xray':{'tls':{'path':()=>generateRandomPath(0xc,'ed=2048'),'security':'tls','fp':'chrome','alpn':'http/1.1','extra':{}},'tcp':{'path':()=>generateRandomPath(0xc,'ed=2048'),'security':'none','fp':'chrome','extra':{}}},'sb':{'tls':{'path':()=>generateRandomPath(0x12),'security':'tls','fp':'firefox','alpn':'h3','extra':CONST['ED_PARAMS']},'tcp':{'path':()=>generateRandomPath(0x12),'security':'none','fp':'firefox','extra':CONST['ED_PARAMS']}}};function makeName(a,b){return a+'-'+b['toUpperCase']();}function createVlessLink({userID:a,address:b,port:c,host:d,path:e,security:f,sni:g,fp:h,alpn:i,extra:extra={},name:j}){const l=new URLSearchParams({'type':'ws','host':d,'path':e});if(f)l['set']('security',f);if(g)l['set']('sni',g);if(h)l['set']('fp',h);if(i)l['set']('alpn',i);for(const [m,n]of Object['entries'](extra))l['set'](m,n);return'vless://'+a+'@'+b+':'+c+'?'+l['toString']()+'#'+encodeURIComponent(j);}function buildLink({core:a,proto:b,userID:c,hostName:d,address:e,port:f,tag:g}){const h=CORE_PRESETS[a][b];return createVlessLink({'userID':c,'address':e,'port':f,'host':d,'path':h['path'](),'security':h['security'],'sni':h['security']==='tls'?d:undefined,'fp':h['fp'],'alpn':h['alpn'],'extra':h['extra'],'name':makeName(g,b)});}const pick=a=>a[Math['floor'](Math['random']()*a['length'])];async function handleIpSubscription(a,b,c){const d=[c,'creativecommons.org','www.speedtest.net','sky.rethinkdns.com','cfip.1323123.xyz','go.inmobi.com','www.visa.com','cf.090227.xyz','cdnjs.com','zula.ir'],f=[0x1bb,0x20fb,0x805,0x823,0x827,0x830],g=[0x50,0x1f90,0x22b0,0x804,0x822,0x826,0x82f];let h=[];const i=c['endsWith']('.pages.dev');d['forEach']((j,k)=>{h['push'](buildLink({'core':a,'proto':'tls','userID':b,'hostName':c,'address':j,'port':pick(f),'tag':'D'+(k+0x1)})),!i&&h['push'](buildLink({'core':a,'proto':'tcp','userID':b,'hostName':c,'address':j,'port':pick(g),'tag':'D'+(k+0x1)}));});try{const j=await fetch('https://raw.githubusercontent.com/NiREvil/vless/refs/heads/main/Cloudflare-IPs.json');if(j['ok']){const k=await j['json'](),l=[...k['ipv4']??[],...k['ipv6']??[]]['slice'](0x0,0x14)['map'](m=>m['ip']);l['forEach']((m,n)=>{const o=m['includes'](':')?'['+m+']':m;h['push'](buildLink({'core':a,'proto':'tls','userID':b,'hostName':c,'address':o,'port':pick(f),'tag':'IP'+(n+0x1)})),!i&&h['push'](buildLink({'core':a,'proto':'tcp','userID':b,'hostName':c,'address':o,'port':pick(g),'tag':'IP'+(n+0x1)}));});}}catch(m){console['error']('Fetch\x20IP\x20list\x20failed',m);}return new Response(btoa(h['join']('\x0a')),{'headers':{'Content-Type':'text/plain;charset=utf-8'}});}function socks5AddressParser(a){try{const [b,c]=a['includes']('@')?a['split']('@'):[null,a],[d,e]=c['split'](':'),f=parseInt(e,0xa);if(!d||isNaN(f))throw new Error();let g,h;if(b){[g,h]=b['split'](':');if(!g)throw new Error();}return{'username':g,'password':h,'hostname':d,'port':f};}catch{throw new Error('Invalid\x20SOCKS5\x20address\x20format.\x20Expected\x20[user:pass@]host:port');}}async function socks5Connect(a,b,c,d,e){const {username:f,password:g,hostname:h,port:j}=e;d('Connecting\x20to\x20SOCKS5\x20proxy\x20at\x20'+h+':'+j);const k=connect({'hostname':h,'port':j}),l=k['writable']['getWriter'](),m=k['readable']['getReader'](),n=new TextEncoder();await l['write'](new Uint8Array([0x5,0x2,0x0,0x2]));let o=(await m['read']())['value'];if(o[0x0]!==0x5)throw new Error('SOCKS5\x20server\x20connection\x20failed\x20(version).');if(o[0x1]===0xff)throw new Error('SOCKS5\x20server\x20requires\x20an\x20auth\x20method\x20we\x20dont\x20support.');if(o[0x1]===0x2){d('SOCKS5\x20authentication\x20required.');if(!f||!g)throw new Error('SOCKS5\x20auth\x20credentials\x20not\x20provided.');const r=new Uint8Array([0x1,f['length'],...n['encode'](f),g['length'],...n['encode'](g)]);await l['write'](r),o=(await m['read']())['value'];if(o[0x0]!==0x1||o[0x1]!==0x0)throw new Error('SOCKS5\x20authentication\x20failed.');d('SOCKS5\x20authentication\x20successful.');}else{if(o[0x1]!==0x0)throw new Error('SOCKS5\x20server\x20selected\x20unsupported\x20auth\x20method:\x20'+o[0x1]);}let p;switch(a){case 0x1:p=new Uint8Array([0x1,...b['split']('.')['map'](Number)]);break;case 0x2:p=new Uint8Array([0x3,b['length'],...n['encode'](b)]);break;case 0x3:const s=b['split'](':'),t=[];if(s['includes']('')){const u=s['indexOf'](''),v=s['slice'](0x0,u),w=s['slice'](u+0x1);v['forEach'](y=>{const z=y['padStart'](0x4,'0');t['push'](parseInt(z['slice'](0x0,0x2),0x10),parseInt(z['slice'](0x2,0x4),0x10));});const x=0x8-v['length']-w['length'];for(let y=0x0;y<x;y++){t['push'](0x0,0x0);}w['forEach'](z=>{const A=z['padStart'](0x4,'0');t['push'](parseInt(A['slice'](0x0,0x2),0x10),parseInt(A['slice'](0x2,0x4),0x10));});}else s['forEach'](z=>{const A=z['padStart'](0x4,'0');t['push'](parseInt(A['slice'](0x0,0x2),0x10),parseInt(A['slice'](0x2,0x4),0x10));});p=new Uint8Array([0x4,...t]);break;default:throw new Error('Invalid\x20addressType\x20for\x20SOCKS5:\x20'+a);}const q=new Uint8Array([0x5,0x1,0x0,...p,c>>0x8,c&0xff]);await l['write'](q),o=(await m['read']())['value'];if(o[0x1]!==0x0)throw new Error('SOCKS5\x20connection\x20failed:\x20status\x20'+o[0x1]);return d('SOCKS5\x20tunnel\x20established\x20to\x20'+b+':'+c),l['releaseLock'](),m['releaseLock'](),k;}export default{async 'fetch'(a,b,c){const d=Config['fromEnv'](b),f=new URL(a['url']);if(f['pathname']['startsWith'](d['adminPath']))return handleAdminRequest(a,b,d,c);if(d['apiToken']&&f['pathname']['startsWith']('/api/v1/'))return handleManagementAPI(a,b,d,c);const g=a['headers']['get']('Upgrade');if(g?.['toLowerCase']()==='websocket'){if(!b['DB']||!b['USER_KV'])return new Response(JSON['stringify']({'error':'VLESS\x20proxy\x20is\x20not\x20fully\x20configured.\x20Missing\x20D1\x20or\x20KV\x20bindings.'}),{'status':0x1f7,'headers':{'Content-Type':'application/json'}});if(d['socks5']['enabled'])try{d['socks5']['parsedSocks5Address']=socks5AddressParser(d['socks5']['address']);}catch(j){return console['error']('Invalid\x20SOCKS5\x20configuration:',j['message']),new Response(JSON['stringify']({'error':'Invalid\x20SOCKS5\x20configuration.\x20Check\x20worker\x20variables.'}),{'status':0x1f4,'headers':{'Content-Type':'application/json'}});}return ProtocolOverWSHandler(a,b,c,d);}if(f['pathname']==='/network-info')return handleNetworkInfoRequest(a,b,d,c);const h=async k=>{const l=f['pathname']['slice'](('/'+k+'/')['length']),m=await getUserData(b,l,c);if(!m||isExpired(m['expiration_date'],m['expiration_time']))return new Response('Invalid\x20or\x20expired\x20user',{'status':0x193});if(m['data_limit']>0x0&&m['data_usage']>=m['data_limit'])return new Response('Data\x20limit\x20reached',{'status':0x193});return handleIpSubscription(k,l,f['hostname']);};if(f['pathname']['startsWith']('/xray/'))return h('xray');if(f['pathname']['startsWith']('/sb/'))return h('sb');const i=f['pathname']['slice'](0x1);if(isValidUUID(i)){const k=await getUserData(b,i,c);if(!k)return new Response('Invalid\x20user\x20ID',{'status':0x193});return handleConfigPage(i,f['hostname'],d['proxyAddress'],k,a['headers']['get']('CF-Connecting-IP'),b,d,c);}if(d['rootProxyUrl'])try{const l=new URL(d['rootProxyUrl']),m=new URL(a['url']);m['hostname']=l['hostname'],m['protocol']=l['protocol'],m['port']=l['port'];const n=new Request(m['toString'](),{'method':a['method'],'headers':a['headers'],'body':a['body'],'redirect':'follow'});n['headers']['set']('Host',l['hostname']),n['headers']['set']('X-Forwarded-For',a['headers']['get']('CF-Connecting-IP')||'unknown'),n['headers']['set']('X-Forwarded-Proto','https');const o=await fetch(n),p=new Headers(o['headers']);return p['delete']('Content-Security-Policy'),p['delete']('X-Frame-Options'),p['delete']('X-XSS-Protection'),new Response(o['body'],{'status':o['status'],'statusText':o['statusText'],'headers':p});}catch(q){return new Response('Proxy\x20error:\x20'+q['message'],{'status':0x1f6});}return new Response('Not\x20found.',{'status':0x194});}};async function ProtocolOverWSHandler(a,b,c,d){const e=new WebSocketPair(),[f,g]=Object['values'](e);g['accept']();let h='',i='',j=0x0,k='',l=null;const m=(u,v)=>console['log']('['+h+':'+i+']\x20'+u,v||''),n=async()=>{if(j>0x0&&k){const u=Math['round'](j);try{await b['DB']['prepare']('UPDATE\x20users\x20SET\x20data_usage\x20=\x20data_usage\x20+\x20?\x20WHERE\x20uuid\x20=\x20?')['bind'](u,k)['run'](),c['waitUntil'](b['USER_KV']['delete']('user:'+k)),m('Updated\x20usage\x20for\x20'+k+'\x20by\x20'+u+'\x20bytes.');}catch(v){console['error']('Failed\x20to\x20update\x20usage\x20for\x20'+k+':',v);}}};c['waitUntil'](new Promise(u=>{const v=()=>{n()['finally'](u);};g['addEventListener']('close',v,{'once':!![]}),g['addEventListener']('error',v,{'once':!![]});}));const o=()=>{return new TransformStream({'transform'(u,v){j+=u['byteLength'],v['enqueue'](u);}});},p=o(),q=o(),r=a['headers']['get'](CONST['ED_PARAMS']['eh'])||'',s=MakeReadableWebSocketStream(g,r,m);let t={'value':null};return s['pipeThrough'](p)['pipeTo'](new WritableStream({async 'write'(u,v){if(l)return l['write'](u);if(t['value']){try{const E=t['value']['writable']['getWriter']();await E['write'](u),E['releaseLock']();}catch(F){console['error']('Error\x20writing\x20to\x20remote\x20socket:',F),v['error'](F);}return;}const {user:w,hasError:x,message:y,addressType:z,portRemote:portRemote=0x1bb,addressRemote:addressRemote='',rawDataIndex:A,ProtocolVersion:ProtocolVersion=new Uint8Array([0x0,0x0]),isUDP:B}=await ProcessProtocolHeader(u,b,c);if(x){v['error'](new Error(y));return;}if(!w){v['error'](new Error('User\x20not\x20found.'));return;}k=w['uuid'];if(isExpired(w['expiration_date'],w['expiration_time'])){v['error'](new Error('User\x20expired.'));return;}if(w['data_limit']>0x0&&w['data_usage']+j>=w['data_limit']){v['error'](new Error('Data\x20limit\x20reached.'));return;}h=addressRemote,i=portRemote+'--'+Math['random']()+'\x20'+(B?'udp':'tcp');const C=new Uint8Array([ProtocolVersion[0x0],0x0]),D=u['slice'](A);if(B){if(portRemote===0x35){const G=I=>{j+=I;},H=await createDnsPipeline(g,C,m,G);l=H['write'],await l(D);}else v['error'](new Error('UDP\x20proxy\x20only\x20supports\x20DNS\x20(port\x2053)\x20via\x20DoH.'));return;}HandleTCPOutBound(t,z,addressRemote,portRemote,D,g,C,m,d,q);},'close'(){m('readableWebSocketStream\x20closed');},'abort'(u){m('readableWebSocketStream\x20aborted',u);}}))['catch'](u=>{console['error']('Pipeline\x20failed:',u['stack']||u),safeCloseWebSocket(g);}),new Response(null,{'status':0x65,'webSocket':f});}async function ProcessProtocolHeader(a,b,c){if(a['byteLength']<0x11)return{'hasError':!![],'message':'invalid\x20data:\x20buffer\x20too\x20short\x20for\x20UUID'};const d=new DataView(a['buffer']),f=d['getUint8'](0x0);let g;try{g=stringify(new Uint8Array(a['slice'](0x1,0x11)));}catch(u){return{'hasError':!![],'message':'invalid\x20UUID\x20format'};}const h=await getUserData(b,g,c);if(!h)return{'hasError':!![],'message':'invalid\x20user'};const i=0x11;if(a['byteLength']<i+0x1)return{'hasError':!![],'message':'invalid\x20data\x20length\x20(payload\x20start)'};const j=d['getUint8'](i),k=i+0x1+j;if(a['byteLength']<k+0x1)return{'hasError':!![],'message':'invalid\x20data\x20length\x20(command)'};const l=d['getUint8'](k);if(l!==0x1&&l!==0x2)return{'hasError':!![],'message':'command\x20'+l+'\x20is\x20not\x20supported\x20(only\x20TCP=1,\x20UDP=2)'};const m=k+0x1;if(a['byteLength']<m+0x2)return{'hasError':!![],'message':'invalid\x20data\x20length\x20(port)'};const n=d['getUint16'](m,![]),o=m+0x2;if(a['byteLength']<o+0x1)return{'hasError':!![],'message':'invalid\x20data\x20length\x20(address\x20type)'};const p=d['getUint8'](o);let q,r,s;switch(p){case 0x1:r=0x4,s=o+0x1;if(a['byteLength']<s+r)return{'hasError':!![],'message':'invalid\x20data\x20length\x20(ipv4)'};q=new Uint8Array(a['slice'](s,s+r))['join']('.');break;case 0x2:r=d['getUint8'](o+0x1),s=o+0x2;if(a['byteLength']<s+r)return{'hasError':!![],'message':'invalid\x20data\x20length\x20(domain)'};q=new TextDecoder()['decode'](a['slice'](s,s+r));break;case 0x3:r=0x10,s=o+0x1;if(a['byteLength']<s+r)return{'hasError':!![],'message':'invalid\x20data\x20length\x20(ipv6)'};q=Array['from']({'length':0x8},(v,w)=>d['getUint16'](s+w*0x2,![])['toString'](0x10))['join'](':');break;default:return{'hasError':!![],'message':'invalid\x20addressType:\x20'+p};}const t=s+r;if(a['byteLength']<t)return{'hasError':!![],'message':'invalid\x20data\x20length\x20(raw\x20data)'};return{'user':h,'hasError':![],'addressRemote':q,'addressType':p,'portRemote':n,'rawDataIndex':t,'ProtocolVersion':new Uint8Array([f]),'isUDP':l===0x2};}async function HandleTCPOutBound(a,b,c,d,f,g,h,i,j,k){async function l(n,o,p=![]){let q;j['socks5']['relayMode']&&j['socks5']['enabled']?(i('SOCKS5\x20Relay:\x20connecting\x20to\x20'+n+':'+o),q=await socks5Connect(b,n,o,i,j['socks5']['parsedSocks5Address'])):q=p&&j['socks5']['enabled']?await socks5Connect(b,n,o,i,j['socks5']['parsedSocks5Address']):connect({'hostname':n,'port':o});a['value']=q,i('connected\x20to\x20'+n+':'+o+'\x20(SOCKS:\x20'+(p||j['socks5']['relayMode'])+')');const r=q['writable']['getWriter']();return await r['write'](f),r['releaseLock'](),q;}async function m(){i('Retrying\x20connection...');let n;try{if(j['socks5']['enabled']&&!j['socks5']['relayMode'])n=await l(c,d,!![]);else{if(j['proxyIP'])n=await l(j['proxyIP'],j['proxyPort']||d,![]);else throw new Error('No\x20proxy\x20or\x20fallback\x20IP\x20configured\x20for\x20retry.');}n['closed']['catch'](o=>{console['log']('retry\x20tcpSocket\x20closed\x20error',o);})['finally'](()=>{safeCloseWebSocket(g);}),RemoteSocketToWS(n,g,h,null,i,k);}catch(o){i('Retry\x20connection\x20failed:\x20'+o['message']),safeCloseWebSocket(g);}}if(j['socks5']['relayMode']&&j['socks5']['enabled']){i('SOCKS5\x20RELAY\x20MODE:\x20connecting\x20to\x20'+c+':'+d+'\x20via\x20SOCKS5.');try{const n=await l(c,d,!![]);n['closed']['catch'](o=>{console['log']('relay\x20tcpSocket\x20closed\x20error',o);})['finally'](()=>{safeCloseWebSocket(g);}),RemoteSocketToWS(n,g,h,null,i,k);}catch(o){i('SOCKS5\x20RELAY\x20failed:\x20'+o['message']),safeCloseWebSocket(g);}}else{const p=j['proxyIP']||c,q=j['proxyIP']?j['proxyPort']:d;i('Attempting\x20direct\x20connection\x20to\x20'+p+':'+q);try{const r=await l(p,q,![]);r['closed']['catch'](s=>{console['log']('direct\x20tcpSocket\x20closed\x20error',s);})['finally'](()=>{safeCloseWebSocket(g);}),RemoteSocketToWS(r,g,h,m,i,k);}catch(s){!j['proxyIP']||j['proxyIP']&&j['socks5']['enabled']?(i('Direct\x20connection\x20failed:\x20'+s['message']+'.\x20Calling\x20retry().'),m()):(i('Direct\x20connection\x20to\x20PROXYIP\x20failed\x20and\x20no\x20SOCKS5\x20configured:\x20'+s['message']),safeCloseWebSocket(g));}}}function MakeReadableWebSocketStream(a,b,c){return new ReadableStream({'start'(d){a['addEventListener']('message',g=>{if(g['data']instanceof ArrayBuffer)d['enqueue'](g['data']);else typeof g['data']==='string'?console['warn']('Received\x20unexpected\x20string\x20message\x20on\x20VLESS\x20WebSocket:',g['data']):console['warn']('Received\x20unexpected\x20message\x20type\x20on\x20VLESS\x20WebSocket.');}),a['addEventListener']('close',()=>{safeCloseWebSocket(a),d['close']();}),a['addEventListener']('error',g=>{c('webSocketServer\x20has\x20error'),d['error'](g);});const {earlyData:e,error:f}=base64ToArrayBuffer(b);if(f)d['error'](f);else{if(e)d['enqueue'](e);}},'pull'(d){},'cancel'(d){c('ReadableStream\x20was\x20canceled,\x20due\x20to\x20'+d),safeCloseWebSocket(a);}});}async function RemoteSocketToWS(a,b,c,d,e,f){let g=![];try{await a['readable']['pipeThrough'](f)['pipeTo'](new WritableStream({async 'write'(h){if(b['readyState']!==CONST['WS_READY_STATE_OPEN'])throw new Error('WebSocket\x20is\x20not\x20open');g=!![];const i=c?await new Blob([c,h])['arrayBuffer']():h;b['send'](i),c=null;},'close'(){e('Remote\x20connection\x20readable\x20closed.\x20Had\x20incoming\x20data:\x20'+g);},'abort'(h){console['error']('Remote\x20connection\x20readable\x20aborted:',h);}}));}catch(h){console['error']('RemoteSocketToWS\x20error:',h['stack']||h),safeCloseWebSocket(b);}!g&&d&&(e('No\x20incoming\x20data\x20received\x20from\x20primary\x20connection,\x20attempting\x20retry.'),d());}function base64ToArrayBuffer(a){if(!a)return{'earlyData':null,'error':null};try{const b=atob(a['replace'](/-/g,'+')['replace'](/_/g,'/')),c=new ArrayBuffer(b['length']),d=new Uint8Array(c);for(let e=0x0;e<b['length'];e++){d[e]=b['charCodeAt'](e);}return{'earlyData':c,'error':null};}catch(f){return console['error']('Base64\x20decoding\x20failed:',f),{'earlyData':null,'error':f};}}function safeCloseWebSocket(a){try{(a['readyState']===CONST['WS_READY_STATE_OPEN']||a['readyState']===CONST['WS_READY_STATE_CLOSING'])&&a['close']();}catch(b){console['error']('safeCloseWebSocket\x20error:',b);}}async function createDnsPipeline(a,b,c,d){let e=![];const f=new TransformStream({'transform'(h,i){if(!(h instanceof ArrayBuffer)&&!(h instanceof Uint8Array)){console['error']('DNS\x20Transform\x20received\x20invalid\x20chunk\x20type:',typeof h);return;}const j=new Uint8Array(h);for(let k=0x0;k<j['byteLength'];){if(j['byteLength']<k+0x2){console['warn']('DNS\x20transform:\x20incomplete\x20length\x20header\x20at\x20end\x20of\x20chunk.');break;}const l=new DataView(j['buffer'],j['byteOffset']+k,0x2),m=l['getUint16'](0x0,![]),n=k+0x2,o=n+m;if(j['byteLength']<o){console['warn']('DNS\x20transform:\x20incomplete\x20UDP\x20packet\x20data\x20in\x20chunk.');break;}const p=j['slice'](n,o);k=o,i['enqueue'](p);}}});f['readable']['pipeTo'](new WritableStream({async 'write'(h){try{const i=await fetch('https://1.1.1.1/dns-query',{'method':'POST','headers':{'content-type':'application/dns-message'},'body':h});if(!i['ok'])throw new Error('DoH\x20server\x20returned\x20status\x20'+i['status']);const j=await i['arrayBuffer'](),k=j['byteLength'],l=new Uint8Array([k>>0x8&0xff,k&0xff]);if(a['readyState']===CONST['WS_READY_STATE_OPEN']){c('DNS\x20query\x20successful,\x20length:\x20'+k);const m=e?new Blob([l,j]):new Blob([b,l,j]),n=await m['arrayBuffer']();d(n['byteLength']),a['send'](n),e=!![];}}catch(o){c('DNS\x20query\x20error:\x20'+o);}},'abort'(h){c('DNS\x20WritableStream\x20aborted:\x20'+h);}}))['catch'](h=>{c('DNS\x20stream\x20error:\x20'+h),safeCloseWebSocket(a);});const g=f['writable']['getWriter']();return{'write':h=>g['write'](h)};}async function getIPGeoInfo(a){if(!a)return null;try{const b=await fetch('https://ip-api.com/json/'+a+'?fields=status,message,country,city,isp,query,as');if(!b['ok'])return null;const c=await b['json']();if(c['status']==='success')return{'ip':c['query'],'country':c['country']||'Unknown','city':c['city']||'Unknown','isp':c['as']||'Unknown'};return null;}catch(d){return console['error']('Error\x20fetching\x20IP\x20info\x20for\x20'+a+':',d),null;}}async function getIPRiskScore(a,b){if(!b['scamalytics']['username']||!b['scamalytics']['apiKey'])return'N/A\x20(Not\x20Configured)';if(!a)return'N/A';try{const c=''+b['scamalytics']['baseUrl']+b['scamalytics']['username']+'/?key='+b['scamalytics']['apiKey']+'&ip='+a,d=await fetch(c);if(!d['ok'])return'N/A\x20(API\x20Error)';const f=await d['json']();if(f['status']==='ok'&&f['score']!==undefined){const g=f['risk']['charAt'](0x0)['toUpperCase']()+f['risk']['slice'](0x1);return f['score']+'%\x20-\x20'+g;}return'Error:\x20'+(f['error_message']||'API\x20error');}catch(h){return'N/A\x20(Fetch\x20Error)';}}async function handleNetworkInfoRequest(a,b,c,d){const e=a['headers']['get']('CF-Connecting-IP');let f=await b['USER_KV']?.['get']('proxy_ip_info','json');if(!f){let j=c['proxyIP'];if(!j)try{const k=await fetch('https://api.ipify.org?format=json');if(k['ok']){const {ip:l}=await k['json']();j=l;}}catch(m){console['error']('Failed\x20to\x20determine\x20proxy\x20IP\x20info\x20(fallback):',m);}f=await getIPGeoInfo(j),f&&b['USER_KV']&&d['waitUntil'](b['USER_KV']['put']('proxy_ip_info',JSON['stringify'](f),{'expirationTtl':0xe10}));}const [g,h]=await Promise['all']([getIPGeoInfo(e),getIPRiskScore(e,c)]),i=g||{};return i['risk']=h,new Response(JSON['stringify']({'proxy':f,'user':i}),{'headers':{'Content-Type':'application/json'}});}async function handleConfigPage(a,b,c,d,e,f,g,h){const {expiration_date:i,expiration_time:j,data_usage:k,data_limit:l}=d,m=generateBeautifulConfigPage(a,b,i,j,k,l);return new Response(m,{'headers':{'Content-Type':'text/html;\x20charset=utf-8'}});}function generateBeautifulConfigPage(a,b,c,d,e,f){const g='https://'+b+'/xray/'+a,h='https://'+b+'/sb/'+a,i='clash://install-config?url='+encodeURIComponent(h),j=d['includes'](':')&&d['split'](':')['length']===0x2?d+':00':d,k=c+'T'+j['split']('.')[0x0]+'Z',l=isExpired(c,d),m=f>0x0,n=m&&e>=f;let o='Checking...',p='status-active-text';if(l)o='Subscription\x20Expired',p='status-expired-text';else n&&(o='Data\x20Limit\x20Reached',p='status-expired-text');const q=m?Math['min'](0x64,e/f*0x64):0x0,r='<!doctype\x20html>'+'<html\x20lang=\x22en\x22>'+'<head>'+'<meta\x20charset=\x22UTF-8\x22\x20/><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22\x20/>'+'<title>VLESS\x20Proxy\x20Configuration</title>'+'<script\x20src=\x22https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js\x22></script>'+'<style>'+':root\x20{'+'--bg-main:\x20#121212;\x20--bg-card:\x20#1E1E1E;\x20--bg-inner:\x20#2f2f2f;\x20--border-color:\x20#333;'+'--text-primary:\x20#E0E0E0;\x20--text-secondary:\x20#B0B0B0;\x20--accent:\x20#BB86FC;\x20--accent-hover:\x20#D1C4E9;'+'--status-active:\x20#03DAC6;\x20--status-expired:\x20#CF6679;\x20--network-bg:\x20#212121;\x20--network-border:\x20#444;'+'}'+'body\x20{\x20margin:\x200;\x20font-family:\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20Helvetica,\x20Arial,\x20sans-serif;\x20background-color:\x20var(--bg-main);\x20color:\x20var(--text-primary);\x20padding:\x2020px;\x20}'+'.container\x20{\x20max-width:\x20900px;\x20margin:\x20auto;\x20}'+'.header\x20{\x20text-align:\x20center;\x20margin-bottom:\x2024px;\x20}'+'.header\x20h1\x20{\x20font-size:\x202em;\x20margin-bottom:\x208px;\x20}'+'.header\x20p\x20{\x20color:\x20var(--text-secondary);\x20}'+'.info-grid\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(320px,\x201fr));\x20gap:\x2020px;\x20margin-bottom:\x2020px;\x20}'+'.info-card\x20{\x20background:\x20var(--bg-card);\x20border-radius:\x2012px;\x20position:\x20relative;\x20overflow:\x20hidden;\x20border:\x201px\x20solid\x20var(--border-color);\x20}'+'.info-card.rainbow-border::before\x20{'+'content:\x20\x27\x27;\x20position:\x20absolute;\x20top:\x20-50%;\x20left:\x20-50%;\x20width:\x20200%;\x20height:\x20200%;'+'background:\x20conic-gradient(from\x20180deg\x20at\x2050%\x2050%,\x20#CF6679,\x20#BB86FC,\x20#03DAC6,\x20#CF6679);'+'animation:\x20spin\x204s\x20linear\x20infinite;\x20z-index:\x201;'+'}'+'.info-card-content\x20{\x20background:\x20var(--bg-card);\x20padding:\x2020px;\x20border-radius:\x2010px;\x20position:\x20relative;\x20z-index:\x202;\x20margin:\x202px;\x20}'+'.info-title\x20{\x20font-size:\x201.25em;\x20text-align:\x20center;\x20margin:\x200\x200\x2016px;\x20font-weight:\x20500;\x20}'+'.info-relative-time\x20{\x20text-align:\x20center;\x20font-size:\x201.4em;\x20font-weight:\x20600;\x20margin-bottom:\x2016px;\x20}'+'.status-active-text\x20{\x20color:\x20var(--status-active);\x20}\x20.status-expired-text\x20{\x20color:\x20var(--status-expired);\x20}'+'.info-time-grid\x20{\x20display:\x20grid;\x20gap:\x208px;\x20font-size:\x200.9em;\x20text-align:\x20center;\x20color:\x20var(--text-secondary);\x20}'+'.data-usage-text\x20{\x20font-size:\x201.4em\x20!important;\x20font-weight:\x20600;\x20text-align:\x20center;\x20color:\x20var(--text-primary);\x20margin-bottom:\x2016px;\x20}'+'.traffic-bar-container\x20{\x20height:\x208px;\x20background-color:\x20var(--bg-inner);\x20border-radius:\x204px;\x20overflow:\x20hidden;\x20}'+'.traffic-bar\x20{\x20height:\x20100%;\x20background:\x20linear-gradient(90deg,\x20var(--accent)\x200%,\x20var(--status-active)\x20100%);\x20border-radius:\x204px;\x20transition:\x20width\x200.5s\x20ease-out;\x20}'+'.network-info-wrapper\x20{\x20background:\x20var(--bg-card);\x20border-radius:\x2012px;\x20padding:\x2024px;\x20margin-bottom:\x2024px;\x20border:\x201px\x20solid\x20var(--border-color);\x20}'+'.network-info-header\x20{\x20display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x20margin-bottom:\x2020px;\x20padding-bottom:\x2016px;\x20border-bottom:\x201px\x20solid\x20var(--border-color);\x20}'+'.network-info-header\x20h2\x20{\x20margin:\x200;\x20font-size:\x201.4rem;\x20}'+'.network-grid\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(300px,\x201fr));\x20gap:\x2020px;\x20}'+'.network-card\x20{\x20background:\x20var(--network-bg);\x20border:\x201px\x20solid\x20var(--network-border);\x20border-radius:\x208px;\x20padding:\x2016px;\x20}'+'.network-title\x20{\x20font-size:\x201.1em;\x20margin-top:\x200;\x20margin-bottom:\x2012px;\x20border-bottom:\x201px\x20solid\x20var(--network-border);\x20padding-bottom:\x208px;\x20color:\x20var(--status-active);\x20}'+'.network-info-grid\x20{\x20display:\x20grid;\x20gap:\x208px;\x20font-size:\x200.9em;\x20}'+'.network-info-grid\x20strong\x20{\x20color:\x20var(--text-secondary);\x20font-weight:\x20400;\x20display:\x20inline-block;\x20min-width:\x2090px;\x20}'+'.network-info-grid\x20span\x20{\x20color:\x20var(--text-primary);\x20font-weight:\x20500;\x20}'+'.skeleton\x20{\x20display:\x20inline-block;\x20width:\x20120px;\x20height:\x201em;\x20background-color:\x20var(--bg-inner);\x20border-radius:\x204px;\x20animation:\x20loading\x201.5s\x20infinite\x20linear;\x20}'+'.config-card\x20{\x20background:\x20var(--bg-card);\x20border-radius:\x2012px;\x20padding:\x2024px;\x20margin-bottom:\x2024px;\x20border:\x201px\x20solid\x20var(--border-color);\x20}'+'.config-title\x20{\x20display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x20font-size:\x201.4rem;\x20margin-bottom:\x2020px;\x20padding-bottom:\x2016px;\x20border-bottom:\x201px\x20solid\x20var(--border-color);\x20}'+'.button,\x20.client-btn\x20{\x20display:\x20inline-flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20gap:\x208px;\x20padding:\x2010px\x2016px;\x20border-radius:\x208px;\x20font-size:\x2014px;\x20font-weight:\x20500;\x20cursor:\x20pointer;\x20border:\x201px\x20solid\x20var(--border-color);\x20background-color:\x20var(--bg-inner);\x20color:\x20var(--text-primary);\x20text-decoration:\x20none;\x20transition:\x20all\x200.2s;\x20}'+'.button:hover\x20{\x20background-color:\x20#3f3f3f;\x20}'+'.client-buttons\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fill,\x20minmax(220px,\x201fr));\x20gap:\x2012px;\x20}'+'.client-btn\x20{\x20width:\x20100%;\x20box-sizing:\x20border-box;\x20background-color:\x20var(--accent);\x20color:\x20#121212;\x20border:\x20none;\x20}'+'.client-btn:hover\x20{\x20background-color:\x20var(--accent-hover);\x20}'+'.qr-container\x20{\x20display:\x20none;\x20margin-top:\x2020px;\x20background:\x20white;\x20padding:\x2016px;\x20border-radius:\x208px;\x20max-width:\x20288px;\x20margin-left:\x20auto;\x20margin-right:\x20auto;\x20}'+'@keyframes\x20spin\x20{\x20100%\x20{\x20transform:\x20rotate(360deg);\x20}\x20}'+'@keyframes\x20loading\x20{\x200%\x20{\x20background-color:\x20#2f2f2f;\x20}\x2050%\x20{\x20background-color:\x20#3f3f3f;\x20}\x20100%\x20{\x20background-color:\x20#2f2f2f;\x20}\x20}'+'@media\x20(max-width:\x20768px)\x20{\x20'+'body\x20{\x20padding:\x2010px;\x20}\x20'+'.info-grid,\x20.network-grid\x20{\x20grid-template-columns:\x201fr;\x20}\x20'+'.network-info-header\x20{\x20flex-direction:\x20column;\x20align-items:\x20flex-start;\x20gap:\x2010px;\x20}'+'.network-info-header\x20button\x20{\x20width:\x20100%;\x20}'+'}'+'</style>'+'</head>'+'<body>'+'<div\x20class=\x22container\x22>'+'<div\x20class=\x22header\x22><h1>VLESS\x20Proxy\x20Configuration</h1><p>Copy\x20the\x20configuration\x20or\x20import\x20directly\x20into\x20your\x20client</p></div>'+'<div\x20class=\x22network-info-wrapper\x22>'+'<div\x20class=\x22network-info-header\x22>'+'<h2>Network\x20Information</h2>'+'<button\x20class=\x22button\x22\x20id=\x22refresh-network-btn\x22>Refresh</button>'+'</div>'+'<div\x20id=\x22network-info-grid\x22\x20class=\x22network-grid\x22>'+'<div\x20class=\x22network-card\x22>'+'<h3\x20class=\x22network-title\x22>Proxy\x20Server</h3>'+'<div\x20class=\x22network-info-grid\x22>'+'<div><strong>IP\x20Address:</strong>\x20<span\x20id=\x22proxy-ip\x22><span\x20class=\x22skeleton\x22></span></span></div>'+'<div><strong>Location:</strong>\x20<span\x20id=\x22proxy-location\x22><span\x20class=\x22skeleton\x22></span></span></div>'+'<div><strong>ISP:</strong>\x20<span\x20id=\x22proxy-isp\x22><span\x20class=\x22skeleton\x22></span></span></div>'+'</div>'+'</div>'+'<div\x20class=\x22network-card\x22>'+'<h3\x20class=\x22network-title\x22>Your\x20Connection</h3>'+'<div\x20class=\x22network-info-grid\x22>'+'<div><strong>IP\x20Address:</strong>\x20<span\x20id=\x22user-ip\x22><span\x20class=\x22skeleton\x22></span></span></div>'+'<div><strong>Location:</strong>\x20<span\x20id=\x22user-location\x22><span\x20class=\x22skeleton\x22></span></span></div>'+'<div><strong>ISP:</strong>\x20<span\x20id=\x22user-isp\x22><span\x20class=\x22skeleton\x22></span></span></div>'+'<div><strong>Risk\x20Score:</strong>\x20<span\x20id=\x22user-risk\x22><span\x20class=\x22skeleton\x22></span></span></div>'+'</div>'+'</div>'+'</div>'+'</div>'+'<div\x20class=\x22info-grid\x22>'+'<div\x20class=\x22info-card\x20rainbow-border\x22>'+'<div\x20class=\x22info-card-content\x22>'+'<h2\x20class=\x22info-title\x22>Expiration\x20Date</h2>'+'<div\x20id=\x22expiration-relative\x22\x20class=\x22info-relative-time\x20'+p+'\x22>'+o+'</div>'+'<div\x20class=\x22info-time-grid\x22\x20id=\x22expiration-display\x22\x20data-utc-time=\x22'+k+'\x22>'+'<div><strong>Your\x20Local\x20Time:</strong>\x20<span\x20id=\x22local-time\x22>--</span></div>'+'<div><strong>Tehran\x20Time:</strong>\x20<span\x20id=\x22tehran-time\x22>--</span></div>'+'<div><strong>Universal\x20Time:</strong>\x20<span\x20id=\x22utc-time\x22>--</span></div>'+'</div>'+'</div>'+'</div>'+'<div\x20class=\x22info-card\x22>'+'<div\x20class=\x22info-card-content\x22>'+'<h2\x20class=\x22info-title\x22>Data\x20Usage</h2>'+'<div\x20class=\x22data-usage-text\x22\x20id=\x22data-usage-display\x22\x20data-usage=\x22'+e+'\x22\x20data-limit=\x22'+f+'\x22>'+'Loading...'+'</div>'+'<div\x20class=\x22traffic-bar-container\x22>'+'<div\x20class=\x22traffic-bar\x22\x20id=\x22traffic-bar-inner\x22\x20style=\x22width:\x20'+q+'%\x22></div>'+'</div>'+'</div>'+'</div>'+'</div>'+'<div\x20class=\x22config-card\x22>'+'<div\x20class=\x22config-title\x22><span>Xray\x20Subscription</span><button\x20id=\x22copy-xray-sub-btn\x22\x20class=\x22button\x22\x20data-clipboard-text=\x22'+g+'\x22>Copy\x20Link</button></div>'+'<div\x20class=\x22client-buttons\x22>'+'<a\x20href=\x22v2rayng://install-config?url='+encodeURIComponent(g)+'\x22\x20class=\x22client-btn\x22>V2rayNG\x20/\x20Universal</a>'+'<a\x20href=\x22shadowrocket://add/sub?url='+encodeURIComponent(g)+'&name='+encodeURIComponent(b)+'\x22\x20class=\x22client-btn\x22>Shadowrocket</a>'+'<a\x20href=\x22stash://install-config?url='+encodeURIComponent(g)+'\x22\x20class=\x22client-btn\x22>Stash\x20(VLESS)</a>'+'<button\x20class=\x22client-btn\x22\x20onclick=\x22toggleQR(\x27xray\x27,\x20\x27'+g+'\x27)\x22>Show\x20QR\x20Code</button>'+'</div>'+'<div\x20id=\x22qr-xray-container\x22\x20class=\x22qr-container\x22><div\x20id=\x22qr-xray\x22></div></div>'+'</div>'+'<div\x20class=\x22config-card\x22>'+'<div\x20class=\x22config-title\x22><span>Sing-Box\x20/\x20Clash\x20Subscription</span><button\x20id=\x22copy-sb-sub-btn\x22\x20class=\x22button\x22\x20data-clipboard-text=\x22'+h+'\x22>Copy\x20Link</button></div>'+'<div\x20class=\x22client-buttons\x22>'+'<a\x20href=\x22'+i+'\x22\x20class=\x22client-btn\x22>Clash\x20Meta\x20/\x20Stash\x20(Sing-Box)</a>'+'<button\x20class=\x22client-btn\x22\x20onclick=\x22toggleQR(\x27singbox\x27,\x20\x27'+h+'\x27)\x22>Show\x20QR\x20Code</button>'+'</div>'+'<div\x20id=\x22qr-singbox-container\x22\x20class=\x22qr-container\x22><div\x20id=\x22qr-singbox\x22></div></div>'+'</div>'+'</div>'+'<script>'+'function\x20copyToClipboard(button,\x20text)\x20{'+'const\x20originalText\x20=\x20button.textContent;'+'navigator.clipboard.writeText(text).then(()\x20=>\x20{'+'button.textContent\x20=\x20\x27Copied!\x27;'+'setTimeout(()\x20=>\x20{\x20button.textContent\x20=\x20originalText;\x20},\x201500);'+'});'+'}'+'function\x20toggleQR(id,\x20url)\x20{'+'const\x20container\x20=\x20document.getElementById(\x27qr-\x27\x20+\x20id\x20+\x20\x27-container\x27);'+'const\x20qrElement\x20=\x20document.getElementById(\x27qr-\x27\x20+\x20id);'+'if\x20(container.style.display\x20===\x20\x27none\x27\x20||\x20container.style.display\x20===\x20\x27\x27)\x20{'+'container.style.display\x20=\x20\x27block\x27;'+'if\x20(!qrElement.hasChildNodes())\x20{\x20new\x20QRCode(qrElement,\x20{\x20text:\x20url,\x20width:\x20256,\x20height:\x20256,\x20colorDark:\x20\x22#E0E0E0\x22,\x20colorLight:\x20\x22#1E1E1E\x22,\x20correctLevel:\x20QRCode.CorrectLevel.H\x20});\x20}'+'}\x20else\x20{\x20container.style.display\x20=\x20\x27none\x27;\x20}'+'}'+'function\x20displayExpirationTimes()\x20{'+'const\x20expElement\x20=\x20document.getElementById(\x27expiration-display\x27);'+'const\x20relativeElement\x20=\x20document.getElementById(\x27expiration-relative\x27);'+'if\x20(!expElement?.dataset.utcTime)\x20return;'+'const\x20utcDate\x20=\x20new\x20Date(expElement.dataset.utcTime);'+'if\x20(isNaN(utcDate.getTime()))\x20return;'+'const\x20diffSeconds\x20=\x20(utcDate.getTime()\x20-\x20new\x20Date().getTime())\x20/\x201000;'+'const\x20isExpired\x20=\x20diffSeconds\x20<\x200;'+'if\x20(relativeElement.textContent\x20===\x20\x22Checking...\x22)\x20{'+'if\x20(isExpired)\x20{'+'relativeElement.textContent\x20=\x20\x22Subscription\x20Expired\x22;'+'relativeElement.className\x20=\x20\x22info-relative-time\x20status-expired-text\x22;'+'}\x20else\x20{'+'const\x20rtf\x20=\x20new\x20Intl.RelativeTimeFormat(\x27en\x27,\x20{\x20numeric:\x20\x27auto\x27\x20});'+'let\x20relTime\x20=\x20\x27\x27;'+'if\x20(Math.abs(diffSeconds)\x20<\x203600)\x20relTime\x20=\x20rtf.format(Math.round(diffSeconds\x20/\x2060),\x20\x27minute\x27);'+'else\x20if\x20(Math.abs(diffSeconds)\x20<\x2086400)\x20relTime\x20=\x20rtf.format(Math.round(diffSeconds\x20/\x203600),\x20\x27hour\x27);'+'else\x20relTime\x20=\x20rtf.format(Math.round(diffSeconds\x20/\x2086400),\x20\x27day\x27);'+'relativeElement.textContent\x20=\x20\x27Expires\x20\x27\x20+\x20relTime;'+'relativeElement.className\x20=\x20\x22info-relative-time\x20status-active-text\x22;'+'}'+'}'+'document.getElementById(\x27local-time\x27).textContent\x20=\x20utcDate.toLocaleString(undefined,\x20{\x20timeZoneName:\x20\x27short\x27\x20});'+'document.getElementById(\x27tehran-time\x27).textContent\x20=\x20utcDate.toLocaleString(\x27en-US\x27,\x20{\x20timeZone:\x20\x27Asia/Tehran\x27,\x20hour12:\x20true,\x20year:\x20\x27numeric\x27,\x20month:\x20\x27short\x27,\x20day:\x20\x27numeric\x27,\x20hour:\x20\x27numeric\x27,\x20minute:\x20\x272-digit\x27\x20});'+'document.getElementById(\x27utc-time\x27).textContent\x20=\x20utcDate.toISOString().substring(0,\x2019).replace(\x27T\x27,\x20\x27\x20\x27)\x20+\x20\x27\x20UTC\x27;'+'}'+'function\x20displayDataUsage()\x20{'+'const\x20usageElement\x20=\x20document.getElementById(\x27data-usage-display\x27);'+'const\x20usage\x20=\x20parseInt(usageElement.dataset.usage,\x2010);'+'const\x20limit\x20=\x20parseInt(usageElement.dataset.limit,\x2010);'+'const\x20bytesToReadable\x20=\x20bytes\x20=>\x20{'+'if\x20(bytes\x20<=\x200)\x20return\x20\x270\x20Bytes\x27;'+'const\x20i\x20=\x20Math.floor(Math.log(bytes)\x20/\x20Math.log(1024));'+'return\x20parseFloat((bytes\x20/\x20Math.pow(1024,\x20i)).toFixed(2))\x20+\x20\x27\x20\x27\x20+\x20[\x27Bytes\x27,\x20\x27KB\x27,\x20\x27MB\x27,\x20\x27GB\x27,\x20\x27TB\x27][i];'+'};'+'const\x20limitText\x20=\x20limit\x20>\x200\x20?\x20bytesToReadable(limit)\x20:\x20\x27&infin;\x27;'+'usageElement.innerHTML\x20=\x20bytesToReadable(usage)\x20+\x20\x27\x20/\x20\x27\x20+\x20limitText;'+'if\x20(limit\x20>\x200\x20&&\x20usage\x20>=\x20limit)\x20{'+'document.getElementById(\x27traffic-bar-inner\x27).style.backgroundColor\x20=\x20\x27var(--status-expired)\x27;'+'const\x20relativeElement\x20=\x20document.getElementById(\x27expiration-relative\x27);'+'relativeElement.textContent\x20=\x20\x22Data\x20Limit\x20Reached\x22;'+'relativeElement.className\x20=\x20\x22info-relative-time\x20status-expired-text\x22;'+'}'+'}'+'async\x20function\x20fetchNetworkInfo()\x20{'+'try\x20{'+'const\x20response\x20=\x20await\x20fetch(\x27/network-info\x27);'+'const\x20data\x20=\x20await\x20response.json();'+'document.getElementById(\x27proxy-ip\x27).textContent\x20=\x20data.proxy?.ip\x20||\x20\x27N/A\x27;'+'document.getElementById(\x27proxy-location\x27).textContent\x20=\x20(data.proxy?.city\x20||\x20\x27\x27)\x20+\x20((data.proxy?.city\x20&&\x20data.proxy?.country)\x20?\x20\x27,\x20\x27\x20:\x20\x27\x27)\x20+\x20(data.proxy?.country\x20||\x20\x27N/A\x27);'+'document.getElementById(\x27proxy-isp\x27).textContent\x20=\x20data.proxy?.isp\x20||\x20\x27N/A\x27;'+'document.getElementById(\x27user-ip\x27).textContent\x20=\x20data.user?.ip\x20||\x20\x27N/A\x27;'+'document.getElementById(\x27user-location\x27).textContent\x20=\x20(data.user?.city\x20||\x20\x27\x27)\x20+\x20((data.user?.city\x20&&\x20data.user?.country)\x20?\x20\x27,\x20\x27\x20:\x20\x27\x27)\x20+\x20(data.user?.country\x20||\x20\x27N/A\x27);'+'document.getElementById(\x27user-isp\x27).textContent\x20=\x20data.user?.isp\x20||\x20\x27N/A\x27;'+'document.getElementById(\x27user-risk\x27).textContent\x20=\x20data.user?.risk\x20||\x20\x27N/A\x27;'+'}\x20catch\x20(error)\x20{'+'console.error(\x27Network\x20info\x20refresh\x20failed:\x27,\x20error);'+'document.getElementById(\x27proxy-ip\x27).textContent\x20=\x20\x27Error\x27;'+'document.getElementById(\x27user-ip\x27).textContent\x20=\x20\x27Error\x27;'+'}'+'}'+'document.addEventListener(\x27DOMContentLoaded\x27,\x20()\x20=>\x20{'+'displayExpirationTimes();'+'displayDataUsage();'+'fetchNetworkInfo();'+'document.getElementById(\x27refresh-network-btn\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20{'+'document.querySelectorAll(\x27.network-info-grid\x20span:not([id$=\x22-risk\x22])\x27).forEach(el\x20=>\x20el.innerHTML\x20=\x20\x27<span\x20class=\x22skeleton\x22></span>\x27);'+'document.getElementById(\x27user-risk\x27).innerHTML\x20=\x20\x27<span\x20class=\x22skeleton\x22></span>\x27;'+'fetchNetworkInfo();'+'});'+'document.querySelectorAll(\x27.button[data-clipboard-text]\x27).forEach(button\x20=>\x20{'+'button.addEventListener(\x27click\x27,\x20()\x20=>\x20copyToClipboard(button,\x20button.dataset.clipboardText));'+'});'+'setInterval(displayExpirationTimes,\x2060000);'+'});'+'</script>'+'</body></html>';return r;}