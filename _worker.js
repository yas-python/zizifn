// <!--GAMFC--> version base on commit 1927347c031f0e6bfcba818518b9a21453d275ac, time is 2025-10-19 11:09:27 UTC<!--We are all REvil-->
// @ts-ignore

import{connect}from'cloudflare:sockets';const CONST={'VLESS_VERSION':0x0,'WS_READY_STATE':{'OPEN':0x1,'CLOSING':0x2},'CUSTOM_ADMIN_PATH_HEADER':'X-Custom-Admin-Path','ED_PARAMS':{'ed':0xa00,'eh':'Sec-WebSocket-Protocol'}},Config={'defaultUserID':'d342d11e-d424-4583-b36e-524ab1f0afa4','proxyIPs':['nima.nscl.ir:443'],'fromEnv'(a){const b=(a['ADMIN_PATH']||'/admin')['replace'](/^\//,''),c=a['PROXYIP']||this['proxyIPs'][Math['floor'](Math['random']()*this['proxyIPs']['length'])],[d,f='443']=c['split'](':');let g=null,h=Boolean(a['SOCKS5']),i=a['SOCKS5_RELAY']==='true';if(h)try{g=socks5AddressParser(a['SOCKS5']);}catch(j){console['error']('Invalid\x20SOCKS5\x20address\x20format:',j['message']),h=![];}return{'userID':a['UUID']||this['defaultUserID'],'adminPath':'/'+b,'proxyIP':d,'proxyPort':f,'proxyAddress':c,'scamalytics':{'apiKey':a['SCAMALYTICS_API_KEY']||null,'baseUrl':'https://api12.scamalytics.com/v3/'},'enableSocks':h,'socks5Relay':i,'parsedSocks5Address':g,'rootProxyURL':a['ROOT_PROXY_URL']||null};}};function generateUUID(){return crypto['randomUUID']();}function isValidUUID(a){if(typeof a!=='string')return![];const b=/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i;return b['test'](a);}function isExpired(a,b){if(!a||!b)return!![];const c=new Date(a+'T'+b+'Z');return c<=new Date();}function hasRemainingData(a,b=0x0){const c=Number(a?.['data_limit']??0x0);if(c<=0x0)return!![];return Number(a?.['data_usage']??0x0)+b<c;}async function getUserData(a,b){if(!isValidUUID(b))return null;const c='user:'+b;try{const f=await a['USER_KV']['get'](c,'json');if(f&&f['uuid'])return f;}catch(g){console['error']('Failed\x20to\x20parse\x20cached\x20user\x20data\x20for\x20'+b+':',g);}const d=await a['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](b)['first']();if(!d)return null;return await a['USER_KV']['put'](c,JSON['stringify'](d),{'expirationTtl':0xe10}),d;}async function updateUserUsage(a,b,c){if(!b||c<=0x0)return;await a['DB']['prepare']('UPDATE\x20users\x20SET\x20data_usage\x20=\x20data_usage\x20+\x20?\x20WHERE\x20uuid\x20=\x20?')['bind'](Math['round'](c),b)['run'](),await a['USER_KV']['delete']('user:'+b);}function safeCloseWebSocket(a){if(a&&a['readyState']===CONST['WS_READY_STATE']['OPEN'])try{a['close'](0x3e8,'Normal\x20Closure');}catch(b){console['log']('Error\x20closing\x20WebSocket:',b['message']);}}function unsafeStringify(a){return Array['from'](a)['map'](c=>c['toString'](0x10)['padStart'](0x2,'0'))['join']('');}const adminLoginHTML='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22><meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20\x20\x20<title>Admin\x20Login</title>\x0a\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20display:\x20flex;\x20justify-content:\x20center;\x20align-items:\x20center;\x20height:\x20100vh;\x20margin:\x200;\x20background-color:\x20#111827;\x20font-family:\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20Helvetica,\x20Arial,\x20sans-serif;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.login-container\x20{\x20background-color:\x20#1F2937;\x20padding:\x2040px;\x20border-radius:\x2012px;\x20box-shadow:\x200\x204px\x2020px\x20rgba(0,\x200,\x200,\x200.5);\x20text-align:\x20center;\x20width:\x20320px;\x20border:\x201px\x20solid\x20#374151;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20h1\x20{\x20color:\x20#F9FAFB;\x20margin-bottom:\x2024px;\x20font-weight:\x20500;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20form\x20{\x20display:\x20flex;\x20flex-direction:\x20column;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20input[type=\x22password\x22]\x20{\x20background-color:\x20#374151;\x20border:\x201px\x20solid\x20#4B5563;\x20color:\x20#F9FAFB;\x20padding:\x2012px;\x20border-radius:\x208px;\x20margin-bottom:\x2020px;\x20font-size:\x2016px;\x20transition:\x20border-color\x200.2s,\x20box-shadow\x200.2s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20input[type=\x22password\x22]:focus\x20{\x20outline:\x20none;\x20border-color:\x20#3B82F6;\x20box-shadow:\x200\x200\x200\x203px\x20rgba(59,\x20130,\x20246,\x200.3);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20button\x20{\x20background-color:\x20#3B82F6;\x20color:\x20white;\x20border:\x20none;\x20padding:\x2012px;\x20border-radius:\x208px;\x20font-size:\x2016px;\x20font-weight:\x20600;\x20cursor:\x20pointer;\x20transition:\x20background-color\x200.2s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20button:hover\x20{\x20background-color:\x20#2563EB;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.error\x20{\x20color:\x20#EF4444;\x20margin-top:\x2015px;\x20font-size:\x2014px;\x20}\x0a\x20\x20\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20\x20\x20<div\x20class=\x22login-container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<h1>Admin\x20Login</h1>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<form\x20method=\x22POST\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22password\x22\x20name=\x22password\x22\x20placeholder=\x22••••••••••••••\x22\x20required>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22submit\x22>Login</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20</div>\x0a</body>\x0a</html>',adminPanelHTML='<!DOCTYPE\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a\x20\x20\x20\x20<meta\x20charset=\x22UTF-8\x22>\x0a\x20\x20\x20\x20<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22>\x0a\x20\x20\x20\x20<title>Admin\x20Dashboard</title>\x0a\x20\x20\x20\x20<style>\x0a\x20\x20\x20\x20\x20\x20\x20\x20:root\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--bg-main:\x20#0c0a09;\x20--bg-card:\x20#1c1917;\x20--bg-input:\x20#292524;\x20--border:\x20#44403c;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--text-primary:\x20#f5f5f4;\x20--text-secondary:\x20#a8a29e;\x20--accent:\x20#fb923c;\x20--accent-hover:\x20#f97316;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--danger:\x20#ef4444;\x20--danger-hover:\x20#dc2626;\x20--success:\x20#4ade80;\x20--expired:\x20#facc15;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20--btn-secondary-bg:\x20#57534e;\x20--btn-secondary-hover:\x20#78716c;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20body\x20{\x20margin:\x200;\x20font-family:\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Roboto,\x20sans-serif;\x20background-color:\x20var(--bg-main);\x20color:\x20var(--text-primary);\x20font-size:\x2014px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20max-width:\x201280px;\x20margin:\x2030px\x20auto;\x20padding:\x200\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.card\x20{\x20background-color:\x20var(--bg-card);\x20border-radius:\x2012px;\x20padding:\x2024px;\x20border:\x201px\x20solid\x20var(--border);\x20box-shadow:\x200\x204px\x2012px\x20rgba(0,0,0,0.3);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stats-grid\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(200px,\x201fr));\x20gap:\x2020px;\x20margin-bottom:\x2030px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stat-card\x20{\x20background-color:\x20var(--bg-card);\x20border-radius:\x2012px;\x20padding:\x2020px;\x20border:\x201px\x20solid\x20var(--border);\x20transition:\x20transform\x200.2s,\x20box-shadow\x200.2s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stat-card:hover\x20{\x20transform:\x20translateY(-5px);\x20box-shadow:\x200\x208px\x2016px\x20rgba(0,0,0,0.4);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stat-title\x20{\x20font-size:\x2014px;\x20color:\x20var(--text-secondary);\x20margin:\x200\x200\x2010px\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.stat-value\x20{\x20font-size:\x2028px;\x20font-weight:\x20600;\x20margin:\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-grid\x20{\x20display:\x20grid;\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(180px,\x201fr));\x20gap:\x2016px;\x20align-items:\x20flex-end;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-group\x20{\x20display:\x20flex;\x20flex-direction:\x20column;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20label\x20{\x20margin-bottom:\x208px;\x20font-weight:\x20500;\x20color:\x20var(--text-secondary);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20{\x20display:\x20flex;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20input,\x20select\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20100%;\x20box-sizing:\x20border-box;\x20background-color:\x20var(--bg-input);\x20border:\x201px\x20solid\x20var(--border);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20color:\x20var(--text-primary);\x20padding:\x2010px;\x20border-radius:\x206px;\x20font-size:\x2014px;\x20transition:\x20border-color\x200.2s,\x20box-shadow\x200.2s;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20input:focus,\x20select:focus\x20{\x20outline:\x20none;\x20border-color:\x20var(--accent);\x20box-shadow:\x200\x200\x200\x203px\x20rgba(251,\x20146,\x2060,\x200.3);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn\x20{\x20padding:\x2010px\x2016px;\x20border:\x20none;\x20border-radius:\x206px;\x20font-weight:\x20600;\x20cursor:\x20pointer;\x20transition:\x20all\x200.2s;\x20display:\x20inline-flex;\x20align-items:\x20center;\x20justify-content:\x20center;\x20gap:\x208px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn:active\x20{\x20transform:\x20scale(0.97);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-primary\x20{\x20background-color:\x20var(--accent);\x20color:\x20var(--bg-main);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-primary:hover\x20{\x20background-color:\x20var(--accent-hover);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-danger\x20{\x20background-color:\x20var(--danger);\x20color:\x20white;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-danger:hover\x20{\x20background-color:\x20var(--danger-hover);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-secondary\x20{\x20background-color:\x20var(--btn-secondary-bg);\x20color:\x20white;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.btn-secondary:hover\x20{\x20background-color:\x20var(--btn-secondary-hover);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20button\x20{\x20border-top-left-radius:\x200;\x20border-bottom-left-radius:\x200;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20input,\x20.input-group\x20select\x20{\x20border-radius:\x200;\x20border-right:\x20none;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20input:first-child,\x20.input-group\x20select:first-child\x20{\x20border-top-left-radius:\x206px;\x20border-bottom-left-radius:\x206px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.input-group\x20button:last-child\x20{\x20border-top-right-radius:\x206px;\x20border-bottom-right-radius:\x206px;\x20border-right:\x201px\x20solid\x20var(--border);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20table\x20{\x20width:\x20100%;\x20border-collapse:\x20collapse;\x20margin-top:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20th,\x20td\x20{\x20padding:\x2012px\x2016px;\x20text-align:\x20left;\x20border-bottom:\x201px\x20solid\x20var(--border);\x20white-space:\x20nowrap;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20th\x20{\x20color:\x20var(--text-secondary);\x20font-weight:\x20600;\x20font-size:\x2012px;\x20text-transform:\x20uppercase;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-badge\x20{\x20padding:\x204px\x2010px;\x20border-radius:\x2012px;\x20font-size:\x2012px;\x20font-weight:\x20600;\x20display:\x20inline-block;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-active\x20{\x20background-color:\x20rgba(74,\x20222,\x20128,\x200.2);\x20color:\x20var(--success);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.status-expired\x20{\x20background-color:\x20rgba(250,\x20204,\x2021,\x200.2);\x20color:\x20var(--expired);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.actions-cell\x20{\x20display:\x20flex;\x20gap:\x208px;\x20justify-content:\x20flex-start;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20#toast\x20{\x20position:\x20fixed;\x20bottom:\x2020px;\x20left:\x2050%;\x20transform:\x20translateX(-50%);\x20background-color:\x20var(--bg-card);\x20color:\x20white;\x20padding:\x2015px\x2025px;\x20border-radius:\x208px;\x20z-index:\x201001;\x20display:\x20none;\x20border:\x201px\x20solid\x20var(--border);\x20box-shadow:\x200\x204px\x2012px\x20rgba(0,\x200,\x200,\x200.3);\x20opacity:\x200;\x20transition:\x20all\x200.3s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20#toast.show\x20{\x20display:\x20block;\x20opacity:\x201;\x20transform:\x20translate(-50%,\x20-10px);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-overlay\x20{\x20position:\x20fixed;\x20top:\x200;\x20left:\x200;\x20width:\x20100%;\x20height:\x20100%;\x20background-color:\x20rgba(0,\x200,\x200,\x200.7);\x20z-index:\x201000;\x20display:\x20flex;\x20justify-content:\x20center;\x20align-items:\x20center;\x20opacity:\x200;\x20visibility:\x20hidden;\x20transition:\x20opacity\x200.3s,\x20visibility\x200.3s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-overlay.show\x20{\x20opacity:\x201;\x20visibility:\x20visible;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-content\x20{\x20background-color:\x20var(--bg-card);\x20padding:\x2030px;\x20border-radius:\x2012px;\x20width:\x2090%;\x20max-width:\x20550px;\x20transform:\x20scale(0.9);\x20transition:\x20transform\x200.3s;\x20border:\x201px\x20solid\x20var(--border);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-overlay.show\x20.modal-content\x20{\x20transform:\x20scale(1);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-header\x20{\x20display:\x20flex;\x20justify-content:\x20space-between;\x20align-items:\x20center;\x20padding-bottom:\x2015px;\x20margin-bottom:\x2020px;\x20border-bottom:\x201px\x20solid\x20var(--border);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-header\x20h2\x20{\x20margin:\x200;\x20font-size:\x2020px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-close-btn\x20{\x20background:\x20none;\x20border:\x20none;\x20color:\x20var(--text-secondary);\x20font-size:\x2024px;\x20cursor:\x20pointer;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.modal-footer\x20{\x20display:\x20flex;\x20justify-content:\x20flex-end;\x20gap:\x2012px;\x20margin-top:\x2025px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.traffic-bar\x20{\x20width:\x20100%;\x20background-color:\x20var(--bg-input);\x20border-radius:\x204px;\x20height:\x206px;\x20overflow:\x20hidden;\x20margin-top:\x204px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.traffic-bar-inner\x20{\x20height:\x20100%;\x20background-color:\x20var(--accent);\x20border-radius:\x204px;\x20transition:\x20width\x200.5s;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-check\x20{\x20display:\x20flex;\x20align-items:\x20center;\x20margin-top:\x2010px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20.form-check\x20input\x20{\x20width:\x20auto;\x20margin-right:\x208px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20@media\x20(max-width:\x20768px)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.container\x20{\x20padding:\x200\x2010px;\x20margin-top:\x2015px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.stats-grid\x20{\x20grid-template-columns:\x201fr\x201fr;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20.user-list-wrapper\x20{\x20overflow-x:\x20auto;\x20-webkit-overflow-scrolling:\x20touch;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20table\x20{\x20min-width:\x20900px;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20</style>\x0a</head>\x0a<body>\x0a\x20\x20\x20\x20<div\x20class=\x22container\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20id=\x22stats\x22\x20class=\x22stats-grid\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2>Create\x20User</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<form\x20id=\x22createUserForm\x22\x20class=\x22form-grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22hidden\x22\x20id=\x22csrf_token\x22\x20name=\x22csrf_token\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22\x20style=\x22grid-column:\x201\x20/\x20-1;\x22><label\x20for=\x22uuid\x22>UUID</label><div\x20class=\x22input-group\x22><input\x20type=\x22text\x22\x20id=\x22uuid\x22\x20required><button\x20type=\x22button\x22\x20id=\x22generateUUID\x22\x20class=\x22btn\x20btn-secondary\x22>Generate</button></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22expiryDate\x22>Expiry\x20Date</label><input\x20type=\x22date\x22\x20id=\x22expiryDate\x22\x20required></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22expiryTime\x22>Expiry\x20Time\x20(Your\x20Local\x20Time)</label><input\x20type=\x22time\x22\x20id=\x22expiryTime\x22\x20step=\x221\x22\x20required></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22dataLimit\x22>Data\x20Limit</label><div\x20class=\x22input-group\x22><input\x20type=\x22number\x22\x20id=\x22dataLimitValue\x22\x20placeholder=\x22e.g.,\x2010\x22><select\x20id=\x22dataLimitUnit\x22><option\x20value=\x22GB\x22>GB</option><option\x20value=\x22MB\x22>MB</option></select><button\x20type=\x22button\x22\x20id=\x22unlimitedBtn\x22\x20class=\x22btn\x20btn-secondary\x22>Unlimited</button></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22ipLimit\x22>IP\x20Limit</label><input\x20type=\x22number\x22\x20id=\x22ipLimit\x22\x20value=\x222\x22\x20placeholder=\x22e.g.,\x202\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22notes\x22>Notes</label><input\x20type=\x22text\x22\x20id=\x22notes\x22\x20placeholder=\x22(Optional)\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22\x20style=\x22grid-column:\x201\x20/\x20-1;\x20align-items:\x20flex-start;\x20margin-top:\x2010px;\x22><button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-primary\x22>Create\x20User</button></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22card\x22\x20style=\x22margin-top:\x2030px;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<h2>User\x20List</h2>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22user-list-wrapper\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<table>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<thead><tr><th>UUID</th><th>Created</th><th>Expiry</th><th>Status</th><th>Traffic</th><th>IP\x20Limit</th><th>Notes</th><th>Actions</th></tr></thead>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tbody\x20id=\x22userList\x22></tbody>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</table>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20<div\x20id=\x22toast\x22></div>\x0a\x0a\x20\x20\x20\x20<div\x20id=\x22editModal\x22\x20class=\x22modal-overlay\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-content\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-header\x22><h2>Edit\x20User</h2><button\x20id=\x22modalCloseBtn\x22\x20class=\x22modal-close-btn\x22>&times;</button></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<form\x20id=\x22editUserForm\x22\x20class=\x22form-grid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<input\x20type=\x22hidden\x22\x20id=\x22editUuid\x22\x20name=\x22uuid\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22editExpiryDate\x22>Expiry\x20Date</label><input\x20type=\x22date\x22\x20id=\x22editExpiryDate\x22\x20name=\x22exp_date\x22\x20required></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22editExpiryTime\x22>Expiry\x20Time\x20(Your\x20Local\x20Time)</label><input\x20type=\x22time\x22\x20id=\x22editExpiryTime\x22\x20name=\x22exp_time\x22\x20step=\x221\x22\x20required></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22editDataLimit\x22>Data\x20Limit</label><div\x20class=\x22input-group\x22><input\x20type=\x22number\x22\x20id=\x22editDataLimitValue\x22\x20placeholder=\x22e.g.,\x2010\x22><select\x20id=\x22editDataLimitUnit\x22><option\x20value=\x22GB\x22>GB</option><option\x20value=\x22MB\x22>MB</option></select><button\x20type=\x22button\x22\x20id=\x22editUnlimitedBtn\x22\x20class=\x22btn\x20btn-secondary\x22>Unlimited</button></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22><label\x20for=\x22editIpLimit\x22>IP\x20Limit</label><input\x20type=\x22number\x22\x20id=\x22editIpLimit\x22\x20placeholder=\x22e.g.,\x202\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x22\x20style=\x22grid-column:\x201\x20/\x20-1;\x22><label\x20for=\x22editNotes\x22>Notes</label><input\x20type=\x22text\x22\x20id=\x22editNotes\x22\x20name=\x22notes\x22\x20placeholder=\x22(Optional)\x22></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22form-group\x20form-check\x22\x20style=\x22grid-column:\x201\x20/\x20-1;\x22><input\x20type=\x22checkbox\x22\x20id=\x22resetTraffic\x22><label\x20for=\x22resetTraffic\x22>Reset\x20Traffic\x20Usage</label></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22modal-footer\x22\x20style=\x22grid-column:\x201\x20/\x20-1;\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22button\x22\x20id=\x22modalCancelBtn\x22\x20class=\x22btn\x20btn-secondary\x22>Cancel</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20type=\x22submit\x22\x20class=\x22btn\x20btn-primary\x22>Save\x20Changes</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</form>\x0a\x20\x20\x20\x20\x20\x20\x20\x20</div>\x0a\x20\x20\x20\x20</div>\x0a\x0a\x20\x20\x20\x20<script>\x0a\x20\x20\x20\x20\x20\x20\x20\x20document.addEventListener(\x27DOMContentLoaded\x27,\x20()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20adminPath\x20=\x20document.body.getAttribute(\x27data-admin-path\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20API_BASE\x20=\x20`${adminPath}/api`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20csrfTokenEl\x20=\x20document.getElementById(\x27csrf_token\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20csrfToken\x20=\x20csrfTokenEl\x20?\x20csrfTokenEl.value\x20:\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20apiHeaders\x20=\x20{\x20\x27Content-Type\x27:\x20\x27application/json\x27,\x20\x27X-CSRF-Token\x27:\x20csrfToken\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20api\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20get:\x20(endpoint)\x20=>\x20fetch(`${API_BASE}${endpoint}`).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20post:\x20(endpoint,\x20body)\x20=>\x20fetch(`${API_BASE}${endpoint}`,\x20{\x20method:\x20\x27POST\x27,\x20headers:\x20apiHeaders,\x20body:\x20JSON.stringify(body)\x20}).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20put:\x20(endpoint,\x20body)\x20=>\x20fetch(`${API_BASE}${endpoint}`,\x20{\x20method:\x20\x27PUT\x27,\x20headers:\x20apiHeaders,\x20body:\x20JSON.stringify(body)\x20}).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20delete:\x20(endpoint)\x20=>\x20fetch(`${API_BASE}${endpoint}`,\x20{\x20method:\x20\x27DELETE\x27,\x20headers:\x20apiHeaders\x20}).then(handleResponse),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20handleResponse(response)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(response.status\x20===\x20403)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27Session\x20expired\x20or\x20invalid.\x20Please\x20refresh\x20and\x20log\x20in\x20again.\x27,\x20true);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20throw\x20new\x20Error(\x27Forbidden:\x20Invalid\x20session\x20or\x20CSRF\x20token.\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!response.ok)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20errorData\x20=\x20await\x20response.json().catch(()\x20=>\x20({\x20error:\x20\x27An\x20unknown\x20error\x20occurred.\x27\x20}));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20throw\x20new\x20Error(errorData.error\x20||\x20`Request\x20failed\x20with\x20status\x20${response.status}`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20response.status\x20===\x20204\x20?\x20null\x20:\x20response.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20showToast(message,\x20isError\x20=\x20false)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20toast\x20=\x20document.getElementById(\x27toast\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20toast.textContent\x20=\x20message;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20toast.style.backgroundColor\x20=\x20isError\x20?\x20\x27var(--danger)\x27\x20:\x20\x27var(--success)\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20toast.classList.add(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setTimeout(()\x20=>\x20{\x20toast.classList.remove(\x27show\x27);\x20},\x203000);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20pad\x20=\x20num\x20=>\x20num.toString().padStart(2,\x20\x270\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20localToUTC\x20=\x20(d,\x20t)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!d\x20||\x20!t)\x20return\x20{\x20utcDate:\x20\x27\x27,\x20utcTime:\x20\x27\x27\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20dt\x20=\x20new\x20Date(`${d}T${t}`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(isNaN(dt))\x20return\x20{\x20utcDate:\x20\x27\x27,\x20utcTime:\x20\x27\x27\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20{\x20utcDate:\x20`${dt.getUTCFullYear()}-${pad(dt.getUTCMonth()\x20+\x201)}-${pad(dt.getUTCDate())}`,\x20utcTime:\x20`${pad(dt.getUTCHours())}:${pad(dt.getUTCMinutes())}:${pad(dt.getUTCSeconds())}`\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20utcToLocal\x20=\x20(d,\x20t)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!d\x20||\x20!t)\x20return\x20{\x20localDate:\x20\x27\x27,\x20localTime:\x20\x27\x27\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20dt\x20=\x20new\x20Date(`${d}T${t}Z`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(isNaN(dt))\x20return\x20{\x20localDate:\x20\x27\x27,\x20localTime:\x20\x27\x27\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20{\x20localDate:\x20`${dt.getFullYear()}-${pad(dt.getMonth()\x20+\x201)}-${pad(dt.getDate())}`,\x20localTime:\x20`${pad(dt.getHours())}:${pad(dt.getMinutes())}:${pad(dt.getSeconds())}`\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20bytesToReadable(bytes)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(bytes\x20<=\x200)\x20return\x20\x270\x20Bytes\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20i\x20=\x20Math.floor(Math.log(bytes)\x20/\x20Math.log(1024));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20`${parseFloat((bytes\x20/\x20Math.pow(1024,\x20i)).toFixed(2))}\x20${[\x27Bytes\x27,\x20\x27KB\x27,\x20\x27MB\x27,\x20\x27GB\x27,\x20\x27TB\x27][i]}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20renderStats(stats)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20statsContainer\x20=\x20document.getElementById(\x27stats\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20statsContainer.innerHTML\x20=\x20`\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><h3\x20class=\x22stat-title\x22>Total\x20Users</h3><p\x20class=\x22stat-value\x22>${stats.totalUsers}</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><h3\x20class=\x22stat-title\x22>Active\x20Users</h3><p\x20class=\x22stat-value\x22>${stats.activeUsers}</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><h3\x20class=\x22stat-title\x22>Expired\x20Users</h3><p\x20class=\x22stat-value\x22>${stats.expiredUsers}</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22stat-card\x22><h3\x20class=\x22stat-title\x22>Total\x20Traffic</h3><p\x20class=\x22stat-value\x22>${bytesToReadable(stats.totalTraffic)}</p></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20function\x20renderUsers(users)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20userList\x20=\x20document.getElementById(\x27userList\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20userList.innerHTML\x20=\x20users.length\x20===\x200\x20?\x20\x27<tr><td\x20colspan=\x228\x22\x20style=\x22text-align:center;\x22>No\x20users\x20found.</td></tr>\x27\x20:\x20users.map(user\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20expiryUTC\x20=\x20new\x20Date(`${user.expiration_date}T${user.expiration_time}Z`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20isUserExpired\x20=\x20expiryUTC\x20<\x20new\x20Date();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20trafficUsage\x20=\x20user.data_limit\x20>\x200\x20?\x20`${bytesToReadable(user.data_usage)}\x20/\x20${bytesToReadable(user.data_limit)}`\x20:\x20`${bytesToReadable(user.data_usage)}\x20/\x20&infin;`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20trafficPercent\x20=\x20user.data_limit\x20>\x200\x20?\x20Math.min(100,\x20(user.data_usage\x20/\x20user.data_limit\x20*\x20100))\x20:\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20`\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<tr\x20data-uuid=\x22${user.uuid}\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20title=\x22${user.uuid}\x22>${user.uuid.substring(0,\x208)}...</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${new\x20Date(user.created_at).toLocaleString()}</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${expiryUTC.toLocaleString()}</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td><span\x20class=\x22status-badge\x20${isUserExpired\x20?\x20\x27status-expired\x27\x20:\x20\x27status-active\x27}\x22>${isUserExpired\x20?\x20\x27Expired\x27\x20:\x20\x27Active\x27}</span></td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20${trafficUsage}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<div\x20class=\x22traffic-bar\x22><div\x20class=\x22traffic-bar-inner\x22\x20style=\x22width:\x20${trafficPercent}%;\x22></div></div>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${user.ip_limit\x20>\x200\x20?\x20user.ip_limit\x20:\x20\x27Unlimited\x27}</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td>${user.notes\x20||\x20\x27-\x27}</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<td\x20class=\x22actions-cell\x22>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-secondary\x20btn-edit\x22>Edit</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20<button\x20class=\x22btn\x20btn-danger\x20btn-delete\x22>Delete</button>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</td>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20</tr>\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}).join(\x27\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20async\x20function\x20refreshData()\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20[stats,\x20users]\x20=\x20await\x20Promise.all([api.get(\x27/stats\x27),\x20api.get(\x27/users\x27)]);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20window.allUsers\x20=\x20users;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20renderStats(stats);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20renderUsers(users);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x20showToast(error.message,\x20true);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20getLimitInBytes\x20=\x20(valueId,\x20unitId)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20value\x20=\x20parseFloat(document.getElementById(valueId).value);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20unit\x20=\x20document.getElementById(unitId).value;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(isNaN(value)\x20||\x20value\x20<=\x200)\x20return\x200;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20multiplier\x20=\x20unit\x20===\x20\x27GB\x27\x20?\x201024\x20*\x201024\x20*\x201024\x20:\x201024\x20*\x201024;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20return\x20Math.round(value\x20*\x20multiplier);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20setLimitFromBytes\x20=\x20(bytes,\x20valueId,\x20unitId)\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20valueEl\x20=\x20document.getElementById(valueId);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20unitEl\x20=\x20document.getElementById(unitId);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(bytes\x20<=\x200)\x20{\x20valueEl.value\x20=\x20\x27\x27;\x20unitEl.value\x20=\x20\x27GB\x27;\x20return;\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20isGB\x20=\x20bytes\x20>=\x201024\x20*\x201024\x20*\x201024;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20unit\x20=\x20isGB\x20?\x20\x27GB\x27\x20:\x20\x27MB\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20divisor\x20=\x20isGB\x20?\x201024\x20*\x201024\x20*\x201024\x20:\x201024\x20*\x201024;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20valueEl.value\x20=\x20parseFloat((bytes\x20/\x20divisor).toFixed(2));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20unitEl.value\x20=\x20unit;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27createUserForm\x27).addEventListener(\x27submit\x27,\x20async\x20e\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20{\x20utcDate,\x20utcTime\x20}\x20=\x20localToUTC(document.getElementById(\x27expiryDate\x27).value,\x20document.getElementById(\x27expiryTime\x27).value);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20userData\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20uuid:\x20document.getElementById(\x27uuid\x27).value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20exp_date:\x20utcDate,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20exp_time:\x20utcTime,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data_limit:\x20getLimitInBytes(\x27dataLimitValue\x27,\x20\x27dataLimitUnit\x27),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ip_limit:\x20parseInt(document.getElementById(\x27ipLimit\x27).value,\x2010)\x20||\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20notes:\x20document.getElementById(\x27notes\x27).value\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20api.post(\x27/users\x27,\x20userData);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20created\x20successfully!\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20e.target.reset();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27uuid\x27).value\x20=\x20crypto.randomUUID();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setDefaultExpiry();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20refreshData();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x20showToast(error.message,\x20true);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20editModal\x20=\x20document.getElementById(\x27editModal\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27userList\x27).addEventListener(\x27click\x27,\x20e\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20button\x20=\x20e.target.closest(\x27button\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!button)\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20uuid\x20=\x20e.target.closest(\x27tr\x27).dataset.uuid;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(button.classList.contains(\x27btn-edit\x27))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20user\x20=\x20window.allUsers.find(u\x20=>\x20u.uuid\x20===\x20uuid);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(!user)\x20return;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20{\x20localDate,\x20localTime\x20}\x20=\x20utcToLocal(user.expiration_date,\x20user.expiration_time);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editUuid\x27).value\x20=\x20user.uuid;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editExpiryDate\x27).value\x20=\x20localDate;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editExpiryTime\x27).value\x20=\x20localTime;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setLimitFromBytes(user.data_limit,\x20\x27editDataLimitValue\x27,\x20\x27editDataLimitUnit\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editIpLimit\x27).value\x20=\x20user.ip_limit;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editNotes\x27).value\x20=\x20user.notes\x20||\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27resetTraffic\x27).checked\x20=\x20false;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20editModal.classList.add(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20else\x20if\x20(button.classList.contains(\x27btn-delete\x27))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(confirm(`Are\x20you\x20sure\x20you\x20want\x20to\x20delete\x20user\x20${uuid.substring(0,8)}...?`))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20api.delete(`/users/${uuid}`).then(()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20deleted\x20successfully!\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20refreshData();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}).catch(err\x20=>\x20showToast(err.message,\x20true));\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editUserForm\x27).addEventListener(\x27submit\x27,\x20async\x20e\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20e.preventDefault();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20uuid\x20=\x20document.getElementById(\x27editUuid\x27).value;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20{\x20utcDate,\x20utcTime\x20}\x20=\x20localToUTC(document.getElementById(\x27editExpiryDate\x27).value,\x20document.getElementById(\x27editExpiryTime\x27).value);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20updatedData\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20exp_date:\x20utcDate,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20exp_time:\x20utcTime,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20data_limit:\x20getLimitInBytes(\x27editDataLimitValue\x27,\x20\x27editDataLimitUnit\x27),\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20ip_limit:\x20parseInt(document.getElementById(\x27editIpLimit\x27).value,\x2010)\x20||\x200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20notes:\x20document.getElementById(\x27editNotes\x27).value,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20reset_traffic:\x20document.getElementById(\x27resetTraffic\x27).checked,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20await\x20api.put(`/users/${uuid}`,\x20updatedData);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20showToast(\x27User\x20updated\x20successfully!\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20editModal.classList.remove(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20refreshData();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(error)\x20{\x20showToast(error.message,\x20true);\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20Modal\x20close\x20events\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20closeModal\x20=\x20()\x20=>\x20editModal.classList.remove(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27modalCloseBtn\x27).addEventListener(\x27click\x27,\x20closeModal);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27modalCancelBtn\x27).addEventListener(\x27click\x27,\x20closeModal);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20editModal.addEventListener(\x27click\x27,\x20e\x20=>\x20{\x20if\x20(e.target\x20===\x20editModal)\x20closeModal();\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.addEventListener(\x27keydown\x27,\x20e\x20=>\x20{\x20if\x20(e.key\x20===\x20\x22Escape\x22)\x20closeModal();\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20Form\x20helpers\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27generateUUID\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20document.getElementById(\x27uuid\x27).value\x20=\x20crypto.randomUUID());\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27unlimitedBtn\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20{\x20document.getElementById(\x27dataLimitValue\x27).value\x20=\x20\x27\x27;\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27editUnlimitedBtn\x27).addEventListener(\x27click\x27,\x20()\x20=>\x20{\x20document.getElementById(\x27editDataLimitValue\x27).value\x20=\x20\x27\x27;\x20});\x0a\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20setDefaultExpiry\x20=\x20()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20now\x20=\x20new\x20Date();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20now.setMonth(now.getMonth()\x20+\x201);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27expiryDate\x27).value\x20=\x20`${now.getFullYear()}-${pad(now.getMonth()\x20+\x201)}-${pad(now.getDate())}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27expiryTime\x27).value\x20=\x20`${pad(now.getHours())}:${pad(now.getMinutes())}:${pad(now.getSeconds())}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20};\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20//\x20Initial\x20load\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20document.getElementById(\x27uuid\x27).value\x20=\x20crypto.randomUUID();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20setDefaultExpiry();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20refreshData();\x0a\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20</script>\x0a</body>\x0a</html>';async function checkAdminAuth(a,b){const c=Config['fromEnv'](b)['adminPath'],d=a['headers']['get']('Cookie'),e=d?.['match'](/auth_token=([^;]+)/)?.[0x1];if(!e)return{'isAdmin':![],'errorResponse':null,'csrfToken':null};const f=await b['USER_KV']['get']('admin_session:'+e,'json');if(!f){const h=new Headers({'Set-Cookie':'auth_token=;\x20Path='+c+';\x20Expires=Thu,\x2001\x20Jan\x201970\x2000:00:00\x20GMT'});return{'isAdmin':![],'errorResponse':new Response(null,{'status':0x193,'headers':h}),'csrfToken':null};}await b['USER_KV']['put']('admin_session:'+e,JSON['stringify'](f),{'expirationTtl':0x15180});const {csrfToken:g}=f;if(['POST','PUT','DELETE']['includes'](a['method'])){const i=a['headers']['get']('X-CSRF-Token');if(!i||i!==g){const j=new Response(JSON['stringify']({'error':'Invalid\x20CSRF\x20token\x20or\x20session\x20expired.'}),{'status':0x193,'headers':{'Content-Type':'application/json'}});return{'isAdmin':![],'errorResponse':j,'csrfToken':null};}}return{'isAdmin':!![],'errorResponse':null,'csrfToken':g};}async function handleAdminRequest(a,b){const c=new URL(a['url']),d=Config['fromEnv'](b),{pathname:f}=c,g={'Content-Type':'application/json'};if(!b['ADMIN_KEY'])return new Response('Admin\x20panel\x20is\x20not\x20configured.\x20Please\x20set\x20ADMIN_KEY\x20secret.',{'status':0x1f7});if(f['startsWith'](d['adminPath']+'/api/')){const {isAdmin:h,errorResponse:i}=await checkAdminAuth(a,b);if(i)return i;if(!h)return new Response(JSON['stringify']({'error':'Forbidden'}),{'status':0x193,'headers':g});if(f['endsWith']('/stats')&&a['method']==='GET')try{const {results:k}=await b['DB']['prepare']('SELECT\x20expiration_date,\x20expiration_time,\x20data_usage\x20FROM\x20users')['all'](),l=new Date(),m={'totalUsers':k['length'],'activeUsers':k['filter'](n=>new Date(n['expiration_date']+'T'+n['expiration_time']+'Z')>l)['length'],'expiredUsers':k['length']-k['filter'](n=>new Date(n['expiration_date']+'T'+n['expiration_time']+'Z')<=l)['length'],'totalTraffic':k['reduce']((n,o)=>n+(o['data_usage']||0x0),0x0)};return new Response(JSON['stringify'](m),{'status':0xc8,'headers':g});}catch(n){return new Response(JSON['stringify']({'error':n['message']}),{'status':0x1f4,'headers':g});}if(f['endsWith']('/users')&&a['method']==='GET'){const {results:o}=await b['DB']['prepare']('SELECT\x20*\x20FROM\x20users\x20ORDER\x20BY\x20created_at\x20DESC')['all']();return new Response(JSON['stringify'](o??[]),{'status':0xc8,'headers':g});}if(f['endsWith']('/users')&&a['method']==='POST')try{const {uuid:p,exp_date:q,exp_time:r,notes:s,data_limit:t,ip_limit:u}=await a['json']();if(!p||!q||!r||!isValidUUID(p))throw new Error('Invalid\x20or\x20missing\x20fields.');return await b['DB']['prepare']('INSERT\x20INTO\x20users\x20(uuid,\x20expiration_date,\x20expiration_time,\x20notes,\x20data_limit,\x20ip_limit)\x20VALUES\x20(?,\x20?,\x20?,\x20?,\x20?,\x20?)')['bind'](p,q,r,s||null,t>=0x0?t:0x0,u>=0x0?u:0x2)['run'](),new Response(JSON['stringify']({'success':!![],'uuid':p}),{'status':0xc9,'headers':g});}catch(v){const w=v['message']['includes']('UNIQUE\x20constraint\x20failed')?'UUID\x20already\x20exists.':v['message'];return new Response(JSON['stringify']({'error':w}),{'status':0x190,'headers':g});}const j=f['match'](new RegExp('^'+d['adminPath']+'/api/users/([a-f0-9-]+)$'));if(j){const x=j[0x1];if(a['method']==='PUT')try{const {exp_date:y,exp_time:z,notes:A,data_limit:B,ip_limit:C,reset_traffic:D}=await a['json']();if(!y||!z)throw new Error('Invalid\x20date/time\x20fields.');const E='UPDATE\x20users\x20SET\x20expiration_date\x20=\x20?,\x20expiration_time\x20=\x20?,\x20notes\x20=\x20?,\x20data_limit\x20=\x20?,\x20ip_limit\x20=\x20?\x20'+(D?',\x20data_usage\x20=\x200':'')+'\x20WHERE\x20uuid\x20=\x20?';return await b['DB']['prepare'](E)['bind'](y,z,A||null,B>=0x0?B:0x0,C>=0x0?C:0x2,x)['run'](),await b['USER_KV']['delete']('user:'+x),new Response(JSON['stringify']({'success':!![],'uuid':x}),{'status':0xc8,'headers':g});}catch(F){return new Response(JSON['stringify']({'error':F['message']}),{'status':0x190,'headers':g});}if(a['method']==='DELETE')return await b['DB']['prepare']('DELETE\x20FROM\x20users\x20WHERE\x20uuid\x20=\x20?')['bind'](x)['run'](),await b['USER_KV']['delete']('user:'+x),await b['USER_KV']['delete']('conn_ips:'+x),new Response(null,{'status':0xcc});}return new Response(JSON['stringify']({'error':'API\x20route\x20not\x20found'}),{'status':0x194,'headers':g});}if(f===d['adminPath']){if(a['method']==='POST'){const G=await a['formData']();if(G['get']('password')===b['ADMIN_KEY']){const H=crypto['randomUUID'](),I=crypto['randomUUID']();await b['USER_KV']['put']('admin_session:'+H,JSON['stringify']({'csrfToken':I}),{'expirationTtl':0x15180});const J=new Headers({'Location':d['adminPath'],'Set-Cookie':'auth_token='+H+';\x20HttpOnly;\x20Secure;\x20Path='+d['adminPath']+';\x20Max-Age=86400;\x20SameSite=Strict'});return new Response(null,{'status':0x12e,'headers':J});}else return new Response(adminLoginHTML['replace']('</form>','</form><p\x20class=\x22error\x22>Invalid\x20password.</p>'),{'status':0x191,'headers':{'Content-Type':'text/html;charset=utf-8'}});}if(a['method']==='GET'){const {isAdmin:K,csrfToken:L,errorResponse:M}=await checkAdminAuth(a,b);if(M)return M;if(K){const N=adminPanelHTML['replace']('<input\x20type=\x22hidden\x22\x20id=\x22csrf_token\x22\x20name=\x22csrf_token\x22>','<input\x20type=\x22hidden\x22\x20id=\x22csrf_token\x22\x20name=\x22csrf_token\x22\x20value=\x22'+L+'\x22>')['replace']('<body>','<body\x20data-admin-path=\x22'+d['adminPath']+'\x22>');return new Response(N,{'headers':{'Content-Type':'text/html;charset=utf-8'}});}else return new Response(adminLoginHTML,{'headers':{'Content-Type':'text/html;charset=utf-8'}});}return new Response('Method\x20Not\x20Allowed',{'status':0x195});}return null;}function makeReadableWebSocketStream(a,b,c){let d=new ReadableStream({'start'(e){a['addEventListener']('message',f=>{f['data']&&e['enqueue'](f['data']);}),a['addEventListener']('close',()=>{safeCloseWebSocket(a),e['close']();}),a['addEventListener']('error',f=>{c('websocket\x20closed\x20due\x20to\x20error:',f),e['error'](f);});if(b){const f=b['substring'](CONST['ED_PARAMS']['eh']['length']+0x1);if(f){const g=atob(f),h=new Uint8Array(g['length']);for(let j=0x0;j<g['length'];j++){h[j]=g['charCodeAt'](j);}e['enqueue'](h['buffer']);}}}});return d;}async function ProtocolOverWSHandler(a,b,c,d){const e=new WebSocketPair(),[f,g]=Object['values'](e);g['accept']();const h=a['headers']['get'](CONST['ED_PARAMS']['eh'])||'',i=(t,u)=>console['log']('['+a['headers']['get']('CF-Connecting-IP')+']\x20'+t,u||''),j=makeReadableWebSocketStream(g,h,i);let k={'value':null},l=null,m=null,n=0x0,o=0x0,p=0x0;const q=t=>{o+=t,m&&m['data_limit']>0x0&&n+o+p>=m['data_limit']&&(i('User\x20'+m['uuid']+'\x20exceeded\x20data\x20cap\x20mid-session\x20(Downstream).'),safeCloseWebSocket(g),k['value']?.['close']?.());},r=t=>{p+=t,m&&m['data_limit']>0x0&&n+o+p>=m['data_limit']&&(i('User\x20'+m['uuid']+'\x20exceeded\x20data\x20cap\x20mid-session\x20(Upstream).'),safeCloseWebSocket(g),k['value']?.['close']?.());};async function s(){if(m?.['uuid']){const t=o+p;t>0x0&&await updateUserUsage(c,m['uuid'],t);}}return d['waitUntil'](new Promise(t=>{g['addEventListener']('close',()=>{s()['then'](t);}),g['addEventListener']('error',()=>{s()['then'](t);}),setTimeout(()=>{g['readyState']===CONST['WS_READY_STATE']['OPEN']&&safeCloseWebSocket(g),s()['then'](t);},0xa*0x3c*0x3e8);})),j['pipeTo'](new WritableStream({async 'write'(t,u){q(t['byteLength']);if(l){await l['write'](t);return;}if(k['value']){const G=k['value']['writable']['getWriter']();await G['write'](t),G['releaseLock']();return;}const {user:v,hasError:w,message:x,addressType:y,addressRemote:z,portRemote:A,rawDataIndex:B,isUDP:C}=await processVlessHeader(t,c);if(w){u['error'](new Error(x));return;}m=v,n=Number(v['data_usage']||0x0);if(isExpired(v['expiration_date'],v['expiration_time'])){u['error'](new Error('User\x20expired.'));return;}if(!hasRemainingData(v)){u['error'](new Error('Data\x20limit\x20reached.'));return;}const D=a['headers']['get']('CF-Connecting-IP');if(v['ip_limit']>0x0){const H='conn_ips:'+v['uuid'];let I=await c['USER_KV']['get'](H,'json')||[];I=I['filter'](J=>J['exp']>Date['now']());if(I['length']>=v['ip_limit']&&!I['some'](J=>J['ip']===D)){u['error'](new Error('IP\x20limit\x20of\x20'+v['ip_limit']+'\x20reached.\x20Blocking\x20IP\x20'+D));return;}!I['some'](J=>J['ip']===D)&&(I['push']({'ip':D,'exp':Date['now']()+0xfde8}),d['waitUntil'](c['USER_KV']['put'](H,JSON['stringify'](I),{'expirationTtl':0x78})));}const E=new Uint8Array([CONST['VLESS_VERSION'],0x0]),F=t['slice'](B);if(C){if(A!==0x35){u['error'](new Error('UDP\x20proxy\x20supports\x20only\x20DNS\x20(port\x2053).'));return;}l=await createDnsPipeline(g,E,i,r),await l['write'](F);return;}HandleTCPOutBound(k,y,z,A,F,g,E,i,b,r);},'close'(){i('Client\x20WebSocket\x20stream\x20closed.'),d['waitUntil'](s());},'abort'(t){i('Client\x20WebSocket\x20stream\x20aborted:',t),d['waitUntil'](s());}}))['catch'](t=>{console['error']('VLESS\x20pipeline\x20failed:',t['stack']||t),safeCloseWebSocket(g),d['waitUntil'](s());}),new Response(null,{'status':0x65,'webSocket':f});}async function processVlessHeader(a,b){if(a['byteLength']<0x18)return{'hasError':!![],'message':'invalid\x20vless\x20header'};const c=new DataView(a),d=c['getUint8'](0x0);if(d!==CONST['VLESS_VERSION'])return{'hasError':!![],'message':'invalid\x20vless\x20version'};const e=unsafeStringify(new Uint8Array(a['slice'](0x1,0x11))),f=await getUserData(b,e);if(!f)return{'hasError':!![],'message':'user\x20not\x20found'};const g=c['getUint8'](0x11),h=c['getUint8'](0x12+g);if(h!==0x1&&h!==0x2)return{'hasError':!![],'message':'unsupported\x20command:\x20'+h};const i=0x13+g,j=c['getUint16'](i,![]),k=c['getUint8'](i+0x2);let l,m;const n=i+0x3,o=new TextDecoder();switch(k){case 0x1:l=new Uint8Array(a['slice'](n,n+0x4))['join']('.'),m=n+0x4;break;case 0x2:const p=c['getUint8'](n);l=o['decode'](a['slice'](n+0x1,n+0x1+p)),m=n+0x1+p;break;case 0x3:const q=Array['from']({'length':0x8},(r,s)=>c['getUint16'](n+s*0x2,![])['toString'](0x10)['padStart'](0x4,'0'))['join'](':');l='['+q+']',m=n+0x10;break;default:return{'hasError':!![],'message':'invalid\x20address\x20type:\x20'+k};}return{'user':f,'hasError':![],'addressType':k,'addressRemote':l,'portRemote':j,'rawDataIndex':m,'isUDP':h===0x2};}async function HandleTCPOutBound(a,b,c,d,e,f,g,h,i,j){const k=i['proxyIP']&&(c===i['proxyIP']||c==='['+i['proxyIP']+']'||c===i['proxyAddress']);async function l(n,o,p=![]){let q;if(i['socks5Relay'])q=await socks5Connect(b,n,o,h,i['parsedSocks5Address']);else p?q=await socks5Connect(b,n,o,h,i['parsedSocks5Address']):q=connect({'hostname':n,'port':o});a['value']=q,h('connected\x20to\x20'+n+':'+o+(p?'\x20via\x20SOCKS5':''));const r=q['writable']['getWriter']();return await r['write'](e),r['releaseLock'](),q;}async function m(){if(i['socks5Relay']){h('SOCKS5\x20Relay\x20is\x20active.\x20No\x20retry\x20logic\x20available\x20after\x20initial\x20SOCKS5\x20connection\x20failed.');throw new Error('SOCKS5\x20Relay\x20failed');}let n=c,o=d,p=![];if(i['enableSocks'])h('Retrying\x20via\x20SOCKS5\x20Outbound\x20Proxy...'),p=!![];else{if(i['proxyIP']&&!k)h('Retrying\x20via\x20PROXYIP:\x20'+i['proxyAddress']+'...'),n=i['proxyIP'],o=i['proxyPort'];else{h('No\x20suitable\x20retry\x20path\x20found.');throw new Error('No\x20retry\x20path');}}const q=await l(n,o,p);q['closed']['catch'](r=>{console['log']('retry\x20tcpSocket\x20closed\x20error',r);})['finally'](()=>{safeCloseWebSocket(f);}),RemoteSocketToWS(q,f,g,null,h,j);}try{const n=await l(c,d,i['enableSocks']&&i['socks5Relay']);RemoteSocketToWS(n,f,g,m,h,j);}catch(o){h('Initial\x20connection\x20failed.\x20Attempting\x20retry...',o['message']);try{await m();}catch(p){h('All\x20connection\x20attempts\x20failed:',p['message']),safeCloseWebSocket(f);}}}async function RemoteSocketToWS(a,b,c,d,e,f){let g=![],h=!![];try{await a['readable']['pipeTo'](new WritableStream({async 'write'(i){if(b['readyState']!==CONST['WS_READY_STATE']['OPEN']){h=![];throw new Error('WebSocket\x20is\x20not\x20open');}f(i['byteLength']),g=!![],h=![];const j=c?await new Blob([c,i])['arrayBuffer']():i;b['send'](j),c=null;},'close'(){e('Remote\x20connection\x20readable\x20closed.\x20Had\x20incoming\x20data:\x20'+g);},'abort'(i){console['error']('Remote\x20connection\x20readable\x20aborted:',i);}}));}catch(i){console['error']('RemoteSocketToWS\x20error:',i['stack']||i),h&&!g&&d?e('No\x20incoming\x20data\x20received\x20on\x20initial\x20attempt,\x20trying\x20fallback...'):safeCloseWebSocket(b);}if(h&&!g&&d)e('No\x20incoming\x20data\x20from\x20direct\x20connection,\x20triggering\x20retry()'),d();else!h&&safeCloseWebSocket(b);}async function socks5Connect(a,b,c,d,e){if(!e)throw new Error('SOCKS5\x20proxy\x20not\x20configured\x20correctly.');const {username:f,password:g,hostname:h,port:i}=e,j=connect({'hostname':h,'port':i}),k=j['writable']['getWriter'](),l=j['readable']['getReader'](),m=new TextEncoder(),n=f&&g?[0x0,0x2]:[0x0];await k['write'](new Uint8Array([0x5,n['length'],...n]));let o=(await l['read']())['value'];if(!o||o['byteLength']<0x2||o[0x0]!==0x5||o[0x1]===0xff)throw new Error('SOCKS5\x20server\x20connection\x20failed\x20(Greeting).');if(o[0x1]===0x2){if(!f||!g)throw new Error('SOCKS5\x20auth\x20credentials\x20not\x20provided.');const s=new Uint8Array([0x1,f['length'],...m['encode'](f),g['length'],...m['encode'](g)]);await k['write'](s),o=(await l['read']())['value'];if(!o||o['byteLength']<0x2||o[0x0]!==0x1||o[0x1]!==0x0)throw new Error('SOCKS5\x20authentication\x20failed.');}let p,q=new Uint8Array([c>>0x8,c&0xff]);switch(a){case 0x1:p=new Uint8Array([0x1,...b['split']('.')['map'](Number)]);break;case 0x2:p=new Uint8Array([0x3,b['length'],...m['encode'](b)]);break;case 0x3:const t=b['replace']('[','')['replace'](']',''),u=t['split'](':')['map'](v=>{const w=v['padStart'](0x4,'0');return[parseInt(w['slice'](0x0,0x2),0x10),parseInt(w['slice'](0x2),0x10)];})['flat']();p=new Uint8Array([0x4,...u]);break;default:throw new Error('Invalid\x20addressType\x20for\x20SOCKS5:\x20'+a);}const r=new Uint8Array([0x5,0x1,0x0,...p,...q]);await k['write'](r),o=(await l['read']())['value'];if(!o||o['byteLength']<0xa||o[0x1]!==0x0)throw new Error('Failed\x20to\x20open\x20SOCKS5\x20connection:\x20code\x20'+(o?o[0x1]:'unknown'));return k['releaseLock'](),l['releaseLock'](),j;}function socks5AddressParser(a){try{const [b,c]=a['includes']('@')?a['split']('@'):[null,a],[d,e]=c['split'](':'),f=parseInt(e,0xa);if(!d||isNaN(f))throw new Error();let g=null,h=null;if(b){[g,h]=b['split'](':');if(!g)throw new Error();}return{'username':g,'password':h,'hostname':d,'port':f};}catch{throw new Error('Invalid\x20SOCKS5\x20address\x20format.\x20Expected\x20[user:pass@]host:port');}}async function createDnsPipeline(a,b,c,d){let e=![];const f=new TransformStream({'transform'(g,h){try{const i=g instanceof ArrayBuffer?g:g['buffer'],j=new DataView(i);let k=0x0;while(k<i['byteLength']){if(k+0x2>i['byteLength']){c('Incomplete\x20UDP\x20length\x20prefix\x20in\x20chunk.');break;}const l=j['getUint16'](k,![]);k+=0x2;if(k+l>i['byteLength']){c('Incomplete\x20UDP\x20packet\x20data\x20in\x20chunk.');break;}const m=i['slice'](k,k+l);h['enqueue'](m),k+=l;}}catch(n){c('Error\x20in\x20DNS\x20transform:',n);}}});return f['readable']['pipeTo'](new WritableStream({async 'write'(g){try{const h=await fetch('https://1.1.1.1/dns-query',{'method':'POST','headers':{'content-type':'application/dns-message'},'body':g});if(!h['ok'])throw new Error('DNS-over-HTTPS\x20failed\x20with\x20status\x20'+h['status']);const i=await h['arrayBuffer']();d(i['byteLength']);const j=i['byteLength'],k=new Uint8Array([j>>0x8&0xff,j&0xff]),l=e?await new Blob([k,i])['arrayBuffer']():await new Blob([b,k,i])['arrayBuffer']();a['send'](l),e=!![];}catch(m){c('DNS\x20query\x20failed:',m);}},'abort'(g){c('DNS\x20query\x20pipeline\x20aborted:',g);}}))['catch'](g=>c('DNS\x20transform\x20pipeline\x20failed',g)),f['writable']['getWriter']();}function generateRandomPath(a=0xc,b=''){const c='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';let d='';for(let e=0x0;e<a;e+=0x1){d+=c['charAt'](Math['floor'](Math['random']()*c['length']));}return'/'+d+(b?'?'+b:'');}const CORE_PRESETS={'xray':{'tls':{'path':()=>generateRandomPath(0xc,'ed=2048'),'security':'tls','fp':'chrome','alpn':'http/1.1','extra':{}},'tcp':{'path':()=>generateRandomPath(0xc,'ed=2048'),'security':'none','fp':'chrome','extra':{}}},'sb':{'tls':{'path':()=>generateRandomPath(0x12),'security':'tls','fp':'firefox','alpn':'h3','extra':CONST['ED_PARAMS']},'tcp':{'path':()=>generateRandomPath(0x12),'security':'none','fp':'firefox','extra':CONST['ED_PARAMS']}}};function makeName(a,b){return a+'-'+b['toUpperCase']();}function createVlessLink({userID:a,address:b,port:c,host:d,path:e,security:f,sni:g,fp:h,alpn:i,extra:extra={},name:j}){const l=new URLSearchParams({'type':'ws','host':d,'path':e});if(f)l['set']('security',f);if(g)l['set']('sni',g);if(h)l['set']('fp',h);if(i)l['set']('alpn',i);for(const [m,n]of Object['entries'](extra))l['set'](m,n);return'vless://'+a+'@'+b+':'+c+'?'+l['toString']()+'#'+encodeURIComponent(j);}function buildLink({core:a,proto:b,userID:c,hostName:d,address:e,port:f,tag:g}){const h=CORE_PRESETS[a][b],i=f===0x1bb?'':':'+f,j=e['startsWith']('[')?e['slice'](0x1,-0x1):e;return createVlessLink({'userID':c,'address':j,'port':f,'host':d,'path':h['path'](),'security':h['security'],'sni':h['security']==='tls'?d:undefined,'fp':h['fp'],'alpn':h['alpn'],'extra':h['extra'],'name':makeName(g,b)});}const pick=a=>a[Math['floor'](Math['random']()*a['length'])];async function fetchSmartIpPool(a){const b=['https://raw.githubusercontent.com/NiREvil/vless/refs/heads/main/Cloudflare-IPs.json'];if(a['SMART_IP_SOURCE'])b['unshift'](a['SMART_IP_SOURCE']);for(const c of b){try{const d='smart_ips:'+new URL(c)['hostname'],e=await a['USER_KV']['get'](d,'json');if(e&&e['length']>0x0)return e;const f=await fetch(c,{'cf':{'cacheTtl':0xe10,'cacheEverything':!![]}});if(!f['ok'])continue;const g=await f['json'](),h=[...g['ipv4']??[],...g['ipv6']??[]]['map'](i=>i['ip']||i)['filter'](Boolean);if(h['length'])return await a['USER_KV']['put'](d,JSON['stringify'](h),{'expirationTtl':0xe10}),h;}catch(i){console['warn']('SMART_IP_SOURCE\x20fetch\x20failed\x20('+c+'):',i['message']);}}return[];}async function handleIpSubscription(a,b,c,d){const e=[c,'creativecommons.org','www.speedtest.net','sky.rethinkdns.com','cfip.1323123.xyz','go.inmobi.com','www.visa.com','cdnjs.com','zula.ir'],f=[0x1bb,0x20fb,0x805,0x823,0x827,0x830],g=[0x50,0x1f90,0x22b0,0x804,0x822,0x826,0x82f],h=[],i=c['endsWith']('.pages.dev');e['forEach']((k,l)=>{h['push'](buildLink({'core':a,'proto':'tls','userID':b,'hostName':c,'address':k,'port':pick(f),'tag':'D'+(l+0x1)+'-TLS'})),!i&&h['push'](buildLink({'core':a,'proto':'tcp','userID':b,'hostName':c,'address':k,'port':pick(g),'tag':'D'+(l+0x1)+'-TCP'}));});const j=await fetchSmartIpPool(d);return j['slice'](0x0,0x28)['forEach']((k,l)=>{const m=k['includes'](':')?'['+k+']':k;h['push'](buildLink({'core':a,'proto':'tls','userID':b,'hostName':c,'address':m,'port':pick(f),'tag':'IP'+(l+0x1)+'-TLS'})),!i&&h['push'](buildLink({'core':a,'proto':'tcp','userID':b,'hostName':c,'address':m,'port':pick(g),'tag':'IP'+(l+0x1)+'-TCP'}));}),new Response(btoa(h['join']('\x0a')),{'headers':{'Content-Type':'text/plain;charset=utf-8'}});}async function handleScamalyticsLookup(a,b){const c=new URL(a['url']),d=c['searchParams']['get']('ip');if(!d)return new Response(JSON['stringify']({'error':'Missing\x20ip\x20parameter'}),{'status':0x190,'headers':{'Content-Type':'application/json'}});const {apiKey:e,baseUrl:f}=b['scamalytics'];if(!e||!f)return new Response(JSON['stringify']({'error':'Scamalytics\x20API\x20credentials\x20not\x20configured.'}),{'status':0x1f4,'headers':{'Content-Type':'application/json'}});const g=f+'?key='+e+'&ip='+encodeURIComponent(d)+'&database=dbip';try{const h='scam_ip:'+d;let i=await b['USER_KV']['get'](h,'json');if(!i){const j=await fetch(g);if(!j['ok'])throw new Error('Scamalytics\x20HTTP\x20error!\x20status:\x20'+j['status']);i=await j['json'](),await b['USER_KV']['put'](h,JSON['stringify'](i),{'expirationTtl':0xe10});}return new Response(JSON['stringify'](i),{'headers':{'Content-Type':'application/json','Access-Control-Allow-Origin':'*'}});}catch(k){return new Response(JSON['stringify']({'error':k['message']}),{'status':0x1f4,'headers':{'Content-Type':'application/json','Access-Control-Allow-Origin':'*'}});}}function bytesToReadable(a=0x0){if(!a)return'0\x20Bytes';const b=['Bytes','KB','MB','GB','TB'],c=Math['floor'](Math['log'](a)/Math['log'](0x400));return parseFloat((a/0x400**c)['toFixed'](0x2))+'\x20'+b[c];}const configPageCSS='\x0a*{\x0a\x20\x20margin:\x200;\x0a\x20\x20padding:\x200;\x0a\x20\x20box-sizing:\x20border-box;\x0a}\x0a:root\x20{\x0a\x20\x20--background-primary:\x20#2a2421;\x20--background-secondary:\x20#35302c;\x20--background-tertiary:\x20#413b35;\x0a\x20\x20--border-color:\x20#5a4f45;\x20--border-color-hover:\x20#766a5f;\x20--text-primary:\x20#e5dfd6;\x20--text-secondary:\x20#b3a89d;\x0a\x20\x20--text-accent:\x20#ffffff;\x20--accent-primary:\x20#be9b7b;\x20--accent-secondary:\x20#d4b595;\x20--accent-tertiary:\x20#8d6e5c;\x0a\x20\x20--accent-primary-darker:\x20#8a6f56;\x20--button-text-primary:\x20#2a2421;\x20--button-text-secondary:\x20var(--text-primary);\x0a\x20\x20--shadow-color:\x20rgba(0,\x200,\x200,\x200.35);\x20--shadow-color-accent:\x20rgba(190,\x20155,\x20123,\x200.4);\x0a\x20\x20--border-radius:\x2012px;\x20--transition-speed:\x200.2s;\x20--transition-speed-fast:\x200.1s;\x20--transition-speed-medium:\x200.3s;\x20--transition-speed-long:\x200.6s;\x0a\x20\x20--status-success:\x20#70b570;\x20--status-error:\x20#e05d44;\x20--status-warning:\x20#e0bc44;\x20--status-info:\x20#4f90c4;\x0a\x20\x20--serif:\x20\x22Aldine\x20401\x20BT\x20Web\x22,\x20\x22Times\x20New\x20Roman\x22,\x20Times,\x20Georgia,\x20ui-serif,\x20serif;\x0a\x20\x20--sans-serif:\x20\x22Styrene\x20B\x20LC\x22,\x20-apple-system,\x20BlinkMacSystemFont,\x20\x22Segoe\x20UI\x22,\x20Helvetica,\x20Arial,\x20\x22Noto\x20Color\x20Emoji\x22,\x20sans-serif;\x0a\x20\x20--mono-serif:\x20\x22Fira\x20Code\x22,\x20Cantarell,\x20\x22Courier\x20Prime\x22,\x20monospace;\x0a}\x0abody\x20{\x0a\x20\x20font-family:\x20var(--sans-serif);\x20\x0a\x20\x20font-size:\x2016px;\x20\x0a\x20\x20font-weight:\x20400;\x20\x0a\x20\x20font-style:\x20normal;\x0a\x20\x20background-color:\x20var(--background-primary);\x20\x0a\x20\x20color:\x20var(--text-primary);\x0a\x20\x20padding:\x203rem;\x20\x0a\x20\x20line-height:\x201.5;\x20\x0a\x20\x20-webkit-font-smoothing:\x20antialiased;\x20\x0a\x20\x20-moz-osx-font-smoothing:\x20grayscale;\x0a}\x0a@keyframes\x20rgb-animation\x20{\x0a\x20\x200%\x20{\x20transform:\x20rotate(0deg);\x20}\x0a\x20\x20100%\x20{\x20transform:\x20rotate(360deg);\x20}\x0a}\x0a.info-card.rainbow\x20{\x0a\x20\x20position:\x20relative;\x0a\x20\x20padding:\x203px;\x0a\x20\x20background:\x20var(--background-secondary);\x0a\x20\x20border-radius:\x20var(--border-radius);\x0a\x20\x20overflow:\x20hidden;\x0a\x20\x20z-index:\x201;\x0a}\x0a.info-card.rainbow::before\x20{\x0a\x20\x20content:\x20\x27\x27;\x0a\x20\x20position:\x20absolute;\x0a\x20\x20top:\x20-50%;\x0a\x20\x20left:\x20-50%;\x0a\x20\x20width:\x20200%;\x0a\x20\x20height:\x20200%;\x0a\x20\x20background:\x20conic-gradient(\x0a\x20\x20\x20\x20#ff0000,\x20#ff00ff,\x20#0000ff,\x20#00ffff,\x20#00ff00,\x20#ffff00,\x20#ff0000\x0a\x20\x20);\x0a\x20\x20animation:\x20rgb-animation\x204s\x20linear\x20infinite;\x0a\x20\x20z-index:\x20-1;\x0a}\x0a.info-card.rainbow\x20.info-card-content\x20{\x0a\x20\x20background:\x20var(--background-secondary);\x0a\x20\x20padding:\x2020px;\x0a\x20\x20border-radius:\x20calc(var(--border-radius)\x20-\x203px);\x0a}\x0a.info-title\x20{\x0a\x20\x20font-family:\x20var(--serif);\x0a\x20\x20font-size:\x201.6rem;\x0a\x20\x20font-weight:\x20400;\x0a\x20\x20text-align:\x20center;\x0a\x20\x20color:\x20var(--accent-secondary);\x0a\x20\x20margin:\x200\x200\x2012px\x200;\x0a}\x0a.info-relative-time\x20{\x0a\x20\x20text-align:\x20center;\x0a\x20\x20font-size:\x201.1rem;\x0a\x20\x20font-weight:\x20500;\x0a\x20\x20margin-bottom:\x2012px;\x0a\x20\x20padding:\x204px\x208px;\x0a\x20\x20border-radius:\x206px;\x0a}\x0a.info-relative-time.active\x20{\x0a\x20\x20color:\x20var(--status-success);\x0a\x20\x20background-color:\x20rgba(112,\x20181,\x20112,\x200.1);\x0a}\x0a.info-relative-time.expired\x20{\x0a\x20\x20color:\x20var(--status-error);\x0a\x20\x20background-color:\x20rgba(224,\x2093,\x2068,\x200.1);\x0a}\x0a#expiration-display\x20{\x20\x0a\x20\x20font-size:\x200.9em;\x20\x0a\x20\x20text-align:\x20center;\x20\x0a\x20\x20color:\x20var(--text-secondary);\x20\x0a}\x0a#expiration-display\x20span\x20{\x20\x0a\x20\x20display:\x20block;\x20\x0a\x20\x20margin-top:\x208px;\x20\x0a\x20\x20font-size:\x200.9em;\x20\x0a\x20\x20line-height:\x201.6;\x20\x0a}\x0a#expiration-display\x20strong\x20{\x20\x0a\x20\x20color:\x20var(--text-primary);\x20\x0a\x20\x20font-weight:\x20500;\x20\x0a}\x0a.container\x20{\x0a\x20\x20max-width:\x20800px;\x20\x0a\x20\x20margin:\x2020px\x20auto;\x20\x0a\x20\x20padding:\x200\x2012px;\x20\x0a\x20\x20border-radius:\x20var(--border-radius);\x0a\x20\x20box-shadow:\x200\x206px\x2015px\x20rgba(0,\x200,\x200,\x200.2),\x200\x200\x2025px\x208px\x20var(--shadow-color-accent);\x0a\x20\x20transition:\x20box-shadow\x20var(--transition-speed-medium)\x20ease;\x0a\x20\x20background-color:\x20var(--background-primary);\x0a}\x0a.container:hover\x20{\x20\x0a\x20\x20box-shadow:\x200\x208px\x2020px\x20rgba(0,\x200,\x200,\x200.25),\x200\x200\x2035px\x2010px\x20var(--shadow-color-accent);\x20\x0a}\x0a.header\x20{\x20\x0a\x20\x20text-align:\x20center;\x20\x0a\x20\x20margin-bottom:\x2030px;\x20\x0a\x20\x20padding-top:\x2030px;\x20\x0a}\x0a.header\x20h1\x20{\x20\x0a\x20\x20font-family:\x20var(--serif);\x20\x0a\x20\x20font-weight:\x20400;\x20\x0a\x20\x20font-size:\x201.8rem;\x20\x0a\x20\x20color:\x20var(--text-accent);\x20\x0a\x20\x20margin-top:\x200px;\x20\x0a\x20\x20margin-bottom:\x202px;\x20\x0a}\x0a.header\x20p\x20{\x20\x0a\x20\x20color:\x20var(--text-secondary);\x20\x0a\x20\x20font-size:\x200.8rem;\x20\x0a\x20\x20font-weight:\x20400;\x20\x0a}\x0a.network-info-wrapper\x20{\x0a\x20\x20margin-bottom:\x2024px;\x0a}\x0a.network-info-header\x20{\x0a\x20\x20display:\x20flex;\x0a\x20\x20justify-content:\x20space-between;\x0a\x20\x20align-items:\x20center;\x0a\x20\x20margin-bottom:\x2015px;\x0a}\x0a.network-info-header\x20h2\x20{\x0a\x20\x20\x20\x20font-family:\x20var(--serif);\x0a\x20\x20\x20\x20font-weight:\x20400;\x0a\x20\x20\x20\x20font-size:\x201.4rem;\x0a\x20\x20\x20\x20color:\x20var(--accent-secondary);\x0a}\x0a.network-grid\x20{\x0a\x20\x20\x20\x20display:\x20grid;\x0a\x20\x20\x20\x20grid-template-columns:\x201fr\x201fr;\x0a\x20\x20\x20\x20gap:\x2016px;\x0a}\x0a.network-card\x20{\x0a\x20\x20\x20\x20background:\x20var(--background-secondary);\x0a\x20\x20\x20\x20border-radius:\x20var(--border-radius);\x0a\x20\x20\x20\x20padding:\x2015px;\x0a\x20\x20\x20\x20border:\x201px\x20solid\x20var(--border-color);\x0a}\x0a.network-title\x20{\x0a\x20\x20\x20\x20font-size:\x201.1rem;\x0a\x20\x20\x20\x20font-weight:\x20500;\x0a\x20\x20\x20\x20color:\x20var(--text-primary);\x0a\x20\x20\x20\x20margin-bottom:\x2010px;\x0a\x20\x20\x20\x20padding-bottom:\x208px;\x0a\x20\x20\x20\x20border-bottom:\x201px\x20solid\x20var(--border-color);\x0a}\x0a.network-info-grid\x20>\x20div\x20{\x0a\x20\x20\x20\x20display:\x20flex;\x0a\x20\x20\x20\x20justify-content:\x20space-between;\x0a\x20\x20\x20\x20font-size:\x200.9rem;\x0a\x20\x20\x20\x20line-height:\x201.8;\x0a\x20\x20\x20\x20color:\x20var(--text-secondary);\x0a}\x0a.network-info-grid\x20>\x20div\x20strong\x20{\x0a\x20\x20\x20\x20color:\x20var(--text-primary);\x0a\x20\x20\x20\x20font-weight:\x20500;\x0a}\x0a.network-info-grid\x20>\x20div\x20span\x20{\x0a\x20\x20\x20\x20text-align:\x20right;\x0a\x20\x20\x20\x20max-width:\x2060%;\x0a}\x0a.config-card\x20{\x0a\x20\x20background:\x20var(--background-secondary);\x20\x0a\x20\x20border-radius:\x20var(--border-radius);\x20\x0a\x20\x20padding:\x2020px;\x20\x0a\x20\x20margin-bottom:\x2024px;\x20\x0a\x20\x20border:\x201px\x20solid\x20var(--border-color);\x0a\x20\x20transition:\x20border-color\x20var(--transition-speed)\x20ease,\x20box-shadow\x20var(--transition-speed)\x20ease;\x0a}\x0a.config-card:hover\x20{\x20\x0a\x20\x20border-color:\x20var(--border-color-hover);\x20\x0a\x20\x20box-shadow:\x200\x204px\x208px\x20var(--shadow-color);\x20\x0a}\x0a.config-title\x20{\x0a\x20\x20font-family:\x20var(--serif);\x20\x0a\x20\x20font-size:\x201.6rem;\x20\x0a\x20\x20font-weight:\x20400;\x20\x0a\x20\x20color:\x20var(--accent-secondary);\x0a\x20\x20margin-bottom:\x2016px;\x20\x0a\x20\x20padding-bottom:\x2013px;\x20\x0a\x20\x20border-bottom:\x201px\x20solid\x20var(--border-color);\x0a\x20\x20display:\x20flex;\x20\x0a\x20\x20align-items:\x20center;\x20\x0a\x20\x20justify-content:\x20space-between;\x0a}\x0a.button\x20{\x0a\x20\x20display:\x20inline-flex;\x20\x0a\x20\x20align-items:\x20center;\x20\x0a\x20\x20justify-content:\x20center;\x20\x0a\x20\x20gap:\x208px;\x0a\x20\x20padding:\x208px\x2016px;\x20\x0a\x20\x20border-radius:\x206px;\x20\x0a\x20\x20font-size:\x2015px;\x20\x0a\x20\x20font-weight:\x20500;\x0a\x20\x20cursor:\x20pointer;\x20\x0a\x20\x20border:\x201px\x20solid\x20var(--border-color);\x20\x0a\x20\x20background-color:\x20var(--background-tertiary);\x0a\x20\x20color:\x20var(--button-text-secondary);\x0a\x20\x20transition:\x20background-color\x20var(--transition-speed)\x20ease,\x20border-color\x20var(--transition-speed)\x20ease,\x20transform\x20var(--transition-speed)\x20ease,\x20box-shadow\x20var(--transition-speed)\x20ease;\x0a\x20\x20text-decoration:\x20none;\x20\x0a\x20\x20overflow:\x20hidden;\x20\x0a\x20\x20position:\x20relative;\x0a}\x0a.button::before\x20{\x0a\x20\x20content:\x20\x27\x27;\x20\x0a\x20\x20position:\x20absolute;\x20\x0a\x20\x20top:\x200;\x20\x0a\x20\x20left:\x200;\x20\x0a\x20\x20width:\x20100%;\x20\x0a\x20\x20height:\x20100%;\x0a\x20\x20background:\x20linear-gradient(120deg,\x20transparent,\x20rgba(255,\x20255,\x20255,\x200.2),\x20transparent);\x0a\x20\x20transform:\x20translateX(-100%);\x20\x0a\x20\x20transition:\x20transform\x200.6s\x20ease;\x20\x0a\x20\x20z-index:\x201;\x0a}\x0a.button:hover::before\x20{\x20\x0a\x20\x20transform:\x20translateX(100%);\x20\x0a}\x0a.button:hover\x20{\x0a\x20\x20background-color:\x20#4d453e;\x20\x0a\x20\x20border-color:\x20var(--border-color-hover);\x20\x0a\x20\x20transform:\x20translateY(-2px);\x20\x0a\x20\x20box-shadow:\x200\x204px\x208px\x20var(--shadow-color);\x0a}\x0a.button:active\x20{\x20\x0a\x20\x20transform:\x20translateY(0px)\x20scale(0.98);\x20\x0a\x20\x20box-shadow:\x20none;\x20\x0a}\x0a.config-content\x20{\x0a\x20\x20position:\x20relative;\x20\x0a\x20\x20background:\x20var(--background-tertiary);\x20\x0a\x20\x20border-radius:\x20var(--border-radius);\x0a\x20\x20padding:\x2016px;\x20\x0a\x20\x20margin-bottom:\x2020px;\x20\x0a\x20\x20border:\x201px\x20solid\x20var(--border-color);\x0a}\x0a.config-content\x20pre\x20{\x0a\x20\x20overflow-x:\x20auto;\x20\x0a\x20\x20font-family:\x20var(--mono-serif);\x20\x0a\x20\x20font-size:\x2012px;\x20\x0a\x20\x20color:\x20var(--text-primary);\x0a\x20\x20margin:\x200;\x20\x0a\x20\x20white-space:\x20pre-wrap;\x20\x0a\x20\x20word-break:\x20break-all;\x0a}\x0a.client-buttons\x20{\x20\x0a\x20\x20display:\x20grid;\x0a\x20\x20grid-template-columns:\x20repeat(auto-fit,\x20minmax(180px,\x201fr));\x0a\x20\x20gap:\x2012px;\x0a}\x0a.client-btn\x20{\x0a\x20\x20background-color:\x20var(--accent-primary);\x0a\x20\x20color:\x20var(--button-text-primary);\x0a\x20\x20border:\x201px\x20solid\x20var(--accent-primary-darker);\x0a\x20\x20font-size:\x2014px;\x0a\x20\x20padding:\x2010px\x2015px;\x0a\x20\x20text-align:\x20center;\x0a}\x0a.client-btn:hover\x20{\x0a\x20\x20\x20\x20background-color:\x20var(--accent-secondary);\x0a\x20\x20\x20\x20border-color:\x20var(--accent-primary);\x0a\x20\x20\x20\x20transform:\x20translateY(-2px);\x0a}\x0a.client-btn:active\x20{\x0a\x20\x20\x20\x20transform:\x20translateY(0px)\x20scale(0.98);\x0a}\x0a.qr-container\x20{\x20\x0a\x20\x20margin-top:\x2020px;\x20\x0a\x20\x20text-align:\x20center;\x20\x0a\x20\x20display:\x20none;\x20\x0a}\x0a.qr-container.show\x20{\x20\x0a\x20\x20display:\x20block;\x20\x0a}\x0a#qr-xray,\x20#qr-singbox\x20{\x20\x0a\x20\x20display:\x20inline-block;\x20\x0a\x20\x20padding:\x2010px;\x20\x0a\x20\x20background:\x20white;\x20\x0a\x20\x20border-radius:\x208px;\x20\x0a\x20\x20box-shadow:\x200\x200\x2010px\x20rgba(0,0,0,0.5);\x20\x0a}\x0a.top-grid\x20{\x0a\x20\x20\x20\x20display:\x20grid;\x0a\x20\x20\x20\x20grid-template-columns:\x201fr\x201fr;\x0a\x20\x20\x20\x20gap:\x2024px;\x0a\x20\x20\x20\x20margin-bottom:\x2024px;\x0a}\x0a.info-card\x20{\x0a\x20\x20\x20\x20background:\x20var(--background-secondary);\x0a\x20\x20\x20\x20border-radius:\x20var(--border-radius);\x0a\x20\x20\x20\x20padding:\x200px;\x20\x0a\x20\x20\x20\x20border:\x201px\x20solid\x20var(--border-color);\x0a}\x0a.data-usage-text\x20{\x0a\x20\x20\x20\x20font-family:\x20var(--mono-serif);\x0a\x20\x20\x20\x20font-size:\x201.4rem;\x0a\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20margin-bottom:\x2010px;\x0a\x20\x20\x20\x20color:\x20var(--text-accent);\x0a}\x0a.traffic-bar-container\x20{\x0a\x20\x20\x20\x20height:\x2010px;\x0a\x20\x20\x20\x20background-color:\x20var(--background-tertiary);\x0a\x20\x20\x20\x20border-radius:\x205px;\x0a\x20\x20\x20\x20overflow:\x20hidden;\x0a\x20\x20\x20\x20margin:\x200\x2010px;\x0a\x20\x20\x20\x20border:\x201px\x20solid\x20var(--border-color);\x0a}\x0a.traffic-bar\x20{\x0a\x20\x20\x20\x20height:\x20100%;\x0a\x20\x20\x20\x20background-color:\x20var(--accent-primary);\x0a\x20\x20\x20\x20transition:\x20width\x200.5s\x20ease;\x0a}\x0a.footer\x20{\x0a\x20\x20\x20\x20text-align:\x20center;\x0a\x20\x20\x20\x20padding:\x2020px\x200\x2010px;\x0a\x20\x20\x20\x20font-size:\x200.8rem;\x0a\x20\x20\x20\x20color:\x20var(--text-secondary);\x0a}\x0a.footer\x20p:first-child\x20{\x20margin-bottom:\x205px;\x20}\x0a@media\x20(max-width:\x20768px)\x20{\x0a\x20\x20\x20\x20body\x20{\x20padding:\x201rem;\x20}\x0a\x20\x20\x20\x20.top-grid,\x20.network-grid\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20grid-template-columns:\x201fr;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.config-content\x20pre\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20font-size:\x2010px;\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20.client-buttons\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20grid-template-columns:\x201fr;\x0a\x20\x20\x20\x20}\x0a}\x0a/*\x20Network\x20Info\x20Badges\x20*/\x0a.badge\x20{\x0a\x20\x20\x20\x20display:\x20inline-block;\x0a\x20\x20\x20\x20padding:\x203px\x208px;\x0a\x20\x20\x20\x20border-radius:\x204px;\x0a\x20\x20\x20\x20font-size:\x200.8rem;\x0a\x20\x20\x20\x20font-weight:\x20600;\x0a}\x0a.badge-yes\x20{\x20background-color:\x20rgba(112,\x20181,\x20112,\x200.2);\x20color:\x20var(--status-success);\x20}\x0a.badge-no\x20{\x20background-color:\x20rgba(224,\x2093,\x2068,\x200.2);\x20color:\x20var(--status-error);\x20}\x0a.badge-warning\x20{\x20background-color:\x20rgba(224,\x20188,\x2068,\x200.2);\x20color:\x20var(--status-warning);\x20}\x0a.badge-neutral\x20{\x20background-color:\x20rgba(179,\x20168,\x20157,\x200.2);\x20color:\x20var(--text-secondary);\x20}\x0a.country-flag\x20{\x0a\x20\x20\x20\x20margin-right:\x205px;\x0a\x20\x20\x20\x20border-radius:\x202px;\x0a\x20\x20\x20\x20vertical-align:\x20middle;\x0a}\x0a/*\x20Skeleton\x20Loading\x20*/\x0a.skeleton\x20{\x0a\x20\x20\x20\x20display:\x20inline-block;\x0a\x20\x20\x20\x20height:\x201em;\x0a\x20\x20\x20\x20width:\x2080px;\x0a\x20\x20\x20\x20background-color:\x20var(--background-tertiary);\x0a\x20\x20\x20\x20border-radius:\x204px;\x0a\x20\x20\x20\x20animation:\x20pulse\x201.5s\x20infinite\x20ease-in-out;\x0a}\x0a@keyframes\x20pulse\x20{\x0a\x20\x20\x20\x200%\x20{\x20opacity:\x200.4;\x20}\x0a\x20\x20\x20\x2050%\x20{\x20opacity:\x200.8;\x20}\x0a\x20\x20\x20\x20100%\x20{\x20opacity:\x200.4;\x20}\x0a}\x0a.network-info-grid\x20.skeleton\x20{\x0a\x20\x20\x20\x20float:\x20right;\x0a\x20\x20\x20\x20margin-top:\x200.3em;\x0a}\x0a',configPageJS='\x0afunction\x20bytesToReadable(bytes\x20=\x200)\x20{\x0a\x20\x20if\x20(!bytes)\x20return\x20\x270\x20Bytes\x27;\x0a\x20\x20const\x20units\x20=\x20[\x27Bytes\x27,\x20\x27KB\x27,\x20\x27MB\x27,\x20\x27GB\x27,\x20\x27TB\x27];\x0a\x20\x20const\x20i\x20=\x20Math.floor(Math.log(bytes)\x20/\x20Math.log(1024));\x0a\x20\x20return\x20`${parseFloat((bytes\x20/\x20(1024\x20**\x20i)).toFixed(2))}\x20${units[i]}`;\x0a}\x0a\x0afunction\x20updateIpApiIoDisplay(geo,\x20prefix,\x20originalHost)\x20{\x0a\x20\x20const\x20hostElement\x20=\x20document.getElementById(`${prefix}-host`);\x0a\x20\x20if\x20(hostElement)\x20hostElement.textContent\x20=\x20originalHost\x20||\x20\x22N/A\x22;\x0a\x20\x20\x0a\x20\x20const\x20elements\x20=\x20{\x0a\x20\x20\x20\x20ip:\x20document.getElementById(`${prefix}-ip`),\x0a\x20\x20\x20\x20location:\x20document.getElementById(`${prefix}-location`),\x0a\x20\x20\x20\x20isp:\x20document.getElementById(`${prefix}-isp`)\x0a\x20\x20};\x0a\x20\x20\x0a\x20\x20if\x20(!geo\x20||\x20geo.status\x20===\x20\x27fail\x27)\x20{\x0a\x20\x20\x20\x20Object.values(elements).forEach(el\x20=>\x20{\x20if(el)\x20el.innerHTML\x20=\x20\x22N/A\x22;\x20});\x0a\x20\x20\x20\x20return;\x0a\x20\x20}\x0a\x20\x20\x0a\x20\x20if\x20(elements.ip)\x20elements.ip.textContent\x20=\x20geo.query\x20||\x20geo.ip\x20||\x20\x22N/A\x22;\x0a\x20\x20\x0a\x20\x20if\x20(elements.location)\x20{\x0a\x20\x20\x20\x20const\x20city\x20=\x20geo.city\x20||\x20\x27\x27;\x0a\x20\x20\x20\x20const\x20countryName\x20=\x20geo.country\x20||\x20\x27\x27;\x0a\x20\x20\x20\x20const\x20countryCode\x20=\x20geo.countryCode\x20?\x20geo.countryCode.toLowerCase()\x20:\x20\x27\x27;\x0a\x20\x20\x20\x20let\x20flagElementHtml\x20=\x20countryCode\x20?\x20`<img\x20src=\x22https://flagcdn.com/w20/${countryCode}.png\x22\x20srcset=\x22https://flagcdn.com/w40/${countryCode}.png\x202x\x22\x20alt=\x22${geo.countryCode}\x22\x20class=\x22country-flag\x22>\x20`\x20:\x20\x27\x27;\x0a\x20\x20\x20\x20let\x20textPart\x20=\x20[city,\x20countryName].filter(Boolean).join(\x27,\x20\x27);\x0a\x20\x20\x20\x20elements.location.innerHTML\x20=\x20(flagElementHtml\x20||\x20textPart)\x20?\x20`${flagElementHtml}${textPart}`.trim()\x20:\x20\x22N/A\x22;\x0a\x20\x20}\x0a\x20\x20\x0a\x20\x20if\x20(elements.isp)\x20elements.isp.textContent\x20=\x20geo.isp\x20||\x20geo.org\x20||\x20geo.as\x20||\x20\x27N/A\x27;\x0a}\x0a\x0afunction\x20updateScamalyticsClientDisplay(data)\x20{\x0a\x20\x20const\x20prefix\x20=\x20\x27client\x27;\x0a\x20\x20const\x20elements\x20=\x20{\x0a\x20\x20\x20\x20ip:\x20document.getElementById(`${prefix}-ip`),\x0a\x20\x20\x20\x20location:\x20document.getElementById(`${prefix}-location`),\x0a\x20\x20\x20\x20isp:\x20document.getElementById(`${prefix}-isp`),\x0a\x20\x20\x20\x20proxy:\x20document.getElementById(`${prefix}-proxy`)\x0a\x20\x20};\x0a\x20\x20\x0a\x20\x20if\x20(!data\x20||\x20!data.scamalytics\x20||\x20data.scamalytics.status\x20!==\x20\x27ok\x27)\x20{\x0a\x20\x20\x20\x20const\x20errorMsg\x20=\x20(data\x20&&\x20data.scamalytics\x20&&\x20data.scamalytics.error)\x20||\x20\x27Data\x20Unavailable\x27;\x0a\x20\x20\x20\x20Object.values(elements).forEach(el\x20=>\x20{\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20if(el\x20&&\x20el.id\x20!==\x20\x27client-proxy\x27)\x20el.innerHTML\x20=\x20\x22N/A\x22;\x20\x0a\x20\x20\x20\x20\x20\x20\x20\x20else\x20if\x20(el)\x20el.innerHTML\x20=\x20`<span\x20class=\x22badge\x20badge-neutral\x22>${errorMsg}</span>`;\x0a\x20\x20\x20\x20});\x0a\x20\x20\x20\x20console.warn(`Client\x20data\x20loading\x20failed:\x20${errorMsg}`);\x0a\x20\x20\x20\x20return;\x0a\x20\x20}\x0a\x20\x20\x0a\x20\x20const\x20sa\x20=\x20data.scamalytics;\x0a\x20\x20const\x20dbip\x20=\x20data.external_datasources?.dbip;\x0a\x20\x20\x0a\x20\x20if\x20(elements.ip)\x20elements.ip.textContent\x20=\x20sa.ip\x20||\x20\x22N/A\x22;\x0a\x20\x20\x0a\x20\x20if\x20(elements.location)\x20{\x0a\x20\x20\x20\x20const\x20city\x20=\x20dbip?.ip_city\x20||\x20\x27\x27;\x0a\x20\x20\x20\x20const\x20countryName\x20=\x20dbip?.ip_country_name\x20||\x20\x27\x27;\x0a\x20\x20\x20\x20const\x20countryCode\x20=\x20dbip?.ip_country_code\x20?\x20dbip.ip_country_code.toLowerCase()\x20:\x20\x27\x27;\x0a\x20\x20\x20\x20let\x20locationString\x20=\x20\x27N/A\x27;\x0a\x20\x20\x20\x20let\x20flagElementHtml\x20=\x20countryCode\x20?\x20`<img\x20src=\x22https://flagcdn.com/w20/${countryCode}.png\x22\x20srcset=\x22https://flagcdn.com/w40/${countryCode}.png\x202x\x22\x20alt=\x22${dbip.ip_country_code}\x22\x20class=\x22country-flag\x22>\x20`\x20:\x20\x27\x27;\x0a\x20\x20\x20\x20let\x20textPart\x20=\x20[city,\x20countryName].filter(Boolean).join(\x27,\x20\x27);\x0a\x20\x20\x20\x20if\x20(flagElementHtml\x20||\x20textPart)\x20locationString\x20=\x20`${flagElementHtml}${textPart}`.trim();\x0a\x20\x20\x20\x20elements.location.innerHTML\x20=\x20locationString\x20||\x20\x22N/A\x22;\x0a\x20\x20}\x0a\x20\x20\x0a\x20\x20if\x20(elements.isp)\x20elements.isp.textContent\x20=\x20sa.scamalytics_isp\x20||\x20dbip?.isp_name\x20||\x20\x22N/A\x22;\x0a\x20\x20\x0a\x20\x20if\x20(elements.proxy)\x20{\x0a\x20\x20\x20\x20const\x20score\x20=\x20sa.scamalytics_score;\x0a\x20\x20\x20\x20const\x20risk\x20=\x20sa.scamalytics_risk;\x0a\x20\x20\x20\x20let\x20riskText\x20=\x20\x22Unknown\x22;\x0a\x20\x20\x20\x20let\x20badgeClass\x20=\x20\x22badge-neutral\x22;\x0a\x20\x20\x20\x20\x0a\x20\x20\x20\x20if\x20(risk\x20&&\x20score\x20!==\x20undefined)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20riskText\x20=\x20`${score}\x20-\x20${risk.charAt(0).toUpperCase()\x20+\x20risk.slice(1)}`;\x0a\x20\x20\x20\x20\x20\x20\x20\x20switch\x20(risk.toLowerCase())\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20case\x20\x22low\x22:\x20badgeClass\x20=\x20\x22badge-yes\x22;\x20break;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20case\x20\x22medium\x22:\x20badgeClass\x20=\x20\x22badge-warning\x22;\x20break;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20case\x20\x22high\x22:\x20case\x20\x22very\x20high\x22:\x20badgeClass\x20=\x20\x22badge-no\x22;\x20break;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20default:\x20badgeClass\x20=\x20\x22badge-neutral\x22;\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20elements.proxy.innerHTML\x20=\x20`<span\x20class=\x22badge\x20${badgeClass}\x22>${riskText}</span>`;\x0a\x20\x20}\x0a}\x0a\x0aasync\x20function\x20fetchIpApiIoInfo(ip)\x20{\x0a\x20\x20try\x20{\x0a\x20\x20\x20\x20const\x20response\x20=\x20await\x20fetch(`https://ip-api.io/json/${ip}`);\x0a\x20\x20\x20\x20if\x20(!response.ok)\x20throw\x20new\x20Error(`HTTP\x20error!\x20status:\x20${response.status}`);\x0a\x20\x20\x20\x20return\x20await\x20response.json();\x0a\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20console.error(\x27IP\x20API\x20Error\x20(ip-api.io):\x27,\x20error);\x0a\x20\x20\x20\x20return\x20null;\x0a\x20\x20}\x0a}\x0a\x0aasync\x20function\x20fetchClientPublicIP()\x20{\x0a\x20\x20try\x20{\x0a\x20\x20\x20\x20const\x20response\x20=\x20await\x20fetch(\x27https://api.ipify.org?format=json\x27);\x0a\x20\x20\x20\x20if\x20(!response.ok)\x20throw\x20new\x20Error(`HTTP\x20error!\x20status:\x20${response.status}`);\x0a\x20\x20\x20\x20return\x20(await\x20response.json()).ip;\x0a\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20console.error(\x27Error\x20fetching\x20client\x20IP:\x27,\x20error);\x0a\x20\x20\x20\x20return\x20null;\x0a\x20\x20}\x0a}\x0a\x0aasync\x20function\x20fetchScamalyticsClientInfo(clientIp)\x20{\x0a\x20\x20if\x20(!clientIp)\x20return\x20null;\x0a\x20\x20try\x20{\x0a\x20\x20\x20\x20//\x20Request\x20is\x20proxied\x20through\x20the\x20worker\x27s\x20/scamalytics-lookup\x20endpoint\x0a\x20\x20\x20\x20const\x20response\x20=\x20await\x20fetch(`/scamalytics-lookup?ip=${encodeURIComponent(clientIp)}`);\x0a\x20\x20\x20\x20if\x20(!response.ok)\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20errorData\x20=\x20await\x20response.json().catch(()\x20=>\x20({\x20error:\x20\x27Unknown\x20Worker\x20Error\x27\x20}));\x0a\x20\x20\x20\x20\x20\x20throw\x20new\x20Error(errorData.error\x20||\x20`Worker\x20request\x20failed!\x20status:\x20${response.status}`);\x0a\x20\x20\x20\x20}\x0a\x20\x20\x20\x20const\x20data\x20=\x20await\x20response.json();\x0a\x20\x20\x20\x20return\x20data;\x0a\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20console.error(\x27Error\x20fetching\x20from\x20Scamalytics\x20via\x20Worker:\x27,\x20error);\x0a\x20\x20\x20\x20//\x20Return\x20partial\x20data\x20structure\x20to\x20allow\x20error\x20display\x0a\x20\x20\x20\x20return\x20{\x20scamalytics:\x20{\x20status:\x20\x27error\x27,\x20error:\x20error.message\x20}\x20};\x0a\x20\x20}\x0a}\x0a\x0afunction\x20displayExpirationTimes()\x20{\x0a\x20\x20const\x20expElement\x20=\x20document.getElementById(\x27expiration-display\x27);\x0a\x20\x20const\x20relativeElement\x20=\x20document.getElementById(\x27expiration-relative\x27);\x0a\x0a\x20\x20if\x20(!expElement\x20||\x20!expElement.dataset.utcTime)\x20{\x0a\x20\x20\x20\x20\x20\x20if\x20(expElement)\x20expElement.textContent\x20=\x20\x27Expiration\x20time\x20not\x20available.\x27;\x0a\x20\x20\x20\x20\x20\x20if\x20(relativeElement)\x20relativeElement.style.display\x20=\x20\x27none\x27;\x0a\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20}\x0a\x0a\x20\x20const\x20utcTimestamp\x20=\x20expElement.dataset.utcTime;\x0a\x20\x20if\x20(!utcTimestamp)\x20return;\x0a\x0a\x20\x20const\x20utcDate\x20=\x20new\x20Date(utcTimestamp);\x0a\x20\x20if\x20(isNaN(utcDate.getTime()))\x20{\x0a\x20\x20\x20\x20\x20\x20expElement.textContent\x20=\x20\x27Invalid\x20expiration\x20time\x20format.\x27;\x0a\x20\x20\x20\x20\x20\x20if\x20(relativeElement)\x20relativeElement.style.display\x20=\x20\x27none\x27;\x0a\x20\x20\x20\x20\x20\x20return;\x0a\x20\x20}\x0a\x20\x20\x0a\x20\x20//\x20---\x20START:\x20Relative\x20Time\x20Calculation\x20---\x0a\x20\x20const\x20now\x20=\x20new\x20Date();\x0a\x20\x20const\x20diffSeconds\x20=\x20(utcDate.getTime()\x20-\x20now.getTime())\x20/\x201000;\x0a\x20\x20const\x20isExpired\x20=\x20diffSeconds\x20<\x200;\x0a\x0a\x20\x20const\x20rtf\x20=\x20new\x20Intl.RelativeTimeFormat(\x27en\x27,\x20{\x20numeric:\x20\x27auto\x27\x20});\x0a\x20\x20let\x20relativeTimeStr\x20=\x20\x27just\x20now\x27;\x0a\x0a\x20\x20if\x20(Math.abs(diffSeconds)\x20>=\x2086400)\x20{\x0a\x20\x20\x20\x20\x20\x20relativeTimeStr\x20=\x20rtf.format(Math.round(diffSeconds\x20/\x2086400),\x20\x27day\x27);\x0a\x20\x20}\x20else\x20if\x20(Math.abs(diffSeconds)\x20>=\x203600)\x20{\x0a\x20\x20\x20\x20\x20\x20relativeTimeStr\x20=\x20rtf.format(Math.round(diffSeconds\x20/\x203600),\x20\x27hour\x27);\x0a\x20\x20}\x20else\x20if\x20(Math.abs(diffSeconds)\x20>=\x2060)\x20{\x0a\x20\x20\x20\x20\x20\x20relativeTimeStr\x20=\x20rtf.format(Math.round(diffSeconds\x20/\x2060),\x20\x27minute\x27);\x0a\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20relativeTimeStr\x20=\x20rtf.format(Math.round(diffSeconds),\x20\x27second\x27);\x0a\x20\x20}\x0a\x0a\x20\x20if\x20(relativeElement)\x20{\x0a\x20\x20\x20\x20\x20\x20relativeElement.textContent\x20=\x20isExpired\x20?\x20`Expired\x20${relativeTimeStr}`\x20:\x20`Expires\x20${relativeTimeStr}`;\x0a\x20\x20\x20\x20\x20\x20relativeElement.classList.remove(\x27active\x27,\x20\x27expired\x27);\x0a\x20\x20\x20\x20\x20\x20relativeElement.classList.add(isExpired\x20?\x20\x27expired\x27\x20:\x20\x27active\x27);\x0a\x20\x20\x20\x20\x20\x20relativeElement.style.display\x20=\x20\x27block\x27;\x0a\x20\x20}\x0a\x20\x20//\x20---\x20END:\x20Relative\x20Time\x20Calculation\x20---\x0a\x0a\x20\x20const\x20commonOptions\x20=\x20{\x0a\x20\x20\x20\x20\x20\x20year:\x20\x27numeric\x27,\x20month:\x20\x27long\x27,\x20day:\x20\x27numeric\x27,\x0a\x20\x20\x20\x20\x20\x20hour:\x20\x272-digit\x27,\x20minute:\x20\x272-digit\x27,\x20second:\x20\x272-digit\x27,\x0a\x20\x20\x20\x20\x20\x20hour12:\x20true\x0a\x20\x20};\x0a\x0a\x20\x20const\x20localTimeStr\x20=\x20utcDate.toLocaleString(undefined,\x20{\x20...commonOptions,\x20timeZoneName:\x20\x27short\x27\x20});\x0a\x20\x20const\x20tehranTimeStr\x20=\x20utcDate.toLocaleString(\x27en-US\x27,\x20{\x20...commonOptions,\x20timeZone:\x20\x27Asia/Tehran\x27,\x20timeZoneName:\x20\x27short\x27\x20});\x0a\x20\x20const\x20utcTimeStr\x20=\x20utcDate.toISOString().replace(\x27T\x27,\x20\x27\x20\x27).substring(0,\x2019)\x20+\x20\x27\x20UTC\x27;\x0a\x0a\x20\x20expElement.innerHTML\x20=\x20`\x0a\x20\x20\x20\x20<span><strong>Your\x20Local\x20Time:</strong>\x20${localTimeStr}</span>\x0a\x20\x20\x20\x20<span><strong>Tehran\x20Time:</strong>\x20${tehranTimeStr}</span>\x0a\x20\x20\x20\x20<span><strong>Universal\x20Time:</strong>\x20${utcTimeStr}</span>\x0a\x20\x20`;\x0a}\x0a\x0a\x0aasync\x20function\x20loadNetworkInfo()\x20{\x0a\x20\x20//\x20Clear\x20all\x20previous\x20data/skeletons\x0a\x20\x20const\x20proxyIpWithPort\x20=\x20document.body.getAttribute(\x27data-proxy-ip\x27)\x20||\x20\x22N/A\x22;\x0a\x20\x20const\x20proxyDomainOrIp\x20=\x20proxyIpWithPort.split(\x27:\x27)[0];\x0a\x20\x20const\x20skeleton\x20=\x20\x27<span\x20class=\x22skeleton\x22></span>\x27;\x0a\x20\x20\x0a\x20\x20const\x20placeholders\x20=\x20[\x27proxy-host\x27,\x20\x27proxy-ip\x27,\x20\x27proxy-location\x27,\x20\x27proxy-isp\x27,\x20\x27client-ip\x27,\x20\x27client-location\x27,\x20\x27client-isp\x27,\x20\x27client-proxy\x27];\x0a\x20\x20placeholders.forEach(id\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20el\x20=\x20document.getElementById(id);\x0a\x20\x20\x20\x20\x20\x20if\x20(el)\x20el.innerHTML\x20=\x20id\x20===\x20\x27proxy-host\x27\x20?\x20proxyIpWithPort\x20:\x20skeleton;\x0a\x20\x20});\x0a\x0a\x20\x20try\x20{\x0a\x20\x20\x20\x20//\x20---\x20Proxy\x20Server\x20Info\x20---\x0a\x20\x20\x20\x20if\x20(proxyDomainOrIp\x20&&\x20proxyDomainOrIp\x20!==\x20\x22N/A\x22)\x20{\x0a\x20\x20\x20\x20\x20\x20let\x20resolvedProxyIp\x20=\x20proxyDomainOrIp;\x0a\x20\x20\x20\x20\x20\x20//\x20Simple\x20DNS\x20resolution\x20for\x20domain\x20names\x0a\x20\x20\x20\x20\x20\x20if\x20(!/^\x5cd{1,3}\x5c.\x5cd{1,3}\x5c.\x5cd{1,3}\x5c.\x5cd{1,3}$/.test(proxyDomainOrIp)\x20&&\x20!/^[0-9a-fA-F:]+$/.test(proxyDomainOrIp))\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20dnsRes\x20=\x20await\x20fetch(`https://dns.google/resolve?name=${encodeURIComponent(proxyDomainOrIp)}&type=A`);\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(dnsRes.ok)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20dnsData\x20=\x20await\x20dnsRes.json();\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20const\x20ipAnswer\x20=\x20dnsData.Answer?.find(a\x20=>\x20a.type\x20===\x201);\x20//\x20A\x20record\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20if\x20(ipAnswer)\x20resolvedProxyIp\x20=\x20ipAnswer.data;\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20\x20\x20}\x20catch\x20(e)\x20{\x20console.error(\x27DNS\x20resolution\x20for\x20proxy\x20failed:\x27,\x20e);\x20}\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20\x20\x20const\x20proxyGeoData\x20=\x20await\x20fetchIpApiIoInfo(resolvedProxyIp);\x0a\x20\x20\x20\x20\x20\x20updateIpApiIoDisplay(proxyGeoData,\x20\x27proxy\x27,\x20proxyIpWithPort);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20updateIpApiIoDisplay(null,\x20\x27proxy\x27,\x20proxyIpWithPort);\x0a\x20\x20\x20\x20}\x0a\x0a\x20\x20\x20\x20//\x20---\x20Client\x20Connection\x20Info\x20---\x0a\x20\x20\x20\x20const\x20clientIp\x20=\x20await\x20fetchClientPublicIP();\x0a\x20\x20\x20\x20if\x20(clientIp)\x20{\x0a\x20\x20\x20\x20\x20\x20document.getElementById(\x27client-ip\x27).textContent\x20=\x20clientIp;\x0a\x20\x20\x20\x20\x20\x20const\x20scamalyticsData\x20=\x20await\x20fetchScamalyticsClientInfo(clientIp);\x0a\x20\x20\x20\x20\x20\x20updateScamalyticsClientDisplay(scamalyticsData);\x0a\x20\x20\x20\x20}\x20else\x20{\x0a\x20\x20\x20\x20\x20\x20updateScamalyticsClientDisplay(null);\x0a\x20\x20\x20\x20}\x0a\x20\x20}\x20catch\x20(error)\x20{\x0a\x20\x20\x20\x20console.error(\x27Overall\x20network\x20info\x20loading\x20failed:\x27,\x20error);\x0a\x20\x20\x20\x20//\x20Ensure\x20all\x20placeholders\x20show\x20error\x20state\x0a\x20\x20\x20\x20updateIpApiIoDisplay(null,\x20\x27proxy\x27,\x20proxyIpWithPort);\x0a\x20\x20\x20\x20updateScamalyticsClientDisplay(null);\x0a\x20\x20}\x0a}\x0a\x0adocument.addEventListener(\x27DOMContentLoaded\x27,\x20()\x20=>\x20{\x0a\x20\x20//\x20---\x20Initial\x20Loads\x20---\x0a\x20\x20displayExpirationTimes();\x0a\x20\x20loadNetworkInfo();\x0a\x20\x20\x0a\x20\x20//\x20---\x20Event\x20Listeners\x20---\x0a\x20\x20document.getElementById(\x27refresh-ip-info\x27).addEventListener(\x27click\x27,\x20loadNetworkInfo);\x0a\x0a\x20\x20//\x20Copy\x20buttons\x0a\x20\x20document.querySelectorAll(\x27.copy-btn\x27).forEach(btn\x20=>\x20{\x0a\x20\x20\x20\x20btn.addEventListener(\x27click\x27,\x20async\x20()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20textToCopy\x20=\x20btn.getAttribute(\x27data-clipboard-text\x27);\x0a\x20\x20\x20\x20\x20\x20try\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20await\x20navigator.clipboard.writeText(textToCopy);\x0a\x20\x20\x20\x20\x20\x20\x20\x20const\x20originalText\x20=\x20btn.textContent;\x0a\x20\x20\x20\x20\x20\x20\x20\x20btn.textContent\x20=\x20\x27Copied!\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20setTimeout(()\x20=>\x20{\x20btn.textContent\x20=\x20originalText;\x20},\x201500);\x0a\x20\x20\x20\x20\x20\x20}\x20catch\x20(err)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20console.error(\x27Failed\x20to\x20copy\x20text:\x27,\x20err);\x0a\x20\x20\x20\x20\x20\x20\x20\x20alert(\x27Failed\x20to\x20copy\x20text.\x20Please\x20copy\x20manually.\x27);\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20});\x0a\x20\x20});\x0a\x0a\x20\x20//\x20QR\x20Code\x20buttons\x0a\x20\x20document.querySelectorAll(\x27[data-qr-target]\x27).forEach(btn\x20=>\x20{\x0a\x20\x20\x20\x20btn.addEventListener(\x27click\x27,\x20()\x20=>\x20{\x0a\x20\x20\x20\x20\x20\x20const\x20target\x20=\x20btn.getAttribute(\x27data-qr-target\x27);\x0a\x20\x20\x20\x20\x20\x20const\x20url\x20=\x20btn.getAttribute(\x27data-qr-url\x27);\x0a\x20\x20\x20\x20\x20\x20const\x20container\x20=\x20document.getElementById(`qr-${target}-container`);\x0a\x20\x20\x20\x20\x20\x20const\x20qrDiv\x20=\x20document.getElementById(`qr-${target}`);\x0a\x0a\x20\x20\x20\x20\x20\x20//\x20Toggle\x20display\x0a\x20\x20\x20\x20\x20\x20const\x20isVisible\x20=\x20container.classList.contains(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20document.querySelectorAll(\x27.qr-container\x27).forEach(c\x20=>\x20c.classList.remove(\x27show\x27));\x0a\x20\x20\x20\x20\x20\x20\x0a\x20\x20\x20\x20\x20\x20if\x20(!isVisible)\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20qrDiv.innerHTML\x20=\x20\x27\x27;\x0a\x20\x20\x20\x20\x20\x20\x20\x20new\x20QRCode(qrDiv,\x20{\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20text:\x20url,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20width:\x20200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20height:\x20200,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20colorDark\x20:\x20\x22#000000\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20colorLight\x20:\x20\x22#ffffff\x22,\x0a\x20\x20\x20\x20\x20\x20\x20\x20\x20\x20correctLevel\x20:\x20QRCode.CorrectLevel.H\x0a\x20\x20\x20\x20\x20\x20\x20\x20});\x0a\x20\x20\x20\x20\x20\x20\x20\x20container.classList.add(\x27show\x27);\x0a\x20\x20\x20\x20\x20\x20}\x0a\x20\x20\x20\x20});\x0a\x20\x20});\x0a});\x0a';function handleConfigPage(a,b,c,d){const e=d['expiration_date'],f=d['expiration_time'],g=Number(d['data_usage']||0x0),h=Number(d['data_limit']||0x0),i=h>0x0,j=i?Math['min'](0x64,g/h*0x64):0x0,k=e+'T'+f['split']('.')[0x0]+'Z',l='https://'+b+'/xray/'+a,m='https://'+b+'/sb/'+a,n=buildLink({'core':'xray','proto':'tls','userID':a,'hostName':b,'address':b,'port':0x1bb,'tag':b+'-Xray'}),o={'universalAndroid':'v2rayng://install-config?url='+encodeURIComponent(l),'karing':'karing://install-config?url='+encodeURIComponent(l),'shadowrocket':'shadowrocket://add/sub?url='+encodeURIComponent(l)+'&name='+encodeURIComponent(b),'stash':'stash://install-config?url='+encodeURIComponent(l),'streisand':'streisand://import/'+btoa(l),'clashMeta':'clash://install-config?url='+encodeURIComponent('https://revil-sub.pages.dev/sub/clash-meta?url='+m+'&remote_config=&udp=false&ss_uot=false&show_host=false&forced_ws0rtt=true')},p='<!doctype\x20html>\x0a<html\x20lang=\x22en\x22>\x0a<head>\x0a<meta\x20charset=\x22UTF-8\x22\x20/>\x0a<meta\x20name=\x22viewport\x22\x20content=\x22width=device-width,\x20initial-scale=1.0\x22\x20/>\x0a<title>VLESS\x20Proxy\x20Configuration</title>\x0a<link\x20rel=\x22icon\x22\x20href=\x22https://raw.githubusercontent.com/NiREvil/zizifn/refs/heads/Legacy/assets/favicon.png\x22\x20type=\x22image/png\x22>\x0a<link\x20rel=\x22preconnect\x22\x20href=\x22https://fonts.googleapis.com\x22>\x0a<link\x20rel=\x22preconnect\x22\x20href=\x22https://fonts.gstatic.com\x22\x20crossorigin>\x0a<link\x20href=\x22https://fonts.googleapis.com/css2?family=Fira+Code:wght@300..700&display=swap\x22\x20rel=\x22stylesheet\x22>\x0a<script\x20src=\x22https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js\x22></script>\x0a<style>'+configPageCSS+'</style>\x0a</head>\x0a<body\x20data-proxy-ip=\x22'+c['proxyAddress']+'\x22>\x0a<div\x20class=\x22container\x22>\x0a<header\x20class=\x22header\x22>\x0a<h1>VLESS\x20Proxy\x20Configuration</h1>\x0a<p>User\x20ID:\x20'+a['substring'](0x0,0x8)+'...\x20|\x20Host:\x20'+b+'</p>\x0a</header>\x0a<section\x20class=\x22network-info-wrapper\x22>\x0a<div\x20class=\x22network-info-header\x22>\x0a<h2>Network\x20Information</h2>\x0a<button\x20class=\x22button\x20refresh-btn\x22\x20id=\x22refresh-ip-info\x22>Refresh</button>\x0a</div>\x0a<div\x20class=\x22network-grid\x22>\x0a<div\x20class=\x22network-card\x22>\x0a<h3\x20class=\x22network-title\x22>Proxy\x20Server\x20(Cloudflare\x20Edge)</h3>\x0a<div\x20class=\x22network-info-grid\x22>\x0a<div><strong>Proxy\x20Host</strong><span\x20id=\x22proxy-host\x22>'+c['proxyAddress']+'</span></div>\x0a<div><strong>IP\x20Address</strong><span\x20id=\x22proxy-ip\x22><span\x20class=\x22skeleton\x22></span></span></div>\x0a<div><strong>Location</strong><span\x20id=\x22proxy-location\x22><span\x20class=\x22skeleton\x22></span></span></div>\x0a<div><strong>ISP\x20Provider</strong><span\x20id=\x22proxy-isp\x22><span\x20class=\x22skeleton\x22></span></span></div>\x0a</div>\x0a</div>\x0a<div\x20class=\x22network-card\x22>\x0a<h3\x20class=\x22network-title\x22>Your\x20Connection\x20(Client)</h3>\x0a<div\x20class=\x22network-info-grid\x22>\x0a<div><strong>Your\x20IP</strong><span\x20id=\x22client-ip\x22><span\x20class=\x22skeleton\x22></span></span></div>\x0a<div><strong>Location</strong><span\x20id=\x22client-location\x22><span\x20class=\x22skeleton\x22></span></span></div>\x0a<div><strong>ISP\x20Provider</strong><span\x20id=\x22client-isp\x22><span\x20class=\x22skeleton\x22></span></span></div>\x0a<div><strong>Risk\x20Score</strong><span\x20id=\x22client-proxy\x22><span\x20class=\x22skeleton\x22></span></span></div>\x0a</div>\x0a</div>\x0a</div>\x0a</section>\x0a<section\x20class=\x22top-grid\x22>\x0a<div\x20class=\x22info-card\x20rainbow\x22>\x0a<div\x20class=\x22info-card-content\x22>\x0a<h2\x20class=\x22info-title\x22>Expiration\x20Date</h2>\x0a<div\x20id=\x22expiration-relative\x22\x20class=\x22info-relative-time\x22>Loading…</div>\x0a<div\x20id=\x22expiration-display\x22\x20data-utc-time=\x22'+k+'\x22\x20class=\x22info-time-grid\x22>\x0a<span><strong>Your\x20Local\x20Time:</strong><span\x20id=\x22local-time\x22>--</span></span>\x0a<span><strong>Tehran\x20Time:</strong><span\x20id=\x22tehran-time\x22>--</span></span>\x0a<span><strong>Universal\x20Time:</strong><span\x20id=\x22utc-time\x22>--</span></span>\x0a</div>\x0a</div>\x0a</div>\x0a<div\x20class=\x22info-card\x22>\x0a<div\x20class=\x22info-card-content\x22>\x0a<h2\x20class=\x22info-title\x22>Data\x20Usage</h2>\x0a<div\x20class=\x22data-usage-text\x22\x20id=\x22data-usage-display\x22\x20data-usage=\x22'+g+'\x22\x20data-limit=\x22'+h+'\x22>\x0a'+bytesToReadable(g)+'\x20/\x20'+(i?bytesToReadable(h):'&infin;')+'\x0a</div>\x0a<div\x20class=\x22traffic-bar-container\x22>\x0a<div\x20class=\x22traffic-bar\x22\x20style=\x22width:'+j+'%\x22></div>\x0a</div>\x0a</div>\x0a</div>\x0a</section>\x0a<section\x20class=\x22config-card\x22>\x0a<div\x20class=\x22config-title\x22>\x0a<span>Single\x20Xray\x20Config</span>\x0a<button\x20class=\x22button\x20copy-btn\x22\x20data-clipboard-text=\x22'+n+'\x22>Copy\x20Config</button>\x0a</div>\x0a<div\x20class=\x22config-content\x22>\x0a<pre\x20id=\x22xray-config\x22>'+n+'</pre>\x0a</div>\x0a</section>\x0a<section\x20class=\x22config-card\x22>\x0a<div\x20class=\x22config-title\x22>\x0a<span>Xray\x20Subscription</span>\x0a<button\x20id=\x22copy-xray-sub-btn\x22\x20class=\x22button\x20copy-btn\x22\x20data-clipboard-text=\x22'+l+'\x22>Copy\x20Link</button>\x0a</div>\x0a<div\x20class=\x22client-buttons\x22>\x0a<a\x20href=\x22'+o['universalAndroid']+'\x22\x20class=\x22client-btn\x22>Universal\x20Import\x20(V2rayNG,\x20etc.)</a>\x0a<a\x20href=\x22'+o['karing']+'\x22\x20class=\x22client-btn\x22>Import\x20to\x20Karing</a>\x0a<a\x20href=\x22'+o['shadowrocket']+'\x22\x20class=\x22client-btn\x22>Import\x20to\x20Shadowrocket</a>\x0a<a\x20href=\x22'+o['stash']+'\x22\x20class=\x22client-btn\x22>Import\x20to\x20Stash</a>\x0a<a\x20href=\x22'+o['streisand']+'\x22\x20class=\x22client-btn\x22>Import\x20to\x20Streisand</a>\x0a<button\x20class=\x22client-btn\x22\x20data-qr-target=\x22xray\x22\x20data-qr-url=\x22'+l+'\x22>Show\x20QR\x20Code</button>\x0a</div>\x0a<div\x20id=\x22qr-xray-container\x22\x20class=\x22qr-container\x22><div\x20id=\x22qr-xray\x22></div></div>\x0a</section>\x0a<section\x20class=\x22config-card\x22>\x0a<div\x20class=\x22config-title\x22>\x0a<span>Sing-Box\x20/\x20Clash\x20Subscription</span>\x0a<button\x20id=\x22copy-sb-sub-btn\x22\x20class=\x22button\x20copy-btn\x22\x20data-clipboard-text=\x22'+m+'\x22>Copy\x20Link</button>\x0a</div>\x0a<div\x20class=\x22client-buttons\x22>\x0a<a\x20href=\x22'+o['clashMeta']+'\x22\x20class=\x22client-btn\x22>Import\x20to\x20Clash\x20Meta\x20/\x20Stash</a>\x0a<button\x20class=\x22client-btn\x22\x20data-qr-target=\x22singbox\x22\x20data-qr-url=\x22'+m+'\x22>Show\x20QR\x20Code</button>\x0a</div>\x0a<div\x20id=\x22qr-singbox-container\x22\x20class=\x22qr-container\x22><div\x20id=\x22qr-singbox\x22></div></div>\x0a</section>\x0a<footer\x20class=\x22footer\x22>\x0a<p>©\x20<span\x20id=\x22current-year\x22>'+new Date()['getFullYear']()+'</span>\x20REvil\x20-\x20All\x20Rights\x20Reserved</p>\x0a<p>Secure.\x20Private.\x20Fast.</p>\x0a</footer>\x0a</div>\x0a<script>'+configPageJS+'</script>\x0a</body>\x0a</html>';return new Response(p,{'headers':{'Content-Type':'text/html;\x20charset=utf-8'}});}const worker={async 'fetch'(a,b,c){const d=new URL(a['url']),e=d['hostname'],f=Config['fromEnv'](b),{pathname:g}=d;if(g['startsWith'](f['adminPath'])){const i=await handleAdminRequest(a,b);if(i)return i;}if(g==='/scamalytics-lookup')return handleScamalyticsLookup(a,{...f,'USER_KV':b['USER_KV']});if(a['headers']['get']('Upgrade')==='websocket'&&a['headers']['get']('Sec-WebSocket-Protocol')?.['includes']('websocket')){const j=g['split']('/'),k=j[j['length']-0x1];if(isValidUUID(k)||k===f['userID']){const l=await getUserData(b,k),m=l?k:f['userID'];if(!l&&m!==f['userID'])return new Response('Unauthorized',{'status':0x191});const n=l||await getUserData(b,m);if(!n)return new Response('Unauthorized\x20(Default\x20user\x20not\x20configured)',{'status':0x191});if(isExpired(n['expiration_date'],n['expiration_time'])||!hasRemainingData(n))return new Response('Forbidden\x20(Expired\x20or\x20Data\x20Limit)',{'status':0x193});return ProtocolOverWSHandler(a,f,b,c);}}const h=g['match'](/^\/(xray|sb)\/([a-f0-9-]+)$/);if(h){const o=h[0x1],p=h[0x2],q=await getUserData(b,p);if(!q)return new Response('User\x20not\x20found',{'status':0x194});if(isExpired(q['expiration_date'],q['expiration_time'])||!hasRemainingData(q))return new Response('Forbidden\x20(Expired\x20or\x20Data\x20Limit)',{'status':0x193});return handleIpSubscription(o,p,e,b);}if(g['match'](/^\/[a-f0-9-]{36}$/i)||g==='/'){const r=g['replace'](/\//g,''),s=isValidUUID(r)?r:f['userID'],t=await getUserData(b,s);if(!t)return new Response('User\x20ID\x20not\x20found\x20or\x20default\x20UUID\x20is\x20missing.',{'status':0x194});return handleConfigPage(s,e,f,t);}if(f['rootProxyURL']){const u=new URL(f['rootProxyURL']);return a=new Request(a),a['headers']['set']('Host',u['host']),fetch(u['toString'](),a);}return new Response('Route\x20Not\x20Found\x20for\x20'+g,{'status':0x194});}};export default worker;